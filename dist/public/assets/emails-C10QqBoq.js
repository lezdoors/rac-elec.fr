import{c as ie,j as e,S as Je,r as i,B as x,O as g,I as R,a as sa,$ as Re,a1 as Le,a2 as Te,a3 as ze,a7 as Ie,a8 as ps,a9 as We,C as Na,e as os,m as z,at as ds,M as Ct,L as _,U as $e,o as ya,a0 as St,X as ea,au as At,aY as ba,aZ as Et,a_ as kt,av as wa,a$ as Dt,b0 as $t,ay as Rt,b1 as Lt,b2 as Tt,b3 as Ca,b4 as zt,b5 as It,aS as Ft,x as te,aX as Sa,u as Mt,q as ns,p as Ot,b6 as Pt,aO as ls}from"./index-DzUC1K2s.js";import{u as pa,I as fe,S as ms,n as xs,T as hs,A as qt,R as ja,o as us,M as _t}from"./admin-layout-CF7Sxr74.js";import{S as Vt,u as Bt,a as Ke}from"./use-auth-CUX4si_X.js";import{C as oe,a as Xe,b as Qe,d as de,c as Ut,e as Ht}from"./card-DoiIT_-u.js";import{T as Rs,a as Ls,b as ae,c as se}from"./tabs-BzDqAV8e.js";import{B as Y}from"./badge-BGla9RRG.js";import{I as Ds}from"./inbox-4jpYTd_O.js";import{T as Gt}from"./triangle-alert-DQB8su61.js";import{T as Kt,S as Aa}from"./trash-2-qoHR-gtO.js";import{S as Fe,a as Me,d as Oe,b as Pe,c as I}from"./select-Czt7zfJZ.js";import{S as $s}from"./switch-BRgOaUeY.js";import{P as Ea,a as ka,b as Da}from"./popover-BH7B49qa.js";import{S as Xs}from"./search-BWKYXEcd.js";import{F as ge}from"./file-text-DoHX98TB.js";import{C as Xt}from"./index-Bq2pZgA_.js";import{C as Qs}from"./checkbox-BDijVysM.js";import{S as Ws}from"./separator-CelyhW_N.js";import{T as Ee,a as ke,b as K,c as w,d as De,e as C}from"./table-CJPtoGCw.js";import{A as Es,a as ks}from"./avatar-kmD7OHE1.js";import{R as Qt}from"./refresh-cw-C6s3n-6C.js";import{P as Ys}from"./plus-BLrJPq2i.js";import{A as fa}from"./arrow-left-_ch1yvlX.js";import{E as Js}from"./eye-BjlrVMdT.js";import{I as Wt}from"./info-CXTf961x.js";import{C as Yt}from"./circle-x-6aDKeugn.js";import"./use-mobile-BvbQVf_v.js";import"./index-K_-G0cOR.js";import"./log-out-CiTIz7aR.js";import"./credit-card-DFqaA2CP.js";import"./users-B-R63lkw.js";import"./settings-DPiXBPnH.js";import"./index-BfYUpgx2.js";import"./external-link-DgBPVkbk.js";import"./index-DKjUHfQ5.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=ie("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=ie("CopyCheck",[["path",{d:"m12 15 2 2 4-4",key:"2c609p"}],["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zt=ie("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=ie("LayoutTemplate",[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"9",height:"7",x:"3",y:"14",rx:"1",key:"jqznyg"}],["rect",{width:"5",height:"7",x:"16",y:"14",rx:"1",key:"q5h2i8"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sr=ie("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=ie("MailX",[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h9",key:"1j9vog"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m17 17 4 4",key:"1b3523"}],["path",{d:"m21 17-4 4",key:"uinynz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=ie("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=ie("Signature",[["path",{d:"m21 17-2.156-1.868A.5.5 0 0 0 18 15.5v.5a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1c0-2.545-3.991-3.97-8.5-4a1 1 0 0 0 0 5c4.153 0 4.745-11.295 5.708-13.5a2.5 2.5 0 1 1 3.31 3.284",key:"y32ogt"}],["path",{d:"M3 21h18",key:"itz85i"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=ie("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=ie("UserRound",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]),ir=a=>{if(Array.isArray(a))return a.length===0?[{name:"Inconnu",address:""}]:a.map(c=>typeof c=="string"?{address:c}:typeof c=="object"&&c!==null?{name:c.name||void 0,address:c.address||c.email||""}:{name:"Inconnu",address:""});if(typeof a=="object"&&a!==null)return[{name:a.name||void 0,address:a.address||a.email||""}];if(typeof a=="string"){const c=a.match(/(.*)<(.*)>/);return c?[{name:c[1].trim(),address:c[2].trim()}]:[{address:a}]}return[{name:"Inconnu",address:""}]},nr=a=>{if(!a||!a.from)return"Inconnu";const c=ir(a.from);return c.length===0?"Inconnu":c[0].name&&c[0].name.trim()?c[0].name:c[0].address?c[0].address:"Inconnu"},lr=a=>a&&a.subject||"(Sans objet)";function cr({currentFolder:a,onFolderChange:c,userId:u=1}){const j=pa(u),f=pa(u);return e.jsx(Rs,{defaultValue:a,value:a,onValueChange:c,className:"w-full",children:e.jsxs(Ls,{className:"grid grid-cols-4 mb-4",children:[e.jsxs(ae,{value:fe,className:"flex items-center justify-center",children:[e.jsx(Ds,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Boîte de réception"}),e.jsx("span",{className:"inline sm:hidden",children:"Réception"}),j.unreadCount>0&&e.jsx(Y,{variant:"secondary",className:"ml-2",children:j.unreadCount})]}),e.jsxs(ae,{value:ms,className:"flex items-center justify-center",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Messages envoyés"}),e.jsx("span",{className:"inline sm:hidden",children:"Envoyés"})]}),e.jsxs(ae,{value:xs,className:"flex items-center justify-center",children:[e.jsx(Gt,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:"Spam"}),f.unreadCount>0&&e.jsx(Y,{variant:"secondary",className:"ml-2",children:f.unreadCount})]}),e.jsxs(ae,{value:hs,className:"flex items-center justify-center",children:[e.jsx(Kt,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Corbeille"}),e.jsx("span",{className:"inline sm:hidden",children:"Corbeille"})]})]})})}function va({value:a,onChange:c}){const[u,j]=i.useState(!1),[f,l]=i.useState(a||"#1e40af"),E=i.useRef(null),r=["#1e40af","#0ea5e9","#0f766e","#ef4444","#f97316","#84cc16","#6366f1","#8b5cf6","#ec4899","#000000","#71717a","#d4d4d8"];i.useEffect(()=>{a&&a!==f&&l(a)},[a]);const D=S=>{l(S),c(S),j(!1)},d=S=>{const F=S.target.value;l(F),c(F)};return e.jsxs(Ea,{open:u,onOpenChange:j,children:[e.jsx(ka,{asChild:!0,children:e.jsx(x,{variant:"outline",className:"w-10 h-10 p-0 border-2",style:{backgroundColor:f},onClick:()=>j(!0),children:e.jsx("span",{className:"sr-only",children:"Choisir une couleur"})})}),e.jsx(Da,{className:"w-64",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"current-color",children:"Couleur courante"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded border",style:{backgroundColor:f}}),e.jsx(R,{id:"current-color",ref:E,type:"text",value:f,onChange:d,className:"flex-1"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Couleurs prédéfinies"}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:r.map(S=>e.jsx("button",{className:`w-8 h-8 rounded-sm border ${f===S?"ring-2 ring-offset-2 ring-offset-white ring-primary":""}`,style:{backgroundColor:S},onClick:()=>D(S),type:"button"},S))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(x,{variant:"secondary",size:"sm",onClick:()=>{E.current&&(E.current.value="#1e40af",D("#1e40af"))},children:"Réinitialiser"}),e.jsx(x,{variant:"default",size:"sm",onClick:()=>{D(f)},children:"Appliquer"})]})]})})]})}function or({initialHtml:a="",onSave:c,onClose:u,isOpen:j}){const{toast:f}=sa();i.useEffect(()=>{a&&a.length>0&&console.log("HTML initial reçu",a.substring(0,50))},[a]);const[l,E]=i.useState({name:"Votre Nom",title:"Votre titre",company:"Raccordement Électrique",email:"votre.email@raccordement.fr",phone:"+33 6 12 34 56 78",website:"www.raccordement.fr",address:"123 Rue du Raccordement, 75000 Paris"}),[r,D]=i.useState({template:"modern",nameColor:"#1e40af",accentColor:"#3b82f6",fontSize:"medium",includeCompanyLogo:!0,includeSocialLinks:!0,includeAddress:!0,dividerStyle:"solid"}),[d,S]=i.useState({linkedin:"",twitter:"",facebook:""}),F=(h,V)=>{E({...l,[h]:V})},O=(h,V)=>{D({...r,[h]:V})},xe=(h,V)=>{S({...d,[h]:V})},J=()=>{const h={modern:`
        <div style="font-family: Arial, sans-serif; max-width: 500px; color: #333;">
          <table cellpadding="0" cellspacing="0" style="width: 100%;">
            <tr>
              <td style="padding-bottom: 10px;">
                <div style="font-size: ${r.fontSize==="small"?"18px":r.fontSize==="medium"?"20px":"22px"}; font-weight: bold; color: ${r.nameColor};">${l.name}</div>
                <div style="font-size: ${r.fontSize==="small"?"13px":r.fontSize==="medium"?"14px":"15px"}; color: #666;">${l.title}${l.company?` | ${l.company}`:""}</div>
              </td>
              ${r.includeCompanyLogo?`
              <td style="text-align: right;">
                <img src="https://placehold.co/100x50?text=Logo" alt="${l.company} Logo" style="max-width: 100px; height: auto;" />
              </td>
              `:""}
            </tr>
            <tr>
              <td colspan="2">
                <div style="border-top: 1px ${r.dividerStyle} ${r.accentColor}; margin: 10px 0;"></div>
              </td>
            </tr>
            <tr>
              <td colspan="2">
                <table cellpadding="0" cellspacing="0" style="width: 100%; font-size: ${r.fontSize==="small"?"12px":r.fontSize==="medium"?"13px":"14px"};">
                  <tr>
                    <td style="padding-right: 15px;">
                      <a href="mailto:${l.email}" style="color: ${r.accentColor}; text-decoration: none;">${l.email}</a>
                    </td>
                    <td>
                      <a href="tel:${l.phone}" style="color: ${r.accentColor}; text-decoration: none;">${l.phone}</a>
                    </td>
                  </tr>
                  ${l.website?`
                  <tr>
                    <td colspan="2" style="padding-top: 5px;">
                      <a href="https://${l.website}" style="color: ${r.accentColor}; text-decoration: none;">${l.website}</a>
                    </td>
                  </tr>
                  `:""}
                  ${r.includeAddress&&l.address?`
                  <tr>
                    <td colspan="2" style="padding-top: 5px; color: #666;">
                      ${l.address}
                    </td>
                  </tr>
                  `:""}
                </table>
              </td>
            </tr>
            ${r.includeSocialLinks&&(d.linkedin||d.twitter||d.facebook)?`
            <tr>
              <td colspan="2" style="padding-top: 10px;">
                <table cellpadding="0" cellspacing="0">
                  <tr>
                    ${d.linkedin?`
                    <td style="padding-right: 10px;">
                      <a href="${d.linkedin}" style="color: ${r.accentColor}; text-decoration: none;">LinkedIn</a>
                    </td>
                    `:""}
                    ${d.twitter?`
                    <td style="padding-right: 10px;">
                      <a href="${d.twitter}" style="color: ${r.accentColor}; text-decoration: none;">Twitter</a>
                    </td>
                    `:""}
                    ${d.facebook?`
                    <td>
                      <a href="${d.facebook}" style="color: ${r.accentColor}; text-decoration: none;">Facebook</a>
                    </td>
                    `:""}
                  </tr>
                </table>
              </td>
            </tr>
            `:""}
          </table>
        </div>
      `,classic:`
        <div style="font-family: 'Times New Roman', Times, serif; max-width: 500px; color: #333;">
          <table cellpadding="0" cellspacing="0" style="width: 100%;">
            <tr>
              <td style="padding-bottom: 10px;">
                <div style="font-size: ${r.fontSize==="small"?"18px":r.fontSize==="medium"?"20px":"22px"}; font-weight: bold; color: ${r.nameColor};">${l.name}</div>
                <div style="font-size: ${r.fontSize==="small"?"13px":r.fontSize==="medium"?"14px":"15px"}; font-style: italic; color: #666;">${l.title}${l.company?` | ${l.company}`:""}</div>
              </td>
            </tr>
            <tr>
              <td>
                <div style="border-top: 1px ${r.dividerStyle} ${r.accentColor}; margin: 10px 0;"></div>
              </td>
            </tr>
            <tr>
              <td>
                <table cellpadding="0" cellspacing="0" style="width: 100%; font-size: ${r.fontSize==="small"?"12px":r.fontSize==="medium"?"13px":"14px"};">
                  <tr>
                    <td width="70" style="color: #666;">Email:</td>
                    <td>
                      <a href="mailto:${l.email}" style="color: ${r.accentColor}; text-decoration: none;">${l.email}</a>
                    </td>
                  </tr>
                  <tr>
                    <td style="color: #666;">Téléphone:</td>
                    <td>
                      <a href="tel:${l.phone}" style="color: ${r.accentColor}; text-decoration: none;">${l.phone}</a>
                    </td>
                  </tr>
                  ${l.website?`
                  <tr>
                    <td style="color: #666;">Site web:</td>
                    <td>
                      <a href="https://${l.website}" style="color: ${r.accentColor}; text-decoration: none;">${l.website}</a>
                    </td>
                  </tr>
                  `:""}
                  ${r.includeAddress&&l.address?`
                  <tr>
                    <td style="color: #666;">Adresse:</td>
                    <td style="color: #333;">
                      ${l.address}
                    </td>
                  </tr>
                  `:""}
                </table>
              </td>
            </tr>
            ${r.includeSocialLinks&&(d.linkedin||d.twitter||d.facebook)?`
            <tr>
              <td style="padding-top: 10px;">
                <div style="font-size: ${r.fontSize==="small"?"11px":r.fontSize==="medium"?"12px":"13px"}; color: #666;">
                  Retrouvez-moi sur: 
                  ${d.linkedin?`<a href="${d.linkedin}" style="color: ${r.accentColor}; text-decoration: none;">LinkedIn</a>`:""}
                  ${d.linkedin&&(d.twitter||d.facebook)?" | ":""}
                  ${d.twitter?`<a href="${d.twitter}" style="color: ${r.accentColor}; text-decoration: none;">Twitter</a>`:""}
                  ${d.twitter&&d.facebook?" | ":""}
                  ${d.facebook?`<a href="${d.facebook}" style="color: ${r.accentColor}; text-decoration: none;">Facebook</a>`:""}
                </div>
              </td>
            </tr>
            `:""}
          </table>
        </div>
      `,compact:`
        <div style="font-family: Helvetica, Arial, sans-serif; max-width: 400px; color: #333;">
          <table cellpadding="0" cellspacing="0" style="width: 100%;">
            <tr>
              <td>
                <span style="font-weight: bold; color: ${r.nameColor};">${l.name}</span>
                <span style="color: #666; margin-left: 10px; font-size: ${r.fontSize==="small"?"12px":r.fontSize==="medium"?"13px":"14px"};">${l.title}</span>
              </td>
            </tr>
            <tr>
              <td>
                <div style="margin: 5px 0; font-size: ${r.fontSize==="small"?"12px":r.fontSize==="medium"?"13px":"14px"}; color: #666;">
                  <a href="mailto:${l.email}" style="color: ${r.accentColor}; text-decoration: none;">${l.email}</a>
                  <span style="margin: 0 5px;">|</span>
                  <a href="tel:${l.phone}" style="color: ${r.accentColor}; text-decoration: none;">${l.phone}</a>
                  ${l.website?`
                  <span style="margin: 0 5px;">|</span>
                  <a href="https://${l.website}" style="color: ${r.accentColor}; text-decoration: none;">${l.website}</a>
                  `:""}
                </div>
              </td>
            </tr>
            ${r.includeAddress&&l.address?`
            <tr>
              <td>
                <div style="font-size: ${r.fontSize==="small"?"11px":r.fontSize==="medium"?"12px":"13px"}; color: #777;">
                  ${l.address}
                </div>
              </td>
            </tr>
            `:""}
            ${r.includeSocialLinks&&(d.linkedin||d.twitter||d.facebook)?`
            <tr>
              <td style="padding-top: 5px;">
                <div style="font-size: ${r.fontSize==="small"?"11px":r.fontSize==="medium"?"12px":"13px"}; color: #777;">
                  ${d.linkedin?`<a href="${d.linkedin}" style="color: ${r.accentColor}; text-decoration: none;">LinkedIn</a>`:""}
                  ${d.linkedin&&(d.twitter||d.facebook)?" · ":""}
                  ${d.twitter?`<a href="${d.twitter}" style="color: ${r.accentColor}; text-decoration: none;">Twitter</a>`:""}
                  ${d.twitter&&d.facebook?" · ":""}
                  ${d.facebook?`<a href="${d.facebook}" style="color: ${r.accentColor}; text-decoration: none;">Facebook</a>`:""}
                </div>
              </td>
            </tr>
            `:""}
          </table>
        </div>
      `};return h[r.template]||h.modern},k=()=>{const h=J();c(h),f({title:"Signature enregistrée",description:"Votre signature a été enregistrée avec succès"})},$=()=>{const h=J();navigator.clipboard.writeText(h).then(()=>{f({title:"Copié dans le presse-papiers",description:"Le code HTML de la signature a été copié"})},V=>{f({title:"Erreur de copie",description:"Impossible de copier la signature dans le presse-papiers",variant:"destructive"})})};return e.jsx(Re,{open:j,onOpenChange:h=>!h&&u(),children:e.jsxs(Le,{className:"max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsxs(Te,{children:[e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx($a,{className:"h-5 w-5"}),"Assistant de signature"]}),e.jsx(Ie,{children:"Créez et personnalisez votre signature d'email professionnelle"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 overflow-y-auto py-4",style:{maxHeight:"calc(90vh - 200px)"},children:[e.jsx("div",{className:"space-y-6 overflow-y-auto pr-2",children:e.jsxs(Rs,{defaultValue:"personal",children:[e.jsxs(Ls,{className:"grid grid-cols-3 mb-4",children:[e.jsxs(ae,{value:"personal",className:"flex items-center gap-1",children:[e.jsx(rr,{className:"h-4 w-4"}),e.jsx("span",{children:"Informations"})]}),e.jsxs(ae,{value:"style",className:"flex items-center gap-1",children:[e.jsx(er,{className:"h-4 w-4"}),e.jsx("span",{children:"Style"})]}),e.jsxs(ae,{value:"social",className:"flex items-center gap-1",children:[e.jsx(Zt,{className:"h-4 w-4"}),e.jsx("span",{children:"Social"})]})]}),e.jsx(se,{value:"personal",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"name",children:"Nom complet"}),e.jsx(R,{id:"name",value:l.name,onChange:h=>F("name",h.target.value),placeholder:"Votre nom complet"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"title",children:"Titre / Poste"}),e.jsx(R,{id:"title",value:l.title,onChange:h=>F("title",h.target.value),placeholder:"Votre titre ou poste"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"company",children:"Entreprise"}),e.jsx(R,{id:"company",value:l.company,onChange:h=>F("company",h.target.value),placeholder:"Nom de votre entreprise"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"email",children:"Email"}),e.jsx(R,{id:"email",type:"email",value:l.email,onChange:h=>F("email",h.target.value),placeholder:"votre.email@exemple.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"phone",children:"Téléphone"}),e.jsx(R,{id:"phone",value:l.phone,onChange:h=>F("phone",h.target.value),placeholder:"+33 6 12 34 56 78"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"website",children:"Site web"}),e.jsx(R,{id:"website",value:l.website,onChange:h=>F("website",h.target.value),placeholder:"www.votresite.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"address",children:"Adresse"}),e.jsx(ps,{id:"address",value:l.address,onChange:h=>F("address",h.target.value),placeholder:"Adresse de l'entreprise",rows:2})]})]})}),e.jsx(se,{value:"style",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Modèle de signature"}),e.jsxs(Fe,{value:r.template,onValueChange:h=>O("template",h),children:[e.jsx(Me,{children:e.jsx(Oe,{placeholder:"Choisir un modèle"})}),e.jsxs(Pe,{children:[e.jsx(I,{value:"modern",children:"Moderne"}),e.jsx(I,{value:"classic",children:"Classique"}),e.jsx(I,{value:"compact",children:"Compact"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Couleur du nom"}),e.jsx(va,{value:r.nameColor,onChange:h=>O("nameColor",h)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Couleur d'accent"}),e.jsx(va,{value:r.accentColor,onChange:h=>O("accentColor",h)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Taille de police"}),e.jsxs(Fe,{value:r.fontSize,onValueChange:h=>O("fontSize",h),children:[e.jsx(Me,{children:e.jsx(Oe,{placeholder:"Choisir une taille"})}),e.jsxs(Pe,{children:[e.jsx(I,{value:"small",children:"Petite"}),e.jsx(I,{value:"medium",children:"Moyenne"}),e.jsx(I,{value:"large",children:"Grande"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Style de séparateur"}),e.jsxs(Fe,{value:r.dividerStyle,onValueChange:h=>O("dividerStyle",h),children:[e.jsx(Me,{children:e.jsx(Oe,{placeholder:"Choisir un style"})}),e.jsxs(Pe,{children:[e.jsx(I,{value:"solid",children:"Ligne pleine"}),e.jsx(I,{value:"dashed",children:"Ligne pointillée"}),e.jsx(I,{value:"dotted",children:"Ligne en pointillés"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between space-y-0 pt-2",children:[e.jsx(g,{htmlFor:"company-logo",children:"Inclure le logo"}),e.jsx($s,{id:"company-logo",checked:r.includeCompanyLogo,onCheckedChange:h=>O("includeCompanyLogo",h)})]}),e.jsxs("div",{className:"flex items-center justify-between space-y-0",children:[e.jsx(g,{htmlFor:"include-address",children:"Inclure l'adresse"}),e.jsx($s,{id:"include-address",checked:r.includeAddress,onCheckedChange:h=>O("includeAddress",h)})]}),e.jsxs("div",{className:"flex items-center justify-between space-y-0",children:[e.jsx(g,{htmlFor:"social-links",children:"Inclure les liens sociaux"}),e.jsx($s,{id:"social-links",checked:r.includeSocialLinks,onCheckedChange:h=>O("includeSocialLinks",h)})]})]})}),e.jsx(se,{value:"social",className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"linkedin",children:"LinkedIn"}),e.jsx(R,{id:"linkedin",value:d.linkedin,onChange:h=>xe("linkedin",h.target.value),placeholder:"https://www.linkedin.com/in/votre-profil"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"twitter",children:"Twitter"}),e.jsx(R,{id:"twitter",value:d.twitter,onChange:h=>xe("twitter",h.target.value),placeholder:"https://twitter.com/votre-compte"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"facebook",children:"Facebook"}),e.jsx(R,{id:"facebook",value:d.facebook,onChange:h=>xe("facebook",h.target.value),placeholder:"https://www.facebook.com/votre-page"})]})]})})]})}),e.jsxs("div",{className:"border rounded-lg p-4 overflow-y-auto bg-white",children:[e.jsxs("div",{className:"text-sm font-medium mb-4 text-muted-foreground flex items-center",children:[e.jsx(Vt,{className:"h-4 w-4 mr-1"}),"Aperçu de la signature"]}),e.jsx("div",{className:"signature-preview",dangerouslySetInnerHTML:{__html:J()}})]})]}),e.jsxs(We,{className:"gap-2",children:[e.jsx(x,{variant:"outline",onClick:u,children:"Annuler"}),e.jsxs(x,{variant:"outline",onClick:$,children:[e.jsx(Jt,{className:"h-4 w-4 mr-2"}),"Copier le HTML"]}),e.jsxs(x,{onClick:k,children:[e.jsx(Na,{className:"h-4 w-4 mr-2"}),"Utiliser cette signature"]})]})]})})}function dr({isOpen:a,onClose:c,initialRecipient:u="",initialSubject:j="",initialBody:f="",selectedLead:l=null,selectedServiceRequest:E=null}){const{toast:r}=sa(),[D,d]=i.useState(u),[S,F]=i.useState(u?[u]:[]),[O,xe]=i.useState(j),[J,k]=i.useState(f),[$,h]=i.useState(""),[V,js]=i.useState([]),[ve,Ze]=i.useState(!1),[Ts,es]=i.useState(!1),[Ne,qe]=i.useState([]),[ye,P]=i.useState(""),[zs,Z]=i.useState(!1),[ss,be]=i.useState(!1),[Is,ee]=i.useState(""),_e=os({mutationFn:async n=>{const y=await z("POST","/api/send-email",n);if(!y.ok){const A=await y.json();throw new Error(A.message||"Erreur lors de l'envoi de l'email")}return await y.json()},onSuccess:()=>{r({title:"Email envoyé",description:"Votre email a été envoyé avec succès"}),ds.invalidateQueries({queryKey:["/api/email-logs"]}),c()},onError:n=>{r({title:"Erreur",description:n.message,variant:"destructive"})}});i.useEffect(()=>{if(!a)return;(async()=>{Z(!0);try{const y=await z("GET","/api/email-templates");if(y.ok){const A=await y.json();A&&Array.isArray(A)?qe(A):A&&A.templates&&Array.isArray(A.templates)?qe(A.templates):qe([])}}catch(y){console.error("Erreur lors du chargement des modèles d'email:",y)}finally{Z(!1)}})()},[a]),i.useEffect(()=>{l&&(d(l.email),S.includes(l.email)||F([...S,l.email]))},[l]),i.useEffect(()=>{E&&(d(E.clientEmail),S.includes(E.clientEmail)||F([...S,E.clientEmail]))},[E]);const he=async()=>{if($){Ze(!0),js([]);try{let n=[],y=!1;try{const b=await z("GET",`/api/leads/search?term=${encodeURIComponent($)}`);if(b.ok){const p=await b.json();p&&p.leads&&Array.isArray(p.leads)&&(n=p.leads,y=!0,console.log("Leads trouvés via /api/leads/search",p.leads.length))}}catch{console.log("Échec de recherche sur /api/leads/search, tentative suivante...")}if(!y)try{const b=await z("GET",`/api/leads?search=${encodeURIComponent($)}`);if(b.ok){const p=await b.json();p&&p.leads&&Array.isArray(p.leads)?(n=p.leads,y=!0,console.log("Leads trouvés via /api/leads?search=",p.leads.length)):Array.isArray(p)&&(n=p,y=!0,console.log("Leads trouvés (format tableau) via /api/leads?search=",p.length))}}catch{console.log("Échec de recherche sur /api/leads?search, tentative suivante...")}if(!y)try{const b=await z("GET","/api/leads");if(b.ok){const p=await b.json();let X=[];p&&p.leads&&Array.isArray(p.leads)?X=p.leads:Array.isArray(p)&&(X=p);const Q=$.toLowerCase();n=X.filter(T=>T.firstName.toLowerCase().includes(Q)||T.lastName.toLowerCase().includes(Q)||T.email.toLowerCase().includes(Q)||T.phone&&T.phone.includes($)||T.referenceNumber&&T.referenceNumber.toLowerCase().includes(Q)),console.log("Leads trouvés par filtrage local",n.length)}}catch(b){console.error("Impossible de récupérer les leads:",b)}let A=[],B=!1;try{const b=await z("GET",`/api/service-requests/search?term=${encodeURIComponent($)}`);if(b.ok){const p=await b.json();p&&p.requests&&Array.isArray(p.requests)&&(A=p.requests,B=!0)}}catch{console.log("Échec de recherche sur /api/service-requests/search, tentative suivante...")}if(!B)try{const b=await z("GET",`/api/service-requests?search=${encodeURIComponent($)}`);if(b.ok){const p=await b.json();p&&p.requests&&Array.isArray(p.requests)?(A=p.requests,B=!0):Array.isArray(p)&&(A=p,B=!0)}}catch{console.log("Échec de recherche sur /api/service-requests?search, tentative suivante...")}if(!B)try{const b=await z("GET","/api/service-requests");if(b.ok){const p=await b.json();let X=[];p&&p.requests&&Array.isArray(p.requests)?X=p.requests:Array.isArray(p)&&(X=p);const Q=$.toLowerCase();A=X.filter(T=>T.clientName.toLowerCase().includes(Q)||T.clientEmail.toLowerCase().includes(Q)||T.clientPhone.includes($)||T.referenceNumber.toLowerCase().includes(Q))}}catch(b){console.error("Impossible de récupérer les demandes:",b)}const Ce=[...n,...A];js(Ce),es(Ce.length>0),Ce.length===0?r({title:"Aucun résultat",description:"Aucun lead ou demande ne correspond à votre recherche"}):console.log(`${Ce.length} résultats trouvés au total (${n.length} leads, ${A.length} demandes)`)}catch(n){console.error("Erreur globale lors de la recherche:",n),r({title:"Erreur de recherche",description:"Impossible de charger les résultats",variant:"destructive"})}finally{Ze(!1)}}},fs=n=>{if(n==="none"){P("none");return}P(n);const y=Ne.find(A=>A.id===n);if(y){let A=y.subject,B=y.body;l&&(A=A.replace(/\{nom\}/gi,`${l.firstName} ${l.lastName}`).replace(/\{prenom\}/gi,l.firstName).replace(/\{reference\}/gi,l.referenceNumber||""),B=B.replace(/\{nom\}/gi,`${l.firstName} ${l.lastName}`).replace(/\{prenom\}/gi,l.firstName).replace(/\{reference\}/gi,l.referenceNumber||"")),E&&(A=A.replace(/\{nom\}/gi,E.clientName).replace(/\{reference\}/gi,E.referenceNumber),B=B.replace(/\{nom\}/gi,E.clientName).replace(/\{reference\}/gi,E.referenceNumber)),xe(A),k(B),r({title:"Modèle appliqué",description:`Le modèle "${y.name}" a été appliqué au message`})}},M=n=>{!n||S.includes(n)||(F([...S,n]),d(""),es(!1))},we=n=>{F(S.filter(y=>y!==n))},ne=n=>{const y="clientEmail"in n?n.clientEmail:n.email;M(y),r({title:"Destinataire ajouté",description:`${y} a été ajouté aux destinataires`})},gs=()=>{if(S.length===0){r({title:"Destinataire manquant",description:"Veuillez ajouter au moins un destinataire",variant:"destructive"});return}if(!O){r({title:"Sujet manquant",description:"Veuillez ajouter un sujet à votre email",variant:"destructive"});return}if(!J){r({title:"Contenu manquant",description:"Veuillez ajouter du contenu à votre email",variant:"destructive"});return}const n={to:S.join(","),subject:O,content:J,leadId:l==null?void 0:l.id,serviceRequestId:E==null?void 0:E.id,templateId:ye||void 0};_e.mutate(n)},le=n=>"firstName"in n,vs=n=>{ee(n),k(J+`

`+n),be(!1),r({title:"Signature ajoutée",description:"Votre signature a été ajoutée à l'email"})};return e.jsxs(e.Fragment,{children:[e.jsx(or,{isOpen:ss,onClose:()=>be(!1),onSave:vs,initialHtml:Is}),e.jsx(Re,{open:a,onOpenChange:n=>!n&&c(),children:e.jsxs(Le,{className:"max-w-3xl max-h-[90vh] overflow-hidden",children:[e.jsxs(Te,{children:[e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx(Ct,{className:"h-5 w-5"}),"Nouveau message"]}),e.jsx(Ie,{children:"Composez votre email et envoyez-le à vos contacts"})]}),e.jsx("div",{className:"overflow-y-auto p-1",style:{maxHeight:"calc(90vh - 200px)"},children:e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(g,{htmlFor:"recipient",className:"text-sm font-medium mb-1 text-muted-foreground",children:"À:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Ea,{open:Ts,onOpenChange:es,children:[e.jsx(ka,{asChild:!0,children:e.jsxs(x,{variant:"outline",size:"sm",className:"h-8 gap-1",children:[e.jsx(Xs,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"text-xs",children:"Rechercher"})]})}),e.jsxs(Da,{className:"w-80 p-0",align:"end",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{placeholder:"Nom, email, référence...",value:$,onChange:n=>h(n.target.value),className:"h-8 text-sm"}),e.jsx(x,{size:"sm",variant:"secondary",className:"h-8 px-3",onClick:he,disabled:ve||!$,children:ve?e.jsx(_,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(Xs,{className:"h-3.5 w-3.5"})})]})}),e.jsx("div",{className:"max-h-[300px] overflow-y-auto p-0",children:V.length>0?e.jsx("div",{className:"divide-y",children:V.map(n=>e.jsxs("div",{className:"p-2.5 hover:bg-muted flex items-center justify-between cursor-pointer",onClick:()=>ne(n),children:[e.jsx("div",{className:"overflow-hidden",children:e.jsxs("div",{className:"flex items-center gap-2",children:[le(n)?e.jsx($e,{className:"h-4 w-4 text-blue-500 flex-shrink-0"}):e.jsx(ge,{className:"h-4 w-4 text-amber-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium truncate",children:le(n)?`${n.firstName} ${n.lastName}`:n.clientName}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:le(n)?n.email:n.clientEmail})]})]})}),e.jsx(ya,{className:"h-4 w-4 text-muted-foreground"})]},le(n)?`lead-${n.id}`:`request-${n.id}`))}):ve?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(_,{className:"h-8 w-8 animate-spin mx-auto text-muted-foreground opacity-50 mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Recherche en cours..."})]}):$?e.jsx("div",{className:"p-6 text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun résultat trouvé"})}):e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(Xs,{className:"h-8 w-8 mx-auto text-muted-foreground opacity-20 mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Recherchez des contacts par nom, email ou référence"})]})})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(Fe,{value:ye,onValueChange:fs,children:[e.jsx(Me,{className:"h-8 text-xs w-44",children:e.jsx(Oe,{placeholder:"Choisir un modèle"})}),e.jsxs(Pe,{children:[e.jsx(I,{value:"none",children:"Aucun modèle"}),Ne.map(n=>e.jsx(I,{value:n.id,children:n.name},n.id))]})]}),e.jsxs(Re,{children:[e.jsx(St,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"icon",className:"h-8 w-8",title:"Gérer les modèles",children:e.jsx(ga,{className:"h-4 w-4"})})}),e.jsxs(Le,{className:"max-w-xl",children:[e.jsxs(Te,{children:[e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5"}),"Gérer les modèles d'emails"]}),e.jsx(Ie,{children:"Créez et personnalisez vos modèles d'emails pour une utilisation rapide"})]}),e.jsxs(Rs,{defaultValue:"new",className:"mt-4",children:[e.jsxs(Ls,{className:"grid grid-cols-2 mb-4",children:[e.jsxs(ae,{value:"new",className:"flex items-center gap-1",children:[e.jsx(ga,{className:"h-4 w-4"}),e.jsx("span",{children:"Nouveau modèle"})]}),e.jsxs(ae,{value:"list",className:"flex items-center gap-1",children:[e.jsx(sr,{className:"h-4 w-4"}),e.jsx("span",{children:"Modèles existants"})]})]}),e.jsxs(se,{value:"new",className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"templateName",children:"Nom du modèle"}),e.jsx(R,{id:"templateName",placeholder:"Ex: Confirmation de commande"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"templateSubject",children:"Sujet"}),e.jsx(R,{id:"templateSubject",placeholder:"Ex: Confirmation de votre demande {reference}"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"templateBody",children:"Corps du message"}),e.jsx(ps,{id:"templateBody",placeholder:"Bonjour {prenom},\\n\\nNous avons bien reçu votre demande avec la référence {reference}.",className:"min-h-[150px]"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($s,{id:"templateActive",defaultChecked:!0}),e.jsx(g,{htmlFor:"templateActive",children:"Activer ce modèle"})]}),e.jsxs("div",{className:"bg-muted rounded-md p-3 text-sm space-y-1",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Variables disponibles :"}),e.jsxs("p",{children:[e.jsx("code",{children:"{nom}"})," - Nom complet du client"]}),e.jsxs("p",{children:[e.jsx("code",{children:"{prenom}"})," - Prénom du client"]}),e.jsxs("p",{children:[e.jsx("code",{children:"{reference}"})," - Numéro de référence"]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[e.jsx(x,{variant:"outline",children:"Annuler"}),e.jsx(x,{type:"submit",onClick:()=>{var b,p,X,Q;const n=(b=document.getElementById("templateName"))==null?void 0:b.value,y=(p=document.getElementById("templateSubject"))==null?void 0:p.value,A=(X=document.getElementById("templateBody"))==null?void 0:X.value,B=(Q=document.getElementById("templateActive"))==null?void 0:Q.checked;if(!n||!y||!A){r({title:"Formulaire incomplet",description:"Veuillez remplir tous les champs requis",variant:"destructive"});return}(async()=>{try{const T=await z("POST","/api/email-templates",{name:n,subject:y,body:A,active:B||!1,trigger:"manual"});if(T.ok){if(await T.json()){const as=await z("GET","/api/email-templates");if(as.ok){const Ns=await as.json();Array.isArray(Ns)&&qe(Ns)}r({title:"Modèle enregistré",description:`Le modèle "${n}" a été créé avec succès`})}}else throw new Error("Impossible d'enregistrer le modèle")}catch(T){console.error("Erreur lors de l'enregistrement du modèle:",T),r({title:"Erreur",description:"Impossible d'enregistrer le modèle",variant:"destructive"})}})()},children:"Enregistrer le modèle"})]})]}),e.jsx(se,{value:"list",children:e.jsx("div",{className:"space-y-2 max-h-[400px] overflow-y-auto",children:Ne.length>0?e.jsx("div",{className:"space-y-2 divide-y",children:Ne.map(n=>e.jsx("div",{className:"pt-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:n.name}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:n.subject})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"Modifier",children:e.jsx(Aa,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",title:"Utiliser ce modèle",onClick:()=>{fs(n.id);const y=document.querySelector("[data-dialog-close]");y&&y.click()},children:e.jsx(Na,{className:"h-4 w-4"})})]})]})},n.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ge,{className:"h-10 w-10 mx-auto text-muted-foreground opacity-20 mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"Aucun modèle disponible"})]})})})]})]})]})]})]})]}),e.jsxs("div",{className:"flex items-center mt-1 border rounded-md px-3 py-2 focus-within:ring-1 focus-within:ring-primary focus-within:border-primary",children:[e.jsx("div",{className:"flex flex-wrap gap-1.5 mr-2",children:S.map(n=>e.jsxs(Y,{variant:"secondary",className:"gap-1.5 py-1",children:[e.jsx("span",{className:"text-xs",children:n}),e.jsx("button",{type:"button",onClick:()=>we(n),className:"h-3.5 w-3.5 rounded-full hover:bg-muted-foreground/10 inline-flex items-center justify-center",children:e.jsx(ea,{className:"h-2.5 w-2.5"})})]},n))}),e.jsx(R,{id:"recipient",value:D,onChange:n=>d(n.target.value),placeholder:S.length>0?"":"Destinataires",className:"border-0 focus-visible:ring-0 px-0 py-1 h-8 text-sm focus-visible:outline-none",onKeyDown:n=>{n.key==="Enter"&&D&&(n.preventDefault(),M(D))}})]})]}),e.jsx("div",{children:e.jsx(R,{value:O,onChange:n=>xe(n.target.value),placeholder:"Sujet",className:"border-x-0 border-t-0 rounded-none focus-visible:ring-0 px-3 py-3 text-base focus-visible:border-primary"})}),e.jsx("div",{children:e.jsx(ps,{value:J,onChange:n=>k(n.target.value),placeholder:"Rédigez votre message ici...",className:"min-h-[200px] focus-visible:ring-0 p-3 resize-none"})})]})}),e.jsxs(We,{className:"mt-4 flex items-center justify-between space-x-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"outline",size:"icon",className:"rounded-full",title:"Joindre un fichier",children:e.jsx(tr,{className:"h-4 w-4"})}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>be(!0),className:"flex items-center gap-1 h-8",children:[e.jsx($a,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"text-xs",children:"Signature"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"outline",onClick:c,children:"Annuler"}),e.jsx(x,{onClick:gs,disabled:_e.isPending||S.length===0||!O||!J,children:_e.isPending?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-4 w-4 animate-spin mr-2"}),"Envoi..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Envoyer"]})})]})]})]})})]})}function Zs({currentPage:a,totalPages:c,totalEmails:u,indexOfFirstEmail:j,indexOfLastEmail:f,onPageChange:l}){return e.jsxs("div",{className:"flex justify-between items-center py-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Affichage de ",j+1," à ",Math.min(f,u)," sur ",u," emails"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"outline",size:"sm",onClick:()=>l(a-1),disabled:a===1,children:e.jsx(Xt,{className:"h-4 w-4"})}),Array.from({length:Math.min(c,5)},(E,r)=>{let D=0;return c<=5||a<=3?D=r+1:a>=c-2?D=c-4+r:D=a-2+r,e.jsx(x,{variant:a===D?"default":"outline",size:"sm",onClick:()=>l(D),className:"w-8 h-8 p-0",children:D},D)}),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>l(a+1),disabled:a===c||c===0,children:e.jsx(ya,{className:"h-4 w-4"})})]})]})}var Ra="AlertDialog",[mr,ci]=At(Ra,[ba]),me=ba(),La=a=>{const{__scopeAlertDialog:c,...u}=a,j=me(c);return e.jsx(zt,{...j,...u,modal:!0})};La.displayName=Ra;var xr="AlertDialogTrigger",hr=i.forwardRef((a,c)=>{const{__scopeAlertDialog:u,...j}=a,f=me(u);return e.jsx(Et,{...f,...j,ref:c})});hr.displayName=xr;var ur="AlertDialogPortal",Ta=a=>{const{__scopeAlertDialog:c,...u}=a,j=me(c);return e.jsx(It,{...j,...u})};Ta.displayName=ur;var pr="AlertDialogOverlay",za=i.forwardRef((a,c)=>{const{__scopeAlertDialog:u,...j}=a,f=me(u);return e.jsx(kt,{...f,...j,ref:c})});za.displayName=pr;var Ye="AlertDialogContent",[jr,fr]=mr(Ye),gr=Ft("AlertDialogContent"),Ia=i.forwardRef((a,c)=>{const{__scopeAlertDialog:u,children:j,...f}=a,l=me(u),E=i.useRef(null),r=wa(c,E),D=i.useRef(null);return e.jsx(Dt,{contentName:Ye,titleName:Fa,docsSlug:"alert-dialog",children:e.jsx(jr,{scope:u,cancelRef:D,children:e.jsxs($t,{role:"alertdialog",...l,...f,ref:r,onOpenAutoFocus:Rt(f.onOpenAutoFocus,d=>{var S;d.preventDefault(),(S=D.current)==null||S.focus({preventScroll:!0})}),onPointerDownOutside:d=>d.preventDefault(),onInteractOutside:d=>d.preventDefault(),children:[e.jsx(gr,{children:j}),e.jsx(Nr,{contentRef:E})]})})})});Ia.displayName=Ye;var Fa="AlertDialogTitle",Ma=i.forwardRef((a,c)=>{const{__scopeAlertDialog:u,...j}=a,f=me(u);return e.jsx(Lt,{...f,...j,ref:c})});Ma.displayName=Fa;var Oa="AlertDialogDescription",Pa=i.forwardRef((a,c)=>{const{__scopeAlertDialog:u,...j}=a,f=me(u);return e.jsx(Tt,{...f,...j,ref:c})});Pa.displayName=Oa;var vr="AlertDialogAction",qa=i.forwardRef((a,c)=>{const{__scopeAlertDialog:u,...j}=a,f=me(u);return e.jsx(Ca,{...f,...j,ref:c})});qa.displayName=vr;var _a="AlertDialogCancel",Va=i.forwardRef((a,c)=>{const{__scopeAlertDialog:u,...j}=a,{cancelRef:f}=fr(_a,u),l=me(u),E=wa(c,f);return e.jsx(Ca,{...l,...j,ref:E})});Va.displayName=_a;var Nr=({contentRef:a})=>{const c=`\`${Ye}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Ye}\` by passing a \`${Oa}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Ye}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return i.useEffect(()=>{var j;document.getElementById((j=a.current)==null?void 0:j.getAttribute("aria-describedby"))||console.warn(c)},[c,a]),null},yr=La,br=Ta,Ba=za,Ua=Ia,Ha=qa,Ga=Va,Ka=Ma,Xa=Pa;const wr=yr,Cr=br,Qa=i.forwardRef(({className:a,...c},u)=>e.jsx(Ba,{className:te("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...c,ref:u}));Qa.displayName=Ba.displayName;const Wa=i.forwardRef(({className:a,...c},u)=>e.jsxs(Cr,{children:[e.jsx(Qa,{}),e.jsx(Ua,{ref:u,className:te("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...c})]}));Wa.displayName=Ua.displayName;const Ya=({className:a,...c})=>e.jsx("div",{className:te("flex flex-col space-y-2 text-center sm:text-left",a),...c});Ya.displayName="AlertDialogHeader";const Ja=({className:a,...c})=>e.jsx("div",{className:te("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...c});Ja.displayName="AlertDialogFooter";const Za=i.forwardRef(({className:a,...c},u)=>e.jsx(Ka,{ref:u,className:te("text-lg font-semibold",a),...c}));Za.displayName=Ka.displayName;const et=i.forwardRef(({className:a,...c},u)=>e.jsx(Xa,{ref:u,className:te("text-sm text-muted-foreground",a),...c}));et.displayName=Xa.displayName;const st=i.forwardRef(({className:a,...c},u)=>e.jsx(Ha,{ref:u,className:te(Sa(),a),...c}));st.displayName=Ha.displayName;const at=i.forwardRef(({className:a,...c},u)=>e.jsx(Ga,{ref:u,className:te(Sa({variant:"outline"}),"mt-2 sm:mt-0",a),...c}));at.displayName=Ga.displayName;const Sr=({template:a,onEdit:c,onSendTest:u,onDelete:j,onSend:f})=>e.jsxs(oe,{children:[e.jsxs(Xe,{className:"pb-2",children:[e.jsxs(Qe,{className:"text-base flex items-start justify-between",children:[e.jsx("span",{className:"truncate mr-2",children:a.name}),a.active?e.jsx(Y,{variant:"outline",className:"bg-green-50 text-green-700 hover:bg-green-50 border-green-200",children:"Actif"}):e.jsx(Y,{variant:"outline",className:"bg-gray-50 text-gray-500 hover:bg-gray-50 border-gray-200",children:"Inactif"})]}),e.jsxs(Ut,{className:"text-xs truncate",children:["Déclencheur: ",a.trigger]})]}),e.jsxs(de,{className:"pb-3 text-sm",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-semibold text-xs text-muted-foreground",children:"Sujet:"}),e.jsx("p",{className:"truncate",children:a.subject})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-xs text-muted-foreground",children:"Contenu:"}),e.jsx("p",{className:"line-clamp-2 text-sm text-muted-foreground",children:a.body})]})]}),e.jsxs(Ht,{className:"flex justify-between pt-0",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(x,{variant:"ghost",size:"sm",onClick:c,children:[e.jsx(Aa,{className:"h-3.5 w-3.5 mr-1"}),"Éditer"]}),e.jsxs(x,{variant:"ghost",size:"sm",onClick:u,children:[e.jsx(Je,{className:"h-3.5 w-3.5 mr-1"}),"Tester"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:j,children:e.jsx(us,{className:"h-3.5 w-3.5 text-red-500"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:f,children:e.jsx(Je,{className:"h-3.5 w-3.5 text-blue-500"})})]})]})]});function oi(){return e.jsx(qt,{title:"Mail",description:"Gestion de votre messagerie",children:e.jsx(Ar,{})})}function Ar(){var ha,ua;const{toast:a}=sa(),[c,u]=i.useState(!1),[j,f]=i.useState([]),[l,E]=i.useState(!1),[r,D]=i.useState([]),[d,S]=i.useState(!1),[F,O]=i.useState(!1),[xe,J]=i.useState("inbox"),[k,$]=i.useState(null),[h,V]=i.useState(!1),[js,ve]=i.useState(!1),[Ze,Ts]=i.useState(""),[es,Ne]=i.useState(!1),[qe,ye]=i.useState(!1),[P,zs]=i.useState(null),[Z,ss]=i.useState([]),[be,Is]=i.useState(!1),[ee,_e]=i.useState(""),[he,fs]=i.useState("");i.useState(""),i.useState(!1);const[M,we]=i.useState(""),[ne,gs]=i.useState([]),[le,vs]=i.useState(""),[n,y]=i.useState(""),[A,B]=i.useState("desc");i.useState("createdAt"),i.useState(!1);const[Ce,b]=i.useState(!1),[p,X]=i.useState(""),[Q,T]=i.useState(""),[aa,as]=i.useState(""),[Ns,Fs]=i.useState(null),[tt,ta]=i.useState(null),ra=async()=>{if(ee){u(!0),E(!0),S(!1);try{const s=await z("GET","/api/leads");if(!s.ok)throw new Error("Erreur lors de la récupération des leads");const t=await s.json();if(t&&typeof t=="object"&&"leads"in t&&Array.isArray(t.leads)){const o=t.leads.filter(m=>{const v=`${m.firstName} ${m.lastName}`.toLowerCase(),L=m.email.toLowerCase(),W=ee.toLowerCase();return v.includes(W)||L.includes(W)||m.referenceNumber&&m.referenceNumber.toLowerCase().includes(W)});f(o)}else f([])}catch(s){console.error("Erreur lors de la recherche des leads:",s),a({title:"Erreur",description:"Impossible de charger les résultats de recherche",variant:"destructive"}),f([])}finally{u(!1)}}},rt=async()=>{if(ee){O(!0),S(!0),E(!1);try{const s=await z("GET","/api/service-requests");if(!s.ok)throw new Error("Erreur lors de la récupération des demandes");const t=await s.json();if(t&&Array.isArray(t)){const o=t.filter(m=>{const v=ee.toLowerCase();return m.referenceNumber.toLowerCase().includes(v)||m.clientName.toLowerCase().includes(v)||m.clientEmail.toLowerCase().includes(v)});D(o)}else D([])}catch(s){console.error("Erreur lors de la recherche des demandes:",s),a({title:"Erreur",description:"Impossible de charger les résultats de recherche",variant:"destructive"}),D([])}finally{O(!1)}}},{user:H}=Bt(),[q,Ve]=i.useState(0),[G,Be]=i.useState(fe);i.useEffect(()=>{H&&H.id&&Ve(H.id)},[H]),i.useEffect(()=>{const s=new URLSearchParams(window.location.search),t=s.get("leadId");if(s.get("view"),t){const o=parseInt(t,10);isNaN(o)||(Fs({id:o}),b(!0))}try{const o=sessionStorage.getItem("reply_to_email");if(o){const m=JSON.parse(o);m&&setTimeout(()=>{Bs(m),sessionStorage.removeItem("reply_to_email")},500)}}catch(o){console.error("Erreur lors de la récupération de l'email à répondre:",o)}},[]);const[N,ue]=i.useState(null),[Ue,pe]=i.useState(!1),[ys,Ms]=i.useState(1),Os=20,bs=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),{data:ce,isLoading:it}=Ke({queryKey:["/api/leads"],queryFn:ls({on401:"returnNull"})}),{data:He,isLoading:nt}=Ke({queryKey:["/api/email-logs"],queryFn:ls({on401:"returnNull"})}),{data:ws,isLoading:lt}=Ke({queryKey:["/api/users"],queryFn:ls({on401:"returnNull"})});Ke({queryKey:["/api/mailboxes",q],queryFn:ls({on401:"returnNull"}),enabled:!!q});const{data:re,isLoading:je,refetch:Ps}=Ke({queryKey:["/api/user-emails",q,G],queryFn:async({queryKey:s})=>{const[t,o,m]=s;if(!o)throw new Error("ID utilisateur requis");const v=await z("GET",`/api/user-emails?userId=${o}&selectedMailbox=${m||"INBOX"}`);if(!v.ok){const L=await v.json();throw new Error(L.message||"Erreur lors de la récupération des emails")}return v.json()},enabled:!!q&&!!G}),{data:U,isLoading:ia}=Ke({queryKey:["/api/email-templates"],queryFn:ls({on401:"returnNull"})});i.useEffect(()=>{const t=new URLSearchParams(window.location.search).get("view");if(t&&re&&typeof re=="object"&&"emails"in re){const o=re.emails.find(m=>m.id===t);o&&Se(o)}},[re]);const ct=U&&typeof U=="object"&&"templates"in U&&Array.isArray(U.templates)?U.templates.length:0,ot=U&&typeof U=="object"&&"templates"in U&&Array.isArray(U.templates)?U.templates.filter(s=>s.active).length:0,qs=Array.isArray(He)?He.length:0,dt=qs>0&&Array.isArray(He)?Math.round(He.filter(s=>s.status==="delivered"||s.status==="opened"||s.status==="clicked").length/qs*100):0,ts=U&&typeof U=="object"&&"templates"in U&&Array.isArray(U.templates)?U.templates:[],na=os({mutationFn:async({userId:s,messageId:t,isRead:o,mailbox:m})=>{const v=await z("POST","/api/mark-email",{userId:s,messageId:t,isRead:o,mailbox:m});if(!v.ok){const L=await v.json();throw new Error(L.message||"Erreur lors du marquage de l'email")}return v.json()},onSuccess:()=>{ds.invalidateQueries({queryKey:["/api/user-emails",q,G]}),a({title:"Email mis à jour",variant:"default"})},onError:s=>{a({title:"Erreur lors de la mise à jour de l'email",description:s.message,variant:"destructive"})}}),_s=os({mutationFn:async({userId:s,messageId:t,destinationMailbox:o,sourceMailbox:m})=>{const v=await z("POST","/api/move-email",{userId:s,messageId:t,destinationMailbox:o,sourceMailbox:m});if(!v.ok){const L=await v.json();throw new Error(L.message||"Erreur lors du déplacement de l'email")}return v.json()},onSuccess:()=>{ds.invalidateQueries({queryKey:["/api/user-emails",q,G]}),ue(null),pe(!1),a({title:"Email déplacé",variant:"default"})},onError:s=>{a({title:"Erreur lors du déplacement de l'email",description:s.message,variant:"destructive"})}}),Vs=os({mutationFn:async({userId:s,messageId:t,mailbox:o})=>{const m=await z("DELETE","/api/delete-email",{userId:s,messageId:t,mailbox:o});if(!m.ok){const v=await m.json();throw new Error(v.message||"Erreur lors de la suppression de l'email")}return m.json()},onSuccess:()=>{ds.invalidateQueries({queryKey:["/api/user-emails",q,G]}),ue(null),pe(!1),a({title:"Email supprimé",variant:"default"})},onError:s=>{a({title:"Erreur lors de la suppression de l'email",description:s.message,variant:"destructive"})}}),Cs=os({mutationFn:async s=>{const t={...s,body:s.content,content:s.content};return await(await z("POST","/api/send-email",t)).json()},onSuccess:()=>{a({title:"Email envoyé avec succès",variant:"default"}),ye(!1),ds.invalidateQueries({queryKey:["/api/email-logs"]})},onError:s=>{a({title:"Erreur lors de l'envoi de l'email",description:s.message,variant:"destructive"})}}),Bs=s=>{if(!s){a({title:"Erreur",description:"Impossible de répondre à cet email",variant:"destructive"});return}const t=lr(s),o=t.startsWith("Re: ")?t:`Re: ${t}`;let m="";if(s.from){if(Array.isArray(s.from)&&s.from.length>0)s.from[0].address?m=s.from[0].address:typeof s.from[0]=="string"&&(m=s.from[0]);else if(typeof s.from=="object"&&s.from!==null){if("address"in s.from&&s.from.address)m=s.from.address;else if("text"in s.from&&s.from.text){const is=String(s.from.text).match(/<([^>]+)>/);m=is?is[1]:s.from.text}}else if(typeof s.from=="string"){const is=s.from.match(/<([^>]+)>/);m=is?is[1]:s.from}}if(!m){a({title:"Erreur",description:"Impossible de déterminer l'adresse de l'expéditeur",variant:"destructive"});return}const v=s.date?new Date(s.date).toLocaleString("fr-FR"):"Date inconnue",W=`

--------- Message original ---------
De: ${nr(s)}
Date: ${v}
Objet: ${t}

`,wt=s.text||"";console.log("Réponse à l'email - Destinataire:",m),X(m),T(o),as(W+wt),Fs(null),ta(null),b(!0)},mt=s=>{s==="no-user"||!s?H&&H.id?Ve(H.id):Ve(1):(Ve(parseInt(s)),Be(fe)),ue(null),pe(!1)},xt=s=>{J(s),Ms(1),(s===fe.toLowerCase()||s===ms.toLowerCase()||s===xs.toLowerCase()||s===hs.toLowerCase())&&(s===fe.toLowerCase()?Be(fe):s===ms.toLowerCase()?Be(ms):s===xs.toLowerCase()?Be(xs):s===hs.toLowerCase()&&Be(hs),ue(null),pe(!1),Ps())},Se=s=>{ue(s),pe(!0),s.isRead||na.mutate({userId:q,messageId:s.id,isRead:!0,mailbox:G})},[la,ht]=i.useState(null),[ut,Us]=i.useState(!1),Hs=(s,t,o)=>{ht({userId:s,messageId:t,mailbox:o}),Us(!0)},pt=()=>{la&&Vs.mutate(la),Us(!1)},ca=(s,t)=>{ss(t?o=>[...o,s]:o=>o.filter(m=>m.id!==s.id))},jt=s=>{zs(s),vs(s.subject),y(s.body),ye(!0)},ft=s=>{if(Z.length===0){a({title:"Aucun lead sélectionné",description:"Veuillez sélectionner au moins un lead avant d'envoyer.",variant:"destructive"});return}Z.forEach(t=>{const o={leadId:t.id,templateId:s.id,to:t.email,subject:s.subject,content:s.body,recipients:[{id:t.id,email:t.email,name:`${t.firstName} ${t.lastName}`,referenceNumber:t.referenceNumber}]};Cs.mutate(o)})};i.useEffect(()=>{if(be){const s=ce&&"leads"in ce?ce.leads.filter(t=>{const o=`${t.firstName} ${t.lastName}`.toLowerCase(),m=t.email.toLowerCase(),v=ee.toLowerCase(),L=o.includes(v)||m.includes(v)||t.referenceNumber&&t.referenceNumber.toLowerCase().includes(v),W=!he||t.status&&t.status===he;return L&&W}):[];ss(s)}},[be,ce,ee,he]);const Ae=re&&typeof re=="object"&&"emails"in re&&Array.isArray(re.emails)?[...re.emails].sort((s,t)=>{if(!s.isRead&&t.isRead)return-1;if(s.isRead&&!t.isRead)return 1;const o=new Date(s.date).getTime(),m=new Date(t.date).getTime();return A==="desc"?m-o:o-m}):[],Ss=Ae.length,Gs=Math.ceil(Ss/Os),rs=ys*Os,As=rs-Os,Ge=Ae.slice(As,rs),Ks=s=>{Ms(s),window.scrollTo(0,0)},oa=ce&&typeof ce=="object"&&"leads"in ce&&Array.isArray(ce.leads)?ce.leads.filter(s=>{const t=`${s.firstName} ${s.lastName}`.toLowerCase(),o=s.email.toLowerCase(),m=ee.toLowerCase(),v=t.includes(m)||o.includes(m)||s.referenceNumber&&s.referenceNumber.toLowerCase().includes(m),L=!he||s.status&&s.status===he;return v&&L}):[],da=Array.isArray(He)?He.filter(s=>!0):[],ma=Array.isArray(da)?[...da].sort((s,t)=>{const o=new Date(s.createdAt).getTime(),m=new Date(t.createdAt).getTime();return A==="desc"?m-o:o-m}):[],gt=()=>{if(!M&&ne.length===0){a({title:"Aucun destinataire spécifié",description:"Veuillez ajouter au moins un destinataire.",variant:"destructive"});return}if(!le){a({title:"Sujet vide",description:"Veuillez ajouter un sujet à votre email.",variant:"destructive"});return}if(!n){a({title:"Contenu vide",description:"Veuillez ajouter du contenu à votre email.",variant:"destructive"});return}const s=[...ne];M&&!s.includes(M)&&s.push(M);const t={templateId:(P==null?void 0:P.id)||"",to:s.join(","),subject:le,content:n};Cs.mutate(t)},vt=()=>{M&&bs(M)&&!ne.includes(M)?(gs(s=>[...s,M]),we("")):M&&!bs(M)?a({title:"Format d'email invalide",description:"Veuillez entrer une adresse email valide.",variant:"destructive"}):ne.includes(M)&&(a({title:"Destinataire déjà ajouté",description:"Ce destinataire est déjà dans la liste.",variant:"default"}),we(""))},Nt=s=>{gs(t=>t.filter(o=>o!==s))},[xa,Er]=Mt();i.useState(0);const yt=async s=>{const t=await z("GET",`/api/mailboxes?userId=${s}`);if(!t.ok)throw new Error("Erreur lors du chargement des boîtes mail");await t.json()},bt=async(s,t)=>{const o=await z("GET",`/api/user-emails?userId=${s}&selectedMailbox=${t}`);if(!o.ok)throw new Error("Erreur lors du chargement des emails");await o.json()};return i.useEffect(()=>{H&&(new URLSearchParams(xa.split("?")[1]||"").get("defaultUser")==="contact@portail-electricite.com"&&H.username==="admin"?(Ve(H.id),yt(H.id),bt(H.id,"INBOX")):Ve(H.id))},[xa,H]),e.jsxs("div",{className:"pb-10",children:[e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsxs("div",{className:"space-y-4 xl:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Mail"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Fe,{value:q.toString(),onValueChange:mt,children:[e.jsx(Me,{className:"w-[200px]",children:e.jsx(Oe,{placeholder:"Sélectionner un utilisateur"})}),e.jsx(Pe,{children:lt?e.jsx("div",{className:"flex items-center justify-center py-2",children:e.jsx(_,{className:"h-4 w-4 animate-spin"})}):ws&&"users"in ws&&Array.isArray(ws.users)&&ws.users.map(s=>e.jsxs(I,{value:s.id.toString(),children:[s.username," (",s.email,")"]},s.id))})]}),e.jsx(x,{variant:"outline",size:"icon",onClick:()=>Ps(),disabled:je,children:je?e.jsx(_,{className:"h-4 w-4 animate-spin"}):e.jsx(Qt,{className:"h-4 w-4"})}),e.jsxs(x,{variant:"default",onClick:()=>{X(""),T(""),as(""),Fs(null),ta(null),b(!0)},children:[e.jsx(Ys,{className:"h-4 w-4 mr-2"}),"Nouveau message"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(oe,{children:[e.jsx(Xe,{className:"pb-2",children:e.jsx(Qe,{className:"text-sm font-medium",children:"Messages non lus"})}),e.jsxs(de,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Ae.filter(s=>!s.isRead).length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",Ae.filter(s=>!s.isRead&&new Date(s.date)>new Date(Date.now()-24*60*60*1e3)).length," aujourd'hui"]})]})]}),e.jsxs(oe,{children:[e.jsx(Xe,{className:"pb-2",children:e.jsx(Qe,{className:"text-sm font-medium",children:"Modèles disponibles"})}),e.jsxs(de,{children:[e.jsx("div",{className:"text-2xl font-bold",children:ct}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[ot," modèles actifs"]})]})]}),e.jsxs(oe,{children:[e.jsx(Xe,{className:"pb-2",children:e.jsx(Qe,{className:"text-sm font-medium",children:"Emails envoyés (30j)"})}),e.jsxs(de,{children:[e.jsx("div",{className:"text-2xl font-bold",children:qs}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Taux de délivrance: ",dt,"%"]})]})]}),e.jsxs(oe,{children:[e.jsx(Xe,{className:"pb-2",children:e.jsx(Qe,{className:"text-sm font-medium",children:"Dossiers disponibles"})}),e.jsxs(de,{children:[e.jsx("div",{className:"text-2xl font-bold",children:"4 "}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Boîte active: ",G]})]})]})]})]}),e.jsx("div",{className:"flex-1 space-y-4 lg:space-y-6",children:e.jsxs(Rs,{value:xe,onValueChange:xt,className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsx(cr,{currentFolder:G,onFolderChange:s=>{Be(s),J(s.toLowerCase()),Ms(1),ue(null),pe(!1),Ps()},userId:q})}),e.jsxs(Ls,{className:"mb-4 ml-2",children:[e.jsxs(ae,{value:"templates",className:"flex items-center gap-1.5",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Modèles"})]}),e.jsxs(ae,{value:"logs",className:"flex items-center gap-1.5",children:[e.jsx(ns,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Historique"})]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:[e.jsxs(se,{value:"inbox",className:"mt-0",children:[je?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):Ue&&N?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>{ue(null),pe(!1)},children:[e.jsx(fa,{className:"h-4 w-4 mr-2"}),"Retour"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>Bs(N),children:[e.jsx(ja,{className:"h-4 w-4 mr-2"}),"Répondre"]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>{Hs(q,N.id,G)},disabled:Vs.isPending,children:[e.jsx(us,{className:"h-4 w-4 mr-2 text-red-500"}),"Supprimer"]})]})]}),e.jsx(oe,{children:e.jsxs(de,{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:N.subject||"(Sans objet)"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-1 md:gap-4 mt-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx($e,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"font-medium",children:"De:"}),e.jsx("span",{className:"ml-1",children:N.from.map(s=>s.name||s.address).join(", ")})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ns,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"font-medium",children:"Date:"}),e.jsx("span",{className:"ml-1",children:new Date(N.date).toLocaleString("fr-FR")})]})]}),N.to&&N.to.length>0&&e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground mt-1",children:[e.jsx($e,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"font-medium",children:"À:"}),e.jsx("span",{className:"ml-1",children:N.to.map(s=>s.name||s.address).join(", ")})]})]}),e.jsx(Ws,{}),e.jsxs("div",{children:[N.hasAttachments&&e.jsxs("div",{className:"mb-4 border border-dashed rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(cs,{className:"h-4 w-4 mr-2 text-blue-500"}),e.jsxs("span",{className:"font-medium",children:[((ha=N.attachments)==null?void 0:ha.length)||0," pièce(s) jointe(s)"]})]}),N.attachments&&N.attachments.length>0&&e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2",children:N.attachments.map((s,t)=>e.jsxs("div",{className:"flex items-center bg-muted p-2 rounded-md text-xs",children:[e.jsx(ge,{className:"h-4 w-4 mr-2 text-blue-500"}),e.jsx("span",{className:"truncate flex-1",children:s.filename}),e.jsxs("span",{className:"text-muted-foreground ml-2",children:[Math.round(s.size/1024),"KB"]})]},t))})]}),e.jsx("div",{className:"email-content",children:N.html?e.jsx("div",{className:"border rounded-md p-4 bg-white",dangerouslySetInnerHTML:{__html:N.html}}):e.jsx("div",{className:"border rounded-md p-4 bg-white whitespace-pre-line",children:N.text||"(Pas de contenu)"})})]})]})})]}):Ge.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Ds,{className:"h-12 w-12 mx-auto text-gray-300 mb-3"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Boîte de réception vide"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-md mx-auto",children:"Aucun email trouvé dans cette boîte. Les nouveaux messages apparaîtront ici."})]}):e.jsxs(Ee,{children:[e.jsx(ke,{children:e.jsxs(K,{children:[e.jsx(w,{className:"w-[40px]"}),e.jsx(w,{children:"Expéditeur"}),e.jsx(w,{children:"Sujet"}),e.jsx(w,{className:"hidden md:table-cell",children:"Date"}),e.jsx(w,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(De,{children:Ge.map(s=>{var t,o,m,v,L,W;return e.jsxs(K,{className:s.isRead?"":"font-medium bg-muted/30",children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center",children:[!s.isRead&&e.jsx("div",{className:"h-2 w-2 rounded-full bg-blue-500 mr-2"}),s.hasAttachments&&e.jsx(cs,{className:"h-4 w-4 text-muted-foreground"})]})}),e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-6 w-6",children:e.jsx(ks,{className:"text-xs",children:((o=(t=s.from[0])==null?void 0:t.name)==null?void 0:o[0])||((v=(m=s.from[0])==null?void 0:m.address)==null?void 0:v[0])||"?"})}),e.jsx("div",{className:"truncate max-w-[120px] md:max-w-[180px]",children:((L=s.from[0])==null?void 0:L.name)||((W=s.from[0])==null?void 0:W.address)||"Inconnu"})]})}),e.jsx(C,{children:e.jsx("div",{className:"cursor-pointer truncate max-w-[180px] md:max-w-[300px]",onClick:()=>Se(s),children:s.subject||"(Sans objet)"})}),e.jsx(C,{className:"hidden md:table-cell text-muted-foreground text-sm",children:new Date(s.date).toLocaleString("fr-FR",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(x,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-primary hover:bg-primary/10",onClick:()=>Se(s),title:"Voir",children:e.jsx(Js,{className:"h-3.5 w-3.5"})}),e.jsx(x,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-blue-500 hover:text-blue-600 hover:bg-blue-50",onClick:()=>Bs(s),title:"Répondre",children:e.jsx(ja,{className:"h-3.5 w-3.5"})}),e.jsx(x,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 hover:bg-gray-100",onClick:()=>{na.mutate({userId:q,messageId:s.id,isRead:!s.isRead,mailbox:G})},title:s.isRead?"Marquer comme non lu":"Marquer comme lu",children:s.isRead?e.jsx(ar,{className:"h-3.5 w-3.5 text-gray-500"}):e.jsx(_t,{className:"h-3.5 w-3.5 text-green-500"})}),e.jsx(x,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-red-400 hover:text-red-600 hover:bg-red-50",onClick:()=>{Hs(q,s.id,G)},title:"Supprimer",children:e.jsx(us,{className:"h-3.5 w-3.5"})})]})})]},s.id)})})]}),!je&&!Ue&&Ae.length>0&&e.jsx(Zs,{currentPage:ys,totalPages:Gs,totalEmails:Ss,indexOfFirstEmail:As,indexOfLastEmail:rs,onPageChange:Ks})]}),e.jsxs(se,{value:ms.toLowerCase(),className:"mt-0",children:[je?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):Ue&&N?e.jsx("div",{className:"space-y-6"}):Ge.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Je,{className:"h-12 w-12 mx-auto text-gray-300 mb-3"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucun email envoyé"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-md mx-auto",children:"Vous n'avez pas encore envoyé d'emails depuis ce compte."})]}):e.jsxs(Ee,{children:[e.jsx(ke,{children:e.jsxs(K,{children:[e.jsx(w,{className:"w-[40px]"}),e.jsx(w,{children:"Destinataire"}),e.jsx(w,{children:"Sujet"}),e.jsx(w,{className:"hidden md:table-cell",children:"Date"}),e.jsx(w,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(De,{children:Ge.map(s=>{var t,o,m,v;return e.jsxs(K,{children:[e.jsx(C,{children:e.jsx("div",{className:"flex items-center",children:s.hasAttachments&&e.jsx(cs,{className:"h-4 w-4 text-muted-foreground"})})}),e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-6 w-6",children:e.jsx(ks,{className:"text-xs",children:s.from&&s.from.length>0?((o=(t=s.from[0])==null?void 0:t.name)==null?void 0:o[0])||((v=(m=s.from[0])==null?void 0:m.address)==null?void 0:v[0]):"?"})}),e.jsx("div",{className:"truncate max-w-[120px] md:max-w-[180px]",children:s.from&&s.from.length>0&&s.from.map(L=>L.name||L.address).join(", ")||"Expéditeur inconnu"})]})}),e.jsx(C,{children:e.jsx("div",{className:"cursor-pointer truncate max-w-[180px] md:max-w-[300px]",onClick:()=>Se(s),children:s.subject||"(Sans objet)"})}),e.jsx(C,{className:"hidden md:table-cell text-muted-foreground text-sm",children:new Date(s.date).toLocaleString("fr-FR",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(x,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-primary hover:bg-primary/10",onClick:()=>Se(s),title:"Voir",children:e.jsx(Js,{className:"h-3.5 w-3.5"})}),e.jsx(x,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-red-400 hover:text-red-600 hover:bg-red-50",onClick:()=>{Hs(q,s.id,G)},title:"Supprimer",children:e.jsx(us,{className:"h-3.5 w-3.5"})})]})})]},s.id)})})]}),!je&&!Ue&&Ae.length>0&&e.jsx(Zs,{currentPage:ys,totalPages:Gs,totalEmails:Ss,indexOfFirstEmail:As,indexOfLastEmail:rs,onPageChange:Ks})]}),e.jsxs(se,{value:"templates",className:"mt-0",children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Modèles d'emails (",ts.length,")"]}),e.jsxs(x,{onClick:()=>{$(null),V(!0)},children:[e.jsx(Ys,{className:"h-4 w-4 mr-2"}),"Nouveau modèle"]})]}),ia?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):ts.length===0?e.jsxs("div",{className:"text-center py-12 border rounded-lg bg-muted/20",children:[e.jsx(ge,{className:"h-12 w-12 mx-auto text-gray-300 mb-3"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucun modèle"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md mx-auto mb-4",children:"Vous n'avez pas encore créé de modèles d'emails. Les modèles vous permettent d'envoyer rapidement des messages standardisés."}),e.jsxs(x,{onClick:()=>{$(null),V(!0)},children:[e.jsx(Ys,{className:"h-4 w-4 mr-2"}),"Créer un modèle"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ts.map(s=>e.jsx(Sr,{template:s,onEdit:()=>{$(s),V(!0)},onSendTest:()=>{$(s),ve(!0)},onDelete:()=>{},onSend:()=>jt(s)},s.id))})]}),e.jsxs(se,{value:"logs",className:"mt-0",children:[e.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Historique des emails"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(Fe,{value:A,onValueChange:s=>B(s),children:[e.jsx(Me,{className:"w-[150px]",children:e.jsx(Oe,{placeholder:"Trier par"})}),e.jsxs(Pe,{children:[e.jsx(I,{value:"desc",children:"Plus récents d'abord"}),e.jsx(I,{value:"asc",children:"Plus anciens d'abord"})]})]})})]}),nt?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):ma.length===0?e.jsxs("div",{className:"text-center py-12 border rounded-lg bg-muted/20",children:[e.jsx(ns,{className:"h-12 w-12 mx-auto text-gray-300 mb-3"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucun historique"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md mx-auto",children:"L'historique des emails envoyés apparaîtra ici."})]}):e.jsxs(Ee,{children:[e.jsx(ke,{children:e.jsxs(K,{children:[e.jsx(w,{className:"w-[40px]"}),e.jsx(w,{children:"Destinataire"}),e.jsx(w,{children:"Sujet"}),e.jsx(w,{children:"Modèle"}),e.jsx(w,{className:"hidden md:table-cell",children:"Date"}),e.jsx(w,{className:"w-[100px]",children:e.jsxs("div",{className:"flex items-center gap-1",children:["Statut",e.jsx(Wt,{className:"h-3.5 w-3.5 text-muted-foreground"})]})})]})}),e.jsx(De,{children:ma.map(s=>{var t;return e.jsxs(K,{children:[e.jsx(C,{children:e.jsx("div",{className:"flex items-center",children:s.status==="delivered"||s.status==="opened"||s.status==="clicked"?e.jsx(Ot,{className:"h-4 w-4 text-green-500"}):s.status==="bounced"||s.status==="failed"?e.jsx(Yt,{className:"h-4 w-4 text-red-500"}):e.jsx(ns,{className:"h-4 w-4 text-amber-500"})})}),e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-6 w-6",children:e.jsx(ks,{className:"text-xs",children:((t=s.recipient[0])==null?void 0:t.toUpperCase())||"?"})}),e.jsx("div",{className:"truncate max-w-[120px] md:max-w-[180px]",children:s.recipient})]})}),e.jsx(C,{children:e.jsx("div",{className:"truncate max-w-[180px] md:max-w-[300px]",children:s.subject||"(Sans objet)"})}),e.jsx(C,{children:e.jsx("div",{className:"truncate max-w-[120px]",children:s.template||"(Personnalisé)"})}),e.jsx(C,{className:"hidden md:table-cell text-muted-foreground text-sm",children:new Date(s.createdAt).toLocaleString("fr-FR",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsx(C,{children:e.jsx(Y,{variant:s.status==="delivered"||s.status==="opened"||s.status==="clicked"?"outline":s.status==="bounced"||s.status==="failed"?"destructive":"secondary",className:te("capitalize",s.status==="delivered"&&"bg-green-50 text-green-700 hover:bg-green-50 border-green-200",s.status==="opened"&&"bg-blue-50 text-blue-700 hover:bg-blue-50 border-blue-200",s.status==="clicked"&&"bg-blue-100 text-blue-800 hover:bg-blue-100 border-blue-300",s.status==="queued"&&"bg-amber-50 text-amber-700 hover:bg-amber-50 border-amber-200"),children:{delivered:"Livré",opened:"Ouvert",clicked:"Cliqué",bounced:"Échec",failed:"Échec",spam:"Spam",queued:"En attente"}[s.status]||s.status})})]},s.id)})})]})]}),e.jsx(se,{value:xs.toLowerCase(),className:"mt-0",children:e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Pt,{className:"h-12 w-12 mx-auto text-gray-300 mb-3"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Dossier spam"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-md mx-auto",children:"Les emails détectés comme indésirables apparaîtront ici."})]})}),e.jsxs(se,{value:hs.toLowerCase(),className:"mt-0",children:[je?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):Ue&&N?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>{ue(null),pe(!1)},children:[e.jsx(fa,{className:"h-4 w-4 mr-2"}),"Retour"]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>{_s.mutate({userId:q,messageId:N.id,destinationMailbox:fe,sourceMailbox:G})},disabled:_s.isPending,children:[e.jsx(Ds,{className:"h-4 w-4 mr-2"}),"Restaurer"]})})]}),e.jsx(oe,{children:e.jsxs(de,{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:N.subject||"(Sans objet)"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-1 md:gap-4 mt-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx($e,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"font-medium",children:"De:"}),e.jsx("span",{className:"ml-1",children:N.from.map(s=>s.name||s.address).join(", ")})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(ns,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"font-medium",children:"Date:"}),e.jsx("span",{className:"ml-1",children:new Date(N.date).toLocaleString("fr-FR")})]})]}),N.to&&N.to.length>0&&e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground mt-1",children:[e.jsx($e,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"font-medium",children:"À:"}),e.jsx("span",{className:"ml-1",children:N.to.map(s=>s.name||s.address).join(", ")})]})]}),e.jsx(Ws,{}),e.jsxs("div",{children:[N.hasAttachments&&e.jsxs("div",{className:"mb-4 border border-dashed rounded-md p-3",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(cs,{className:"h-4 w-4 mr-2 text-blue-500"}),e.jsxs("span",{className:"font-medium",children:[((ua=N.attachments)==null?void 0:ua.length)||0," pièce(s) jointe(s)"]})]}),N.attachments&&N.attachments.length>0&&e.jsx("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2",children:N.attachments.map((s,t)=>e.jsxs("div",{className:"flex items-center bg-muted p-2 rounded-md text-xs",children:[e.jsx(ge,{className:"h-4 w-4 mr-2 text-blue-500"}),e.jsx("span",{className:"truncate flex-1",children:s.filename}),e.jsxs("span",{className:"text-muted-foreground ml-2",children:[Math.round(s.size/1024),"KB"]})]},t))})]}),e.jsx("div",{className:"email-content",children:N.html?e.jsx("div",{className:"border rounded-md p-4 bg-white",dangerouslySetInnerHTML:{__html:N.html}}):e.jsx("div",{className:"border rounded-md p-4 bg-white whitespace-pre-line",children:N.text||"(Pas de contenu)"})})]})]})})]}):Ge.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(us,{className:"h-12 w-12 mx-auto text-gray-300 mb-3"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Corbeille vide"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-md mx-auto",children:"Aucun email dans la corbeille."})]}):e.jsxs(Ee,{children:[e.jsx(ke,{children:e.jsxs(K,{children:[e.jsx(w,{className:"w-[40px]"}),e.jsx(w,{children:"Expéditeur"}),e.jsx(w,{children:"Sujet"}),e.jsx(w,{className:"hidden md:table-cell",children:"Date"}),e.jsx(w,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(De,{children:Ge.map(s=>{var t,o,m,v,L,W;return e.jsxs(K,{children:[e.jsx(C,{children:e.jsx("div",{className:"flex items-center",children:s.hasAttachments&&e.jsx(cs,{className:"h-4 w-4 text-muted-foreground"})})}),e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-6 w-6",children:e.jsx(ks,{className:"text-xs",children:((o=(t=s.from[0])==null?void 0:t.name)==null?void 0:o[0])||((v=(m=s.from[0])==null?void 0:m.address)==null?void 0:v[0])||"?"})}),e.jsx("div",{className:"truncate max-w-[120px] md:max-w-[180px]",children:((L=s.from[0])==null?void 0:L.name)||((W=s.from[0])==null?void 0:W.address)||"Inconnu"})]})}),e.jsx(C,{children:e.jsx("div",{className:"cursor-pointer truncate max-w-[180px] md:max-w-[300px]",onClick:()=>Se(s),children:s.subject||"(Sans objet)"})}),e.jsx(C,{className:"hidden md:table-cell text-muted-foreground text-sm",children:new Date(s.date).toLocaleString("fr-FR",{year:"numeric",month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsx(C,{children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(x,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-primary hover:bg-primary/10",onClick:()=>Se(s),title:"Voir",children:e.jsx(Js,{className:"h-3.5 w-3.5"})}),e.jsx(x,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 text-blue-500 hover:text-blue-600 hover:bg-blue-50",onClick:()=>{_s.mutate({userId:q,messageId:s.id,destinationMailbox:fe,sourceMailbox:G})},title:"Restaurer",children:e.jsx(Ds,{className:"h-3.5 w-3.5"})})]})})]},s.id)})})]}),!je&&!Ue&&Ae.length>0&&e.jsx(Zs,{currentPage:ys,totalPages:Gs,totalEmails:Ss,indexOfFirstEmail:As,indexOfLastEmail:rs,onPageChange:Ks})]})]})]})})]}),e.jsx(Re,{open:h,onOpenChange:V,children:e.jsxs(Le,{className:"max-w-3xl",children:[e.jsxs(Te,{children:[e.jsx(ze,{children:k?"Modifier le modèle":"Nouveau modèle d'email"}),e.jsx(Ie,{children:"Créez ou modifiez un modèle d'email pour une utilisation rapide."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"template-name",className:"text-right",children:"Nom"}),e.jsx(R,{id:"template-name",placeholder:"Nom du modèle",className:"col-span-3",value:(k==null?void 0:k.name)||"",onChange:s=>$(t=>t?{...t,name:s.target.value}:{id:"",name:s.target.value,subject:"",body:"",trigger:"",active:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"template-trigger",className:"text-right",children:"Déclencheur"}),e.jsx(R,{id:"template-trigger",placeholder:"Ex: nouveau-client, suivi-commande",className:"col-span-3",value:(k==null?void 0:k.trigger)||"",onChange:s=>$(t=>t?{...t,trigger:s.target.value}:{id:"",name:"",subject:"",body:"",trigger:s.target.value,active:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"template-subject",className:"text-right",children:"Sujet"}),e.jsx(R,{id:"template-subject",placeholder:"Sujet de l'email",className:"col-span-3",value:(k==null?void 0:k.subject)||"",onChange:s=>$(t=>t?{...t,subject:s.target.value}:{id:"",name:"",subject:s.target.value,body:"",trigger:"",active:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx(g,{htmlFor:"template-body",className:"text-right pt-2",children:"Contenu"}),e.jsx(ps,{id:"template-body",placeholder:"Contenu de l'email...",className:"col-span-3 min-h-[200px]",value:(k==null?void 0:k.body)||"",onChange:s=>$(t=>t?{...t,body:s.target.value}:{id:"",name:"",subject:"",body:s.target.value,trigger:"",active:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("div",{className:"text-right",children:e.jsx(g,{htmlFor:"template-active",className:"mr-2",children:"Actif"})}),e.jsx("div",{className:"col-span-3",children:e.jsx(Qs,{id:"template-active",checked:(k==null?void 0:k.active)||!1,onCheckedChange:s=>$(t=>t?{...t,active:s}:{id:"",name:"",subject:"",body:"",trigger:"",active:s,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})})})]})]}),e.jsxs(We,{children:[e.jsx(x,{variant:"outline",onClick:()=>V(!1),children:"Annuler"}),e.jsx(x,{children:"Enregistrer"})]})]})}),e.jsx(Re,{open:js,onOpenChange:ve,children:e.jsxs(Le,{children:[e.jsxs(Te,{children:[e.jsx(ze,{children:"Tester le modèle"}),e.jsx(Ie,{children:"Envoyez un email de test pour vérifier l'apparence du modèle."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"test-email",className:"text-right",children:"Destinataire"}),e.jsx(R,{id:"test-email",placeholder:"Email de test",className:"col-span-3",value:Ze,onChange:s=>Ts(s.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{className:"text-right",children:"Modèle"}),e.jsx("div",{className:"col-span-3",children:e.jsx(Y,{variant:"outline",className:"bg-gray-50 border-gray-200",children:(k==null?void 0:k.name)||"Modèle non sélectionné"})})]})]}),e.jsxs(We,{children:[e.jsx(x,{variant:"outline",onClick:()=>ve(!1),children:"Annuler"}),e.jsx(x,{disabled:!bs(Ze)||!k,children:"Envoyer le test"})]})]})}),e.jsx(Re,{open:qe,onOpenChange:ye,children:e.jsxs(Le,{className:"max-w-3xl",children:[e.jsxs(Te,{children:[e.jsx(ze,{children:"Nouveau message"}),e.jsx(Ie,{children:"Rédigez un email personnalisé."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"email-to",className:"text-right",children:"Destinataire"}),e.jsxs("div",{className:"col-span-3 flex items-center gap-2",children:[e.jsx(R,{id:"email-to",placeholder:"Email du destinataire",className:"flex-1",value:M,onChange:s=>we(s.target.value)}),e.jsx(x,{variant:"outline",size:"sm",onClick:vt,disabled:!M||!bs(M),children:"Ajouter"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{className:"text-right",children:"Rechercher par référence"}),e.jsx("div",{className:"col-span-3",children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(R,{placeholder:"Ex: RAC-2025-0602-143045-742",className:"flex-1",value:ee,onChange:s=>_e(s.target.value),onKeyDown:s=>s.key==="Enter"&&ra()}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:ra,disabled:c,title:"Rechercher un lead",children:[c?e.jsx(_,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx($e,{className:"h-4 w-4 mr-1"}),"Leads"]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:rt,disabled:F,title:"Rechercher une demande de service",children:[F?e.jsx(_,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(ge,{className:"h-4 w-4 mr-1"}),"Demandes"]})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4 mt-2",children:[e.jsx("div",{}),e.jsxs("div",{className:"col-span-3",children:[l&&j.length>0&&e.jsx("div",{className:"mt-2 border rounded-md max-h-[200px] overflow-y-auto",children:e.jsxs(Ee,{children:[e.jsx(ke,{children:e.jsxs(K,{children:[e.jsx(w,{className:"w-[200px]",children:"Nom"}),e.jsx(w,{children:"Référence"}),e.jsx(w,{className:"text-right",children:"Action"})]})}),e.jsx(De,{children:j.map(s=>e.jsxs(K,{children:[e.jsxs(C,{className:"font-medium",children:[s.firstName," ",s.lastName]}),e.jsx(C,{children:s.referenceNumber||"N/A"}),e.jsx(C,{className:"text-right",children:e.jsx(x,{size:"sm",variant:"outline",onClick:()=>{we(s.email),E(!1),a({title:"Lead sélectionné",description:`${s.firstName} ${s.lastName} ajouté comme destinataire`})},children:"Sélectionner"})})]},s.id))})]})}),l&&j.length===0&&e.jsx("div",{className:"mt-2 p-4 text-center text-muted-foreground border rounded-md",children:"Aucun lead trouvé"}),d&&r.length>0&&e.jsx("div",{className:"mt-2 border rounded-md max-h-[200px] overflow-y-auto",children:e.jsxs(Ee,{children:[e.jsx(ke,{children:e.jsxs(K,{children:[e.jsx(w,{children:"Référence"}),e.jsx(w,{className:"w-[200px]",children:"Client"}),e.jsx(w,{className:"text-right",children:"Action"})]})}),e.jsx(De,{children:r.map(s=>e.jsxs(K,{children:[e.jsx(C,{className:"font-medium",children:s.referenceNumber}),e.jsx(C,{children:s.clientName}),e.jsx(C,{className:"text-right",children:e.jsx(x,{size:"sm",variant:"outline",onClick:()=>{we(s.clientEmail),S(!1),a({title:"Demande sélectionnée",description:`${s.referenceNumber} ajoutée comme destinataire`})},children:"Sélectionner"})})]},s.id))})]})}),d&&r.length===0&&e.jsx("div",{className:"mt-2 p-4 text-center text-muted-foreground border rounded-md",children:"Aucune demande trouvée"})]})]}),ne.length>0&&e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx("div",{}),e.jsx("div",{className:"col-span-3 flex flex-wrap gap-2",children:ne.map(s=>e.jsxs(Y,{variant:"secondary",className:"flex items-center gap-1.5 py-1.5 pl-2 pr-1.5",children:[e.jsx("span",{children:s}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-4 w-4 rounded-full hover:bg-gray-200 p-0",onClick:()=>Nt(s),children:e.jsx(ea,{className:"h-2.5 w-2.5"})})]},s))})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{htmlFor:"email-subject",className:"text-right",children:"Sujet"}),e.jsx(R,{id:"email-subject",placeholder:"Sujet de l'email",className:"col-span-3",value:le,onChange:s=>vs(s.target.value)})]}),P&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(g,{className:"text-right",children:"Modèle"}),e.jsx("div",{className:"col-span-3",children:e.jsx(Y,{variant:"outline",className:"bg-gray-50 border-gray-200",children:P.name})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-start gap-4",children:[e.jsx(g,{htmlFor:"email-content",className:"text-right pt-2",children:"Message"}),e.jsx(ps,{id:"email-content",placeholder:"Contenu de l'email...",className:"col-span-3 min-h-[200px]",value:n,onChange:s=>y(s.target.value)})]})]}),e.jsxs(We,{children:[e.jsx(x,{variant:"outline",onClick:()=>ye(!1),children:"Annuler"}),e.jsx(x,{onClick:gt,disabled:!M&&ne.length===0||!le||!n||Cs.isPending,children:Cs.isPending?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),"Envoi en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"mr-2 h-4 w-4"}),"Envoyer"]})})]})]})}),e.jsx(Re,{open:es,onOpenChange:Ne,children:e.jsxs(Le,{className:"max-w-3xl",children:[e.jsxs(Te,{children:[e.jsx(ze,{children:"Envoyer un email aux leads"}),e.jsx(Ie,{children:"Sélectionnez les leads auxquels vous souhaitez envoyer un email."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Qs,{id:"select-all",checked:be,onCheckedChange:s=>Is(s)}),e.jsx(g,{htmlFor:"select-all",children:"Tous sélectionner"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{placeholder:"Rechercher un lead...",value:ee,onChange:s=>_e(s.target.value),className:"w-48 h-8 text-xs"}),e.jsxs(Fe,{value:he,onValueChange:fs,children:[e.jsx(Me,{className:"w-[130px] h-8 text-xs",children:e.jsx(Oe,{placeholder:"Tous les statuts"})}),e.jsxs(Pe,{children:[e.jsx(I,{value:"",children:"Tous les statuts"}),e.jsx(I,{value:"nouveau",children:"Nouveau"}),e.jsx(I,{value:"en_cours",children:"En cours"}),e.jsx(I,{value:"termine",children:"Terminé"}),e.jsx(I,{value:"annule",children:"Annulé"})]})]})]})]}),e.jsx("div",{className:"border rounded-md max-h-[300px] overflow-y-auto",children:it?e.jsx("div",{className:"flex justify-center items-center py-6",children:e.jsx(_,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):oa.length===0?e.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[e.jsx($e,{className:"h-8 w-8 mx-auto text-gray-300 mb-2"}),e.jsx("p",{children:"Aucun lead correspondant aux critères."})]}):e.jsxs(Ee,{children:[e.jsx(ke,{children:e.jsxs(K,{children:[e.jsx(w,{className:"w-[50px]"}),e.jsx(w,{children:"Nom"}),e.jsx(w,{children:"Email"}),e.jsx(w,{children:"Référence"}),e.jsx(w,{children:"Statut"})]})}),e.jsx(De,{children:oa.map(s=>e.jsxs(K,{children:[e.jsx(C,{children:e.jsx(Qs,{checked:Z.some(t=>t.id===s.id),onCheckedChange:t=>ca(s,t)})}),e.jsxs(C,{children:[s.firstName," ",s.lastName]}),e.jsx(C,{children:s.email}),e.jsx(C,{children:s.referenceNumber||"-"}),e.jsx(C,{children:e.jsx(Y,{variant:"outline",className:te(s.status==="nouveau"&&"bg-blue-50 text-blue-700 border-blue-200",s.status==="en_cours"&&"bg-amber-50 text-amber-700 border-amber-200",s.status==="termine"&&"bg-green-50 text-green-700 border-green-200",s.status==="annule"&&"bg-red-50 text-red-700 border-red-200"),children:{nouveau:"Nouveau",en_cours:"En cours",termine:"Terminé",annule:"Annulé"}[s.status||""]||"Non défini"})})]},s.id))})]})}),e.jsxs("div",{className:"mt-2 mb-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Destinataires sélectionnés:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Z.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun destinataire sélectionné"}):Z.map(s=>e.jsxs(Y,{variant:"secondary",className:"flex items-center gap-1.5 py-1.5 pl-2 pr-1.5 bg-white border shadow-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{children:[s.firstName," ",s.lastName]}),s.referenceNumber&&e.jsx("span",{className:"text-xs text-primary font-normal",children:s.referenceNumber})]}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-5 w-5 rounded-full hover:bg-gray-200 ml-1.5",onClick:()=>ca(s,!1),children:e.jsx(ea,{className:"h-3 w-3"})})]},`lead-${s.id}`))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Sélectionnez un modèle:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:ia?e.jsx("div",{className:"col-span-full flex justify-center items-center py-4",children:e.jsx(_,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):ts.length===0?e.jsx("div",{className:"col-span-full text-center py-4 text-muted-foreground",children:e.jsx("p",{children:"Aucun modèle disponible."})}):ts.map(s=>e.jsxs(oe,{className:te("cursor-pointer transition-all hover:border-primary hover:shadow-md",(P==null?void 0:P.id)===s.id&&"border-primary ring-1 ring-primary"),onClick:()=>zs(s),children:[e.jsx(Xe,{className:"p-3 pb-1",children:e.jsxs(Qe,{className:"text-sm flex items-center justify-between",children:[e.jsx("span",{className:"truncate",children:s.name}),s.active?e.jsx(Y,{variant:"outline",className:"ml-2 bg-green-50 text-green-700 hover:bg-green-50 border-green-200 text-xs py-0",children:"Actif"}):e.jsx(Y,{variant:"outline",className:"ml-2 bg-gray-50 text-gray-500 hover:bg-gray-50 border-gray-200 text-xs py-0",children:"Inactif"})]})}),e.jsx(de,{className:"p-3 pt-1.5",children:e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Sujet:"})," ",s.subject]}),e.jsxs("div",{className:"mt-1 truncate",children:[e.jsx("span",{className:"font-medium",children:"Contenu:"})," ",s.body.substring(0,50),"..."]})]})})]},s.id))})]}),P&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Aperçu du modèle:"}),e.jsx(oe,{children:e.jsxs(de,{className:"p-4",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"font-medium text-sm",children:"Sujet:"})," ",P.subject]}),e.jsx(Ws,{className:"my-2"}),e.jsx("div",{className:"whitespace-pre-line text-sm",children:P.body})]})})]})]}),e.jsxs(We,{children:[e.jsx(x,{variant:"outline",onClick:()=>Ne(!1),children:"Annuler"}),e.jsxs(x,{onClick:()=>ft(P),disabled:Z.length===0||!P,children:["Envoyer à ",Z.length," destinataire",Z.length!==1?"s":""]})]})]})}),e.jsx(dr,{isOpen:Ce,onClose:()=>b(!1),initialRecipient:p,initialSubject:Q,initialBody:aa,selectedLead:Ns,selectedServiceRequest:tt}),e.jsx(wr,{open:ut,onOpenChange:Us,children:e.jsxs(Wa,{children:[e.jsxs(Ya,{children:[e.jsx(Za,{children:"Confirmer la suppression"}),e.jsx(et,{children:"Êtes-vous sûr de vouloir supprimer cet email ? Cette action est irréversible."})]}),e.jsxs(Ja,{children:[e.jsx(at,{children:"Annuler"}),e.jsx(st,{onClick:pt,className:"bg-red-600 hover:bg-red-700",children:Vs.isPending?e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}),"Suppression..."]}):"Supprimer"})]})]})})]})}export{oi as default};
