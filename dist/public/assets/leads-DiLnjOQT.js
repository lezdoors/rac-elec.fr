import{c as qe,a as fe,j as e,L as de,B as w,al as Ye,r as g,am as Ze,ao as Me,ap as ke,aq as Rs,an as _s,v as es,z as N,d as Ps,e as je,X as Le,F as ks,f as _,g as P,h as k,i as L,D as ae,k as I,I as B,a1 as ss,t as Ls,l as Y,o as Ie,p as rs,$ as Is,M as $s,P as Fs,a4 as K,aQ as qs,w as Ms}from"./index-BLoS_0LT.js";import{u as Pe}from"./useQuery-KQQkfJQL.js";import{C as Vs,D as Os,p as Ds,q as zs,x as ue,v as he,r as z,y as Bs,A as Gs,U as Us,z as Ks}from"./admin-layout-Deqloubg.js";import{C as me,d as pe,a as $e,b as Fe,c as Ws,e as Hs}from"./card-aVTXWK1R.js";import{S as se,a as re,d as ne,b as te,c as j}from"./select-CbPx4enh.js";import{B as W}from"./badge-DtFIJxC4.js";import{T as ns,a as ts,b as H,c as Q}from"./tabs-BfedRaxc.js";import{L as C}from"./schema-DqLMhGT0.js";import{c as as,R as Qs,I as Xs}from"./use-mobile-BXhop-qi.js";import{u as Js}from"./index-CpuPSOm8.js";import{u as Ys}from"./index-BNMzf5Fr.js";import{u as Zs}from"./index-BwzLys51.js";import{A as er}from"./appointment-modal-CD15ADwK.js";import{C as sr}from"./circle-x-BBSWCjgy.js";import{T as is}from"./triangle-alert-BmHDiVkX.js";import{D as ls}from"./download-DxJdLfjP.js";import{F as rr}from"./file-text-D2gMvw-5.js";import{T as nr}from"./trash-2-De8nne7G.js";import{E as tr}from"./jspdf.es.min-Mrcsrdpq.js";import ar from"./html2canvas.esm-CBrSDip1.js";import{A as ir,a as lr,b as cr,c as or,d as dr,e as mr,f as pr,g as xr}from"./alert-dialog-jG0Mq-FE.js";import{S as ur}from"./search-D7dcZXPi.js";import{P as hr}from"./phone-call-Dpd8u0Fn.js";import{I as gr}from"./info-ryf1hc4_.js";import"./use-auth-BQft_32K.js";import"./log-out-De6GffcA.js";import"./credit-card-DkxUTpwi.js";import"./settings-BWQUVhkH.js";import"./index-EVrCeJlw.js";import"./separator-3tCi-qaU.js";import"./external-link-jHrayAQ5.js";import"./chevron-down-ejZbNYEb.js";import"./calendar-Bn39EUJ8.js";import"./endOfMonth-BE3PbLK0.js";import"./isBefore-Bw3eZk8e.js";import"./popover-DP9ObzcZ.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=qe("CircleArrowRight",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fr=qe("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=qe("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);function Ve({leadsLoading:s,incompleteLeadsData:n,currentPage:a,goToPage:c,goToPreviousPage:p,goToNextPage:d,openDetailsDialog:t,openAssignDialog:m,title:x="Leads incomplets",description:y="Formulaires partiellement remplis par les utilisateurs"}){return fe(),e.jsx(e.Fragment,{children:s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(de,{className:"h-8 w-8 animate-spin text-blue-600"})}):!(n!=null&&n.leads)||n.leads.length===0?e.jsx(me,{children:e.jsx(pe,{className:"py-10 text-center",children:e.jsxs("p",{className:"text-muted-foreground mb-4",children:["Aucun ",x.toLowerCase()," trouv√©."]})})}):e.jsxs(me,{children:[e.jsxs($e,{className:"pb-1",children:[e.jsx(Fe,{children:x}),e.jsx(Ws,{children:y})]}),e.jsx(pe,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"R√©f√©rence"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Client"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Source"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"√âtape"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Date"}),e.jsx("th",{className:"text-right py-3 px-2 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:n.leads.map(r=>{const u=new Date(r.createdAt).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});return e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsxs("td",{className:"py-3 px-2",children:[e.jsx("div",{className:"font-mono text-xs text-blue-600",children:r.referenceNumber||r.reference_number||`#${r.id}`}),r.sessionToken&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Session: ",r.sessionToken.substring(0,8),"..."]})]}),e.jsxs("td",{className:"py-3 px-2",children:[e.jsx("div",{className:"font-medium",children:r.firstName||r.lastName?`${r.firstName||""} ${r.lastName||""}`.trim():r.name?r.name:r.email?`<${r.email}>`:"Non renseign√©"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[r.email||"Email non fourni",r.phone&&e.jsxs("span",{className:"ml-2 text-blue-600",children:["‚Ä¢ ",r.phone]})]}),r.clientType&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:r.clientType==="particulier"?"Particulier":r.clientType==="professionnel"?"Professionnel":r.clientType})})]}),e.jsxs("td",{className:"py-3 px-2",children:[r.referenceNumber&&r.referenceNumber.includes("LEAD-")?e.jsx(W,{variant:"outline",className:"bg-blue-50 text-blue-700 hover:bg-blue-100",children:"üìß Email"}):e.jsx(W,{variant:"outline",className:"bg-green-50 text-green-700 hover:bg-green-100",children:"üåê Web"}),r.serviceType&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:r.serviceType==="electricity"?"√âlectricit√©":r.serviceType==="photovoltaic"?"Photovolta√Øque":r.serviceType})]}),e.jsx("td",{className:"py-3 px-2",children:r.completedSteps===3?e.jsx(W,{variant:"outline",className:"bg-green-50 text-green-700 hover:bg-green-100",children:"Complet ‚úì"}):e.jsxs(W,{variant:"outline",children:["√âtape ",Math.max(1,r.completedSteps||1),"/3"]})}),e.jsx("td",{className:"py-3 px-2",children:r.status?e.jsxs(W,{variant:"secondary",className:`
                              ${r.status===C.INTERESTED?"bg-green-100 text-green-800 hover:bg-green-200":""}
                              ${r.status===C.NOT_INTERESTED?"bg-red-100 text-red-800 hover:bg-red-200":""}
                              ${r.status===C.NO_RESPONSE?"bg-amber-100 text-amber-800 hover:bg-amber-200":""}
                              ${r.status===C.CALLBACK_SCHEDULED?"bg-blue-100 text-blue-800 hover:bg-blue-200":""}
                              ${r.status===C.NEW||!r.status?"bg-gray-100 text-gray-800 hover:bg-gray-200":""}
                            `,children:[r.status===C.INTERESTED&&"Int√©ress√©",r.status===C.NOT_INTERESTED&&"Non int√©ress√©",r.status===C.NO_RESPONSE&&"Sans r√©ponse",r.status===C.CALLBACK_SCHEDULED&&"Rappel programm√©",(r.status===C.NEW||!r.status)&&"Nouveau"]}):e.jsx(W,{variant:"secondary",className:"bg-gray-100 text-gray-800 hover:bg-gray-200",children:"Nouveau"})}),e.jsx("td",{className:"py-3 px-2 text-muted-foreground text-xs",children:u}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[r.phone&&e.jsx(w,{variant:"ghost",size:"icon",title:"WhatsApp",onClick:()=>{let h=r.phone.replace(/\s+/g,"");h.startsWith("0")?h="+33"+h.substring(1):h.startsWith("+")||(h="+33"+h);const f=`Bonjour ${r.firstName||r.lastName?`${r.firstName||""} ${r.lastName||""}`.trim():r.name||"Client"}, nous avons bien re√ßu votre demande de raccordement √©lectrique. L'√©quipe demande-raccordement.fr souhaite vous contacter pour finaliser votre dossier.`;window.open(`https://wa.me/${h}?text=${encodeURIComponent(f)}`,"_blank")},className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:e.jsx("svg",{viewBox:"0 0 24 24",className:"h-4 w-4",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M17.6 6.32A7.85 7.85 0 0 0 12.025 4c-4.4 0-7.975 3.58-7.975 7.98a8.06 8.06 0 0 0 1.065 4.02L4 20l4.1-1.08a7.88 7.88 0 0 0 3.775.965h.004c4.4 0 7.975-3.58 7.975-7.98a8.05 8.05 0 0 0-2.254-5.585zM12.025 18.37h-.003a6.58 6.58 0 0 1-3.335-.92l-.24-.144-2.48.652.66-2.425-.156-.25a6.56 6.56 0 0 1-1.01-3.505 6.48 6.48 0 0 1 6.565-6.56c1.75 0 3.4.685 4.65 1.925a6.565 6.565 0 0 1 1.935 4.66c-.005 3.64-2.965 6.565-6.585 6.565zm3.595-4.92c-.2-.1-1.175-.58-1.36-.65-.18-.065-.315-.1-.445.1-.13.195-.51.645-.62.775-.115.13-.23.145-.43.05-.2-.1-.845-.31-1.605-.995-.595-.535-.995-1.2-1.115-1.4-.115-.2-.01-.31.09-.41.09-.09.2-.235.3-.355.1-.115.135-.2.2-.33.065-.135.035-.25-.015-.35-.05-.1-.445-1.075-.61-1.47-.16-.39-.32-.335-.445-.34-.115-.01-.245-.01-.375-.01s-.345.05-.525.25c-.18.2-.685.67-.685 1.64 0 .97.705 1.905.8 2.035.095.135 1.36 2.075 3.295 2.915 1.94.84 1.94.56 2.29.525.35-.035 1.125-.46 1.285-.91.16-.44.16-.82.115-.9-.05-.075-.18-.12-.38-.21z"})})}),e.jsx(w,{variant:"ghost",size:"icon",title:"Voir les d√©tails",onClick:()=>t(r.id),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]})}),e.jsx(w,{variant:"ghost",size:"icon",title:"Assigner",onClick:()=>m(r.id),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]})})]})})]},r.id)})})]})})}),e.jsxs(Hs,{className:"flex justify-between border-t p-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Affichage de ",(a-1)*20+1,"-",Math.min(a*20,n.pagination.total),"sur ",n.pagination.total," ",x.toLowerCase(),n.pagination.total!==1?"s":""]}),n.pagination.totalPages>1&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{variant:"outline",size:"sm",onClick:p,disabled:a===1,children:"Pr√©c√©dent"}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(n.pagination.totalPages,5)},(r,v)=>{let u;return n.pagination.totalPages<=5||a<=3?u=v+1:a>=n.pagination.totalPages-2?u=n.pagination.totalPages-4+v:u=a-2+v,e.jsx(w,{variant:a===u?"default":"outline",size:"sm",onClick:()=>c(u),children:u},u)})}),e.jsx(w,{variant:"outline",size:"sm",onClick:d,disabled:a>=n.pagination.totalPages,children:"Suivant"})]})]})]})})}function Nr({leadsLoading:s,allLeadsData:n,currentPage:a,goToPage:c,goToPreviousPage:p,goToNextPage:d,openDetailsDialog:t,openAssignDialog:m}){return e.jsx(Ve,{leadsLoading:s,incompleteLeadsData:n,currentPage:a,goToPage:c,goToPreviousPage:p,goToNextPage:d,openDetailsDialog:t,openAssignDialog:m,title:"Tous les leads",description:"Liste compl√®te de tous les leads du syst√®me"})}function yr({leadsLoading:s,newLeadsData:n,currentPage:a,goToPage:c,goToPreviousPage:p,goToNextPage:d,openDetailsDialog:t,openAssignDialog:m}){return e.jsx(Ve,{leadsLoading:s,incompleteLeadsData:n,currentPage:a,goToPage:c,goToPreviousPage:p,goToNextPage:d,openDetailsDialog:t,openAssignDialog:m,title:"Nouveaux leads",description:"Leads cr√©√©s dans les derni√®res 24 heures"})}var Oe="Radio",[br,cs]=Ye(Oe),[Cr,wr]=br(Oe),os=g.forwardRef((s,n)=>{const{__scopeRadio:a,name:c,checked:p=!1,required:d,disabled:t,value:m="on",onCheck:x,form:y,...r}=s,[v,u]=g.useState(null),h=Ze(n,S=>u(S)),o=g.useRef(!1),f=v?y||!!v.closest("form"):!0;return e.jsxs(Cr,{scope:a,checked:p,disabled:t,children:[e.jsx(Me.button,{type:"button",role:"radio","aria-checked":p,"data-state":ps(p),"data-disabled":t?"":void 0,disabled:t,value:m,...r,ref:h,onClick:ke(s.onClick,S=>{p||x==null||x(),f&&(o.current=S.isPropagationStopped(),o.current||S.stopPropagation())})}),f&&e.jsx(Er,{control:v,bubbles:!o.current,name:c,value:m,checked:p,required:d,disabled:t,form:y,style:{transform:"translateX(-100%)"}})]})});os.displayName=Oe;var ds="RadioIndicator",ms=g.forwardRef((s,n)=>{const{__scopeRadio:a,forceMount:c,...p}=s,d=wr(ds,a);return e.jsx(Rs,{present:c||d.checked,children:e.jsx(Me.span,{"data-state":ps(d.checked),"data-disabled":d.disabled?"":void 0,...p,ref:n})})});ms.displayName=ds;var Er=s=>{const{control:n,checked:a,bubbles:c=!0,...p}=s,d=g.useRef(null),t=Zs(a),m=Ys(n);return g.useEffect(()=>{const x=d.current,y=window.HTMLInputElement.prototype,v=Object.getOwnPropertyDescriptor(y,"checked").set;if(t!==a&&v){const u=new Event("click",{bubbles:c});v.call(x,a),x.dispatchEvent(u)}},[t,a,c]),e.jsx("input",{type:"radio","aria-hidden":!0,defaultChecked:a,...p,tabIndex:-1,ref:d,style:{...s.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function ps(s){return s?"checked":"unchecked"}var Tr=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],De="RadioGroup",[Sr,bn]=Ye(De,[as,cs]),xs=as(),us=cs(),[Ar,Rr]=Sr(De),hs=g.forwardRef((s,n)=>{const{__scopeRadioGroup:a,name:c,defaultValue:p,value:d,required:t=!1,disabled:m=!1,orientation:x,dir:y,loop:r=!0,onValueChange:v,...u}=s,h=xs(a),o=Js(y),[f,S]=_s({prop:d,defaultProp:p,onChange:v});return e.jsx(Ar,{scope:a,name:c,required:t,disabled:m,value:f,onValueChange:S,children:e.jsx(Qs,{asChild:!0,...h,orientation:x,dir:o,loop:r,children:e.jsx(Me.div,{role:"radiogroup","aria-required":t,"aria-orientation":x,"data-disabled":m?"":void 0,dir:o,...u,ref:n})})})});hs.displayName=De;var gs="RadioGroupItem",js=g.forwardRef((s,n)=>{const{__scopeRadioGroup:a,disabled:c,...p}=s,d=Rr(gs,a),t=d.disabled||c,m=xs(a),x=us(a),y=g.useRef(null),r=Ze(n,y),v=d.value===p.value,u=g.useRef(!1);return g.useEffect(()=>{const h=f=>{Tr.includes(f.key)&&(u.current=!0)},o=()=>u.current=!1;return document.addEventListener("keydown",h),document.addEventListener("keyup",o),()=>{document.removeEventListener("keydown",h),document.removeEventListener("keyup",o)}},[]),e.jsx(Xs,{asChild:!0,...m,focusable:!t,active:v,children:e.jsx(os,{disabled:t,required:d.required,checked:v,...x,...p,name:d.name,ref:r,onCheck:()=>d.onValueChange(p.value),onKeyDown:ke(h=>{h.key==="Enter"&&h.preventDefault()}),onFocus:ke(p.onFocus,()=>{var h;u.current&&((h=y.current)==null||h.click())})})})});js.displayName=gs;var _r="RadioGroupIndicator",fs=g.forwardRef((s,n)=>{const{__scopeRadioGroup:a,...c}=s,p=us(a);return e.jsx(ms,{...p,...c,ref:n})});fs.displayName=_r;var vs=hs,Ns=js,Pr=fs;const ys=g.forwardRef(({className:s,...n},a)=>e.jsx(vs,{className:es("grid gap-2",s),...n,ref:a}));ys.displayName=vs.displayName;const ge=g.forwardRef(({className:s,...n},a)=>e.jsx(Ns,{ref:a,className:es("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...n,children:e.jsx(Pr,{className:"flex items-center justify-center",children:e.jsx(Vs,{className:"h-2.5 w-2.5 fill-current text-current"})})}));ge.displayName=Ns.displayName;const kr=N.object({clientType:N.enum(["particulier","professionnel","collectivite"],{errorMap:()=>({message:"Veuillez s√©lectionner un type de client"})}),firstName:N.string().min(1,"Le pr√©nom est requis"),lastName:N.string().min(1,"Le nom est requis"),email:N.string().email("Adresse email invalide"),phone:N.string().regex(/^[0-9]{10}$/,"Le num√©ro doit contenir exactement 10 chiffres"),company:N.string().optional().or(N.literal("")),siret:N.string().optional().or(N.literal("")),address:N.string().optional().or(N.literal("")),addressComplement:N.string().optional().or(N.literal("")),postalCode:N.string().optional().or(N.literal("")),city:N.string().optional().or(N.literal("")),serviceType:N.enum(["electricity"],{errorMap:()=>({message:"Veuillez s√©lectionner un type de service"})}),requestType:N.enum(["new_connection","power_upgrade","temporary_connection","relocation","technical_visit","other"]),buildingType:N.enum(["individual_house","apartment_building","commercial","industrial","agricultural","public","terrain"]).optional(),terrainViabilise:N.enum(["viabilise","non_viabilise"]).optional(),powerRequired:N.string().optional(),phaseType:N.enum(["monophase","triphase"]).optional(),comments:N.string().optional().or(N.literal(""))}).refine(s=>!(s.clientType==="professionnel"&&(!s.company||!s.siret)),{message:"La raison sociale et le num√©ro SIRET sont requis pour les professionnels",path:["siret"]});function Lr({isOpen:s,onClose:n,onLeadCreated:a}){const{toast:c}=fe(),[p,d]=g.useState(!1),t=Ps({resolver:Ls(kr),defaultValues:{clientType:"particulier",firstName:"",lastName:"",email:"",phone:"",company:"",siret:"",address:"",addressComplement:"",postalCode:"",city:"",serviceType:"electricity",requestType:"new_connection",buildingType:"individual_house",terrainViabilise:"viabilise",powerRequired:"9",phaseType:"monophase",comments:""}}),m=t.watch("clientType"),x=je({mutationFn:async r=>await(await Y("POST","/api/leads/admin-create",r)).json(),onSuccess:r=>{r.success?(c({title:"Lead cr√©√© avec succ√®s",description:`R√©f√©rence: ${r.referenceNumber}`}),a(),n()):c({title:"Erreur",description:r.message||"Une erreur est survenue lors de la cr√©ation du lead",variant:"destructive"})},onError:r=>{c({title:"Erreur",description:r.message||"Une erreur est survenue lors de la cr√©ation du lead",variant:"destructive"})},onSettled:()=>{d(!1)}}),y=async r=>{d(!0),x.mutate(r)};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Cr√©er un nouveau lead"}),e.jsx(w,{variant:"ghost",size:"icon",onClick:n,className:"h-8 w-8 rounded-full",children:e.jsx(Le,{className:"h-4 w-4"})})]}),e.jsx(ks,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(y),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Informations du client"}),e.jsx(_,{control:t.control,name:"clientType",render:({field:r})=>e.jsxs(P,{className:"space-y-1",children:[e.jsx(k,{children:"Type de client"}),e.jsx(L,{children:e.jsxs(ys,{onValueChange:r.onChange,defaultValue:r.value,className:"flex space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ge,{value:"particulier",id:"particulier"}),e.jsx(ae,{htmlFor:"particulier",children:"Particulier"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ge,{value:"professionnel",id:"professionnel"}),e.jsx(ae,{htmlFor:"professionnel",children:"Professionnel"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ge,{value:"collectivite",id:"collectivite"}),e.jsx(ae,{htmlFor:"collectivite",children:"Collectivit√©"})]})]})}),e.jsx(I,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_,{control:t.control,name:"firstName",render:({field:r})=>e.jsxs(P,{children:[e.jsx(k,{children:"Pr√©nom"}),e.jsx(L,{children:e.jsx(B,{placeholder:"Pr√©nom",...r})}),e.jsx(I,{})]})}),e.jsx(_,{control:t.control,name:"lastName",render:({field:r})=>e.jsxs(P,{children:[e.jsx(k,{children:"Nom"}),e.jsx(L,{children:e.jsx(B,{placeholder:"Nom",...r})}),e.jsx(I,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_,{control:t.control,name:"email",render:({field:r})=>e.jsxs(P,{children:[e.jsx(k,{children:"Email"}),e.jsx(L,{children:e.jsx(B,{type:"email",placeholder:"email@exemple.com",...r})}),e.jsx(I,{})]})}),e.jsx(_,{control:t.control,name:"phone",render:({field:r})=>e.jsxs(P,{children:[e.jsx(k,{children:"T√©l√©phone"}),e.jsx(L,{children:e.jsx(B,{placeholder:"0600000000",...r})}),e.jsx(I,{})]})})]}),m==="professionnel"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_,{control:t.control,name:"company",render:({field:r})=>e.jsxs(P,{children:[e.jsx(k,{children:"Raison sociale"}),e.jsx(L,{children:e.jsx(B,{placeholder:"Nom de l'entreprise",...r})}),e.jsx(I,{})]})}),e.jsx(_,{control:t.control,name:"siret",render:({field:r})=>e.jsxs(P,{children:[e.jsx(k,{children:"SIRET"}),e.jsx(L,{children:e.jsx(B,{placeholder:"SIRET",...r})}),e.jsx(I,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Adresse"}),e.jsx(_,{control:t.control,name:"address",render:({field:r})=>e.jsxs(P,{children:[e.jsx(k,{children:"Adresse"}),e.jsx(L,{children:e.jsx(B,{placeholder:"Num√©ro et nom de rue",...r})}),e.jsx(I,{})]})}),e.jsx(_,{control:t.control,name:"addressComplement",render:({field:r})=>e.jsxs(P,{children:[e.jsx(k,{children:"Compl√©ment d'adresse"}),e.jsx(L,{children:e.jsx(B,{placeholder:"Appartement, b√¢timent, etc.",...r})}),e.jsx(I,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_,{control:t.control,name:"postalCode",render:({field:r})=>e.jsxs(P,{children:[e.jsx(k,{children:"Code postal"}),e.jsx(L,{children:e.jsx(B,{placeholder:"00000",...r})}),e.jsx(I,{})]})}),e.jsx(_,{control:t.control,name:"city",render:({field:r})=>e.jsxs(P,{children:[e.jsx(k,{children:"Ville"}),e.jsx(L,{children:e.jsx(B,{placeholder:"Ville",...r})}),e.jsx(I,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"D√©tails techniques"}),e.jsx(_,{control:t.control,name:"requestType",render:({field:r})=>e.jsxs(P,{children:[e.jsx(k,{children:"Type de demande"}),e.jsxs(se,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(L,{children:e.jsx(re,{children:e.jsx(ne,{placeholder:"S√©lectionner un type de demande"})})}),e.jsxs(te,{children:[e.jsx(j,{value:"new_connection",children:"Nouveau raccordement"}),e.jsx(j,{value:"power_upgrade",children:"Augmentation de puissance"}),e.jsx(j,{value:"temporary_connection",children:"Raccordement provisoire"}),e.jsx(j,{value:"relocation",children:"D√©placement d'ouvrage"}),e.jsx(j,{value:"technical_visit",children:"Visite technique"}),e.jsx(j,{value:"other",children:"Autre"})]})]}),e.jsx(I,{})]})}),e.jsx(_,{control:t.control,name:"buildingType",render:({field:r})=>e.jsxs(P,{children:[e.jsx(k,{children:"Type de b√¢timent"}),e.jsxs(se,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(L,{children:e.jsx(re,{children:e.jsx(ne,{placeholder:"S√©lectionner un type de b√¢timent"})})}),e.jsxs(te,{children:[e.jsx(j,{value:"individual_house",children:"Maison individuelle"}),e.jsx(j,{value:"apartment_building",children:"Immeuble collectif"}),e.jsx(j,{value:"commercial",children:"Local commercial"}),e.jsx(j,{value:"industrial",children:"Site industriel"}),e.jsx(j,{value:"agricultural",children:"Exploitation agricole"}),e.jsx(j,{value:"public",children:"√âtablissement public"}),e.jsx(j,{value:"terrain",children:"Terrain"})]})]}),e.jsx(I,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_,{control:t.control,name:"powerRequired",render:({field:r})=>e.jsxs(P,{children:[e.jsx(k,{children:"Puissance demand√©e (kVA)"}),e.jsxs(se,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(L,{children:e.jsx(re,{children:e.jsx(ne,{placeholder:"Choisir une puissance"})})}),e.jsxs(te,{children:[e.jsx(j,{value:"3",children:"3 kVA"}),e.jsx(j,{value:"6",children:"6 kVA"}),e.jsx(j,{value:"9",children:"9 kVA"}),e.jsx(j,{value:"12",children:"12 kVA"}),e.jsx(j,{value:"15",children:"15 kVA"}),e.jsx(j,{value:"18",children:"18 kVA"}),e.jsx(j,{value:"24",children:"24 kVA"}),e.jsx(j,{value:"30",children:"30 kVA"}),e.jsx(j,{value:"36",children:"36 kVA"}),e.jsx(j,{value:"beyond",children:"Plus de 36 kVA"})]})]}),e.jsx(I,{})]})}),e.jsx(_,{control:t.control,name:"phaseType",render:({field:r})=>e.jsxs(P,{children:[e.jsx(k,{children:"Type de phase"}),e.jsxs(se,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(L,{children:e.jsx(re,{children:e.jsx(ne,{placeholder:"Choisir un type de phase"})})}),e.jsxs(te,{children:[e.jsx(j,{value:"monophase",children:"Monophas√©"}),e.jsx(j,{value:"triphase",children:"Triphas√©"})]})]}),e.jsx(I,{})]})})]}),e.jsx(_,{control:t.control,name:"comments",render:({field:r})=>e.jsxs(P,{children:[e.jsx(k,{children:"Commentaires"}),e.jsx(L,{children:e.jsx(ss,{placeholder:"Informations compl√©mentaires sur la demande",className:"min-h-[100px]",...r})}),e.jsx(I,{})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(w,{variant:"outline",onClick:n,type:"button",children:"Annuler"}),e.jsx(w,{type:"submit",disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"mr-2 h-4 w-4 animate-spin"}),"Cr√©ation..."]}):"Cr√©er le lead"})]})]})})]})}):null}function Ir({leadDetails:s}){const n=c=>{if(!c)return"Non renseign√©";try{return new Date(c).toLocaleDateString("fr-FR")}catch{return c}},a=c=>{if(!c)return"Non renseign√©";try{return new Date(c).toLocaleString("fr-FR")}catch{return"Date invalide"}};return e.jsx(me,{children:e.jsx(pe,{className:"p-0",children:e.jsxs(ns,{defaultValue:"step1",className:"p-4",children:[e.jsxs(ts,{className:"mb-4",children:[e.jsx(H,{value:"step1",children:"Informations client"}),e.jsx(H,{value:"step2",children:"Type de demande"}),e.jsx(H,{value:"step3",children:"Adresse & technique"}),e.jsx(H,{value:"step4",children:"Planning & facturation"}),e.jsx(H,{value:"step5",children:"M√©tadonn√©es"})]}),e.jsxs(Q,{value:"step1",className:"border rounded-md p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Informations client"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Type de client:"}),e.jsx("span",{children:s.clientType==="particulier"?"Particulier":s.clientType==="professionnel"?"Professionnel":s.clientType==="collectivite"?"Collectivit√©":"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Nom complet:"}),e.jsx("span",{children:s.firstName||s.lastName?`${s.firstName||""} ${s.lastName||""}`.trim():s.email?`<${s.email}>`:"Non renseign√©"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Email:"}),e.jsx("span",{children:s.email||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"T√©l√©phone:"}),e.jsx("span",{children:s.phone||"Non renseign√©"})]}),s.clientType==="professionnel"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Entreprise:"}),e.jsx("span",{children:s.company||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"SIRET:"}),e.jsx("span",{children:s.siret||"Non renseign√©"})]})]})]})]})]}),e.jsxs(Q,{value:"step2",className:"border rounded-md p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Type de demande"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Service:"}),e.jsx("span",{children:s.serviceType==="electricity"?"√âlectricit√©":s.serviceType||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Type:"}),e.jsx("span",{children:s.requestType==="new_connection"?"Nouveau raccordement":s.requestType==="power_upgrade"?"Modification de puissance":s.requestType==="temporary_connection"?"Raccordement temporaire":s.requestType==="relocation"?"D√©placement d'ouvrage":s.requestType==="technical_visit"?"Visite technique":s.requestType==="other"?"Autre":"Non renseign√©"})]}),s.requestType==="other"&&e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Description:"}),e.jsx("span",{children:s.otherRequestTypeDesc||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"B√¢timent:"}),e.jsx("span",{children:s.buildingType==="individual_house"?"Maison individuelle":s.buildingType==="apartment_building"?"Immeuble":s.buildingType==="commercial"?"Local commercial":s.buildingType==="industrial"?"B√¢timent industriel":s.buildingType==="agricultural"?"Exploitation agricole":s.buildingType==="public"?"B√¢timent public":s.buildingType==="terrain"?"Terrain":"Non renseign√©"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[135px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Terrain:"}),e.jsx("span",{children:s.terrainViabilise==="viabilise"?"Terrain viabilis√©":s.terrainViabilise==="non_viabilise"?"Terrain non viabilis√©":"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[135px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"√âtat projet:"}),e.jsx("span",{children:s.projectStatus==="planning"?"En phase de projet":s.projectStatus==="permit_pending"?"Permis d√©pos√©":s.projectStatus==="permit_approved"?"Permis approuv√©":s.projectStatus==="construction_started"?"Construction d√©marr√©e":s.projectStatus==="construction_completed"?"Construction termin√©e":"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[135px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Permis n¬∞:"}),e.jsx("span",{children:s.permitNumber||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[135px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Date permis:"}),e.jsx("span",{children:n(s.permitDeliveryDate)})]})]})]})]}),e.jsxs(Q,{value:"step3",className:"border rounded-md p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Adresse & D√©tails techniques"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Adresse:"}),e.jsx("span",{children:s.address||"Non renseign√©"})]}),s.addressComplement&&e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Compl√©ment:"}),e.jsx("span",{children:s.addressComplement})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Ville:"}),e.jsx("span",{children:s.city||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Code postal:"}),e.jsx("span",{children:s.postalCode||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"R√©f. cadastrale:"}),e.jsx("span",{children:s.cadastralReference||"Non renseign√©"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Puissance:"}),e.jsx("span",{children:s.powerRequired?`${s.powerRequired} kVA`:"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Phase:"}),e.jsx("span",{children:s.phaseType==="monophase"?"Monophas√©":s.phaseType==="triphase"?"Triphas√©":"Non renseign√©"})]}),s.hasArchitect&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1 mt-4",children:[e.jsx("span",{className:"text-slate-500 font-medium",children:"Architecte:"}),e.jsx("span",{})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Nom:"}),e.jsx("span",{children:s.architectName||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"T√©l√©phone:"}),e.jsx("span",{children:s.architectPhone||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Email:"}),e.jsx("span",{children:s.architectEmail||"Non renseign√©"})]})]})]})]})]}),e.jsxs(Q,{value:"step4",className:"border rounded-md p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Planning et facturation"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Date souhait√©e:"}),e.jsx("span",{children:n(s.desiredCompletionDate)})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"D√©lai connexion:"}),e.jsx("span",{children:s.connectionDelay||"Non sp√©cifi√©"})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Achat imm√©diat:"}),e.jsx("span",{children:s.immediatePurchaseAccepted?"Oui":"Non"})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"CGV accept√©es:"}),e.jsx("span",{children:s.termsAccepted?"Oui":"Non"})]})]}),e.jsxs("div",{className:"space-y-2",children:[(s.billingAddress||s.billingCity||s.billingPostalCode)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1 mt-1",children:[e.jsx("span",{className:"text-slate-500 font-medium",children:"Adresse de facturation:"}),e.jsx("span",{})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Adresse:"}),e.jsx("span",{children:s.billingAddress||"Identique √† l'adresse du projet"})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Ville:"}),e.jsx("span",{children:s.billingCity||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Code postal:"}),e.jsx("span",{children:s.billingPostalCode||"Non renseign√©"})]})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1 mt-4",children:[e.jsx("span",{className:"text-slate-500",children:"Commentaires:"}),e.jsx("span",{className:"whitespace-pre-line",children:s.comments||"Aucun commentaire"})]})]})]})]}),e.jsxs(Q,{value:"step5",className:"border rounded-md p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"M√©tadonn√©es"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"R√©f√©rence:"}),e.jsx("span",{className:"font-medium",children:s.referenceNumber||"Non g√©n√©r√©e"})]}),e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Prix standard:"}),e.jsx("span",{className:"font-medium",children:"129,80 ‚Ç¨ TTC"})]}),e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"TVA:"}),e.jsx("span",{className:"font-medium",children:s.vatRate||"20%"})]}),e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Statut:"}),e.jsx("span",{className:"font-medium",children:s.isCompleted?e.jsxs("span",{className:"text-green-600 flex items-center",children:[e.jsx(Ie,{className:"h-4 w-4 mr-1"})," Compl√©t√©"]}):e.jsxs("span",{className:"text-amber-600 flex items-center",children:[e.jsx(rs,{className:"h-4 w-4 mr-1"})," En progression"]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Cr√©√© le:"}),e.jsx("span",{children:a(s.createdAt)})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Mis √† jour le:"}),e.jsx("span",{children:a(s.updatedAt)})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Derni√®re activit√©:"}),e.jsx("span",{children:a(s.lastTouchedAt)})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Progression:"}),e.jsxs("span",{children:[s.completedSteps,"/5 √©tapes"]})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Converti en demande:"}),e.jsx("span",{children:s.convertedToRequest?"Oui":"Non"})]}),s.ipAddress&&e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"IP:"}),e.jsx("span",{className:"font-mono text-xs",children:s.ipAddress})]})]})]})]})]})})})}function $r({leadId:s,phone:n,email:a,firstName:c,lastName:p,currentStatus:d,hasContract:t,onRequestAppointment:m,onExportPDF:x,onDelete:y}){const{toast:r}=fe(),v=je({mutationFn:async({leadId:o,status:f})=>await(await Y("PATCH",`/api/leads/${o}/status`,{status:f})).json(),onSuccess:(o,f)=>{const S={[C.INTERESTED]:"Int√©ress√© (OK)",[C.NOT_INTERESTED]:"Pas int√©ress√©",[C.NO_RESPONSE]:"Pas de r√©ponse (NRP)",[C.CALLBACK_SCHEDULED]:"Rappel programm√©"};r({title:"Statut mis √† jour",description:`Le lead a √©t√© marqu√© comme : ${S[f.status]||f.status}`}),K.invalidateQueries({queryKey:["/api/leads"]}),K.invalidateQueries({queryKey:["/api/leads/incomplete"]})},onError:o=>{r({title:"Erreur",description:`Impossible de mettre √† jour le statut: ${o.message}`,variant:"destructive"})}}),u=o=>{v.mutate({leadId:s,status:o})},h=()=>{if(!n){r({title:"Aucun num√©ro de t√©l√©phone",description:"Ce lead n'a pas de num√©ro de t√©l√©phone renseign√©.",variant:"destructive"});return}let o=n.replace(/[\s()\-+]/g,"");!o.startsWith("33")&&o.startsWith("0")&&(o="33"+o.substring(1)),window.open(`https://wa.me/${o}`,"_blank")};return e.jsxs(Os,{children:[e.jsx(Ds,{asChild:!0,children:e.jsxs(w,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx(fr,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Actions"})]})}),e.jsxs(zs,{align:"end",className:"w-[220px]",children:[e.jsx(ue,{children:"Actions rapides"}),e.jsx(he,{}),e.jsx(ue,{className:"text-xs text-muted-foreground font-normal",children:"Statut"}),e.jsxs(z,{className:d===C.INTERESTED?"bg-blue-50":"",onClick:()=>u(C.INTERESTED),children:[e.jsx(Ie,{className:"mr-2 h-4 w-4 text-green-500"})," Int√©ress√© (OK)"]}),e.jsxs(z,{className:d===C.NOT_INTERESTED?"bg-blue-50":"",onClick:()=>u(C.NOT_INTERESTED),children:[e.jsx(sr,{className:"mr-2 h-4 w-4 text-red-500"})," Pas int√©ress√©"]}),e.jsxs(z,{className:d===C.NO_RESPONSE?"bg-blue-50":"",onClick:()=>u(C.NO_RESPONSE),children:[e.jsx(is,{className:"mr-2 h-4 w-4 text-amber-500"})," Pas de r√©ponse (NRP)"]}),e.jsxs(z,{className:d===C.CALLBACK_SCHEDULED?"bg-blue-50":"",onClick:m,children:[e.jsx(rs,{className:"mr-2 h-4 w-4 text-blue-500"})," Programmer rappel"]}),e.jsxs(z,{className:d===C.PROCESS_COMPLETE?"bg-green-50":"",onClick:()=>u(C.PROCESS_COMPLETE),children:[e.jsx(Ie,{className:"mr-2 h-4 w-4 text-green-600"})," 5/5 vert (complet)"]}),e.jsx(he,{}),e.jsx(ue,{className:"text-xs text-muted-foreground font-normal",children:"Communication"}),e.jsxs(Bs,{children:[e.jsxs(z,{onClick:h,children:[e.jsx(Is,{className:"mr-2 h-4 w-4 text-green-600"})," WhatsApp"]}),e.jsxs(z,{onClick:()=>{if(!a){r({title:"Aucune adresse email",description:"Ce lead n'a pas d'adresse email renseign√©e.",variant:"destructive"});return}const o="Votre demande de raccordement",f=`Bonjour ${c||""} ${p||""},

Nous avons bien re√ßu votre demande de raccordement. 

Cordialement,
L'√©quipe Raccordement`;window.location.href=`mailto:${a}?subject=${encodeURIComponent(o)}&body=${encodeURIComponent(f)}`},children:[e.jsx($s,{className:"mr-2 h-4 w-4 text-blue-600"})," Email"]}),e.jsxs(z,{disabled:!0,children:[e.jsx(Fs,{className:"mr-2 h-4 w-4"})," Appeler"]})]}),e.jsx(he,{}),e.jsx(ue,{className:"text-xs text-muted-foreground font-normal",children:"Documents"}),e.jsxs(z,{onClick:x,disabled:!x,children:[e.jsx(ls,{className:"mr-2 h-4 w-4"})," Exporter PDF"]}),e.jsxs(z,{className:t?"bg-green-50":"",onClick:()=>{t?Y("GET",`/api/contracts/${s}`).then(o=>o.json()).then(o=>{if(o.success&&o.url)window.open(o.url,"_blank");else throw new Error(o.message||"Erreur lors de la r√©cup√©ration du contrat")}).catch(o=>{r({title:"Erreur",description:`Impossible d'ouvrir le contrat: ${o.message}`,variant:"destructive"})}):Y("POST",`/api/contracts/${s}/generate`).then(o=>o.json()).then(o=>{if(o.success)r({title:"Contrat g√©n√©r√©",description:o.message}),o.url&&window.open(o.url,"_blank"),K.invalidateQueries({queryKey:["/api/leads"]});else throw new Error(o.message||"Erreur inconnue")}).catch(o=>{r({title:"Erreur",description:`Impossible de g√©n√©rer le contrat: ${o.message}`,variant:"destructive"})})},children:[e.jsx(rr,{className:`mr-2 h-4 w-4 ${t?"text-green-600":""}`}),t?"Voir contrat":"G√©n√©rer contrat"]}),y&&e.jsxs(e.Fragment,{children:[e.jsx(he,{}),e.jsxs(z,{onClick:y,className:"text-red-600 focus:text-red-600 focus:bg-red-50",children:[e.jsx(nr,{className:"mr-2 h-4 w-4"}),"Supprimer"]})]})]})]})}const Fr=async s=>{try{const n=["ID","R√©f√©rence","Nom","Email","T√©l√©phone","Statut","Type de service","Date de cr√©ation"],a=[];a.push(n.join(","));for(const m of s){const x=[m.id,m.referenceNumber||"",`"${m.firstName&&m.lastName?`${m.firstName} ${m.lastName}`:m.name||"Non sp√©cifi√©"}"`,`"${m.email||""}"`,`"${m.phone||""}"`,`"${m.status||"Nouveau"}"`,`"${m.serviceType||""}"`,new Date(m.createdAt).toLocaleDateString("fr-FR")];a.push(x.join(","))}const c=a.join(`
`),p=new Blob([c],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(p),t=document.createElement("a");t.setAttribute("href",d),t.setAttribute("download",`leads_export_${new Date().toISOString().slice(0,10)}.csv`),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(n){throw console.error("Erreur lors de l'exportation CSV:",n),new Error("Impossible d'exporter les leads au format CSV.")}},qr=async s=>{try{const n=document.createElement("div");n.style.position="absolute",n.style.top="-9999px",n.style.width="800px",n.style.padding="20px",n.style.backgroundColor="white",n.style.fontFamily="Arial, sans-serif";const a=document.createElement("div");a.style.display="flex",a.style.justifyContent="space-between",a.style.alignItems="center",a.style.marginBottom="20px",a.style.padding="10px",a.style.borderBottom="1px solid #ddd";const c=document.createElement("div");c.style.fontWeight="bold",c.style.fontSize="24px",c.style.color="#3b82f6",c.textContent="Raccordement √âlectrique";const p=document.createElement("div");p.textContent=`Date: ${new Date().toLocaleDateString("fr-FR")}`,p.style.color="#666",a.appendChild(c),a.appendChild(p);const d=document.createElement("div");d.style.padding="15px";const t=document.createElement("h1");t.textContent="Fiche Lead",t.style.fontSize="20px",t.style.color="#333",t.style.marginBottom="15px";const m=document.createElement("div");m.style.marginBottom="20px";const x=document.createElement("div");x.style.marginBottom="15px",x.style.padding="10px",x.style.backgroundColor="#f8fafc",x.style.borderRadius="5px";const y=document.createElement("div");y.textContent="Identification",y.style.fontWeight="bold",y.style.marginBottom="5px",y.style.color="#3b82f6";const r=document.createElement("div");r.style.display="flex",r.style.justifyContent="space-between";const v=document.createElement("div");v.textContent=`ID: ${s.id}`,v.style.fontSize="14px";const u=document.createElement("div");u.textContent=`Cr√©√© le: ${new Date(s.createdAt).toLocaleString("fr-FR")}`,u.style.fontSize="14px",r.appendChild(v),r.appendChild(u),x.appendChild(y),x.appendChild(r);const h=document.createElement("div");h.style.marginBottom="15px",h.style.padding="10px",h.style.backgroundColor="#f8fafc",h.style.borderRadius="5px";const o=document.createElement("div");o.textContent="Informations client",o.style.fontWeight="bold",o.style.marginBottom="10px",o.style.color="#3b82f6",h.appendChild(o);const f=document.createElement("div");f.style.display="grid",f.style.gridTemplateColumns="1fr 1fr",f.style.gap="10px";const S=[{label:"Nom complet",value:`${s.firstName||""} ${s.lastName||""}`.trim()||"Non renseign√©"},{label:"Email",value:s.email||"Non renseign√©"},{label:"T√©l√©phone",value:s.phone||"Non renseign√©"},{label:"Type de client",value:s.clientType==="particulier"?"Particulier":s.clientType==="professionnel"?"Professionnel":"Non renseign√©"}];s.clientType==="professionnel"&&S.push({label:"Entreprise",value:s.company||"Non renseign√©"},{label:"SIRET",value:s.siret||"Non renseign√©"}),S.forEach(O=>{const A=document.createElement("div");A.style.marginBottom="5px";const G=document.createElement("div");G.textContent=O.label,G.style.fontSize="12px",G.style.color="#666";const U=document.createElement("div");U.textContent=O.value,U.style.fontSize="14px",A.appendChild(G),A.appendChild(U),f.appendChild(A)}),h.appendChild(f);const V=document.createElement("div");V.style.marginBottom="15px",V.style.padding="10px",V.style.backgroundColor="#f8fafc",V.style.borderRadius="5px";const E=document.createElement("div");E.textContent="Informations projet",E.style.fontWeight="bold",E.style.marginBottom="10px",E.style.color="#3b82f6",V.appendChild(E);const X=document.createElement("div");X.style.display="grid",X.style.gridTemplateColumns="1fr 1fr",X.style.gap="10px",[{label:"Adresse",value:s.address||"Non renseign√©"},{label:"Code postal",value:s.postalCode||"Non renseign√©"},{label:"Ville",value:s.city||"Non renseign√©"},{label:"Type de b√¢timent",value:s.buildingType||"Non renseign√©"}].forEach(O=>{const A=document.createElement("div");A.style.marginBottom="5px";const G=document.createElement("div");G.textContent=O.label,G.style.fontSize="12px",G.style.color="#666";const U=document.createElement("div");U.textContent=O.value,U.style.fontSize="14px",A.appendChild(G),A.appendChild(U),X.appendChild(A)}),V.appendChild(X);const T=document.createElement("div");T.style.marginTop="30px",T.style.borderTop="1px solid #ddd",T.style.paddingTop="10px",T.style.fontSize="12px",T.style.color="#666",T.style.textAlign="center",T.textContent="Document g√©n√©r√© automatiquement - Raccordement √âlectrique ¬© 2025",m.appendChild(x),m.appendChild(h),m.appendChild(V),d.appendChild(t),d.appendChild(m),d.appendChild(T),n.appendChild(a),n.appendChild(d),document.body.appendChild(n);const le=await ar(n);document.body.removeChild(n);const Z=le.toDataURL("image/jpeg",1),$=new tr("p","mm","a4"),ce=$.internal.pageSize.getWidth(),J=$.internal.pageSize.getHeight(),ve=le.width,l=le.height,xe=ce/ve,ee=l*xe;if($.addImage(Z,"JPEG",0,0,ce,ee),ee>J){const O=Math.ceil(ee/J);for(let A=1;A<O;A++)$.addPage(),$.addImage(Z,"JPEG",0,-(A*J),ce,ee)}const oe=`Lead_${s.id}_${(s.firstName||"")+(s.lastName||"")}_${new Date().toISOString().split("T")[0]}.pdf`;return $.save(oe),oe}catch(n){throw console.error("Erreur lors de la g√©n√©ration du PDF:",n),n}};function Cn(){var Ue,Ke,We,He,Qe,Xe;const{toast:s}=fe(),[n,a]=g.useState(""),[c,p]=g.useState("all"),[d,t]=g.useState(1),[m,x]=g.useState(!1),[y,r]=g.useState(!1),[v,u]=g.useState(!1),[h,o]=g.useState(!1),[f,S]=g.useState(null),V=20,{data:E,isLoading:X,refetch:ie}=Pe({queryKey:["/api/leads/incomplete",{page:d,limit:V}],queryFn:async({queryKey:i})=>{const[b,F]=i,{page:R,limit:q}=F,D=await fetch(`${b}?page=${R}&limit=${q}`);if(!D.ok)throw new Error("Erreur lors de la r√©cup√©ration des leads");return D.json()},enabled:c==="incomplete"}),{data:T,isLoading:le,refetch:Z}=Pe({queryKey:["/api/leads/all",{page:d,limit:V}],queryFn:async({queryKey:i})=>{const[b,F]=i,{page:R,limit:q}=F,D=await fetch(`/api/leads?page=${R}&limit=${q}`);if(!D.ok)throw new Error("Erreur lors de la r√©cup√©ration des leads");const M=await D.json();return M.success&&Array.isArray(M.leads)?M:Array.isArray(M)?{success:!0,leads:M,pagination:{total:M.length,totalPages:Math.ceil(M.length/q),currentPage:R,perPage:q}}:(console.error("Format de donn√©es inattendu:",M),{success:!0,leads:[],pagination:{total:0,totalPages:1,currentPage:R,perPage:q}})},enabled:c==="all"}),{data:$,isLoading:ce,refetch:J}=Pe({queryKey:["/api/leads/new",{page:d,limit:V}],queryFn:async({queryKey:i})=>{const[b,F]=i,{page:R,limit:q}=F,D=await fetch(`/api/leads?page=${R}&limit=${q}`);if(!D.ok)throw new Error("Erreur lors de la r√©cup√©ration des nouveaux leads");const M=await D.json();let Ae=[];if(M.success&&Array.isArray(M.leads))Ae=M.leads;else if(Array.isArray(M))Ae=M;else return console.error("Format de donn√©es inattendu pour les nouveaux leads:",M),{success:!0,leads:[],pagination:{total:0,totalPages:1,currentPage:R,perPage:q}};const Re=new Date;Re.setDate(Re.getDate()-1);const _e=Ae.filter(Je=>Je.createdAt?new Date(Je.createdAt)>=Re:!1);return{success:!0,leads:_e,pagination:{total:_e.length,totalPages:Math.ceil(_e.length/q),currentPage:R,perPage:q}}},enabled:c==="new"});g.useEffect(()=>{t(1)},[c]),g.useEffect(()=>{c==="incomplete"?ie():c==="all"?Z():c==="new"&&J()},[d,c,ie,Z,J]);const ve=async i=>{if(!i)return null;try{const b=await fetch(`/api/leads/${i}`);if(!b.ok)throw new Error("Erreur lors de la r√©cup√©ration des d√©tails du lead");return await b.json()}catch(b){return console.error("Erreur de r√©cup√©ration des d√©tails du lead:",b),null}},[l,xe]=g.useState(null),[ee,oe]=g.useState(!1),[O,A]=g.useState(!1),[G,U]=g.useState(!1),[ze,Ne]=g.useState(null),[bs,ye]=g.useState(!1);g.useEffect(()=>((async()=>{if(f&&m){oe(!0);const b=await ve(f);xe((b==null?void 0:b.lead)||null),oe(!1)}})(),()=>{m||xe(null)}),[f,m]);const Cs=async i=>{if(i)try{A(!0);const F=await(await Y("POST",`/api/leads/${i}/convert`,{})).json();F.success?(s({title:"Conversion r√©ussie",description:`Le lead a √©t√© converti en demande #${F.referenceNumber}`}),x(!1),ie()):s({title:"Erreur de conversion",description:F.message||"Une erreur est survenue lors de la conversion du lead",variant:"destructive"})}catch(b){s({title:"Erreur",description:b.message||"Une erreur est survenue lors de la conversion du lead",variant:"destructive"})}finally{A(!1)}},be=i=>{S(i),x(!0)},Ce=i=>{S(i),r(!0)},Be=i=>{S(i),o(!0)},we=i=>{t(i)},Ee=()=>{d>1&&t(d-1)},Te=()=>{const i=c==="incomplete"?E:c==="all"?T:$;i&&d<i.pagination.totalPages&&t(d+1)},Se=je({mutationFn:async({leadId:i,userId:b,priority:F,note:R})=>await(await Y("POST",`/api/leads/${i}/assign`,{userId:b,priority:F,note:R})).json(),onSuccess:i=>{i.success?(s({title:"Lead assign√©",description:i.message||"Le lead a √©t√© assign√© avec succ√®s"}),r(!1),c==="incomplete"&&ie(),c==="all"&&Z(),c==="new"&&J()):s({title:"Erreur",description:i.message||"Un probl√®me est survenu lors de l'assignation du lead",variant:"destructive"})},onError:i=>{console.error("Erreur lors de l'assignation du lead:",i),s({title:"Erreur",description:i.message||"Un probl√®me est survenu lors de l'assignation du lead",variant:"destructive"})}}),ws=(i,b,F,R)=>{Se.mutate({leadId:i,userId:b,priority:F,note:R})},Es=je({mutationFn:async i=>await(await Y("DELETE",`/api/leads/${i}`)).json(),onSuccess:i=>{i.success?(s({title:"Lead supprim√©",description:"Le lead a √©t√© supprim√© avec succ√®s"}),x(!1),K.invalidateQueries({queryKey:["/api/leads"]}),K.invalidateQueries({queryKey:["/api/leads/incomplete"]}),K.invalidateQueries({queryKey:["/api/leads/new"]})):s({title:"Erreur",description:i.message||"Un probl√®me est survenu lors de la suppression",variant:"destructive"})},onError:i=>{s({title:"Erreur",description:i.message||"Un probl√®me est survenu lors de la suppression",variant:"destructive"})}}),Ts=i=>{Ne(i),ye(!0)},Ss=()=>{ze&&(Es.mutate(ze),ye(!1),Ne(null))},As=async()=>{if(l)try{U(!0),await qr(l),s({title:"Exportation r√©ussie",description:"Le PDF a √©t√© g√©n√©r√© et t√©l√©charg√©"})}catch(i){console.error("Erreur lors de l'exportation PDF:",i),s({title:"Erreur d'exportation",description:i.message||"Impossible de g√©n√©rer le PDF",variant:"destructive"})}finally{U(!1)}},Ge={all:((Ue=T==null?void 0:T.pagination)==null?void 0:Ue.total)||0,incomplete:((Ke=E==null?void 0:E.pagination)==null?void 0:Ke.total)||0,new:((We=$==null?void 0:$.pagination)==null?void 0:We.total)||0,pending:0,inProgress:0,validated:0,completed:0,cancelled:0};return e.jsxs(Gs,{title:"Leads",description:"Gestion des leads et prospects",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Leads"}),e.jsx("p",{className:"text-muted-foreground",children:"Gestion des prospects et demandes entrantes"})]}),e.jsxs("div",{className:"flex w-full sm:w-auto items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ur,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(B,{type:"search",placeholder:"Rechercher...",className:"pl-8 w-full sm:w-[300px]",value:n,onChange:i=>a(i.target.value)})]}),e.jsxs(w,{variant:"outline",onClick:async()=>{try{const i=c==="incomplete"?E==null?void 0:E.leads:c==="all"?T==null?void 0:T.leads:$==null?void 0:$.leads;i&&i.length>0?(await Fr(i),s({title:"Exportation r√©ussie",description:`${i.length} leads ont √©t√© export√©s au format CSV`})):s({title:"Aucune donn√©e √† exporter",description:"Il n'y a aucun lead √† exporter dans cet onglet",variant:"default"})}catch(i){console.error("Erreur lors de l'exportation CSV:",i),s({title:"Erreur d'exportation",description:i.message||"Impossible d'exporter les leads au format CSV",variant:"destructive"})}},children:[e.jsx(ls,{className:"h-4 w-4 mr-2"}),"Exporter"]}),e.jsxs(w,{onClick:()=>u(!0),children:[e.jsx(qs,{className:"h-4 w-4 mr-2"}),"Nouveau Lead"]})]})]}),e.jsxs(ns,{defaultValue:"incomplete",value:c,onValueChange:p,className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs(ts,{children:[e.jsxs(H,{value:"all",className:"relative",children:["Tous",e.jsx(W,{variant:"secondary",className:"ml-2",children:Ge.all})]}),e.jsxs(H,{value:"incomplete",className:"relative",children:["Incomplets",e.jsx(W,{variant:"secondary",className:"ml-2",children:((He=E==null?void 0:E.pagination)==null?void 0:He.total)||0})]}),e.jsxs(H,{value:"new",className:"relative",children:["Nouveaux",e.jsx(W,{variant:"secondary",className:"ml-2",children:Ge.new})]})]})}),e.jsx(Q,{value:"all",className:"m-0",children:e.jsx(Nr,{leadsLoading:le,allLeadsData:T,currentPage:d,goToPage:we,goToPreviousPage:Ee,goToNextPage:Te,openDetailsDialog:be,openAssignDialog:Ce})}),e.jsx(Q,{value:"incomplete",className:"m-0",children:e.jsx(Ve,{leadsLoading:X,incompleteLeadsData:E,currentPage:d,goToPage:we,goToPreviousPage:Ee,goToNextPage:Te,openDetailsDialog:be,openAssignDialog:Ce})}),e.jsx(Q,{value:"new",className:"m-0",children:e.jsx(yr,{leadsLoading:ce,newLeadsData:$,currentPage:d,goToPage:we,goToPreviousPage:Ee,goToNextPage:Te,openDetailsDialog:be,openAssignDialog:Ce})})]})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"D√©tails du lead"}),l&&l.referenceNumber&&e.jsx("p",{className:"text-sm text-muted-foreground font-mono",children:l.referenceNumber})]}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>x(!1),className:"h-8 w-8 rounded-full",children:e.jsx(Le,{className:"h-4 w-4"})})]}),ee?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(de,{className:"h-8 w-8 animate-spin text-blue-600"})}):l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4 bg-slate-50 p-3 rounded-md",children:[e.jsxs("div",{className:"flex items-center flex-wrap gap-3",children:[e.jsxs("div",{className:"bg-white px-3 py-1 rounded-full border flex items-center gap-1.5",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${l.isCompleted?"bg-green-500":"bg-amber-500"}`}),e.jsx("span",{className:"text-sm font-medium",children:l.isCompleted?"Complet":"Incomplet"})]}),e.jsxs("div",{className:"bg-white px-3 py-1 rounded-full border flex items-center gap-1.5",children:[e.jsx(Ms,{className:"h-3.5 w-3.5 text-slate-500"}),e.jsx("span",{className:"text-sm",children:new Date(l.createdAt).toLocaleDateString("fr-FR")})]}),e.jsx("div",{className:"bg-white px-3 py-1 rounded-full border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-xs font-medium mr-1.5",children:"Progression:"}),e.jsxs("span",{className:"text-xs font-medium",children:[Math.max(1,l.completedSteps||1),"/5"]}),e.jsx("div",{className:"ml-2 bg-slate-200 w-16 h-1.5 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-blue-600 h-full",style:{width:`${Math.floor(Math.max(1,l.completedSteps||1)/5*100)}%`}})})]})})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs(w,{variant:"outline",size:"sm",className:"flex-1 sm:flex-auto",onClick:()=>r(!0),children:[e.jsx(Us,{className:"h-4 w-4 mr-1"}),"Assigner"]}),e.jsxs(w,{variant:"outline",size:"sm",className:"flex-1 sm:flex-auto",onClick:()=>Be(l.id),children:[e.jsx(hr,{className:"h-4 w-4 mr-1"}),"Nouveau RDV"]}),e.jsx(w,{variant:"default",size:"sm",className:"flex-1 sm:flex-auto",onClick:()=>Cs(l.id),disabled:O,children:O?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"h-4 w-4 mr-1 animate-spin"}),"Traitement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(jr,{className:"h-4 w-4 mr-1"}),"Convertir"]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(me,{children:[e.jsx($e,{className:"pb-2",children:e.jsx(Fe,{className:"text-base font-medium",children:"Informations g√©n√©rales"})}),e.jsxs(pe,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"ID:"}),e.jsx("span",{className:"font-mono",children:l.id})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Cr√©√© le:"}),e.jsx("span",{children:new Date(l.createdAt).toLocaleString("fr-FR")})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Modifi√© le:"}),e.jsx("span",{children:new Date(l.updatedAt).toLocaleString("fr-FR")})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Source:"}),e.jsx("span",{children:l.ipAddress?e.jsx(Ks,{content:l.userAgent,children:e.jsxs("div",{className:"cursor-help flex items-center",children:[((Qe=l.geoLocation)==null?void 0:Qe.flag)&&e.jsx("span",{className:"mr-2 text-lg","aria-label":`Drapeau ${l.geoLocation.countryName}`,children:l.geoLocation.flag}),l.ipAddress,((Xe=l.geoLocation)==null?void 0:Xe.countryName)&&e.jsxs("span",{className:"ml-2 text-xs text-slate-500",children:["(",l.geoLocation.countryName,")"]})]})}):"Aucune"})]})]})]}),e.jsxs(me,{children:[e.jsx($e,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Fe,{className:"text-base font-medium",children:"Informations de contact"}),e.jsx($r,{leadId:l.id,phone:l.phone,email:l.email,firstName:l.firstName,lastName:l.lastName,currentStatus:l.status||"",hasContract:l.hasContract||!1,onRequestAppointment:()=>Be(l.id),onExportPDF:As,onDelete:()=>Ts(l.id)})]})}),e.jsxs(pe,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Nom:"}),e.jsx("span",{children:l.firstName||l.lastName?`${l.firstName||""} ${l.lastName||""}`.trim():l.email?`<${l.email}>`:"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Email:"}),e.jsx("span",{children:l.email?e.jsx("a",{href:`mailto:${l.email}`,className:"text-blue-600 hover:underline",children:l.email}):"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"T√©l√©phone:"}),e.jsx("span",{children:l.phone?e.jsx("a",{href:`tel:${l.phone}`,className:"text-blue-600 hover:underline",children:l.phone}):"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Type de client:"}),e.jsx("span",{children:l.clientType==="particulier"?"Particulier":l.clientType==="professionnel"?"Professionnel":"Non renseign√©"})]}),l.clientType==="professionnel"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Entreprise:"}),e.jsx("span",{children:l.company||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"SIRET:"}),e.jsx("span",{children:l.siret||"Non renseign√©"})]})]})]})]})]}),e.jsx(Ir,{leadDetails:l})]}),e.jsx("div",{className:"mt-6 flex justify-end gap-2",children:e.jsx(w,{variant:"outline",onClick:()=>x(!1),children:"Fermer"})})]}):e.jsx("div",{className:"bg-amber-50 text-amber-800 p-4 rounded-md",children:e.jsxs("p",{className:"flex items-center",children:[e.jsx(is,{className:"h-5 w-5 mr-2"}),"Aucune information disponible."]})})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Assigner le lead"}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>r(!1),className:"h-8 w-8 rounded-full",children:e.jsx(Le,{className:"h-4 w-4"})})]}),f&&e.jsxs("div",{children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(gr,{className:"h-5 w-5 text-blue-500"})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:["Vous allez assigner ",e.jsxs("span",{className:"font-medium",children:["Lead #",f]})," √† un membre de l'√©quipe commerciale."]})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ae,{htmlFor:"assignee",children:"S√©lectionner un utilisateur"}),e.jsxs(se,{name:"assignee",children:[e.jsx(re,{children:e.jsx(ne,{placeholder:"Choisir un utilisateur"})}),e.jsxs(te,{children:[e.jsx(j,{value:"1",children:"Marina Alves"}),e.jsx(j,{value:"2",children:"Thomas Dupont"}),e.jsx(j,{value:"3",children:"Sara Benali"})]})]})]}),e.jsxs("div",{children:[e.jsx(ae,{htmlFor:"priority",children:"Priorit√©"}),e.jsxs(se,{name:"priority",defaultValue:"medium",children:[e.jsx(re,{children:e.jsx(ne,{})}),e.jsxs(te,{children:[e.jsx(j,{value:"high",children:"Haute"}),e.jsx(j,{value:"medium",children:"Moyenne"}),e.jsx(j,{value:"low",children:"Basse"})]})]})]}),e.jsxs("div",{children:[e.jsx(ae,{htmlFor:"note",children:"Note (optionnelle)"}),e.jsx(ss,{name:"note",placeholder:"Ajouter une note pour le destinataire...",className:"resize-none",rows:3})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-2",children:[e.jsx(w,{variant:"outline",onClick:()=>r(!1),children:"Annuler"}),e.jsx(w,{disabled:Se.isPending||O,onClick:()=>{var R,q,D;const i=Number((R=document.querySelector('select[name="assignee"]'))==null?void 0:R.value),b=(q=document.querySelector('select[name="priority"]'))==null?void 0:q.value,F=(D=document.querySelector('textarea[name="note"]'))==null?void 0:D.value;f&&i&&b?ws(f,i,b,F):s({title:"Erreur",description:"Veuillez s√©lectionner un utilisateur et une priorit√©",variant:"destructive"})},children:Se.isPending?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"h-4 w-4 mr-2 animate-spin"}),"Traitement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(vr,{className:"h-4 w-4 mr-2"}),"Assigner"]})})]})]})]})}),e.jsx(Lr,{isOpen:v,onClose:()=>u(!1),onLeadCreated:()=>{K.invalidateQueries({queryKey:["/api/leads/all"]}),K.invalidateQueries({queryKey:["/api/leads/incomplete"]}),K.invalidateQueries({queryKey:["/api/leads/new"]})}}),e.jsx(er,{isOpen:h,onClose:()=>o(!1),leadId:f,leadInfo:l?{firstName:l.firstName,lastName:l.lastName,phone:l.phone,email:l.email}:void 0}),e.jsx(ir,{open:bs,onOpenChange:ye,children:e.jsxs(lr,{children:[e.jsxs(cr,{children:[e.jsx(or,{children:"Confirmer la suppression"}),e.jsxs(dr,{children:["√ätes-vous s√ªr de vouloir supprimer ce lead ?",e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{className:"text-red-600 font-medium",children:"Cette action est irr√©versible."})]})]}),e.jsxs(mr,{children:[e.jsx(pr,{onClick:()=>Ne(null),children:"Annuler"}),e.jsx(xr,{onClick:Ss,className:"bg-red-600 hover:bg-red-700 text-white",children:"Supprimer"})]})]})})]})}export{Cn as default};
