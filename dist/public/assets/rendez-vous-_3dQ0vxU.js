import{c as $,a as Ne,r as x,j as e,I as ge,B as a,p as Y,w as ye,L as M,o as be,M as we,n as Ce,Q,T as _,V as K,W as G,a0 as X,a2 as J,l as W,a7 as q,aI as De}from"./index-BtS7nRqx.js";import{u as Re}from"./useQuery-B3hZvu7O.js";import{A as ze}from"./admin-layout-1auoTqnR.js";import{C as n,d as l,a as g,b as y,c as b,e as ke}from"./card-4w5MxnDX.js";import{B as h}from"./badge-CMWvwoog.js";import{T as Se,a as Me,b as A,c as L}from"./tabs-DSdcFsau.js";import{C as Z}from"./checkbox-BFc0ZPQS.js";import{A as Ae}from"./appointment-modal-BIitr_37.js";import{S as Le}from"./search-CYD8nZaU.js";import{T}from"./triangle-alert-QxnH57r-.js";import{C as Te}from"./index-CSivFRSi.js";import"./use-auth-SmQO9HXs.js";import"./use-mobile-DPSu7EX0.js";import"./index-DUCnuLkZ.js";import"./log-out-DpFhShNA.js";import"./file-text-B92JhXqI.js";import"./credit-card-Cmnyo_Xr.js";import"./users-DIMEKWaH.js";import"./settings-CrlbU-xK.js";import"./separator-DOP-gbQk.js";import"./index-Dz3gKZC9.js";import"./external-link-IAlv8HF-.js";import"./index-BQhGFiWS.js";import"./schema-C418XRmz.js";import"./calendar-B1mDqnpX.js";import"./endOfMonth-CysY3RQQ.js";import"./isBefore-Bq-pFZ1g.js";import"./popover-ktvZ84KE.js";import"./select-DkO99xHR.js";import"./chevron-down-D5KCvo08.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=$("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=$("CalendarPlus",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M16 19h6",key:"xwg31i"}],["path",{d:"M19 16v6",key:"tddt3s"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=$("CalendarX",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m14 14-4 4",key:"rymu2i"}],["path",{d:"m10 14 4 4",key:"3sz06r"}]]);function hs(){const{toast:u}=Ne(),[i,j]=x.useState(""),[w,te]=x.useState("upcoming"),[C,P]=x.useState(new Date),[ae,f]=x.useState(!1),[re,D]=x.useState(null),[ne,R]=x.useState(!1),[F,O]=x.useState(null),[V,le]=x.useState("list"),B=()=>{f(!1),D(null)},ie=s=>{O(s),R(!0)},ce=async()=>{if(F)try{await W("POST",`/api/service-requests/${F}/cancel`,{reason:"Annulé par l'administrateur via l'interface des rendez-vous"}),u({title:"Rendez-vous annulé",description:"Le rendez-vous a été annulé avec succès."}),q.invalidateQueries({queryKey:["/api/service-requests"]})}catch{u({title:"Erreur",description:"Impossible d'annuler le rendez-vous. Veuillez réessayer.",variant:"destructive"})}finally{R(!1),O(null)}},[d,H]=x.useState(null),[de,z]=x.useState(!1),oe=s=>{H(s),z(!0)},xe=async()=>{if(d)try{await W("POST",`/api/service-requests/${d.id}/send-reminder`,{type:"appointment_reminder",includeCalendarInvite:!0}),u({title:"Rappel envoyé",description:`Un rappel a été envoyé à ${d.customerName}.`}),q.invalidateQueries({queryKey:["/api/service-requests"]})}catch{u({title:"Erreur",description:"Impossible d'envoyer le rappel. Veuillez réessayer.",variant:"destructive"})}finally{z(!1),H(null)}},{data:U,isLoading:k,error:S}=Re({queryKey:["/api/service-requests"],queryFn:De({on401:"throw"})}),o=(U?U.map(s=>({id:s.id,referenceNumber:s.referenceNumber,customerName:s.name||"Client sans nom",appointmentDate:s.scheduledDate?new Date(s.scheduledDate):null,timeSlot:s.scheduledTime||null,status:s.status,enedisRef:s.enedisReferenceNumber||null,createdAt:new Date(s.createdAt).toISOString(),updatedAt:s.updatedAt?new Date(s.updatedAt).toISOString():void 0,address:s.address||"",postalCode:s.postalCode||"",city:s.city||"",email:s.email,phone:s.phone,hasReminderSent:s.hasReminderSent})).filter(s=>s.status==="scheduled"||s.status==="validated"||s.status==="in_progress"||s.status==="canceled"):[]).filter(s=>{const t=i===""||s.customerName.toLowerCase().includes(i.toLowerCase())||s.referenceNumber.toLowerCase().includes(i.toLowerCase())||s.enedisRef&&s.enedisRef.toLowerCase().includes(i.toLowerCase())||s.address.toLowerCase().includes(i.toLowerCase())||s.city.toLowerCase().includes(i.toLowerCase()),r=new Date;return w==="upcoming"&&s.appointmentDate?t&&s.appointmentDate>=r:w==="past"&&s.appointmentDate?t&&s.appointmentDate<r:w==="pending"?t&&!s.appointmentDate:t}),me=()=>{const s=new Date(C);s.setMonth(s.getMonth()+1),P(s)},he=()=>{const s=new Date(C);s.setMonth(s.getMonth()-1),P(s)},p=s=>`${s.address}, ${s.postalCode} ${s.city}`,ue=(s=>{const t=s.getFullYear(),r=s.getMonth(),I=new Date(t,r+1,0).getDate(),m=new Date(t,r,1).getDay(),N=[],pe=new Date(t,r,0).getDate();for(let c=m===0?6:m-1;c>0;c--)N.push({date:new Date(t,r-1,pe-c+1),isCurrentMonth:!1});for(let c=1;c<=I;c++)N.push({date:new Date(t,r,c),isCurrentMonth:!0});const ve=42-N.length;for(let c=1;c<=ve;c++)N.push({date:new Date(t,r+1,c),isCurrentMonth:!1});return N})(C),je=s=>o.filter(t=>t.appointmentDate&&t.appointmentDate.getDate()===s.getDate()&&t.appointmentDate.getMonth()===s.getMonth()&&t.appointmentDate.getFullYear()===s.getFullYear()),fe=s=>s.toLocaleDateString("fr-FR",{month:"long",year:"numeric"}),v=s=>s.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"});return e.jsx(ze,{title:"Rendez-vous",description:"Gestion des rendez-vous clients",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Rendez-vous"})}),e.jsx("p",{className:"text-muted-foreground",children:"Gestion des rendez-vous et planification"})]}),e.jsxs("div",{className:"flex w-full sm:w-auto items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Le,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(ge,{type:"search",placeholder:"Rechercher un rendez-vous...",className:"pl-8 w-full sm:w-[300px]",value:i,onChange:s=>j(s.target.value)})]}),e.jsx(a,{variant:"outline",onClick:()=>le(V==="calendar"?"list":"calendar"),children:V==="calendar"?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Vue liste"]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Vue calendrier"]})}),e.jsxs(a,{onClick:()=>f(!0),children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Nouveau RDV"]})]})]}),e.jsxs(Se,{defaultValue:"upcoming",value:w,onValueChange:te,className:"space-y-4",children:[e.jsxs(Me,{children:[e.jsx(A,{value:"upcoming",children:"À venir"}),e.jsx(A,{value:"pending",children:"En attente"}),e.jsx(A,{value:"past",children:"Passés"}),e.jsx(A,{value:"canceled",children:"Annulés"})]}),e.jsx(L,{value:"upcoming",className:"m-0",children:k?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(M,{className:"h-8 w-8 animate-spin text-blue-600"})}):S?e.jsx(n,{children:e.jsxs(l,{className:"py-10 text-center",children:[e.jsx(T,{className:"h-10 w-10 text-amber-500 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Une erreur est survenue lors du chargement des rendez-vous."}),e.jsx(a,{variant:"outline",size:"sm",className:"mt-4",children:"Réessayer"})]})}):o.length===0?e.jsx(n,{children:e.jsxs(l,{className:"py-10 text-center",children:[e.jsx(E,{className:"h-10 w-10 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun rendez-vous trouvé."}),i&&e.jsx(a,{variant:"outline",size:"sm",onClick:()=>j(""),children:"Effacer la recherche"})]})}):V==="list"?e.jsxs(n,{children:[e.jsxs(g,{className:"pb-1",children:[e.jsx(y,{children:"Liste des rendez-vous à venir"}),e.jsx(b,{children:"Consultez et gérez les rendez-vous planifiés"})]}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{id:"selectAll",className:"mr-2"}),e.jsx("label",{htmlFor:"selectAll",children:"Client"})]})}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Référence"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Adresse"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Statut"}),e.jsx("th",{className:"text-right py-3 px-2 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:o.map(s=>{let t;switch(s.status){case"scheduled":t=e.jsx(h,{className:"bg-blue-500",children:"Planifié"});break;case"validated":t=e.jsx(h,{className:"bg-green-500",children:"Validé"});break;case"in_progress":t=e.jsx(h,{variant:"secondary",children:"En cours"});break;default:t=e.jsx(h,{variant:"outline",children:s.status})}return e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"py-3 px-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{id:`select-${s.id}`,className:"mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.customerName}),s.enedisRef&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Ref. Enedis: ",s.enedisRef]})]})]})}),e.jsx("td",{className:"py-3 px-2",children:s.appointmentDate?e.jsxs("div",{children:[e.jsx("div",{children:v(s.appointmentDate)}),s.timeSlot&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.timeSlot})]}):e.jsx("span",{className:"text-muted-foreground text-xs italic",children:"En attente de planification"})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"font-mono text-xs",children:s.referenceNumber})}),e.jsx("td",{className:"py-3 px-2 max-w-xs truncate",children:p(s)}),e.jsx("td",{className:"py-3 px-2",children:t}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(a,{variant:"ghost",size:"icon",title:"Détails",onClick:()=>{u({title:"Détails du rendez-vous",description:e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Client:"})," ",s.customerName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Référence:"})," ",s.referenceNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",s.appointmentDate?v(s.appointmentDate):"Non planifié"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Heure:"})," ",s.timeSlot||"Non précisée"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Adresse:"})," ",p(s)]}),s.enedisRef&&e.jsxs("p",{children:[e.jsx("strong",{children:"Réf. Enedis:"})," ",s.enedisRef]}),s.email&&e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),s.phone&&e.jsxs("p",{children:[e.jsx("strong",{children:"Téléphone:"})," ",s.phone]})]}),duration:6e3})},children:e.jsx(Y,{className:"h-4 w-4"})}),s.email&&e.jsx(a,{variant:"ghost",size:"icon",title:s.hasReminderSent?"Rappel déjà envoyé":"Envoyer un rappel",onClick:()=>oe(s),disabled:s.hasReminderSent,className:s.hasReminderSent?"text-green-500":"",children:s.hasReminderSent?e.jsx(be,{className:"h-4 w-4"}):e.jsx(we,{className:"h-4 w-4"})}),e.jsx(a,{variant:"ghost",size:"icon",title:"Modifier le rendez-vous",onClick:()=>{const r=s.id;D(r),f(!0)},children:e.jsx(E,{className:"h-4 w-4"})}),e.jsx(a,{variant:"ghost",size:"icon",title:"Annuler le rendez-vous",onClick:()=>ie(s.id),children:e.jsx(se,{className:"h-4 w-4"})})]})})]},s.id)})})]})})}),e.jsx(ke,{className:"flex justify-between border-t p-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Affichage de ",o.length," rendez-vous"]})})]}):e.jsxs(n,{children:[e.jsxs(g,{className:"pb-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{children:"Calendrier des rendez-vous"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{variant:"outline",size:"icon",onClick:he,children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium",children:fe(C)}),e.jsx(a,{variant:"outline",size:"icon",onClick:me,children:e.jsx(Ce,{className:"h-4 w-4"})})]})]}),e.jsx(b,{children:"Vue mensuelle des rendez-vous planifiés"})]}),e.jsx(l,{children:e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"].map((s,t)=>e.jsx("div",{className:"text-center text-sm font-medium py-2",children:s},s)),ue.map((s,t)=>{const r=je(s.date),I=new Date().getDate()===s.date.getDate()&&new Date().getMonth()===s.date.getMonth()&&new Date().getFullYear()===s.date.getFullYear();return e.jsxs("div",{className:`min-h-24 border rounded-md p-1 ${s.isCurrentMonth?"bg-background":"bg-muted opacity-50"} ${I?"border-blue-500 border-2":"border-border"}`,children:[e.jsx("div",{className:"text-right p-1 text-sm",children:s.date.getDate()}),e.jsx("div",{className:"space-y-1",children:r.map(m=>e.jsxs("div",{className:"bg-blue-100 text-blue-800 text-xs p-1 rounded cursor-pointer truncate",onClick:()=>{D(m.id),f(!0)},children:[m.timeSlot?m.timeSlot:"—"," • ",m.customerName]},m.id))})]},t)})]})})]})}),e.jsx(L,{value:"pending",className:"m-0",children:k?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(M,{className:"h-8 w-8 animate-spin text-blue-600"})}):S?e.jsx(n,{children:e.jsxs(l,{className:"py-10 text-center",children:[e.jsx(T,{className:"h-10 w-10 text-amber-500 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Une erreur est survenue lors du chargement des rendez-vous."}),e.jsx(a,{variant:"outline",size:"sm",className:"mt-4",children:"Réessayer"})]})}):o.length===0?e.jsx(n,{children:e.jsxs(l,{className:"py-10 text-center",children:[e.jsx(E,{className:"h-10 w-10 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun rendez-vous en attente trouvé."}),i&&e.jsx(a,{variant:"outline",size:"sm",onClick:()=>j(""),children:"Effacer la recherche"})]})}):e.jsxs(n,{children:[e.jsxs(g,{className:"pb-1",children:[e.jsx(y,{children:"Demandes en attente de planification"}),e.jsx(b,{children:"Rendez-vous qui nécessitent une date et une heure"})]}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Client"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Référence"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Adresse"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Créé le"}),e.jsx("th",{className:"text-right py-3 px-2 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:o.map(s=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"py-3 px-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.customerName}),s.enedisRef&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Ref. Enedis: ",s.enedisRef]})]})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"font-mono text-xs",children:s.referenceNumber})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"text-sm truncate max-w-[200px]",children:p(s)})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{children:new Date(s.createdAt).toLocaleDateString("fr-FR")})}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsxs(a,{size:"sm",variant:"default",onClick:()=>{D(s.id),f(!0)},children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Planifier"]})})]},s.id))})]})})})]})}),e.jsx(L,{value:"past",className:"m-0",children:k?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(M,{className:"h-8 w-8 animate-spin text-blue-600"})}):S?e.jsx(n,{children:e.jsxs(l,{className:"py-10 text-center",children:[e.jsx(T,{className:"h-10 w-10 text-amber-500 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Une erreur est survenue lors du chargement des rendez-vous."}),e.jsx(a,{variant:"outline",size:"sm",className:"mt-4",children:"Réessayer"})]})}):o.length===0?e.jsx(n,{children:e.jsxs(l,{className:"py-10 text-center",children:[e.jsx(E,{className:"h-10 w-10 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun rendez-vous passé trouvé."}),i&&e.jsx(a,{variant:"outline",size:"sm",onClick:()=>j(""),children:"Effacer la recherche"})]})}):e.jsxs(n,{children:[e.jsxs(g,{className:"pb-1",children:[e.jsx(y,{children:"Historique des rendez-vous"}),e.jsx(b,{children:"Rendez-vous passés et terminés"})]}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Client"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Référence"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Adresse"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Statut"})]})}),e.jsx("tbody",{children:o.map(s=>{let t;switch(s.status){case"scheduled":t=e.jsx(h,{className:"bg-blue-500",children:"Planifié"});break;case"validated":t=e.jsx(h,{className:"bg-green-500",children:"Validé"});break;case"in_progress":t=e.jsx(h,{variant:"secondary",children:"En cours"});break;default:t=e.jsx(h,{variant:"outline",children:s.status})}return e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsxs("td",{className:"py-3 px-2",children:[e.jsx("div",{className:"font-medium",children:s.customerName}),s.enedisRef&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Ref. Enedis: ",s.enedisRef]})]}),e.jsx("td",{className:"py-3 px-2",children:s.appointmentDate?e.jsxs("div",{children:[e.jsx("div",{children:v(s.appointmentDate)}),s.timeSlot&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.timeSlot})]}):e.jsx("span",{className:"text-muted-foreground text-xs italic",children:"Non planifié"})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"font-mono text-xs",children:s.referenceNumber})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"text-sm truncate max-w-[200px]",children:p(s)})}),e.jsx("td",{className:"py-3 px-2",children:t})]},s.id)})})]})})})]})}),e.jsx(L,{value:"canceled",className:"m-0",children:k?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(M,{className:"h-8 w-8 animate-spin text-blue-600"})}):S?e.jsx(n,{children:e.jsxs(l,{className:"py-10 text-center",children:[e.jsx(T,{className:"h-10 w-10 text-amber-500 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Une erreur est survenue lors du chargement des rendez-vous."}),e.jsx(a,{variant:"outline",size:"sm",className:"mt-4",children:"Réessayer"})]})}):o.length===0?e.jsx(n,{children:e.jsxs(l,{className:"py-10 text-center",children:[e.jsx(se,{className:"h-10 w-10 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun rendez-vous annulé trouvé."}),i&&e.jsx(a,{variant:"outline",size:"sm",onClick:()=>j(""),children:"Effacer la recherche"})]})}):e.jsxs(n,{children:[e.jsxs(g,{className:"pb-1",children:[e.jsx(y,{children:"Rendez-vous annulés"}),e.jsx(b,{children:"Historique des rendez-vous annulés"})]}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Client"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Date prévue"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Référence"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Adresse"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Date d'annulation"})]})}),e.jsx("tbody",{children:o.map(s=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsxs("td",{className:"py-3 px-2",children:[e.jsx("div",{className:"font-medium",children:s.customerName}),s.enedisRef&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Ref. Enedis: ",s.enedisRef]})]}),e.jsx("td",{className:"py-3 px-2",children:s.appointmentDate?e.jsxs("div",{children:[e.jsx("div",{children:v(s.appointmentDate)}),s.timeSlot&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.timeSlot})]}):e.jsx("span",{className:"text-muted-foreground text-xs italic",children:"Non planifié"})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"font-mono text-xs",children:s.referenceNumber})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"text-sm truncate max-w-[200px]",children:p(s)})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"text-sm",children:new Date(s.updatedAt||s.createdAt).toLocaleDateString("fr-FR")})})]},s.id))})]})})})]})})]}),e.jsx(Ae,{isOpen:ae,onClose:B,leadId:re,onAppointmentCreated:s=>{u({title:"Rendez-vous créé",description:`Le rendez-vous a été créé avec succès pour ${s.customerName}.`}),B()}}),e.jsx(Q,{open:ne,onOpenChange:R,children:e.jsxs(_,{children:[e.jsxs(K,{children:[e.jsx(G,{children:"Confirmer l'annulation"}),e.jsx(X,{children:"Êtes-vous sûr de vouloir annuler ce rendez-vous ? Cette action est irréversible."})]}),e.jsxs(J,{children:[e.jsx(a,{variant:"outline",onClick:()=>R(!1),children:"Annuler"}),e.jsx(a,{variant:"destructive",onClick:ce,children:F?"Confirmer l'annulation":"Fermer"})]})]})}),e.jsx(Q,{open:de,onOpenChange:z,children:e.jsxs(_,{children:[e.jsxs(K,{children:[e.jsx(G,{children:"Envoyer un rappel"}),e.jsx(X,{children:d&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"my-2",children:["Un email de rappel sera envoyé à ",e.jsx("strong",{children:d.customerName})," pour le rendez-vous prévu le ",e.jsx("strong",{children:d.appointmentDate?v(d.appointmentDate):"Non planifié"}),d.timeSlot?` à ${d.timeSlot}`:"","."]}),e.jsxs("p",{className:"my-2",children:["Email: ",e.jsx("strong",{children:d.email})]})]})})]}),e.jsxs(J,{children:[e.jsx(a,{variant:"outline",onClick:()=>z(!1),children:"Annuler"}),e.jsx(a,{variant:"default",onClick:xe,children:"Envoyer le rappel"})]})]})})]})})}export{hs as default};
