import{c as K,a as U,r as b,e as B,j as e,L as h,O as o,I as i,B as m,R as O,W as V,T as Q,M as R,av as H,l as q,d as W,t as J,F as X,f as P,g as C,h as S,i as k,k as F,m as Y,o as Z,s as E}from"./index-BrNNGNep.js";import{a as $}from"./use-auth-DJHSvkeD.js";import{A}from"./admin-layout-Bh-ckVX4.js";import{C as j,a as g,b as f,c as v,d as y,e as L}from"./card-XGaEUDSn.js";import{T as ee,a as se,b as N,c as w}from"./tabs-B934nsrZ.js";import{S as ae}from"./separator-JLyzjYyE.js";import{B as T}from"./use-mobile-vIMhvYUF.js";import{S as M}from"./save-C3erpEmu.js";import{T as re}from"./triangle-alert-B598nRLT.js";import{C as te}from"./credit-card-ByJORvsP.js";import{E as ie}from"./eye-off-FPwX1Hnh.js";import{P as ne}from"./pencil-CR0V5AVM.js";import{L as D}from"./lock-SC5NF5-7.js";import"./log-out-Qzc6qSOT.js";import"./settings-CN0oOa9S.js";import"./index-CKP3Y2sy.js";import"./index-bipKvpz_.js";import"./index-CFnTPfOk.js";import"./external-link-CDkF8v_-.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=K("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=K("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=K("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);function Le(){var _,z;const{toast:d}=U(),[s,n]=b.useState({stripe:{publicKey:"",hasSecretKey:!1},email:{provider:"sendgrid",senderEmail:"",senderName:""},general:{siteName:"",defaultPrice:129.8,adminContactNumber:"",siteUrl:""}}),[l,u]=b.useState(!1),{data:c,isLoading:r}=$({queryKey:["/api/system-config"],queryFn:async()=>{const a=await q("GET","/api/system-config");if(!a.ok){const x=await a.text();throw new Error(x||"Erreur lors de la récupération de la configuration")}return a.json()}});b.useState(()=>{c!=null&&c.success&&(c!=null&&c.configs)&&n(c.configs)});const t=B({mutationFn:async a=>{const x=await q("POST","/api/system-config",a);if(!x.ok){const G=await x.text();throw new Error(G||"Erreur lors de la mise à jour de la configuration")}return x.json()},onSuccess:()=>{H.invalidateQueries({queryKey:["/api/system-config"]}),d({title:"Configuration enregistrée",description:"Les paramètres ont été mis à jour avec succès"})},onError:a=>{d({title:"Erreur",description:a.message,variant:"destructive"})}}),p=a=>{t.mutate({section:a,config:s[a]})};return r?e.jsx(A,{title:"Paramètres",children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(h,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsx(A,{title:"Paramètres",description:"Configuration générale de l'application",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Paramètres"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Configuration générale du système et des intégrations"})]}),e.jsxs(ee,{defaultValue:"general",className:"w-full",children:[e.jsxs(se,{className:"grid w-full grid-cols-4",children:[e.jsx(N,{value:"general",children:"Général"}),e.jsx(N,{value:"payments",children:"Paiements"}),e.jsx(N,{value:"emails",children:"Emails"}),e.jsx(N,{value:"security",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Sécurité"]})})]}),e.jsx(w,{value:"general",className:"space-y-4 mt-4",children:e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsx(f,{children:"Configuration générale"}),e.jsx(v,{children:"Paramètres généraux de l'application"})]}),e.jsxs(y,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"site-name",children:"Nom du site"}),e.jsx(i,{id:"site-name",value:s.general.siteName,onChange:a=>n({...s,general:{...s.general,siteName:a.target.value}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"site-url",children:"URL du site"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx(i,{id:"site-url",value:s.general.siteUrl,onChange:a=>n({...s,general:{...s.general,siteUrl:a.target.value}}),placeholder:"https://portail-electricite.com"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"contact-number",children:"Numéro de contact administrateur"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx(i,{id:"contact-number",value:s.general.adminContactNumber,onChange:a=>n({...s,general:{...s.general,adminContactNumber:a.target.value}}),placeholder:"+33 1 23 45 67 89"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"default-price",children:"Prix par défaut (€)"}),e.jsx(i,{id:"default-price",type:"number",step:"0.01",value:s.general.defaultPrice,onChange:a=>n({...s,general:{...s.general,defaultPrice:parseFloat(a.target.value)}})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Prix par défaut pour les demandes de raccordement (129.80€ TTC)"})]})]}),e.jsx(L,{className:"flex justify-end",children:e.jsx(m,{onClick:()=>p("general"),disabled:t.isPending,children:t.isPending?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Enregistrer"]})})})]})}),e.jsx(w,{value:"payments",className:"space-y-4 mt-4",children:e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsx(f,{children:"Configuration Stripe"}),e.jsx(v,{children:"Paramètres pour le traitement des paiements via Stripe"})]}),e.jsxs(y,{className:"space-y-6",children:[e.jsxs(O,{children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(V,{children:"Important"}),e.jsx(Q,{children:"Les clés API Stripe sont sensibles et ne doivent jamais être partagées. Ces paramètres sont stockés de manière sécurisée dans l'environnement de l'application."})]}),e.jsxs("div",{className:"space-y-6 pt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{htmlFor:"stripe-public-key",className:"flex items-center",children:[e.jsx("span",{children:"Clé publique Stripe"}),e.jsx(T,{variant:"outline",className:"ml-2",children:s.stripe.publicKey?"Configurée":"Non configurée"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx(i,{id:"stripe-public-key",value:l?s.stripe.publicKey:s.stripe.publicKey?"pk_•••••••••••••••••••••••••••••••":"",onChange:a=>n({...s,stripe:{...s.stripe,publicKey:a.target.value}}),placeholder:"pk_live_..."}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>u(!l),children:e.jsx(ie,{className:"h-4 w-4"})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),'Commence par "pk_test_" ou "pk_live_"']})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(o,{htmlFor:"stripe-secret-key",children:"Clé secrète Stripe"}),e.jsx(T,{variant:s.stripe.hasSecretKey?"default":"destructive",children:s.stripe.hasSecretKey?"Configurée":"Manquante"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"La clé secrète est stockée en tant que variable d'environnement et n'est pas accessible via l'interface. Contactez l'administrateur système pour la modifier."})]}),e.jsx(ae,{}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{htmlFor:"stripe-mode",children:"Mode de paiement"}),e.jsx(T,{variant:"outline",className:(_=s.stripe.publicKey)!=null&&_.includes("pk_live")?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800",children:(z=s.stripe.publicKey)!=null&&z.includes("pk_live")?"Production":"Test"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'Le mode est déterminé automatiquement selon la clé publique utilisée. Utilisez une clé avec "pk_test_" pour le mode test, ou "pk_live_" pour le mode production.'})]})]})]}),e.jsx(L,{className:"flex justify-end",children:e.jsx(m,{onClick:()=>p("stripe"),disabled:t.isPending,children:t.isPending?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Enregistrer"]})})})]})}),e.jsx(w,{value:"emails",className:"space-y-4 mt-4",children:e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsx(f,{children:"Configuration des emails"}),e.jsx(v,{children:"Paramètres pour l'envoi d'emails depuis l'application"})]}),e.jsxs(y,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"email-sender-name",children:"Nom d'expéditeur"}),e.jsx(i,{id:"email-sender-name",value:s.email.senderName,onChange:a=>n({...s,email:{...s.email,senderName:a.target.value}}),placeholder:"Service Raccordement Électrique"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"email-sender-email",children:"Email d'expéditeur"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(R,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx(i,{id:"email-sender-email",type:"email",value:s.email.senderEmail,onChange:a=>n({...s,email:{...s.email,senderEmail:a.target.value}}),placeholder:"contact@portail-electricite.com"})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Configuration SMTP détaillée"}),e.jsxs("div",{className:"bg-muted p-4 rounded-md",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:`La configuration SMTP avancée est disponible dans l'onglet "Config SMTP" du menu latéral.`}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>window.location.href="/admin/smtp",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Configurer le serveur SMTP"]})]})]})]}),e.jsx(L,{className:"flex justify-end",children:e.jsx(m,{onClick:()=>p("email"),disabled:t.isPending,children:t.isPending?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Enregistrer"]})})})]})}),e.jsx(w,{value:"security",className:"space-y-4 mt-4",children:e.jsxs(j,{children:[e.jsxs(g,{children:[e.jsxs(f,{className:"flex items-center",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Sécurité du compte"]}),e.jsx(v,{children:"Paramètres de sécurité et modification du mot de passe"})]}),e.jsx(y,{className:"space-y-6",children:e.jsx(de,{})})]})})]})]})})}const oe=Z({currentPassword:E().min(1,"Le mot de passe actuel est requis"),newPassword:E().min(6,"Le nouveau mot de passe doit contenir au moins 6 caractères"),confirmPassword:E().min(1,"La confirmation du mot de passe est requise")}).refine(d=>d.newPassword===d.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirmPassword"]});function de(){const{toast:d}=U(),[s,n]=b.useState(!1),l=W({resolver:J(oe),defaultValues:{currentPassword:"",newPassword:"",confirmPassword:""}}),u=B({mutationFn:async r=>{const t=await q("POST","/api/change-password",{currentPassword:r.currentPassword,newPassword:r.newPassword});if(!t.ok){const p=await t.json();throw new Error(p.message||"Erreur lors du changement de mot de passe")}return t.json()},onSuccess:()=>{d({title:"Mot de passe modifié",description:"Votre mot de passe a été modifié avec succès",variant:"default"}),l.reset()},onError:r=>{d({title:"Erreur",description:r.message,variant:"destructive"})}}),c=r=>{u.mutate(r)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Modifier votre mot de passe"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Modifiez votre mot de passe. Pour des raisons de sécurité, choisissez un mot de passe fort que vous n'utilisez pas ailleurs."})]}),e.jsx(X,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(c),className:"space-y-5",children:[e.jsx(P,{control:l.control,name:"currentPassword",render:({field:r})=>e.jsxs(C,{children:[e.jsx(S,{children:"Mot de passe actuel"}),e.jsx(k,{children:e.jsx(i,{type:"password",...r})}),e.jsx(F,{})]})}),e.jsx(P,{control:l.control,name:"newPassword",render:({field:r})=>e.jsxs(C,{children:[e.jsx(S,{children:"Nouveau mot de passe"}),e.jsx(k,{children:e.jsx(i,{type:"password",...r})}),e.jsx(Y,{children:"Le mot de passe doit contenir au moins 6 caractères."}),e.jsx(F,{})]})}),e.jsx(P,{control:l.control,name:"confirmPassword",render:({field:r})=>e.jsxs(C,{children:[e.jsx(S,{children:"Confirmer le mot de passe"}),e.jsx(k,{children:e.jsx(i,{type:"password",...r})}),e.jsx(F,{})]})}),e.jsx(m,{type:"submit",disabled:u.isPending,className:"mt-4",children:u.isPending?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"mr-2 h-4 w-4 animate-spin"}),"Modification en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Changer le mot de passe"]})})]})})]})}export{Le as default};
