import{c as z,j as e,B as o,b5 as Q,r as u,e as oe,b2 as xe,I as he,L as pe,P as W,A as je,w as X,R as ue,V as ge,W as Ne,Y as ve,a1 as fe,p as ye,a7 as be,o as we,U as Z,a0 as Se,l as Ce,a8 as Te,aJ as De}from"./index-B68p28tH.js";import{u as Ae}from"./useQuery-DNbaHa9s.js";import{A as Me,D as Pe,p as Re,q as Ee,r as w,v as ke}from"./admin-layout-DQBCNrhH.js";import{C as l,a as r,b as m,c as q,d as t,e as Le}from"./card-jdZ5RFLE.js";import{T as _e,a as Fe,b as Y,c as N,d as Ie,e as v}from"./table-BWlzHg6X.js";import{S as P,a as R,d as E,b as k,c as i}from"./select-BS2oQKQi.js";import{B as S}from"./badge-DP1HY1Tf.js";import{C as Ve}from"./copy-DnMLseqN.js";import{D as ze}from"./download-D0gKjP4q.js";import{S as $e}from"./search-D1LopY1o.js";import{C as Be}from"./circle-x-BQwMUlXt.js";import{R as He}from"./refresh-cw-CoM1osE-.js";import{F as C}from"./file-text-DZVQFndI.js";import{E as Ge}from"./eye-BFbVk0FK.js";import{P as Ue}from"./pencil-DRBFrHxR.js";import{M as Oe}from"./map-pin-BBdS_6M9.js";import{C as K}from"./credit-card-Y5pUkyEh.js";import"./use-auth-D8kPxXyX.js";import"./use-mobile-CiffdCor.js";import"./index-BZhe7pAt.js";import"./log-out-C8Q2C3mi.js";import"./users-XNDtQCy_.js";import"./settings-BVbp-LDN.js";import"./index-D3mlvssk.js";import"./index-EEdLqHjB.js";import"./separator-gMbJhXSU.js";import"./external-link-BwCMoZ9r.js";import"./index-D00Q3tbH.js";import"./chevron-down-CWGuasjc.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=z("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=z("HardHat",[["path",{d:"M2 18a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v2z",key:"1dej2m"}],["path",{d:"M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5",key:"1p9q5i"}],["path",{d:"M4 15v-3a6 6 0 0 1 6-6",key:"9ciidu"}],["path",{d:"M14 6a6 6 0 0 1 6 6v3",key:"1hnv84"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=z("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);function Je({referenceNumber:s}){const g=n=>`https://www.demande-raccordement.fr/paiement-multiple/${s}/${n}`,b=(n,h)=>{navigator.clipboard.writeText(n).then(()=>{Q({title:"Lien copié",description:`Le lien de paiement (x${h}) a été copié dans le presse-papier.`})}).catch(d=>{console.error("Erreur lors de la copie du lien:",d),Q({title:"Erreur",description:"Impossible de copier le lien. Veuillez réessayer.",variant:"destructive"})})};return e.jsxs(l,{children:[e.jsxs(r,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5 text-blue-600"}),"Liens de paiement majoré"]}),e.jsxs(q,{children:["Liens de paiement avec montants majorés pour la référence ",e.jsx("strong",{children:s}),". Partagez ces liens avec vos clients pour différents niveaux de service."]})]}),e.jsxs(t,{className:"space-y-4",children:[e.jsx("div",{className:"rounded-md bg-blue-50 p-4 border border-blue-100",children:e.jsx("p",{className:"text-sm text-blue-700",children:"Ces liens permettent aux clients d'effectuer des paiements avec différents multiplicateurs. Choisissez le montant approprié en fonction des services supplémentaires convenus."})}),e.jsx("div",{className:"space-y-3",children:[2,3,4,5].map(n=>{const h=g(n),d=(129.8*n).toFixed(2).replace(".",",");return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md bg-white hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Paiement x",n]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 truncate max-w-xs md:max-w-md",children:h}),e.jsxs("p",{className:"text-sm font-semibold text-blue-600 mt-1",children:[d,"€"]})]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>b(h,n),className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"w-3.5 h-3.5"}),"Copier"]})]},n)})})]}),e.jsx(Le,{className:"flex justify-between border-t pt-4",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Les liens sont valables tant que la référence est active."})})]})}function L(s){return s?new Date(s).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"}):"N/A"}function We(s){return s?new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(s):"N/A"}function J(s){return s?s.replace(/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/,"$1 $2 $3 $4 $5"):"N/A"}function ee(s,x){window.open(`tel:${s}`,"_blank"),console.log(`Appel de ${x} au ${s}`)}function Xe({requests:s}){const x=s.length,g=s.filter(c=>c.status==="pending").length,b=s.filter(c=>c.status==="in_progress").length,n=s.filter(c=>c.status==="completed").length,h=s.filter(c=>!c.paymentStatus||c.paymentStatus!=="succeeded").length,d=s.filter(c=>c.paymentStatus==="succeeded").length;return e.jsxs("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-6",children:[e.jsx(l,{className:"bg-blue-50 border-blue-100",children:e.jsxs(t,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(C,{className:"h-8 w-8 text-blue-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-blue-800",children:x}),e.jsx("p",{className:"text-xs text-blue-700",children:"Total demandes"})]})}),e.jsx(l,{className:"bg-yellow-50 border-yellow-100",children:e.jsxs(t,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(ye,{className:"h-8 w-8 text-yellow-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-yellow-800",children:g}),e.jsx("p",{className:"text-xs text-yellow-700",children:"En attente"})]})}),e.jsx(l,{className:"bg-purple-50 border-purple-100",children:e.jsxs(t,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(be,{className:"h-8 w-8 text-purple-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-purple-800",children:b}),e.jsx("p",{className:"text-xs text-purple-700",children:"En cours"})]})}),e.jsx(l,{className:"bg-green-50 border-green-100",children:e.jsxs(t,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(we,{className:"h-8 w-8 text-green-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-green-800",children:n}),e.jsx("p",{className:"text-xs text-green-700",children:"Terminées"})]})}),e.jsx(l,{className:"bg-indigo-50 border-indigo-100",children:e.jsxs(t,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(Z,{className:"h-8 w-8 text-indigo-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-indigo-800",children:d}),e.jsx("p",{className:"text-xs text-indigo-700",children:"Clients"})]})}),e.jsx(l,{className:"bg-orange-50 border-orange-100",children:e.jsxs(t,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(C,{className:"h-8 w-8 text-orange-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-orange-800",children:h}),e.jsx("p",{className:"text-xs text-orange-700",children:"Leads"})]})})]})}function Ze({request:s,onClose:x}){return s?e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s.referenceNumber}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Créée le ",L(s.createdAt)]})]}),e.jsx(S,{variant:s.status==="completed"?"default":s.status==="in_progress"?"secondary":s.status==="pending"?"outline":"destructive",children:s.status==="completed"?"Terminé":s.status==="in_progress"?"En cours":s.status==="pending"?"En attente":"Annulé"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 max-h-[70vh] md:max-h-none overflow-y-auto md:overflow-visible pb-4 pr-1",children:[e.jsxs(l,{children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(Z,{className:"mr-2 h-5 w-5 text-blue-600"}),"Informations client"]})}),e.jsxs(t,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Nom"}),e.jsx("div",{className:"font-medium",children:s.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Email"}),e.jsx("div",{children:e.jsx("a",{href:`mailto:${s.email}`,className:"text-blue-600 hover:underline",children:s.email})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Téléphone"}),e.jsx("div",{children:e.jsx("a",{href:`tel:${s.phone}`,className:"text-blue-600 hover:underline",children:J(s.phone)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Type"}),e.jsx("div",{children:e.jsx(S,{variant:"outline",className:"font-normal",children:s.clientType==="particulier"?"Particulier":s.clientType==="professionnel"?"Professionnel":"Collectivité"})})]}),s.clientType!=="particulier"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Société"}),e.jsx("div",{className:"font-medium",children:s.company})]}),s.siret&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"SIRET"}),e.jsx("div",{className:"font-mono text-xs",children:s.siret})]})]}),s.ipAddress&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"IP"}),e.jsx("div",{className:"font-mono text-xs",children:s.ipAddress})]}),s.userAgent&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Navigateur"}),e.jsx("div",{className:"truncate text-xs",children:s.userAgent})]})]})]}),e.jsxs(l,{children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(C,{className:"mr-2 h-5 w-5 text-blue-600"}),"Détails de la demande"]})}),e.jsxs(t,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Type"}),e.jsx("div",{children:s.requestType==="new_connection"?"Nouvelle connexion":s.requestType==="power_upgrade"?"Augmentation puissance":s.requestType==="meter_upgrade"?"Modification compteur":s.requestType==="temporary_connection"?"Raccordement temporaire":s.requestType==="relocation"?"Déplacement d'ouvrage":s.requestType==="technical_visit"?"Visite technique":"Autre"})]}),s.otherRequestTypeDesc&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Détail"}),e.jsx("div",{children:s.otherRequestTypeDesc})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Puissance"}),e.jsxs("div",{children:[s.powerRequired," kVA"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Phase"}),e.jsx("div",{children:s.phaseType==="monophase"?"Monophasé":"Triphasé"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Bâtiment"}),e.jsx("div",{children:s.buildingType==="individual_house"?"Maison individuelle":s.buildingType==="apartment_building"?"Immeuble collectif":s.buildingType==="commercial"?"Local commercial":s.buildingType==="industrial"?"Bâtiment industriel":s.buildingType==="agricultural"?"Exploitation agricole":s.buildingType==="public"?"Établissement public":s.buildingType==="terrain"?"Terrain":"Autre"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Avancement"}),e.jsx("div",{children:s.projectStatus==="planning"?"En projet":s.projectStatus==="permit_pending"?"Permis déposé":s.projectStatus==="permit_approved"?"Permis approuvé":s.projectStatus==="construction_started"?"Construction démarrée":s.projectStatus==="construction_completed"?"Construction terminée":"Autre"})]}),s.terrainViabilise&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Terrain"}),e.jsx("div",{children:s.terrainViabilise==="viabilise"?"Viabilisé":"Non viabilisé"})]}),s.billingAddress&&s.billingAddress!==s.address&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Adresse facturation différente"}),e.jsx("div",{children:"Oui"})]}),s.permitNumber&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"N° Permis"}),e.jsx("div",{children:s.permitNumber})]}),s.permitDeliveryDate&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Date permis"}),e.jsx("div",{children:s.permitDeliveryDate})]}),s.desiredCompletionDate&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Date souhaitée"}),e.jsx("div",{children:s.desiredCompletionDate})]})]})]}),e.jsxs(l,{children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(Oe,{className:"mr-2 h-5 w-5 text-blue-600"}),"Adresse du projet"]})}),e.jsxs(t,{className:"space-y-2",children:[e.jsxs("div",{className:"font-medium",children:[s.address,s.addressComplement&&e.jsxs("span",{children:[", ",s.addressComplement]}),e.jsx("br",{}),s.postalCode," ",s.city]}),s.cadastralReference&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Référence cadastrale"}),e.jsx("div",{children:s.cadastralReference})]}),s.billingAddress&&s.billingAddress!==s.address&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4 mb-2 text-sm font-medium",children:"Adresse de facturation"}),e.jsxs("div",{className:"font-medium",children:[s.billingAddress,e.jsx("br",{}),s.billingPostalCode," ",s.billingCity]})]})]})]}),s.hasArchitect&&e.jsxs(l,{children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(Ye,{className:"mr-2 h-5 w-5 text-blue-600"}),"Architecte"]})}),e.jsxs(t,{className:"space-y-2",children:[s.architectName&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Nom"}),e.jsx("div",{children:s.architectName})]}),s.architectPhone&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Téléphone"}),e.jsx("div",{children:J(s.architectPhone)})]}),s.architectEmail&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Email"}),e.jsx("div",{children:s.architectEmail})]})]})]}),e.jsxs(l,{className:"border-blue-200 bg-blue-50",children:[e.jsx(r,{className:"pb-2",children:e.jsxs(m,{className:"flex items-center text-blue-700",children:[e.jsx(K,{className:"mr-2 h-5 w-5"}),"Informations de paiement"]})}),e.jsxs(t,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Statut"}),e.jsx("div",{children:e.jsx(S,{variant:s.paymentStatus==="succeeded"||s.paymentStatus==="paid"?"default":"outline",className:`${s.paymentStatus==="succeeded"||s.paymentStatus==="paid"?"bg-green-100 text-green-800":s.paymentStatus==="failed"?"bg-red-100 text-red-800":""}`,children:s.paymentStatus==="succeeded"||s.paymentStatus==="paid"?"Payé":s.paymentStatus==="processing"?"En cours":s.paymentStatus==="failed"?"Échec":"Non payé"})})]}),s.paymentAmount&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Montant"}),e.jsx("div",{className:"font-semibold",children:We(parseFloat(s.paymentAmount.toString()))})]}),s.paymentMethod&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Méthode"}),e.jsx("div",{children:s.paymentMethod==="card"?"Carte bancaire":s.paymentMethod==="manual"?"Paiement manuel":s.paymentMethod})]}),s.paymentDate&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Date"}),e.jsx("div",{children:L(s.paymentDate)})]}),s.paymentId&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"ID Paiement"}),e.jsx("div",{className:"text-xs",children:s.paymentId})]}),s.cardBrand&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Carte"}),e.jsx("div",{className:"capitalize",children:s.cardBrand})]}),s.cardLast4&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Numéro"}),e.jsx("div",{className:"font-mono",children:s.cardLast4})]}),s.cardExpMonth&&s.cardExpYear&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Expiration"}),e.jsxs("div",{children:[s.cardExpMonth.toString().padStart(2,"0"),"/",s.cardExpYear]})]}),s.billingName&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Titulaire"}),e.jsx("div",{children:s.billingName})]}),s.bankName&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Banque"}),e.jsx("div",{children:s.bankName})]})]}),s.paymentError&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-red-200",children:[e.jsx("div",{className:"text-sm font-medium text-red-600 mb-1",children:"Erreur de paiement"}),e.jsx("div",{className:"text-xs whitespace-pre-wrap text-red-600 bg-red-50 p-2 rounded",children:s.paymentError})]})]})]}),(!s.paymentStatus||s.paymentStatus!=="succeeded"&&s.paymentStatus!=="paid")&&e.jsxs(l,{className:"border-green-200 bg-green-50",children:[e.jsxs(r,{className:"pb-2",children:[e.jsxs(m,{className:"flex items-center text-green-700",children:[e.jsx(K,{className:"mr-2 h-5 w-5"}),"Liens de paiement multiples"]}),e.jsx(q,{className:"text-green-600",children:"Générateur de liens de paiement avec montant majoré"})]}),e.jsx(t,{children:e.jsx(Je,{referenceNumber:s.referenceNumber})})]}),s.scheduledDate&&e.jsxs(l,{children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(X,{className:"mr-2 h-5 w-5 text-blue-600"}),"Rendez-vous Enedis"]})}),e.jsxs(t,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Date"}),e.jsx("div",{children:L(s.scheduledDate)})]}),s.scheduledTime&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Créneau"}),e.jsx("div",{children:s.scheduledTime})]}),s.enedisReferenceNumber&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Référence Enedis"}),e.jsx("div",{children:s.enedisReferenceNumber})]})]})]}),s.comments&&e.jsxs(l,{className:"md:col-span-2",children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(Se,{className:"mr-2 h-5 w-5 text-blue-600"}),"Commentaires"]})}),e.jsx(t,{children:e.jsx("p",{className:"whitespace-pre-wrap",children:s.comments})})]}),s.notes&&e.jsxs(l,{className:"md:col-span-2",children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(C,{className:"mr-2 h-5 w-5 text-blue-600"}),"Notes internes"]})}),e.jsx(t,{children:e.jsx("p",{className:"whitespace-pre-wrap",children:s.notes})})]})]}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-2 pt-4",children:[e.jsx(o,{variant:"outline",onClick:x,children:"Fermer"}),e.jsxs(o,{variant:"outline",className:"bg-blue-50 text-blue-700 hover:bg-blue-100",onClick:()=>ee(s.phone,s.name),children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Appeler"]}),e.jsx(o,{children:"Traiter la demande"})]})]}):null}function Ms(){const[s,x]=u.useState(""),[g,b]=u.useState(null),[n,h]=u.useState(null),[d,c]=u.useState("all"),[T,se]=u.useState(null),[$,ae]=u.useState(null),[ie,_]=u.useState(!1),[f,B]=u.useState(1),y=20,{data:le,isLoading:H,error:G,refetch:te}=Ae({queryKey:["/api/service-requests"],queryFn:De({on401:"throw"})}),ne=oe({mutationFn:async a=>await(await Ce("PATCH",`/api/service-requests/${a}`,{paymentStatus:"paid",status:"in_progress",paymentMethod:"manual",paymentDate:new Date().toISOString()})).json(),onSuccess:()=>{Te.invalidateQueries({queryKey:["/api/service-requests"]})}}),F=le||[],p=[...F.filter(a=>{var O;const D=!s||((O=a.referenceNumber)==null?void 0:O.toLowerCase().includes(s.toLowerCase()))||a.name&&a.name.toLowerCase().includes(s.toLowerCase())||a.email&&a.email.toLowerCase().includes(s.toLowerCase())||a.phone&&a.phone.includes(s)||a.address&&a.address.toLowerCase().includes(s.toLowerCase()),I=!g||a.status===g,U=!n||a.requestType===n,me=!T||T==="paid"&&(a.paymentStatus==="succeeded"||a.paymentStatus==="paid")||T==="unpaid"&&(!a.paymentStatus||a.paymentStatus!=="succeeded"&&a.paymentStatus!=="paid");let A=!0;if(d!=="all"&&a.createdAt){const V=new Date(a.createdAt),M=new Date;if(d==="today"){const j=new Date;j.setHours(0,0,0,0),A=V>=j}else if(d==="week"){const j=new Date(M);j.setDate(M.getDate()-7),A=V>=j}else if(d==="month"){const j=new Date(M);j.setMonth(M.getMonth()-1),A=V>=j}}return D&&I&&U&&me&&A})].sort((a,D)=>{const I=new Date(a.createdAt||0);return new Date(D.createdAt||0).getTime()-I.getTime()}),ce=a=>{ae(a),_(!0)},de=()=>{_(!1)},re=a=>{ne.mutate(a.id)};return e.jsxs(Me,{title:"Gestion des demandes",description:"Gérez toutes les demandes de raccordement électrique",children:[e.jsxs("div",{className:"space-y-6",children:[!H&&!G&&F&&e.jsx(Xe,{requests:F}),e.jsxs(l,{children:[e.jsx(r,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(m,{children:"Toutes les demandes"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Exporter"]}),e.jsxs(o,{size:"sm",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Nouvelle demande"]})]})]})}),e.jsxs(t,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($e,{className:"absolute h-4 w-4 top-3 left-3 text-gray-400"}),e.jsx(he,{placeholder:"Rechercher par nom, référence, adresse...",className:"pl-10",value:s,onChange:a=>x(a.target.value)})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(P,{value:g||"all",onValueChange:a=>b(a==="all"?null:a),children:[e.jsx(R,{className:"w-[140px]",children:e.jsx(E,{placeholder:"Tous les statuts"})}),e.jsxs(k,{children:[e.jsx(i,{value:"all",children:"Tous les statuts"}),e.jsx(i,{value:"pending",children:"En attente"}),e.jsx(i,{value:"in_progress",children:"En cours"}),e.jsx(i,{value:"completed",children:"Terminées"}),e.jsx(i,{value:"cancelled",children:"Annulées"})]})]}),e.jsxs(P,{value:n||"all",onValueChange:a=>h(a==="all"?null:a),children:[e.jsx(R,{className:"w-[180px]",children:e.jsx(E,{placeholder:"Tous les types"})}),e.jsxs(k,{children:[e.jsx(i,{value:"all",children:"Tous les types"}),e.jsx(i,{value:"new_connection",children:"Nouvelle connexion"}),e.jsx(i,{value:"power_upgrade",children:"Augmentation puissance"}),e.jsx(i,{value:"meter_upgrade",children:"Modification compteur"}),e.jsx(i,{value:"technical_visit",children:"Visite technique"})]})]}),e.jsxs(P,{value:T||"all",onValueChange:a=>se(a==="all"?null:a),children:[e.jsx(R,{className:"w-[140px]",children:e.jsx(E,{placeholder:"Paiement"})}),e.jsxs(k,{children:[e.jsx(i,{value:"all",children:"Tous"}),e.jsx(i,{value:"paid",children:"Payés"}),e.jsx(i,{value:"unpaid",children:"Non payés"})]})]}),e.jsxs(P,{value:d,onValueChange:c,children:[e.jsx(R,{className:"w-[140px]",children:e.jsx(E,{placeholder:"Période"})}),e.jsxs(k,{children:[e.jsx(i,{value:"all",children:"Toutes dates"}),e.jsx(i,{value:"today",children:"Aujourd'hui"}),e.jsx(i,{value:"week",children:"7 derniers jours"}),e.jsx(i,{value:"month",children:"30 derniers jours"})]})]})]})]}),H?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(pe,{className:"h-8 w-8 animate-spin text-blue-600"})}):G?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Be,{className:"h-10 w-10 text-red-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 mb-3",children:"Une erreur est survenue lors du chargement des demandes"}),e.jsxs(o,{variant:"outline",onClick:()=>te(),children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"Réessayer"]})]}):p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{className:"h-10 w-10 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Aucune demande ne correspond à vos critères de recherche"})]}):e.jsxs("div",{className:"rounded-md border overflow-hidden",children:[e.jsxs(_e,{children:[e.jsx(Fe,{children:e.jsxs(Y,{children:[e.jsx(N,{className:"w-[120px]",children:"Référence"}),e.jsx(N,{children:"Client"}),e.jsx(N,{className:"hidden md:table-cell",children:"Date"}),e.jsx(N,{className:"hidden md:table-cell",children:"Type"}),e.jsx(N,{children:"Statut"}),e.jsx(N,{children:"Paiement"}),e.jsx(N,{className:"text-right",children:"Actions"})]})}),e.jsx(Ie,{children:p.slice((f-1)*y,f*y).map(a=>e.jsxs(Y,{children:[e.jsx(v,{className:"font-medium",children:a.referenceNumber}),e.jsxs(v,{children:[e.jsx("div",{children:a.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.email})]}),e.jsx(v,{className:"hidden md:table-cell",children:L(a.createdAt)}),e.jsx(v,{className:"hidden md:table-cell",children:a.requestType==="new_connection"?"Nouvelle connexion":a.requestType==="power_upgrade"?"Augmentation puissance":a.requestType==="meter_upgrade"?"Modification compteur":"Visite technique"}),e.jsx(v,{children:e.jsx(S,{variant:a.status==="completed"?"default":a.status==="in_progress"?"secondary":a.status==="pending"?"outline":"destructive",children:a.status==="completed"?"Terminé":a.status==="in_progress"?"En cours":a.status==="pending"?"En attente":"Annulé"})}),e.jsx(v,{children:e.jsx(S,{variant:a.paymentStatus==="succeeded"||a.paymentStatus==="paid"?"default":"outline",className:a.paymentStatus==="succeeded"||a.paymentStatus==="paid"?"bg-green-100 text-green-800 hover:bg-green-200":a.paymentStatus==="processing"?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":a.paymentStatus==="failed"?"bg-red-100 text-red-800 hover:bg-red-200":"",children:a.paymentStatus==="succeeded"||a.paymentStatus==="paid"?"Payé":a.paymentStatus==="processing"?"En cours":a.paymentStatus==="failed"?"Échoué":"Non payé"})}),e.jsx(v,{className:"text-right",children:e.jsxs(Pe,{children:[e.jsx(Re,{asChild:!0,children:e.jsxs(o,{variant:"ghost",size:"icon",children:[e.jsx(Qe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Menu"})]})}),e.jsxs(Ee,{align:"end",children:[e.jsxs(w,{onClick:()=>ce(a),children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),"Voir détails"]}),e.jsxs(w,{onClick:()=>ee(a.phone,a.name),children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Appeler client"]}),(!a.paymentStatus||a.paymentStatus!=="succeeded"&&a.paymentStatus!=="paid")&&e.jsxs(w,{onClick:()=>re(a),children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Marquer comme payé"]}),a.paymentStatus==="succeeded"&&!a.scheduledDate&&e.jsxs(w,{children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Planifier RDV"]}),e.jsx(ke,{}),e.jsxs(w,{children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"}),"Modifier"]})]})]})})]},a.id))})]}),p.length>0&&e.jsxs("div",{className:"flex justify-between items-center mt-4 px-4 pb-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Affichage de ",Math.min((f-1)*y+1,p.length)," à ",Math.min(f*y,p.length)," sur ",p.length," demandes"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>B(a=>Math.max(1,a-1)),disabled:f===1,children:"Précédent"}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>B(a=>Math.min(Math.ceil(p.length/y),a+1)),disabled:f>=Math.ceil(p.length/y),children:"Suivant"})]})]})]})]})]})]}),e.jsx(ue,{open:ie,onOpenChange:_,children:e.jsxs(ge,{className:"max-w-4xl max-h-[90vh] overflow-auto",children:[e.jsxs(Ne,{children:[e.jsx(ve,{children:"Détails de la demande"}),e.jsx(fe,{children:"Consultez et gérez les informations détaillées de la demande"})]}),$&&e.jsx(Ze,{request:$,onClose:de})]})})]})}export{Ms as default};
