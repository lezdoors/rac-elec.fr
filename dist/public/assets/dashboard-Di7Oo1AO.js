import{r as g,j as e,p as q,D as ee,B as E,w as B,aR as t,o as I,aJ as Q,l as se,a6 as te,aH as ae}from"./index-z4k4-rB4.js";import{u as re}from"./useQuery-hCMmNHqT.js";import{C as x,a as u,b as h,c as V,d as p}from"./card-Pu8wWEUa.js";import{T as ne,a as ie,b as le,c as ce}from"./tabs-EQLmR4mP.js";import{S as de,a as oe,d as me,b as xe,c as y}from"./select-BB-qt2Ir.js";import{C as z}from"./calendar-D48_KWMs.js";import{P as K,a as M,b as U}from"./popover-iDM703Bk.js";import{B as ue}from"./badge-CZR9quHR.js";import{A as he}from"./admin-layout-BYQKSFHr.js";import{F as N}from"./file-text-BJE8DGoa.js";import{C as Y}from"./credit-card-CPX-vmtt.js";import{R as pe}from"./refresh-cw-BXyc2BK-.js";import"./use-mobile-DUqEIAPU.js";import"./index-CN4j8vaB.js";import"./index-BiCxHt_G.js";import"./index-Cb_IxzCR.js";import"./index-BNMwOkRu.js";import"./chevron-down-DJGzNPuO.js";import"./endOfMonth-_f6LYDUo.js";import"./isBefore-CyO1jS7Q.js";import"./use-auth-CG3NUtPj.js";import"./log-out-Ci6vpC8V.js";import"./settings-DCeLAZGe.js";import"./separator-DWKdqKPb.js";import"./external-link-DPUn5uho.js";function G(d){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(d)}function ze(){var S,R,D,A,$,F,P,T,H;const[d,J]=g.useState({type:"today"}),[j,O]=g.useState(),[f,W]=g.useState(),[je,w]=g.useState(!1);g.useEffect(()=>{(async()=>{try{w(!0),await se("GET","/api/stripe/sync-today"),te.invalidateQueries({queryKey:["/api/dashboard/stats"]})}catch(l){console.log("Sync Stripe silencieux:",l)}finally{w(!1)}})()},[]);const X=()=>{const a=new Date,l=i=>{const r=i.getFullYear(),c=String(i.getMonth()+1).padStart(2,"0"),m=String(i.getDate()).padStart(2,"0");return`${r}-${c}-${m}`},n=l(a);switch(d.type){case"today":return{startDate:n,endDate:n};case"yesterday":const i=new Date(a);i.setDate(i.getDate()-1);const r=l(i);return{startDate:r,endDate:r};case"week":const c=new Date(a);return c.setDate(a.getDate()-a.getDay()),{startDate:l(c),endDate:n};case"month":const m=new Date(a.getFullYear(),a.getMonth(),1);return{startDate:l(m),endDate:n};case"custom":return{startDate:j?l(j):n,endDate:f?l(f):n};default:return{startDate:n,endDate:n}}},{startDate:b,endDate:v}=X(),{data:s,isLoading:Z}=re({queryKey:[`/api/dashboard/stats?startDate=${b}&endDate=${v}`],queryFn:ae({on401:"throw"}),enabled:!!b&&!!v}),o=Z,_=()=>{var c,m,L,k;if(o)return"Chargement des données en cours...";const a=((c=s==null?void 0:s.payments)==null?void 0:c.count)||0,l=((m=s==null?void 0:s.payments)==null?void 0:m.revenue)||0,n=((L=s==null?void 0:s.leads)==null?void 0:L.count)||0,i=((k=s==null?void 0:s.requests)==null?void 0:k.count)||0;let r="";return a>0?r+=`${a} paiement${a>1?"s":""} RAC- pour ${G(l)}`:r+="Aucun paiement RAC-",r+=", ",n>0?r+=`${n} nouveau${n>1?"x":""} lead${n>1?"s":""}`:r+="aucun nouveau lead",r+=", ",i>0?r+=`${i} demande${i>1?"s":""} de service`:r+="aucune nouvelle demande",r+` ${C()}.`},C=()=>{switch(d.type){case"today":return"aujourd'hui";case"yesterday":return"hier";case"week":return"cette semaine";case"month":return"ce mois";case"custom":return"sur la période sélectionnée";default:return"aujourd'hui"}};return e.jsx(he,{children:e.jsxs("div",{className:"flex-1 space-y-4 p-4 md:p-8 pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between space-y-2",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Tableau de bord"}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(ue,{variant:"outline",className:"text-green-600 border-green-200",children:[e.jsx(q,{className:"mr-1 h-3 w-3"}),"Données RAC- en temps réel"]})})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(ee,{htmlFor:"date-filter",children:"Période :"}),e.jsxs(de,{value:d.type,onValueChange:a=>J({type:a}),children:[e.jsx(oe,{className:"w-[180px]",children:e.jsx(me,{})}),e.jsxs(xe,{children:[e.jsx(y,{value:"today",children:"Aujourd'hui"}),e.jsx(y,{value:"yesterday",children:"Hier"}),e.jsx(y,{value:"week",children:"Cette semaine"}),e.jsx(y,{value:"month",children:"Ce mois"}),e.jsx(y,{value:"custom",children:"Personnalisé"})]})]}),d.type==="custom"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(K,{children:[e.jsx(M,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-[120px] justify-start text-left font-normal",children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),j?j.toLocaleDateString():"Début"]})}),e.jsx(U,{className:"w-auto p-0",children:e.jsx(z,{mode:"single",selected:j,onSelect:O,initialFocus:!0})})]}),e.jsx("span",{children:"-"}),e.jsxs(K,{children:[e.jsx(M,{asChild:!0,children:e.jsxs(E,{variant:"outline",className:"w-[120px] justify-start text-left font-normal",children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),f?f.toLocaleDateString():"Fin"]})}),e.jsx(U,{className:"w-auto p-0",children:e.jsx(z,{mode:"single",selected:f,onSelect:W,initialFocus:!0})})]})]})]}),e.jsx(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},children:e.jsxs(x,{className:"bg-gradient-to-br from-emerald-50 via-blue-50 to-indigo-50 border-0 shadow-xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-blue-200/20 to-emerald-200/20 rounded-full -translate-y-20 translate-x-20"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-tr from-purple-200/15 to-pink-200/15 rounded-full translate-y-16 -translate-x-16"}),e.jsx(u,{className:"relative z-10",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(t.div,{className:"p-3 bg-gradient-to-br from-emerald-100 to-blue-100 rounded-xl shadow-md border border-white/50",whileHover:{scale:1.05,rotate:5},transition:{type:"spring",stiffness:300},children:e.jsx(N,{className:"h-6 w-6 text-emerald-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{className:"text-xl font-bold bg-gradient-to-r from-emerald-700 to-blue-700 bg-clip-text text-transparent",children:"Résumé Intelligent"}),e.jsx(t.div,{animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0},children:e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"})})]}),e.jsxs(V,{className:"text-slate-600 flex items-center gap-2 mt-1",children:[e.jsx(q,{className:"h-3 w-3"}),"Données ",C()," - Références RAC- authentiques"]})]})]})}),e.jsx(p,{className:"relative z-10",children:e.jsx("div",{className:"bg-white/80 rounded-xl p-4 backdrop-blur-sm border border-white/60 shadow-sm",children:e.jsx("p",{className:"text-slate-800 font-semibold leading-relaxed",children:_()})})})]})}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},whileHover:{y:-5},children:e.jsxs(x,{className:"bg-gradient-to-br from-blue-50 to-cyan-50 border-blue-200 shadow-lg hover:shadow-xl transition-shadow duration-300",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-3",children:[e.jsx(h,{className:"text-sm font-semibold text-blue-700",children:"Paiements RAC-"}),e.jsx(t.div,{whileHover:{scale:1.1,rotate:15},transition:{type:"spring",stiffness:300},className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Y,{className:"h-5 w-5 text-blue-600"})})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-800 mb-1",children:o?e.jsx("div",{className:"animate-pulse bg-blue-200 h-8 w-8 rounded"}):e.jsx(t.span,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,delay:.2},children:((S=s==null?void 0:s.payments)==null?void 0:S.count)||0})}),e.jsx("p",{className:"text-sm font-medium text-blue-600 mb-2",children:G(((R=s==null?void 0:s.payments)==null?void 0:R.revenue)||0)}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"h-3 w-3 text-green-500 mr-1"}),e.jsxs("span",{className:"text-xs text-slate-600",children:[((D=s==null?void 0:s.payments)==null?void 0:D.successRate)||0,"% réussis"]})]})})]})]})}),e.jsx(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},whileHover:{y:-5},children:e.jsxs(x,{className:"bg-gradient-to-br from-purple-50 to-pink-50 border-purple-200 shadow-lg hover:shadow-xl transition-shadow duration-300",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-3",children:[e.jsx(h,{className:"text-sm font-semibold text-purple-700",children:"Leads"}),e.jsx(t.div,{whileHover:{scale:1.1,rotate:15},transition:{type:"spring",stiffness:300},className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Q,{className:"h-5 w-5 text-purple-600"})})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-3xl font-bold text-purple-800 mb-1",children:o?e.jsx("div",{className:"animate-pulse bg-purple-200 h-8 w-8 rounded"}):e.jsx(t.span,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,delay:.3},children:((A=s==null?void 0:s.leads)==null?void 0:A.count)||0})}),e.jsx("p",{className:"text-sm text-purple-600 font-medium",children:"Nouveaux prospects"})]})]})}),e.jsx(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.2},whileHover:{y:-5},children:e.jsxs(x,{className:"bg-gradient-to-br from-orange-50 to-amber-50 border-orange-200 shadow-lg hover:shadow-xl transition-shadow duration-300",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-3",children:[e.jsx(h,{className:"text-sm font-semibold text-orange-700",children:"Demandes"}),e.jsx(t.div,{whileHover:{scale:1.1,rotate:15},transition:{type:"spring",stiffness:300},className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(N,{className:"h-5 w-5 text-orange-600"})})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-3xl font-bold text-orange-800 mb-1",children:o?e.jsx("div",{className:"animate-pulse bg-orange-200 h-8 w-8 rounded"}):e.jsx(t.span,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,delay:.4},children:(($=s==null?void 0:s.requests)==null?void 0:$.count)||0})}),e.jsx("p",{className:"text-sm text-orange-600 font-medium",children:"Demandes de service"})]})]})}),e.jsx(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.3},whileHover:{y:-5},children:e.jsxs(x,{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-green-200 shadow-lg hover:shadow-xl transition-shadow duration-300",children:[e.jsxs(u,{className:"flex flex-row items-center justify-between space-y-0 pb-3",children:[e.jsx(h,{className:"text-sm font-semibold text-green-700",children:"Taux de réussite"}),e.jsx(t.div,{whileHover:{scale:1.1,rotate:15},transition:{type:"spring",stiffness:300},className:"p-2 bg-green-100 rounded-lg",children:e.jsx(I,{className:"h-5 w-5 text-green-600"})})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-3xl font-bold text-green-800 mb-1",children:o?e.jsx("div",{className:"animate-pulse bg-green-200 h-8 w-8 rounded"}):e.jsxs(t.span,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:200,delay:.5},children:[((F=s==null?void 0:s.payments)==null?void 0:F.successRate)||0,"%"]})}),e.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Paiements réussis"})]})]})})]}),e.jsxs(ne,{defaultValue:"payments",className:"space-y-4",children:[e.jsx(ie,{children:e.jsx(le,{value:"payments",children:"Activité récente"})}),e.jsx(ce,{value:"payments",className:"space-y-4",children:e.jsxs(x,{children:[e.jsxs(u,{children:[e.jsx(h,{children:"Activité récente"}),e.jsx(V,{children:"Aperçu des dernières activités RAC- sur votre plateforme"})]}),e.jsx(p,{children:o?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(pe,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Chargement des données..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Période: ",b," au ",v]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-blue-100",children:e.jsx(Y,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Paiements RAC-"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[((P=s==null?void 0:s.payments)==null?void 0:P.count)||0," transactions"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-green-100",children:e.jsx(Q,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Nouveaux leads"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[((T=s==null?void 0:s.leads)==null?void 0:T.count)||0," prospects"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-purple-100",children:e.jsx(N,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Demandes"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[((H=s==null?void 0:s.requests)==null?void 0:H.count)||0," services"]})]})]})]})]})})]})})]})]})})}export{ze as default};
