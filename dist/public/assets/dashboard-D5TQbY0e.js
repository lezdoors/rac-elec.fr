import{c as G,r as d,j as e,B as A,x as L,aH as T,m as J,a4 as O,aF as W}from"./index-BK98VQ5F.js";import{u as X}from"./useQuery-CeUf9-P4.js";import{C as m,a as o,b as x,d as u}from"./card-CdJ_2Jsj.js";import{S as Z,a as _,d as ee,b as se,c as h}from"./select-z7-ybKU8.js";import{C as k}from"./calendar-CMvHypft.js";import{P as q,a as $,b as H}from"./popover-D681aaZd.js";import{A as te}from"./admin-layout-D-1BJ3rJ.js";import{R as re}from"./refresh-cw-BJGxwb-t.js";import{E as ae}from"./euro-_KnbgV3H.js";import{C as I}from"./credit-card-sbxkXRy6.js";import{F as U}from"./file-text-Cf4cAjZj.js";import"./index-DRwQ35eW.js";import"./index-YVpoeFfG.js";import"./index-CigaS-v9.js";import"./index-BnVOeou3.js";import"./chevron-down-6zcunRD4.js";import"./endOfMonth-DVeq-QgJ.js";import"./isBefore-DcMIdcPs.js";import"./use-auth-DDA4cOrX.js";import"./badge-CFTHm_pp.js";import"./use-mobile-CaPxtXK8.js";import"./log-out-Cxe76wKU.js";import"./settings-CokUIdI1.js";import"./separator-CGE3VMYe.js";import"./external-link-BPiGZE9F.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=G("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);function Q(l){return new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(l)}function Ae(){var w,v,S,C,D,F,R,P,E;const[l,z]=d.useState({type:"today"}),[i,B]=d.useState(),[c,K]=d.useState(),[M,f]=d.useState(!1);d.useEffect(()=>{(async()=>{try{f(!0),await J("GET","/api/stripe/sync-today"),O.invalidateQueries({queryKey:["/api/dashboard/stats"]})}catch(r){console.log("Sync Stripe silencieux:",r)}finally{f(!1)}})()},[]);const V=()=>{const t=new Date,r=n=>{const g=n.getFullYear(),j=String(n.getMonth()+1).padStart(2,"0"),y=String(n.getDate()).padStart(2,"0");return`${g}-${j}-${y}`},a=r(t);switch(l.type){case"today":return{startDate:a,endDate:a};case"yesterday":const n=new Date(t);n.setDate(n.getDate()-1);const g=r(n);return{startDate:g,endDate:g};case"week":const j=new Date(t);return j.setDate(t.getDate()-t.getDay()),{startDate:r(j),endDate:a};case"month":const y=new Date(t.getFullYear(),t.getMonth(),1);return{startDate:r(y),endDate:a};case"custom":return{startDate:i?r(i):a,endDate:c?r(c):a};default:return{startDate:a,endDate:a}}},{startDate:N,endDate:b}=V(),{data:s,isLoading:p}=X({queryKey:[`/api/dashboard/stats?startDate=${N}&endDate=${b}`],queryFn:W({on401:"throw"}),enabled:!!N&&!!b}),Y=()=>{switch(l.type){case"today":return"Aujourd'hui";case"yesterday":return"Hier";case"week":return"Cette semaine";case"month":return"Ce mois";case"custom":return"Période personnalisée";default:return"Aujourd'hui"}};return e.jsx(te,{children:e.jsxs("div",{className:"flex-1 space-y-6 p-6 md:p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Tableau de bord"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[Y()," - Données RAC-"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Z,{value:l.type,onValueChange:t=>z({type:t}),children:[e.jsx(_,{className:"w-[160px] bg-white border-gray-200",children:e.jsx(ee,{})}),e.jsxs(se,{children:[e.jsx(h,{value:"today",children:"Aujourd'hui"}),e.jsx(h,{value:"yesterday",children:"Hier"}),e.jsx(h,{value:"week",children:"Cette semaine"}),e.jsx(h,{value:"month",children:"Ce mois"}),e.jsx(h,{value:"custom",children:"Personnalisé"})]})]}),l.type==="custom"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(q,{children:[e.jsx($,{asChild:!0,children:e.jsxs(A,{variant:"outline",size:"sm",className:"bg-white border-gray-200",children:[e.jsx(L,{className:"h-4 w-4 mr-2 text-gray-500"}),i?i.toLocaleDateString("fr-FR"):"Début"]})}),e.jsx(H,{className:"w-auto p-0",children:e.jsx(k,{mode:"single",selected:i,onSelect:B,initialFocus:!0})})]}),e.jsx("span",{className:"text-gray-400",children:"—"}),e.jsxs(q,{children:[e.jsx($,{asChild:!0,children:e.jsxs(A,{variant:"outline",size:"sm",className:"bg-white border-gray-200",children:[e.jsx(L,{className:"h-4 w-4 mr-2 text-gray-500"}),c?c.toLocaleDateString("fr-FR"):"Fin"]})}),e.jsx(H,{className:"w-auto p-0",children:e.jsx(k,{mode:"single",selected:c,onSelect:K,initialFocus:!0})})]})]}),M&&e.jsx(re,{className:"h-4 w-4 animate-spin text-gray-400"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(m,{className:"bg-white border border-gray-100 shadow-sm",children:[e.jsxs(o,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(x,{className:"text-sm font-medium text-gray-600",children:"Chiffre d'affaires"}),e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(ae,{className:"h-4 w-4 text-blue-600"})})]}),e.jsxs(u,{children:[p?e.jsx("div",{className:"h-8 w-24 bg-gray-100 rounded animate-pulse"}):e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:Q(((w=s==null?void 0:s.payments)==null?void 0:w.revenue)||0)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Paiements réussis"})]})]}),e.jsxs(m,{className:"bg-white border border-gray-100 shadow-sm",children:[e.jsxs(o,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(x,{className:"text-sm font-medium text-gray-600",children:"Paiements"}),e.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:e.jsx(I,{className:"h-4 w-4 text-green-600"})})]}),e.jsxs(u,{children:[p?e.jsx("div",{className:"h-8 w-12 bg-gray-100 rounded animate-pulse"}):e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:((v=s==null?void 0:s.payments)==null?void 0:v.count)||0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[((S=s==null?void 0:s.payments)==null?void 0:S.successRate)||0,"% de réussite"]})]})]}),e.jsxs(m,{className:"bg-white border border-gray-100 shadow-sm",children:[e.jsxs(o,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(x,{className:"text-sm font-medium text-gray-600",children:"Leads"}),e.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:e.jsx(T,{className:"h-4 w-4 text-purple-600"})})]}),e.jsxs(u,{children:[p?e.jsx("div",{className:"h-8 w-12 bg-gray-100 rounded animate-pulse"}):e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:((C=s==null?void 0:s.leads)==null?void 0:C.count)||0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Nouveaux prospects"})]})]}),e.jsxs(m,{className:"bg-white border border-gray-100 shadow-sm",children:[e.jsxs(o,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(x,{className:"text-sm font-medium text-gray-600",children:"Demandes"}),e.jsx("div",{className:"p-2 bg-orange-50 rounded-lg",children:e.jsx(U,{className:"h-4 w-4 text-orange-600"})})]}),e.jsxs(u,{children:[p?e.jsx("div",{className:"h-8 w-12 bg-gray-100 rounded animate-pulse"}):e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:((D=s==null?void 0:s.requests)==null?void 0:D.count)||0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Demandes de service"})]})]})]}),e.jsxs(m,{className:"bg-white border border-gray-100 shadow-sm",children:[e.jsx(o,{className:"pb-3",children:e.jsxs(x,{className:"text-base font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4 text-gray-500"}),"Résumé de la période"]})}),e.jsx(u,{children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-50 flex items-center justify-center",children:e.jsx(I,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[((F=s==null?void 0:s.payments)==null?void 0:F.count)||0," paiements"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[Q(((R=s==null?void 0:s.payments)==null?void 0:R.revenue)||0)," de revenus"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-purple-50 flex items-center justify-center",children:e.jsx(T,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[((P=s==null?void 0:s.leads)==null?void 0:P.count)||0," leads"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Nouveaux prospects"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-orange-50 flex items-center justify-center",children:e.jsx(U,{className:"h-5 w-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[((E=s==null?void 0:s.requests)==null?void 0:E.count)||0," demandes"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Demandes de service"})]})]})]})})]})]})})}export{Ae as default};
