const g="AW-16683623620",f={FORM_START:"xhTDCODCy6gbEMTJr5M-",FORM_SUBMIT:"20wfCK-NyqgbEMTJr5M-",PURCHASE:"b5XPCPfuirYbEMTJr5M-"},w=o=>{const t=o.toLowerCase().trim();let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);e=(e<<5)-e+r,e=e&e}return Math.abs(e).toString(36)},l=(o,t)=>`tracking_${o}_${t}`,a=o=>typeof sessionStorage>"u"?!1:sessionStorage.getItem(o)==="true",m=o=>{typeof sessionStorage<"u"&&sessionStorage.setItem(o,"true")},_=(o,t={})=>{typeof window>"u"||(window.gtag&&window.gtag("event","conversion",{send_to:`${g}/${o}`,...t}),Array.isArray(window.dataLayer)&&window.dataLayer.push({event:t.event_name||"conversion",send_to:`${g}/${o}`,...t}))},y=(o,t)=>{if(typeof window>"u")return!1;if(!o||!o.includes("@"))return console.warn("‚ö†Ô∏è trackFormStart: valid email required"),!1;const e=w(o),n=l("form_start",e);return a(n)?(console.log(`‚ÑπÔ∏è form_start already fired for ${e} (skipped)`),!1):(m(n),_(f.FORM_START,{event_name:"form_start",user_data:{email:o.toLowerCase().trim(),phone_number:(t==null?void 0:t.replace(/\s/g,""))||void 0}}),console.log(`‚úÖ form_start fired [dedupe: ${e}]`),!0)},p=(o,t,e)=>{if(typeof window>"u")return!1;if(!o)return console.warn("‚ö†Ô∏è trackFormSubmit: reference required"),!1;const n=l("form_submit",o);return a(n)?(console.log(`‚ÑπÔ∏è form_submit already fired for ${o} (skipped)`),!1):(m(n),t&&sessionStorage.setItem("ec_email",t.toLowerCase().trim()),e&&sessionStorage.setItem("ec_phone",e.replace(/\s/g,"")),_(f.FORM_SUBMIT,{event_name:"form_submit",transaction_id:o,user_data:{email:(t==null?void 0:t.toLowerCase().trim())||void 0,phone_number:(e==null?void 0:e.replace(/\s/g,""))||void 0}}),console.log(`‚úÖ form_submit fired [ref: ${o}]`),!0)},u=()=>{if(typeof window>"u")return null;const o=localStorage.getItem("gclid");return o||new URLSearchParams(window.location.search).get("gclid")},v=(o,t=129.8,e)=>{if(typeof window>"u")return!1;if(!o)return console.warn("‚ö†Ô∏è trackPurchase: reference required"),!1;const n=l("purchase",o);if(a(n))return console.log(`‚ÑπÔ∏è purchase already fired for ${o} (skipped)`),!1;m(n);let r=e==null?void 0:e.email,s=e==null?void 0:e.phone;typeof sessionStorage<"u"&&(r||(r=sessionStorage.getItem("ec_email")||void 0),s||(s=sessionStorage.getItem("ec_phone")||void 0),sessionStorage.removeItem("ec_email"),sessionStorage.removeItem("ec_phone"));const d=u();if(console.log("üîç PURCHASE CONVERSION:",{reference:o,value:t,gclid:d,userData:e,timestamp:new Date().toISOString()}),_(f.PURCHASE,{event_name:"purchase",transaction_id:o,value:t,currency:"EUR",gclid:d||void 0,user_data:{email:(r==null?void 0:r.toLowerCase().trim())||void 0,phone_number:(s==null?void 0:s.replace(/\s/g,""))||void 0}}),Array.isArray(window.dataLayer)){const c={event:"purchase",transaction_id:o,value:t,currency:"EUR"},i={};r&&(i.email=r.toLowerCase().trim()),s&&(i.phone_number=s.replace(/\s/g,"")),e!=null&&e.firstName&&(i.address_first_name=e.firstName),e!=null&&e.lastName&&(i.address_last_name=e.lastName),e!=null&&e.city&&(i.address_city=e.city),e!=null&&e.postalCode&&(i.address_postal_code=e.postalCode),e!=null&&e.country&&(i.address_country=e.country||"FR"),Object.keys(i).length>0&&(c.user_data=i),window.dataLayer.push(c),console.log("üéØ GTM dataLayer.push:",c)}return console.log(`‚úÖ purchase fired [ref: ${o}, ‚Ç¨${t}, gclid: ${d||"none"}]`),!0},S=(o,t,e,n)=>{typeof window<"u"&&window.dataLayer&&window.dataLayer.push({event:"custom_event",event_action:o,event_category:t,event_label:e,event_value:n})};export{p as a,v as b,S as c,y as t};
