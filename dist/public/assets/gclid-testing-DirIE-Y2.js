import{c as z,a as O,r as l,j as e,B as o,$ as d,a0 as h,v as F}from"./index-CpDjrPge.js";import{A as _}from"./admin-layout-DX0Kk5HQ.js";import{C as g,a as m,b as u,d as x,c as y}from"./card-kwaVVhdJ.js";import{B as L}from"./use-mobile-BMh-vbEF.js";import{T as M,a as B,b as v,c as p}from"./tabs-EStKKK4R.js";import{getStoredGclid as C,getCurrentGclid as k,initializeGclidTracking as I}from"./gclid-tracking-C-JG5jfn.js";import{R as q}from"./refresh-cw-DuUtjEKu.js";import{C as T}from"./circle-x-8Zuf0VT4.js";import{T as S}from"./triangle-alert-BXPVoVSW.js";import{C as H}from"./copy-U-5weNqq.js";import"./use-auth-Cwl-QG43.js";import"./log-out-CQjzW_NC.js";import"./file-text-CPAW-xf3.js";import"./credit-card-dLoa9KgF.js";import"./settings-DcDHKTJ-.js";import"./separator-D63b-bg3.js";import"./external-link-CKWtTz9q.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=z("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);function D(){const s={isValid:!1,checks:{urlParameter:!1,localStorage:!1,googleTag:!1,conversionTracking:!1,gclidFormat:!1},currentGclid:null,storedGclid:null,errors:[],warnings:[]};try{const i=new URLSearchParams(window.location.search).get("gclid");s.currentGclid=i,s.checks.urlParameter=!!i;const r=C();s.storedGclid=r,s.checks.localStorage=!!r;const a=i||r;a&&(s.checks.gclidFormat=/^[A-Za-z0-9_-]+$/.test(a)&&a.length>10,s.checks.gclidFormat||s.warnings.push("GCLID format may be invalid")),s.checks.googleTag=typeof window.gtag=="function",s.checks.googleTag||s.errors.push("Google Tag (gtag) not available"),s.checks.conversionTracking=s.checks.googleTag&&!!a,!s.checks.conversionTracking&&s.checks.googleTag&&s.warnings.push("Conversion tracking available but no GCLID present"),s.isValid=(s.checks.localStorage||s.checks.urlParameter)&&s.checks.googleTag&&s.checks.gclidFormat,s.isValid||(a||s.errors.push("No GCLID found in URL or localStorage"),s.checks.googleTag||s.errors.push("Google Analytics not properly initialized"))}catch(t){s.errors.push(`Validation error: ${t instanceof Error?t.message:"Unknown error"}`)}return s}async function K(s){try{if(typeof window.gtag!="function")throw new Error("Google Tag not available");const t=k();if(!t)throw new Error("No GCLID available for testing");return window.gtag("event","conversion",{send_to:s,gclid:t,transaction_id:`test_${Date.now()}`,value:1,currency:"EUR",event_category:"test",event_label:"gclid_test_conversion"}),console.log("‚úÖ Test conversion sent with GCLID:",t),!0}catch(t){return console.error("‚ùå Test conversion failed:",t),!1}}function b(){const s=D(),t=new Date().toISOString();let i=`GCLID DIAGNOSTIC REPORT
`;return i+=`Generated: ${t}
`,i+=`URL: ${window.location.href}

`,i+=`OVERALL STATUS: ${s.isValid?"‚úÖ VALID":"‚ùå INVALID"}

`,i+=`VALIDATION CHECKS:
`,i+=`- URL Parameter: ${s.checks.urlParameter?"‚úÖ":"‚ùå"}
`,i+=`- Local Storage: ${s.checks.localStorage?"‚úÖ":"‚ùå"}
`,i+=`- Google Tag: ${s.checks.googleTag?"‚úÖ":"‚ùå"}
`,i+=`- Conversion Tracking: ${s.checks.conversionTracking?"‚úÖ":"‚ùå"}
`,i+=`- GCLID Format: ${s.checks.gclidFormat?"‚úÖ":"‚ùå"}

`,i+=`GCLID VALUES:
`,i+=`- Current (URL): ${s.currentGclid||"None"}
`,i+=`- Stored (localStorage): ${s.storedGclid||"None"}

`,s.errors.length>0&&(i+=`ERRORS:
`,s.errors.forEach(r=>{i+=`- ${r}
`}),i+=`
`),s.warnings.length>0&&(i+=`WARNINGS:
`,s.warnings.forEach(r=>{i+=`- ${r}
`}),i+=`
`),i+=`ENVIRONMENT INFO:
`,i+=`- User Agent: ${navigator.userAgent}
`,i+=`- Local Storage Available: ${typeof Storage<"u"}
`,i+=`- Google Tag Available: ${typeof window.gtag=="function"}
`,i+=`- Session Storage: ${Object.keys(sessionStorage).length} items
`,i+=`- Local Storage: ${Object.keys(localStorage).length} items
`,i}function X(){console.log("üîç Starting GCLID monitoring...");const s=history.pushState,t=history.replaceState;history.pushState=function(...i){s.apply(history,i),f()},history.replaceState=function(...i){t.apply(history,i),f()},window.addEventListener("popstate",f),window.addEventListener("storage",i=>{i.key==="gclid_data"&&console.log("üì± GCLID localStorage changed:",i.newValue)}),f(),console.log("‚úÖ GCLID monitoring active")}function f(){const t=new URLSearchParams(window.location.search).get("gclid"),i=C();t&&(console.log("üéØ New GCLID detected in URL:",t),I()),console.log("üìä Current GCLID status:",{url:t,stored:i,timestamp:new Date().toISOString()})}function me(){const{toast:s}=O(),[t,i]=l.useState(null),[r,a]=l.useState(!1),[w,G]=l.useState(""),[j,A]=l.useState(!1);l.useEffect(()=>{N(),G(b())},[]);const N=()=>{const n=D();i(n)},R=async()=>{a(!0);try{const n=await K("AW-16698052873/test-conversion");s({title:n?"Test r√©ussi":"Test √©chou√©",description:n?"La conversion test a √©t√© envoy√©e avec succ√®s":"Erreur lors du test de conversion",variant:n?"default":"destructive"})}catch{s({title:"Erreur de test",description:"Impossible de tester la conversion",variant:"destructive"})}finally{a(!1)}},V=()=>{navigator.clipboard.writeText(w),s({title:"Copi√©",description:"Rapport de diagnostic copi√© dans le presse-papier"})},E=()=>{X(),A(!0),s({title:"Monitoring activ√©",description:"Surveillance GCLID d√©marr√©e - v√©rifiez la console"})},$=()=>{I(),N(),G(b()),s({title:"Tracking r√©initialis√©",description:"Le syst√®me GCLID a √©t√© r√©initialis√©"})},P=n=>n?e.jsx(F,{className:"h-5 w-5 text-green-500"}):e.jsx(T,{className:"h-5 w-5 text-red-500"}),U=n=>n?"text-green-700 bg-green-50":"text-red-700 bg-red-50";return e.jsx(_,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Test GCLID & Attribution"}),e.jsx("p",{className:"text-gray-600",children:"Validation et test du syst√®me de tracking Google Ads"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(o,{onClick:N,variant:"outline",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Actualiser"]}),e.jsx(o,{onClick:$,children:"R√©initialiser"})]})]}),e.jsxs(M,{defaultValue:"status",className:"space-y-4",children:[e.jsxs(B,{children:[e.jsx(v,{value:"status",children:"√âtat GCLID"}),e.jsx(v,{value:"testing",children:"Tests"}),e.jsx(v,{value:"diagnostic",children:"Diagnostic"}),e.jsx(v,{value:"monitoring",children:"Monitoring"})]}),e.jsxs(p,{value:"status",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(g,{children:[e.jsx(m,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[t&&P(t.isValid),e.jsx("span",{children:"Statut G√©n√©ral"})]})}),e.jsx(x,{children:t&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Statut:"}),e.jsx(L,{className:U(t.isValid),children:t.isValid?"Valide":"Invalide"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"GCLID actuel:"}),e.jsx("span",{className:"font-mono text-sm",children:t.gclid||"Aucun"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Source:"}),e.jsx(L,{variant:"outline",children:t.source})]})]})})]}),e.jsxs(g,{children:[e.jsx(m,{children:e.jsx(u,{children:"Donn√©es Stock√©es"})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"GCLID stock√©:"}),e.jsx("span",{className:"font-mono text-sm",children:C()||"Aucun"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"URL actuelle:"}),e.jsx("span",{className:"text-sm truncate max-w-[200px]",children:k()||"Aucun"})]})]})})]})]}),t&&e.jsxs(e.Fragment,{children:[t.errors.length>0&&e.jsxs(d,{className:"border-red-200 bg-red-50",children:[e.jsx(T,{className:"h-4 w-4 text-red-500"}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:"Erreurs d√©tect√©es:"}),t.errors.map((n,c)=>e.jsxs("div",{className:"text-sm",children:["‚Ä¢ ",n]},c))]})})]}),t.warnings.length>0&&e.jsxs(d,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(S,{className:"h-4 w-4 text-yellow-500"}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:"Avertissements:"}),t.warnings.map((n,c)=>e.jsxs("div",{className:"text-sm",children:["‚Ä¢ ",n]},c))]})})]}),t.recommendations.length>0&&e.jsxs(d,{className:"border-blue-200 bg-blue-50",children:[e.jsx(S,{className:"h-4 w-4 text-blue-500"}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:"Recommandations:"}),t.recommendations.map((n,c)=>e.jsxs("div",{className:"text-sm",children:["‚Ä¢ ",n]},c))]})})]})]})]}),e.jsx(p,{value:"testing",children:e.jsxs(g,{children:[e.jsxs(m,{children:[e.jsx(u,{children:"Tests de Conversion"}),e.jsx(y,{children:"Testez les conversions Google Ads avec attribution GCLID"})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Test de Conversion"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Envoie une conversion test avec GCLID si disponible"})]}),e.jsxs(o,{onClick:R,disabled:r,className:"flex items-center space-x-2",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{children:r?"Test en cours...":"Tester"})]})]}),e.jsx(d,{children:e.jsx(h,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"Instructions de test:"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:["1. Visitez la page avec un param√®tre GCLID test: ",e.jsx("code",{children:"?gclid=test123456789"})]}),e.jsx("div",{children:'2. Cliquez sur "Tester" pour envoyer une conversion'}),e.jsx("div",{children:"3. V√©rifiez la console pour les logs de confirmation"}),e.jsx("div",{children:"4. Consultez Google Ads pour v√©rifier la r√©ception"})]})]})})})]})]})}),e.jsx(p,{value:"diagnostic",children:e.jsxs(g,{children:[e.jsxs(m,{children:[e.jsxs(u,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Rapport de Diagnostic"}),e.jsxs(o,{onClick:V,variant:"outline",size:"sm",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Copier"]})]}),e.jsx(y,{children:"Rapport technique complet du syst√®me GCLID"})]}),e.jsx(x,{children:e.jsx("pre",{className:"bg-gray-50 p-4 rounded-lg text-sm font-mono whitespace-pre-wrap overflow-x-auto",children:w})})]})}),e.jsx(p,{value:"monitoring",children:e.jsxs(g,{children:[e.jsxs(m,{children:[e.jsx(u,{children:"Monitoring en Temps R√©el"}),e.jsx(y,{children:"Surveillance continue du syst√®me GCLID"})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Monitoring GCLID"}),e.jsx("div",{className:"text-sm text-gray-600",children:j?"Surveillance active - v√©rifiez la console":"Surveillance inactive"})]}),e.jsx(o,{onClick:E,disabled:j,variant:j?"outline":"default",children:j?"Actif":"D√©marrer"})]}),e.jsx(d,{children:e.jsx(h,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"Fonctionnalit√©s de monitoring:"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsx("div",{children:"‚Ä¢ Validation continue du GCLID"}),e.jsx("div",{children:"‚Ä¢ D√©tection des changements d'URL"}),e.jsx("div",{children:"‚Ä¢ Alertes d'expiration du GCLID"}),e.jsx("div",{children:"‚Ä¢ Logs d√©taill√©s dans la console"})]})]})})})]})]})})]})]})})}export{me as default};
