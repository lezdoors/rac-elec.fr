import{c as z,a as M,r as l,j as e,B as o,G as d,J as h,o as O}from"./index-Q1O3lOiD.js";import{A as F}from"./admin-layout-C9tG7lNp.js";import{C as m,a as g,b as u,d as x,c as N}from"./card-BLLbdvan.js";import{B as G}from"./badge-DboorIjv.js";import{T as _,a as B,b as p,c as v}from"./tabs-BcoqRdGy.js";import{getStoredGclid as C,getCurrentGclid as k,initializeGclidTracking as I}from"./gclid-tracking-BDXPv1ra.js";import{R as q}from"./refresh-cw-CAilYR3H.js";import{C as T}from"./circle-x-CKaDN03n.js";import{T as S}from"./triangle-alert-DAZ1385C.js";import{C as H}from"./copy-CrTU8y7E.js";import"./use-auth-DB1Ju0MA.js";import"./useQuery-CraHRfe1.js";import"./use-mobile-CCzMrBDY.js";import"./index-BxQfFeWG.js";import"./log-out-XKEE66vL.js";import"./file-text-DQtr1Htd.js";import"./credit-card-Bsf3DdG1.js";import"./users-Buoe37Mz.js";import"./settings-DUC0ErgR.js";import"./index-Bb8KzYlc.js";import"./index-CMJPc-0C.js";import"./separator-DxZY_0t_.js";import"./external-link-CW46I6LZ.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=z("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);function D(){const s={isValid:!1,checks:{urlParameter:!1,localStorage:!1,googleTag:!1,conversionTracking:!1,gclidFormat:!1},currentGclid:null,storedGclid:null,errors:[],warnings:[]};try{const i=new URLSearchParams(window.location.search).get("gclid");s.currentGclid=i,s.checks.urlParameter=!!i;const a=C();s.storedGclid=a,s.checks.localStorage=!!a;const n=i||a;n&&(s.checks.gclidFormat=/^[A-Za-z0-9_-]+$/.test(n)&&n.length>10,s.checks.gclidFormat||s.warnings.push("GCLID format may be invalid")),s.checks.googleTag=Array.isArray(window.dataLayer),s.checks.googleTag||s.errors.push("GTM dataLayer not available"),s.checks.conversionTracking=s.checks.googleTag&&!!n,!s.checks.conversionTracking&&s.checks.googleTag&&s.warnings.push("Conversion tracking available but no GCLID present"),s.isValid=(s.checks.localStorage||s.checks.urlParameter)&&s.checks.googleTag&&s.checks.gclidFormat,s.isValid||(n||s.errors.push("No GCLID found in URL or localStorage"),s.checks.googleTag||s.errors.push("Google Analytics not properly initialized"))}catch(r){s.errors.push(`Validation error: ${r instanceof Error?r.message:"Unknown error"}`)}return s}async function J(s){try{if(!Array.isArray(window.dataLayer))throw new Error("GTM dataLayer not available");const r=k();if(!r)throw new Error("No GCLID available for testing");return window.dataLayer.push({event:"ads_conversion",conversion_id:s,gclid:r,transaction_id:`test_${Date.now()}`,value:1,currency:"EUR"}),console.log("‚úÖ Test conversion pushed to GTM dataLayer with GCLID:",r),!0}catch(r){return console.error("‚ùå Test conversion failed:",r),!1}}function b(){const s=D(),r=new Date().toISOString();let i=`GCLID DIAGNOSTIC REPORT
`;return i+=`Generated: ${r}
`,i+=`URL: ${window.location.href}

`,i+=`OVERALL STATUS: ${s.isValid?"‚úÖ VALID":"‚ùå INVALID"}

`,i+=`VALIDATION CHECKS:
`,i+=`- URL Parameter: ${s.checks.urlParameter?"‚úÖ":"‚ùå"}
`,i+=`- Local Storage: ${s.checks.localStorage?"‚úÖ":"‚ùå"}
`,i+=`- Google Tag: ${s.checks.googleTag?"‚úÖ":"‚ùå"}
`,i+=`- Conversion Tracking: ${s.checks.conversionTracking?"‚úÖ":"‚ùå"}
`,i+=`- GCLID Format: ${s.checks.gclidFormat?"‚úÖ":"‚ùå"}

`,i+=`GCLID VALUES:
`,i+=`- Current (URL): ${s.currentGclid||"None"}
`,i+=`- Stored (localStorage): ${s.storedGclid||"None"}

`,s.errors.length>0&&(i+=`ERRORS:
`,s.errors.forEach(a=>{i+=`- ${a}
`}),i+=`
`),s.warnings.length>0&&(i+=`WARNINGS:
`,s.warnings.forEach(a=>{i+=`- ${a}
`}),i+=`
`),i+=`ENVIRONMENT INFO:
`,i+=`- User Agent: ${navigator.userAgent}
`,i+=`- Local Storage Available: ${typeof Storage<"u"}
`,i+=`- GTM dataLayer Available: ${Array.isArray(window.dataLayer)}
`,i+=`- Session Storage: ${Object.keys(sessionStorage).length} items
`,i+=`- Local Storage: ${Object.keys(localStorage).length} items
`,i}function K(){console.log("üîç Starting GCLID monitoring...");const s=history.pushState,r=history.replaceState;history.pushState=function(...i){s.apply(history,i),f()},history.replaceState=function(...i){r.apply(history,i),f()},window.addEventListener("popstate",f),window.addEventListener("storage",i=>{i.key==="gclid_data"&&console.log("üì± GCLID localStorage changed:",i.newValue)}),f(),console.log("‚úÖ GCLID monitoring active")}function f(){const r=new URLSearchParams(window.location.search).get("gclid"),i=C();r&&(console.log("üéØ New GCLID detected in URL:",r),I()),console.log("üìä Current GCLID status:",{url:r,stored:i,timestamp:new Date().toISOString()})}function fe(){const{toast:s}=M(),[r,i]=l.useState(null),[a,n]=l.useState(!1),[w,L]=l.useState(""),[j,A]=l.useState(!1);l.useEffect(()=>{y(),L(b())},[]);const y=()=>{const t=D();i(t)},R=async()=>{n(!0);try{const t=await J("AW-16698052873/test-conversion");s({title:t?"Test r√©ussi":"Test √©chou√©",description:t?"La conversion test a √©t√© envoy√©e avec succ√®s":"Erreur lors du test de conversion",variant:t?"default":"destructive"})}catch{s({title:"Erreur de test",description:"Impossible de tester la conversion",variant:"destructive"})}finally{n(!1)}},V=()=>{navigator.clipboard.writeText(w),s({title:"Copi√©",description:"Rapport de diagnostic copi√© dans le presse-papier"})},E=()=>{K(),A(!0),s({title:"Monitoring activ√©",description:"Surveillance GCLID d√©marr√©e - v√©rifiez la console"})},$=()=>{I(),y(),L(b()),s({title:"Tracking r√©initialis√©",description:"Le syst√®me GCLID a √©t√© r√©initialis√©"})},P=t=>t?e.jsx(O,{className:"h-5 w-5 text-green-500"}):e.jsx(T,{className:"h-5 w-5 text-red-500"}),U=t=>t?"text-green-700 bg-green-50":"text-red-700 bg-red-50";return e.jsx(F,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Test GCLID & Attribution"}),e.jsx("p",{className:"text-gray-600",children:"Validation et test du syst√®me de tracking Google Ads"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(o,{onClick:y,variant:"outline",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Actualiser"]}),e.jsx(o,{onClick:$,children:"R√©initialiser"})]})]}),e.jsxs(_,{defaultValue:"status",className:"space-y-4",children:[e.jsxs(B,{children:[e.jsx(p,{value:"status",children:"√âtat GCLID"}),e.jsx(p,{value:"testing",children:"Tests"}),e.jsx(p,{value:"diagnostic",children:"Diagnostic"}),e.jsx(p,{value:"monitoring",children:"Monitoring"})]}),e.jsxs(v,{value:"status",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(m,{children:[e.jsx(g,{children:e.jsxs(u,{className:"flex items-center space-x-2",children:[r&&P(r.isValid),e.jsx("span",{children:"Statut G√©n√©ral"})]})}),e.jsx(x,{children:r&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Statut:"}),e.jsx(G,{className:U(r.isValid),children:r.isValid?"Valide":"Invalide"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"GCLID actuel:"}),e.jsx("span",{className:"font-mono text-sm",children:r.gclid||"Aucun"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Source:"}),e.jsx(G,{variant:"outline",children:r.source})]})]})})]}),e.jsxs(m,{children:[e.jsx(g,{children:e.jsx(u,{children:"Donn√©es Stock√©es"})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"GCLID stock√©:"}),e.jsx("span",{className:"font-mono text-sm",children:C()||"Aucun"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"URL actuelle:"}),e.jsx("span",{className:"text-sm truncate max-w-[200px]",children:k()||"Aucun"})]})]})})]})]}),r&&e.jsxs(e.Fragment,{children:[r.errors.length>0&&e.jsxs(d,{className:"border-red-200 bg-red-50",children:[e.jsx(T,{className:"h-4 w-4 text-red-500"}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:"Erreurs d√©tect√©es:"}),r.errors.map((t,c)=>e.jsxs("div",{className:"text-sm",children:["‚Ä¢ ",t]},c))]})})]}),r.warnings.length>0&&e.jsxs(d,{className:"border-yellow-200 bg-yellow-50",children:[e.jsx(S,{className:"h-4 w-4 text-yellow-500"}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:"Avertissements:"}),r.warnings.map((t,c)=>e.jsxs("div",{className:"text-sm",children:["‚Ä¢ ",t]},c))]})})]}),r.recommendations.length>0&&e.jsxs(d,{className:"border-blue-200 bg-blue-50",children:[e.jsx(S,{className:"h-4 w-4 text-blue-500"}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium",children:"Recommandations:"}),r.recommendations.map((t,c)=>e.jsxs("div",{className:"text-sm",children:["‚Ä¢ ",t]},c))]})})]})]})]}),e.jsx(v,{value:"testing",children:e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(u,{children:"Tests de Conversion"}),e.jsx(N,{children:"Testez les conversions Google Ads avec attribution GCLID"})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Test de Conversion"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Envoie une conversion test avec GCLID si disponible"})]}),e.jsxs(o,{onClick:R,disabled:a,className:"flex items-center space-x-2",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{children:a?"Test en cours...":"Tester"})]})]}),e.jsx(d,{children:e.jsx(h,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"Instructions de test:"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:["1. Visitez la page avec un param√®tre GCLID test: ",e.jsx("code",{children:"?gclid=test123456789"})]}),e.jsx("div",{children:'2. Cliquez sur "Tester" pour envoyer une conversion'}),e.jsx("div",{children:"3. V√©rifiez la console pour les logs de confirmation"}),e.jsx("div",{children:"4. Consultez Google Ads pour v√©rifier la r√©ception"})]})]})})})]})]})}),e.jsx(v,{value:"diagnostic",children:e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsxs(u,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Rapport de Diagnostic"}),e.jsxs(o,{onClick:V,variant:"outline",size:"sm",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Copier"]})]}),e.jsx(N,{children:"Rapport technique complet du syst√®me GCLID"})]}),e.jsx(x,{children:e.jsx("pre",{className:"bg-gray-50 p-4 rounded-lg text-sm font-mono whitespace-pre-wrap overflow-x-auto",children:w})})]})}),e.jsx(v,{value:"monitoring",children:e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(u,{children:"Monitoring en Temps R√©el"}),e.jsx(N,{children:"Surveillance continue du syst√®me GCLID"})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Monitoring GCLID"}),e.jsx("div",{className:"text-sm text-gray-600",children:j?"Surveillance active - v√©rifiez la console":"Surveillance inactive"})]}),e.jsx(o,{onClick:E,disabled:j,variant:j?"outline":"default",children:j?"Actif":"D√©marrer"})]}),e.jsx(d,{children:e.jsx(h,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"Fonctionnalit√©s de monitoring:"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsx("div",{children:"‚Ä¢ Validation continue du GCLID"}),e.jsx("div",{children:"‚Ä¢ D√©tection des changements d'URL"}),e.jsx("div",{children:"‚Ä¢ Alertes d'expiration du GCLID"}),e.jsx("div",{children:"‚Ä¢ Logs d√©taill√©s dans la console"})]})]})})})]})]})})]})]})})}export{fe as default};
