import{c as V,j as e,B as x,b4 as K,a as ge,r as j,e as O,b1 as Ne,I as ve,L as fe,P as q,A as ye,w as ee,Q as be,T as we,V as Se,W as Ce,a0 as Te,p as De,a6 as Ae,o as Ee,U as se,$ as Me,l as Y,a7 as W,aI as Pe}from"./index-Q1O3lOiD.js";import{u as Re}from"./useQuery-CraHRfe1.js";import{A as ke,D as Le,p as _e,q as Fe,r as b,v as $e}from"./admin-layout-C9tG7lNp.js";import{C as t,a as r,b as m,c as ae,d as l,e as Ie}from"./card-BLLbdvan.js";import{T as Ve,a as ze,b as X,c as N,d as Be,e as v}from"./table-sp1YVJkd.js";import{S as M,a as P,d as R,b as k,c as i}from"./select-D1u1QHcV.js";import{B as C}from"./badge-DboorIjv.js";import{C as He}from"./copy-CrTU8y7E.js";import{D as Ue}from"./download-efFcUZp-.js";import{S as Ge}from"./search-Brsu0ZdY.js";import{C as Qe}from"./circle-x-CKaDN03n.js";import{R as Ke}from"./refresh-cw-CAilYR3H.js";import{F as T}from"./file-text-DQtr1Htd.js";import{E as Oe}from"./eye-BpHhsJdk.js";import{P as Ye}from"./pencil-ZAD_4F4T.js";import{T as We}from"./trash-2-BYWLn7M3.js";import{M as Xe}from"./map-pin-CMhecqnG.js";import{C as Z}from"./credit-card-Bsf3DdG1.js";import"./use-auth-DB1Ju0MA.js";import"./use-mobile-CCzMrBDY.js";import"./index-BxQfFeWG.js";import"./log-out-XKEE66vL.js";import"./users-Buoe37Mz.js";import"./settings-DUC0ErgR.js";import"./index-Bb8KzYlc.js";import"./index-CMJPc-0C.js";import"./separator-DxZY_0t_.js";import"./external-link-CW46I6LZ.js";import"./index-47uJxDOT.js";import"./chevron-down-DGOkmUin.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=V("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=V("HardHat",[["path",{d:"M2 18a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v2z",key:"1dej2m"}],["path",{d:"M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5",key:"1p9q5i"}],["path",{d:"M4 15v-3a6 6 0 0 1 6-6",key:"9ciidu"}],["path",{d:"M14 6a6 6 0 0 1 6 6v3",key:"1hnv84"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=V("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);function es({referenceNumber:s}){const w=d=>`https://www.demande-raccordement.fr/paiement-multiple/${s}/${d}`,u=(d,o)=>{navigator.clipboard.writeText(d).then(()=>{K({title:"Lien copié",description:`Le lien de paiement (x${o}) a été copié dans le presse-papier.`})}).catch(g=>{console.error("Erreur lors de la copie du lien:",g),K({title:"Erreur",description:"Impossible de copier le lien. Veuillez réessayer.",variant:"destructive"})})};return e.jsxs(t,{children:[e.jsxs(r,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5 text-blue-600"}),"Liens de paiement majoré"]}),e.jsxs(ae,{children:["Liens de paiement avec montants majorés pour la référence ",e.jsx("strong",{children:s}),". Partagez ces liens avec vos clients pour différents niveaux de service."]})]}),e.jsxs(l,{className:"space-y-4",children:[e.jsx("div",{className:"rounded-md bg-blue-50 p-4 border border-blue-100",children:e.jsx("p",{className:"text-sm text-blue-700",children:"Ces liens permettent aux clients d'effectuer des paiements avec différents multiplicateurs. Choisissez le montant approprié en fonction des services supplémentaires convenus."})}),e.jsx("div",{className:"space-y-3",children:[2,3,4,5].map(d=>{const o=w(d),g=(129.8*d).toFixed(2).replace(".",",");return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md bg-white hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Paiement x",d]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 truncate max-w-xs md:max-w-md",children:o}),e.jsxs("p",{className:"text-sm font-semibold text-blue-600 mt-1",children:[g,"€"]})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>u(o,d),className:"flex items-center gap-1",children:[e.jsx(He,{className:"w-3.5 h-3.5"}),"Copier"]})]},d)})})]}),e.jsx(Ie,{className:"flex justify-between border-t pt-4",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Les liens sont valables tant que la référence est active."})})]})}function L(s){return s?new Date(s).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"}):"N/A"}function ss(s){return s?new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(s):"N/A"}function J(s){return s?s.replace(/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/,"$1 $2 $3 $4 $5"):"N/A"}function ie(s,c){window.open(`tel:${s}`,"_blank"),console.log(`Appel de ${c} au ${s}`)}function as({requests:s}){const c=s.length,w=s.filter(n=>n.status==="pending").length,u=s.filter(n=>n.status==="in_progress").length,d=s.filter(n=>n.status==="completed").length,o=s.filter(n=>!n.paymentStatus||n.paymentStatus!=="succeeded").length,g=s.filter(n=>n.paymentStatus==="succeeded").length;return e.jsxs("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-6",children:[e.jsx(t,{className:"bg-blue-50 border-blue-100",children:e.jsxs(l,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(T,{className:"h-8 w-8 text-blue-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-blue-800",children:c}),e.jsx("p",{className:"text-xs text-blue-700",children:"Total demandes"})]})}),e.jsx(t,{className:"bg-yellow-50 border-yellow-100",children:e.jsxs(l,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(De,{className:"h-8 w-8 text-yellow-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-yellow-800",children:w}),e.jsx("p",{className:"text-xs text-yellow-700",children:"En attente"})]})}),e.jsx(t,{className:"bg-purple-50 border-purple-100",children:e.jsxs(l,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(Ae,{className:"h-8 w-8 text-purple-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-purple-800",children:u}),e.jsx("p",{className:"text-xs text-purple-700",children:"En cours"})]})}),e.jsx(t,{className:"bg-green-50 border-green-100",children:e.jsxs(l,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(Ee,{className:"h-8 w-8 text-green-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-green-800",children:d}),e.jsx("p",{className:"text-xs text-green-700",children:"Terminées"})]})}),e.jsx(t,{className:"bg-indigo-50 border-indigo-100",children:e.jsxs(l,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(se,{className:"h-8 w-8 text-indigo-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-indigo-800",children:g}),e.jsx("p",{className:"text-xs text-indigo-700",children:"Clients"})]})}),e.jsx(t,{className:"bg-orange-50 border-orange-100",children:e.jsxs(l,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(T,{className:"h-8 w-8 text-orange-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-orange-800",children:o}),e.jsx("p",{className:"text-xs text-orange-700",children:"Leads"})]})})]})}function is({request:s,onClose:c}){return s?e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s.referenceNumber}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Créée le ",L(s.createdAt)]})]}),e.jsx(C,{variant:s.status==="completed"?"default":s.status==="in_progress"?"secondary":s.status==="pending"?"outline":"destructive",children:s.status==="completed"?"Terminé":s.status==="in_progress"?"En cours":s.status==="pending"?"En attente":"Annulé"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 max-h-[70vh] md:max-h-none overflow-y-auto md:overflow-visible pb-4 pr-1",children:[e.jsxs(t,{children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(se,{className:"mr-2 h-5 w-5 text-blue-600"}),"Informations client"]})}),e.jsxs(l,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Nom"}),e.jsx("div",{className:"font-medium",children:s.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Email"}),e.jsx("div",{children:e.jsx("a",{href:`mailto:${s.email}`,className:"text-blue-600 hover:underline",children:s.email})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Téléphone"}),e.jsx("div",{children:e.jsx("a",{href:`tel:${s.phone}`,className:"text-blue-600 hover:underline",children:J(s.phone)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Type"}),e.jsx("div",{children:e.jsx(C,{variant:"outline",className:"font-normal",children:s.clientType==="particulier"?"Particulier":s.clientType==="professionnel"?"Professionnel":"Collectivité"})})]}),s.clientType!=="particulier"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Société"}),e.jsx("div",{className:"font-medium",children:s.company})]}),s.siret&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"SIRET"}),e.jsx("div",{className:"font-mono text-xs",children:s.siret})]})]}),s.ipAddress&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"IP"}),e.jsx("div",{className:"font-mono text-xs",children:s.ipAddress})]}),s.userAgent&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Navigateur"}),e.jsx("div",{className:"truncate text-xs",children:s.userAgent})]})]})]}),e.jsxs(t,{children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(T,{className:"mr-2 h-5 w-5 text-blue-600"}),"Détails de la demande"]})}),e.jsxs(l,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Type"}),e.jsx("div",{children:s.requestType==="new_connection"?"Nouvelle connexion":s.requestType==="power_upgrade"?"Augmentation puissance":s.requestType==="meter_upgrade"?"Modification compteur":s.requestType==="temporary_connection"?"Raccordement temporaire":s.requestType==="relocation"?"Déplacement d'ouvrage":s.requestType==="technical_visit"?"Visite technique":"Autre"})]}),s.otherRequestTypeDesc&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Détail"}),e.jsx("div",{children:s.otherRequestTypeDesc})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Puissance"}),e.jsxs("div",{children:[s.powerRequired," kVA"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Phase"}),e.jsx("div",{children:s.phaseType==="monophase"?"Monophasé":"Triphasé"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Bâtiment"}),e.jsx("div",{children:s.buildingType==="individual_house"?"Maison individuelle":s.buildingType==="apartment_building"?"Immeuble collectif":s.buildingType==="commercial"?"Local commercial":s.buildingType==="industrial"?"Bâtiment industriel":s.buildingType==="agricultural"?"Exploitation agricole":s.buildingType==="public"?"Établissement public":s.buildingType==="terrain"?"Terrain":"Autre"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Avancement"}),e.jsx("div",{children:s.projectStatus==="planning"?"En projet":s.projectStatus==="permit_pending"?"Permis déposé":s.projectStatus==="permit_approved"?"Permis approuvé":s.projectStatus==="construction_started"?"Construction démarrée":s.projectStatus==="construction_completed"?"Construction terminée":"Autre"})]}),s.terrainViabilise&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Terrain"}),e.jsx("div",{children:s.terrainViabilise==="viabilise"?"Viabilisé":"Non viabilisé"})]}),s.billingAddress&&s.billingAddress!==s.address&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Adresse facturation différente"}),e.jsx("div",{children:"Oui"})]}),s.permitNumber&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"N° Permis"}),e.jsx("div",{children:s.permitNumber})]}),s.permitDeliveryDate&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Date permis"}),e.jsx("div",{children:s.permitDeliveryDate})]}),s.desiredCompletionDate&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Date souhaitée"}),e.jsx("div",{children:s.desiredCompletionDate})]})]})]}),e.jsxs(t,{children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(Xe,{className:"mr-2 h-5 w-5 text-blue-600"}),"Adresse du projet"]})}),e.jsxs(l,{className:"space-y-2",children:[e.jsxs("div",{className:"font-medium",children:[s.address,s.addressComplement&&e.jsxs("span",{children:[", ",s.addressComplement]}),e.jsx("br",{}),s.postalCode," ",s.city]}),s.cadastralReference&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Référence cadastrale"}),e.jsx("div",{children:s.cadastralReference})]}),s.billingAddress&&s.billingAddress!==s.address&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4 mb-2 text-sm font-medium",children:"Adresse de facturation"}),e.jsxs("div",{className:"font-medium",children:[s.billingAddress,e.jsx("br",{}),s.billingPostalCode," ",s.billingCity]})]})]})]}),s.hasArchitect&&e.jsxs(t,{children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(Je,{className:"mr-2 h-5 w-5 text-blue-600"}),"Architecte"]})}),e.jsxs(l,{className:"space-y-2",children:[s.architectName&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Nom"}),e.jsx("div",{children:s.architectName})]}),s.architectPhone&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Téléphone"}),e.jsx("div",{children:J(s.architectPhone)})]}),s.architectEmail&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Email"}),e.jsx("div",{children:s.architectEmail})]})]})]}),e.jsxs(t,{className:"border-blue-200 bg-blue-50",children:[e.jsx(r,{className:"pb-2",children:e.jsxs(m,{className:"flex items-center text-blue-700",children:[e.jsx(Z,{className:"mr-2 h-5 w-5"}),"Informations de paiement"]})}),e.jsxs(l,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Statut"}),e.jsx("div",{children:e.jsx(C,{variant:s.paymentStatus==="succeeded"||s.paymentStatus==="paid"?"default":"outline",className:`${s.paymentStatus==="succeeded"||s.paymentStatus==="paid"?"bg-green-100 text-green-800":s.paymentStatus==="failed"?"bg-red-100 text-red-800":""}`,children:s.paymentStatus==="succeeded"||s.paymentStatus==="paid"?"Payé":s.paymentStatus==="processing"?"En cours":s.paymentStatus==="failed"?"Échec":"Non payé"})})]}),s.paymentAmount&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Montant"}),e.jsx("div",{className:"font-semibold",children:ss(parseFloat(s.paymentAmount.toString()))})]}),s.paymentMethod&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Méthode"}),e.jsx("div",{children:s.paymentMethod==="card"?"Carte bancaire":s.paymentMethod==="manual"?"Paiement manuel":s.paymentMethod})]}),s.paymentDate&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Date"}),e.jsx("div",{children:L(s.paymentDate)})]}),s.paymentId&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"ID Paiement"}),e.jsx("div",{className:"text-xs",children:s.paymentId})]}),s.cardBrand&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Carte"}),e.jsx("div",{className:"capitalize",children:s.cardBrand})]}),s.cardLast4&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Numéro"}),e.jsx("div",{className:"font-mono",children:s.cardLast4})]}),s.cardExpMonth&&s.cardExpYear&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Expiration"}),e.jsxs("div",{children:[s.cardExpMonth.toString().padStart(2,"0"),"/",s.cardExpYear]})]}),s.billingName&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Titulaire"}),e.jsx("div",{children:s.billingName})]}),s.bankName&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Banque"}),e.jsx("div",{children:s.bankName})]})]}),s.paymentError&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-red-200",children:[e.jsx("div",{className:"text-sm font-medium text-red-600 mb-1",children:"Erreur de paiement"}),e.jsx("div",{className:"text-xs whitespace-pre-wrap text-red-600 bg-red-50 p-2 rounded",children:s.paymentError})]})]})]}),(!s.paymentStatus||s.paymentStatus!=="succeeded"&&s.paymentStatus!=="paid")&&e.jsxs(t,{className:"border-green-200 bg-green-50",children:[e.jsxs(r,{className:"pb-2",children:[e.jsxs(m,{className:"flex items-center text-green-700",children:[e.jsx(Z,{className:"mr-2 h-5 w-5"}),"Liens de paiement multiples"]}),e.jsx(ae,{className:"text-green-600",children:"Générateur de liens de paiement avec montant majoré"})]}),e.jsx(l,{children:e.jsx(es,{referenceNumber:s.referenceNumber})})]}),s.scheduledDate&&e.jsxs(t,{children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(ee,{className:"mr-2 h-5 w-5 text-blue-600"}),"Rendez-vous Enedis"]})}),e.jsxs(l,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Date"}),e.jsx("div",{children:L(s.scheduledDate)})]}),s.scheduledTime&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Créneau"}),e.jsx("div",{children:s.scheduledTime})]}),s.enedisReferenceNumber&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Référence Enedis"}),e.jsx("div",{children:s.enedisReferenceNumber})]})]})]}),s.comments&&e.jsxs(t,{className:"md:col-span-2",children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(Me,{className:"mr-2 h-5 w-5 text-blue-600"}),"Commentaires"]})}),e.jsx(l,{children:e.jsx("p",{className:"whitespace-pre-wrap",children:s.comments})})]}),s.notes&&e.jsxs(t,{className:"md:col-span-2",children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(T,{className:"mr-2 h-5 w-5 text-blue-600"}),"Notes internes"]})}),e.jsx(l,{children:e.jsx("p",{className:"whitespace-pre-wrap",children:s.notes})})]})]}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-2 pt-4",children:[e.jsx(x,{variant:"outline",onClick:c,children:"Fermer"}),e.jsxs(x,{variant:"outline",className:"bg-blue-50 text-blue-700 hover:bg-blue-100",onClick:()=>ie(s.phone,s.name),children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Appeler"]}),e.jsx(x,{children:"Traiter la demande"})]})]}):null}function _s(){const{toast:s}=ge(),[c,w]=j.useState(""),[u,d]=j.useState(null),[o,g]=j.useState(null),[n,te]=j.useState("all"),[D,le]=j.useState(null),[z,ne]=j.useState(null),[ce,_]=j.useState(!1),[f,B]=j.useState(1),y=20,{data:de,isLoading:H,error:U,refetch:re}=Re({queryKey:["/api/service-requests"],queryFn:Pe({on401:"throw"})}),me=O({mutationFn:async a=>await(await Y("PATCH",`/api/service-requests/${a}`,{paymentStatus:"paid",status:"in_progress",paymentMethod:"manual",paymentDate:new Date().toISOString()})).json(),onSuccess:()=>{W.invalidateQueries({queryKey:["/api/service-requests"]})}}),oe=O({mutationFn:async a=>await(await Y("DELETE",`/api/service-requests/${a}`)).json(),onSuccess:a=>{a.success&&s({title:"Demande supprimée",description:"La demande a été supprimée avec succès"}),W.invalidateQueries({queryKey:["/api/service-requests"]})},onError:a=>{s({title:"Erreur",description:a.message||"Un problème est survenu lors de la suppression",variant:"destructive"})}}),xe=a=>{window.confirm(`Êtes-vous sûr de vouloir supprimer la demande ${a.referenceNumber} de ${a.name} ?`)&&oe.mutate(a.id)},F=de||[],h=[...F.filter(a=>{var Q;const S=!c||((Q=a.referenceNumber)==null?void 0:Q.toLowerCase().includes(c.toLowerCase()))||a.name&&a.name.toLowerCase().includes(c.toLowerCase())||a.email&&a.email.toLowerCase().includes(c.toLowerCase())||a.phone&&a.phone.includes(c)||a.address&&a.address.toLowerCase().includes(c.toLowerCase()),$=!u||a.status===u,G=!o||a.requestType===o,ue=!D||D==="paid"&&(a.paymentStatus==="succeeded"||a.paymentStatus==="paid")||D==="unpaid"&&(!a.paymentStatus||a.paymentStatus!=="succeeded"&&a.paymentStatus!=="paid");let A=!0;if(n!=="all"&&a.createdAt){const I=new Date(a.createdAt),E=new Date;if(n==="today"){const p=new Date;p.setHours(0,0,0,0),A=I>=p}else if(n==="week"){const p=new Date(E);p.setDate(E.getDate()-7),A=I>=p}else if(n==="month"){const p=new Date(E);p.setMonth(E.getMonth()-1),A=I>=p}}return S&&$&&G&&ue&&A})].sort((a,S)=>{const $=new Date(a.createdAt||0);return new Date(S.createdAt||0).getTime()-$.getTime()}),he=a=>{ne(a),_(!0)},pe=()=>{_(!1)},je=a=>{me.mutate(a.id)};return e.jsxs(ke,{title:"Gestion des demandes",description:"Gérez toutes les demandes de raccordement électrique",children:[e.jsxs("div",{className:"space-y-6",children:[!H&&!U&&F&&e.jsx(as,{requests:F}),e.jsxs(t,{children:[e.jsx(r,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(m,{children:"Toutes les demandes"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{variant:"outline",size:"sm",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Exporter"]}),e.jsxs(x,{size:"sm",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Nouvelle demande"]})]})]})}),e.jsxs(l,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ge,{className:"absolute h-4 w-4 top-3 left-3 text-gray-400"}),e.jsx(ve,{placeholder:"Rechercher par nom, référence, adresse...",className:"pl-10",value:c,onChange:a=>w(a.target.value)})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(M,{value:u||"all",onValueChange:a=>d(a==="all"?null:a),children:[e.jsx(P,{className:"w-[140px]",children:e.jsx(R,{placeholder:"Tous les statuts"})}),e.jsxs(k,{children:[e.jsx(i,{value:"all",children:"Tous les statuts"}),e.jsx(i,{value:"pending",children:"En attente"}),e.jsx(i,{value:"in_progress",children:"En cours"}),e.jsx(i,{value:"completed",children:"Terminées"}),e.jsx(i,{value:"cancelled",children:"Annulées"})]})]}),e.jsxs(M,{value:o||"all",onValueChange:a=>g(a==="all"?null:a),children:[e.jsx(P,{className:"w-[180px]",children:e.jsx(R,{placeholder:"Tous les types"})}),e.jsxs(k,{children:[e.jsx(i,{value:"all",children:"Tous les types"}),e.jsx(i,{value:"new_connection",children:"Nouvelle connexion"}),e.jsx(i,{value:"power_upgrade",children:"Augmentation puissance"}),e.jsx(i,{value:"meter_upgrade",children:"Modification compteur"}),e.jsx(i,{value:"technical_visit",children:"Visite technique"})]})]}),e.jsxs(M,{value:D||"all",onValueChange:a=>le(a==="all"?null:a),children:[e.jsx(P,{className:"w-[140px]",children:e.jsx(R,{placeholder:"Paiement"})}),e.jsxs(k,{children:[e.jsx(i,{value:"all",children:"Tous"}),e.jsx(i,{value:"paid",children:"Payés"}),e.jsx(i,{value:"unpaid",children:"Non payés"})]})]}),e.jsxs(M,{value:n,onValueChange:te,children:[e.jsx(P,{className:"w-[140px]",children:e.jsx(R,{placeholder:"Période"})}),e.jsxs(k,{children:[e.jsx(i,{value:"all",children:"Toutes dates"}),e.jsx(i,{value:"today",children:"Aujourd'hui"}),e.jsx(i,{value:"week",children:"7 derniers jours"}),e.jsx(i,{value:"month",children:"30 derniers jours"})]})]})]})]}),H?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(fe,{className:"h-8 w-8 animate-spin text-blue-600"})}):U?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Qe,{className:"h-10 w-10 text-red-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 mb-3",children:"Une erreur est survenue lors du chargement des demandes"}),e.jsxs(x,{variant:"outline",onClick:()=>re(),children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Réessayer"]})]}):h.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(T,{className:"h-10 w-10 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Aucune demande ne correspond à vos critères de recherche"})]}):e.jsxs("div",{className:"rounded-md border overflow-hidden",children:[e.jsxs(Ve,{children:[e.jsx(ze,{children:e.jsxs(X,{children:[e.jsx(N,{className:"w-[120px]",children:"Référence"}),e.jsx(N,{children:"Client"}),e.jsx(N,{className:"hidden md:table-cell",children:"Date"}),e.jsx(N,{className:"hidden md:table-cell",children:"Type"}),e.jsx(N,{children:"Statut"}),e.jsx(N,{children:"Paiement"}),e.jsx(N,{className:"text-right",children:"Actions"})]})}),e.jsx(Be,{children:h.slice((f-1)*y,f*y).map(a=>e.jsxs(X,{children:[e.jsx(v,{className:"font-medium",children:a.referenceNumber}),e.jsxs(v,{children:[e.jsx("div",{children:a.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.email})]}),e.jsx(v,{className:"hidden md:table-cell",children:L(a.createdAt)}),e.jsx(v,{className:"hidden md:table-cell",children:a.requestType==="new_connection"?"Nouvelle connexion":a.requestType==="power_upgrade"?"Augmentation puissance":a.requestType==="meter_upgrade"?"Modification compteur":"Visite technique"}),e.jsx(v,{children:e.jsx(C,{variant:a.status==="completed"?"default":a.status==="in_progress"?"secondary":a.status==="pending"?"outline":"destructive",children:a.status==="completed"?"Terminé":a.status==="in_progress"?"En cours":a.status==="pending"?"En attente":"Annulé"})}),e.jsx(v,{children:e.jsx(C,{variant:a.paymentStatus==="succeeded"||a.paymentStatus==="paid"?"default":"outline",className:a.paymentStatus==="succeeded"||a.paymentStatus==="paid"?"bg-green-100 text-green-800 hover:bg-green-200":a.paymentStatus==="processing"?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":a.paymentStatus==="failed"?"bg-red-100 text-red-800 hover:bg-red-200":"",children:a.paymentStatus==="succeeded"||a.paymentStatus==="paid"?"Payé":a.paymentStatus==="processing"?"En cours":a.paymentStatus==="failed"?"Échoué":"Non payé"})}),e.jsx(v,{className:"text-right",children:e.jsxs(Le,{children:[e.jsx(_e,{asChild:!0,children:e.jsxs(x,{variant:"ghost",size:"icon",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Menu"})]})}),e.jsxs(Fe,{align:"end",children:[e.jsxs(b,{onClick:()=>he(a),children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Voir détails"]}),e.jsxs(b,{onClick:()=>ie(a.phone,a.name),children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Appeler client"]}),(!a.paymentStatus||a.paymentStatus!=="succeeded"&&a.paymentStatus!=="paid")&&e.jsxs(b,{onClick:()=>je(a),children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Marquer comme payé"]}),a.paymentStatus==="succeeded"&&!a.scheduledDate&&e.jsxs(b,{children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Planifier RDV"]}),e.jsx($e,{}),e.jsxs(b,{children:[e.jsx(Ye,{className:"mr-2 h-4 w-4"}),"Modifier"]}),e.jsxs(b,{onClick:()=>xe(a),className:"text-red-600 focus:text-red-600 focus:bg-red-50",children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Supprimer"]})]})]})})]},a.id))})]}),h.length>0&&e.jsxs("div",{className:"flex justify-between items-center mt-4 px-4 pb-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Affichage de ",Math.min((f-1)*y+1,h.length)," à ",Math.min(f*y,h.length)," sur ",h.length," demandes"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{variant:"outline",size:"sm",onClick:()=>B(a=>Math.max(1,a-1)),disabled:f===1,children:"Précédent"}),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>B(a=>Math.min(Math.ceil(h.length/y),a+1)),disabled:f>=Math.ceil(h.length/y),children:"Suivant"})]})]})]})]})]})]}),e.jsx(be,{open:ce,onOpenChange:_,children:e.jsxs(we,{className:"max-w-4xl max-h-[90vh] overflow-auto",children:[e.jsxs(Se,{children:[e.jsx(Ce,{children:"Détails de la demande"}),e.jsx(Te,{children:"Consultez et gérez les informations détaillées de la demande"})]}),z&&e.jsx(is,{request:z,onClose:pe})]})})]})}export{_s as default};
