import{c as $,a as Ne,r as m,j as e,I as ge,B as r,d as M,M as ye,f as be,D as Y,n as Q,o as _,p as K,s as G,t as X,e as J,$ as q,ak as Ce}from"./index-CUIrBm9o.js";import{a as we}from"./use-auth-BcgWddCX.js";import{A as De}from"./admin-layout-B_5lEmpc.js";import{C as n,d as l,a as g,b as y,c as b,e as Re}from"./card-B3S0I_H7.js";import{B as h}from"./use-mobile-DKykdz_A.js";import{T as ke,a as ze,b as A,c as L}from"./tabs-DhPsVOkk.js";import{C as W}from"./checkbox-E5uPEUq0.js";import{A as Se}from"./appointment-modal-BqwIkV5_.js";import{S as Me}from"./search-qFNkKYVk.js";import{C as Z}from"./clock-pgo03ecp.js";import{C as Ae}from"./calendar-CMp338cE.js";import{T}from"./triangle-alert-CRf2tDw8.js";import{C as Le}from"./circle-check-big-BsYUaqy4.js";import{C as Te}from"./index-CulLse46.js";import"./useMutation-D1_2mGyz.js";import"./log-out-CAGW1Fe6.js";import"./file-text-CDM67-yI.js";import"./credit-card-BsMekCjh.js";import"./users-D8XrnR9s.js";import"./settings-B08tDknL.js";import"./index-Cj87Fuwj.js";import"./separator-mByQb6DW.js";import"./index-3wgKPZld.js";import"./check-B460mZXX.js";import"./external-link-DVHpcEbQ.js";import"./index-Dl0olJZU.js";import"./schema-cZS9kAQ1.js";import"./index-D4r1jjLZ.js";import"./calendar-B48O4zd5.js";import"./endOfMonth-DA-GPzd4.js";import"./isBefore-BKwF5-_5.js";import"./form-2XVttuC3.js";import"./popover-Ze0ZfbGk.js";import"./select-CWZnZ7K2.js";import"./chevron-down-IDCDttL2.js";import"./textarea-BVmmHZmc.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=$("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=$("CalendarPlus",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M16 19h6",key:"xwg31i"}],["path",{d:"M19 16v6",key:"tddt3s"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=$("CalendarX",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m14 14-4 4",key:"rymu2i"}],["path",{d:"m10 14 4 4",key:"3sz06r"}]]);function Ns(){const{toast:u}=Ne(),[i,j]=m.useState(""),[C,te]=m.useState("upcoming"),[w,P]=m.useState(new Date),[re,f]=m.useState(!1),[ae,D]=m.useState(null),[ne,R]=m.useState(!1),[F,O]=m.useState(null),[V,le]=m.useState("list"),B=()=>{f(!1),D(null)},ie=s=>{O(s),R(!0)},ce=async()=>{if(F)try{await J("POST",`/api/service-requests/${F}/cancel`,{reason:"Annulé par l'administrateur via l'interface des rendez-vous"}),u({title:"Rendez-vous annulé",description:"Le rendez-vous a été annulé avec succès."}),q.invalidateQueries({queryKey:["/api/service-requests"]})}catch{u({title:"Erreur",description:"Impossible d'annuler le rendez-vous. Veuillez réessayer.",variant:"destructive"})}finally{R(!1),O(null)}},[d,H]=m.useState(null),[de,k]=m.useState(!1),oe=s=>{H(s),k(!0)},me=async()=>{if(d)try{await J("POST",`/api/service-requests/${d.id}/send-reminder`,{type:"appointment_reminder",includeCalendarInvite:!0}),u({title:"Rappel envoyé",description:`Un rappel a été envoyé à ${d.customerName}.`}),q.invalidateQueries({queryKey:["/api/service-requests"]})}catch{u({title:"Erreur",description:"Impossible d'envoyer le rappel. Veuillez réessayer.",variant:"destructive"})}finally{k(!1),H(null)}},{data:U,isLoading:z,error:S}=we({queryKey:["/api/service-requests"],queryFn:Ce({on401:"throw"})}),o=(U?U.map(s=>({id:s.id,referenceNumber:s.referenceNumber,customerName:s.name||"Client sans nom",appointmentDate:s.scheduledDate?new Date(s.scheduledDate):null,timeSlot:s.scheduledTime||null,status:s.status,enedisRef:s.enedisReferenceNumber||null,createdAt:new Date(s.createdAt).toISOString(),updatedAt:s.updatedAt?new Date(s.updatedAt).toISOString():void 0,address:s.address||"",postalCode:s.postalCode||"",city:s.city||"",email:s.email,phone:s.phone,hasReminderSent:s.hasReminderSent})).filter(s=>s.status==="scheduled"||s.status==="validated"||s.status==="in_progress"||s.status==="canceled"):[]).filter(s=>{const t=i===""||s.customerName.toLowerCase().includes(i.toLowerCase())||s.referenceNumber.toLowerCase().includes(i.toLowerCase())||s.enedisRef&&s.enedisRef.toLowerCase().includes(i.toLowerCase())||s.address.toLowerCase().includes(i.toLowerCase())||s.city.toLowerCase().includes(i.toLowerCase()),a=new Date;return C==="upcoming"&&s.appointmentDate?t&&s.appointmentDate>=a:C==="past"&&s.appointmentDate?t&&s.appointmentDate<a:C==="pending"?t&&!s.appointmentDate:t}),xe=()=>{const s=new Date(w);s.setMonth(s.getMonth()+1),P(s)},he=()=>{const s=new Date(w);s.setMonth(s.getMonth()-1),P(s)},p=s=>`${s.address}, ${s.postalCode} ${s.city}`,ue=(s=>{const t=s.getFullYear(),a=s.getMonth(),I=new Date(t,a+1,0).getDate(),x=new Date(t,a,1).getDay(),N=[],pe=new Date(t,a,0).getDate();for(let c=x===0?6:x-1;c>0;c--)N.push({date:new Date(t,a-1,pe-c+1),isCurrentMonth:!1});for(let c=1;c<=I;c++)N.push({date:new Date(t,a,c),isCurrentMonth:!0});const ve=42-N.length;for(let c=1;c<=ve;c++)N.push({date:new Date(t,a+1,c),isCurrentMonth:!1});return N})(w),je=s=>o.filter(t=>t.appointmentDate&&t.appointmentDate.getDate()===s.getDate()&&t.appointmentDate.getMonth()===s.getMonth()&&t.appointmentDate.getFullYear()===s.getFullYear()),fe=s=>s.toLocaleDateString("fr-FR",{month:"long",year:"numeric"}),v=s=>s.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"});return e.jsx(De,{title:"Rendez-vous",description:"Gestion des rendez-vous clients",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Rendez-vous"})}),e.jsx("p",{className:"text-muted-foreground",children:"Gestion des rendez-vous et planification"})]}),e.jsxs("div",{className:"flex w-full sm:w-auto items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Me,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(ge,{type:"search",placeholder:"Rechercher un rendez-vous...",className:"pl-8 w-full sm:w-[300px]",value:i,onChange:s=>j(s.target.value)})]}),e.jsx(r,{variant:"outline",onClick:()=>le(V==="calendar"?"list":"calendar"),children:V==="calendar"?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Vue liste"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Vue calendrier"]})}),e.jsxs(r,{onClick:()=>f(!0),children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Nouveau RDV"]})]})]}),e.jsxs(ke,{defaultValue:"upcoming",value:C,onValueChange:te,className:"space-y-4",children:[e.jsxs(ze,{children:[e.jsx(A,{value:"upcoming",children:"À venir"}),e.jsx(A,{value:"pending",children:"En attente"}),e.jsx(A,{value:"past",children:"Passés"}),e.jsx(A,{value:"canceled",children:"Annulés"})]}),e.jsx(L,{value:"upcoming",className:"m-0",children:z?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(M,{className:"h-8 w-8 animate-spin text-blue-600"})}):S?e.jsx(n,{children:e.jsxs(l,{className:"py-10 text-center",children:[e.jsx(T,{className:"h-10 w-10 text-amber-500 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Une erreur est survenue lors du chargement des rendez-vous."}),e.jsx(r,{variant:"outline",size:"sm",className:"mt-4",children:"Réessayer"})]})}):o.length===0?e.jsx(n,{children:e.jsxs(l,{className:"py-10 text-center",children:[e.jsx(E,{className:"h-10 w-10 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun rendez-vous trouvé."}),i&&e.jsx(r,{variant:"outline",size:"sm",onClick:()=>j(""),children:"Effacer la recherche"})]})}):V==="list"?e.jsxs(n,{children:[e.jsxs(g,{className:"pb-1",children:[e.jsx(y,{children:"Liste des rendez-vous à venir"}),e.jsx(b,{children:"Consultez et gérez les rendez-vous planifiés"})]}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{id:"selectAll",className:"mr-2"}),e.jsx("label",{htmlFor:"selectAll",children:"Client"})]})}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Référence"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Adresse"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Statut"}),e.jsx("th",{className:"text-right py-3 px-2 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:o.map(s=>{let t;switch(s.status){case"scheduled":t=e.jsx(h,{className:"bg-blue-500",children:"Planifié"});break;case"validated":t=e.jsx(h,{className:"bg-green-500",children:"Validé"});break;case"in_progress":t=e.jsx(h,{variant:"secondary",children:"En cours"});break;default:t=e.jsx(h,{variant:"outline",children:s.status})}return e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"py-3 px-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{id:`select-${s.id}`,className:"mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.customerName}),s.enedisRef&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Ref. Enedis: ",s.enedisRef]})]})]})}),e.jsx("td",{className:"py-3 px-2",children:s.appointmentDate?e.jsxs("div",{children:[e.jsx("div",{children:v(s.appointmentDate)}),s.timeSlot&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.timeSlot})]}):e.jsx("span",{className:"text-muted-foreground text-xs italic",children:"En attente de planification"})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"font-mono text-xs",children:s.referenceNumber})}),e.jsx("td",{className:"py-3 px-2 max-w-xs truncate",children:p(s)}),e.jsx("td",{className:"py-3 px-2",children:t}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{variant:"ghost",size:"icon",title:"Détails",onClick:()=>{u({title:"Détails du rendez-vous",description:e.jsxs("div",{className:"mt-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Client:"})," ",s.customerName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Référence:"})," ",s.referenceNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",s.appointmentDate?v(s.appointmentDate):"Non planifié"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Heure:"})," ",s.timeSlot||"Non précisée"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Adresse:"})," ",p(s)]}),s.enedisRef&&e.jsxs("p",{children:[e.jsx("strong",{children:"Réf. Enedis:"})," ",s.enedisRef]}),s.email&&e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),s.phone&&e.jsxs("p",{children:[e.jsx("strong",{children:"Téléphone:"})," ",s.phone]})]}),duration:6e3})},children:e.jsx(Z,{className:"h-4 w-4"})}),s.email&&e.jsx(r,{variant:"ghost",size:"icon",title:s.hasReminderSent?"Rappel déjà envoyé":"Envoyer un rappel",onClick:()=>oe(s),disabled:s.hasReminderSent,className:s.hasReminderSent?"text-green-500":"",children:s.hasReminderSent?e.jsx(Le,{className:"h-4 w-4"}):e.jsx(ye,{className:"h-4 w-4"})}),e.jsx(r,{variant:"ghost",size:"icon",title:"Modifier le rendez-vous",onClick:()=>{const a=s.id;D(a),f(!0)},children:e.jsx(E,{className:"h-4 w-4"})}),e.jsx(r,{variant:"ghost",size:"icon",title:"Annuler le rendez-vous",onClick:()=>ie(s.id),children:e.jsx(se,{className:"h-4 w-4"})})]})})]},s.id)})})]})})}),e.jsx(Re,{className:"flex justify-between border-t p-4",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Affichage de ",o.length," rendez-vous"]})})]}):e.jsxs(n,{children:[e.jsxs(g,{className:"pb-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{children:"Calendrier des rendez-vous"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(r,{variant:"outline",size:"icon",onClick:he,children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium",children:fe(w)}),e.jsx(r,{variant:"outline",size:"icon",onClick:xe,children:e.jsx(be,{className:"h-4 w-4"})})]})]}),e.jsx(b,{children:"Vue mensuelle des rendez-vous planifiés"})]}),e.jsx(l,{children:e.jsxs("div",{className:"grid grid-cols-7 gap-1",children:[["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"].map((s,t)=>e.jsx("div",{className:"text-center text-sm font-medium py-2",children:s},s)),ue.map((s,t)=>{const a=je(s.date),I=new Date().getDate()===s.date.getDate()&&new Date().getMonth()===s.date.getMonth()&&new Date().getFullYear()===s.date.getFullYear();return e.jsxs("div",{className:`min-h-24 border rounded-md p-1 ${s.isCurrentMonth?"bg-background":"bg-muted opacity-50"} ${I?"border-blue-500 border-2":"border-border"}`,children:[e.jsx("div",{className:"text-right p-1 text-sm",children:s.date.getDate()}),e.jsx("div",{className:"space-y-1",children:a.map(x=>e.jsxs("div",{className:"bg-blue-100 text-blue-800 text-xs p-1 rounded cursor-pointer truncate",onClick:()=>{D(x.id),f(!0)},children:[x.timeSlot?x.timeSlot:"—"," • ",x.customerName]},x.id))})]},t)})]})})]})}),e.jsx(L,{value:"pending",className:"m-0",children:z?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(M,{className:"h-8 w-8 animate-spin text-blue-600"})}):S?e.jsx(n,{children:e.jsxs(l,{className:"py-10 text-center",children:[e.jsx(T,{className:"h-10 w-10 text-amber-500 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Une erreur est survenue lors du chargement des rendez-vous."}),e.jsx(r,{variant:"outline",size:"sm",className:"mt-4",children:"Réessayer"})]})}):o.length===0?e.jsx(n,{children:e.jsxs(l,{className:"py-10 text-center",children:[e.jsx(E,{className:"h-10 w-10 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun rendez-vous en attente trouvé."}),i&&e.jsx(r,{variant:"outline",size:"sm",onClick:()=>j(""),children:"Effacer la recherche"})]})}):e.jsxs(n,{children:[e.jsxs(g,{className:"pb-1",children:[e.jsx(y,{children:"Demandes en attente de planification"}),e.jsx(b,{children:"Rendez-vous qui nécessitent une date et une heure"})]}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Client"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Référence"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Adresse"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Créé le"}),e.jsx("th",{className:"text-right py-3 px-2 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:o.map(s=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"py-3 px-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.customerName}),s.enedisRef&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Ref. Enedis: ",s.enedisRef]})]})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"font-mono text-xs",children:s.referenceNumber})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"text-sm truncate max-w-[200px]",children:p(s)})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{children:new Date(s.createdAt).toLocaleDateString("fr-FR")})}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsxs(r,{size:"sm",variant:"default",onClick:()=>{D(s.id),f(!0)},children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Planifier"]})})]},s.id))})]})})})]})}),e.jsx(L,{value:"past",className:"m-0",children:z?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(M,{className:"h-8 w-8 animate-spin text-blue-600"})}):S?e.jsx(n,{children:e.jsxs(l,{className:"py-10 text-center",children:[e.jsx(T,{className:"h-10 w-10 text-amber-500 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Une erreur est survenue lors du chargement des rendez-vous."}),e.jsx(r,{variant:"outline",size:"sm",className:"mt-4",children:"Réessayer"})]})}):o.length===0?e.jsx(n,{children:e.jsxs(l,{className:"py-10 text-center",children:[e.jsx(E,{className:"h-10 w-10 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun rendez-vous passé trouvé."}),i&&e.jsx(r,{variant:"outline",size:"sm",onClick:()=>j(""),children:"Effacer la recherche"})]})}):e.jsxs(n,{children:[e.jsxs(g,{className:"pb-1",children:[e.jsx(y,{children:"Historique des rendez-vous"}),e.jsx(b,{children:"Rendez-vous passés et terminés"})]}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Client"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Référence"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Adresse"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Statut"})]})}),e.jsx("tbody",{children:o.map(s=>{let t;switch(s.status){case"scheduled":t=e.jsx(h,{className:"bg-blue-500",children:"Planifié"});break;case"validated":t=e.jsx(h,{className:"bg-green-500",children:"Validé"});break;case"in_progress":t=e.jsx(h,{variant:"secondary",children:"En cours"});break;default:t=e.jsx(h,{variant:"outline",children:s.status})}return e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsxs("td",{className:"py-3 px-2",children:[e.jsx("div",{className:"font-medium",children:s.customerName}),s.enedisRef&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Ref. Enedis: ",s.enedisRef]})]}),e.jsx("td",{className:"py-3 px-2",children:s.appointmentDate?e.jsxs("div",{children:[e.jsx("div",{children:v(s.appointmentDate)}),s.timeSlot&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.timeSlot})]}):e.jsx("span",{className:"text-muted-foreground text-xs italic",children:"Non planifié"})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"font-mono text-xs",children:s.referenceNumber})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"text-sm truncate max-w-[200px]",children:p(s)})}),e.jsx("td",{className:"py-3 px-2",children:t})]},s.id)})})]})})})]})}),e.jsx(L,{value:"canceled",className:"m-0",children:z?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(M,{className:"h-8 w-8 animate-spin text-blue-600"})}):S?e.jsx(n,{children:e.jsxs(l,{className:"py-10 text-center",children:[e.jsx(T,{className:"h-10 w-10 text-amber-500 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Une erreur est survenue lors du chargement des rendez-vous."}),e.jsx(r,{variant:"outline",size:"sm",className:"mt-4",children:"Réessayer"})]})}):o.length===0?e.jsx(n,{children:e.jsxs(l,{className:"py-10 text-center",children:[e.jsx(se,{className:"h-10 w-10 text-muted-foreground/50 mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Aucun rendez-vous annulé trouvé."}),i&&e.jsx(r,{variant:"outline",size:"sm",onClick:()=>j(""),children:"Effacer la recherche"})]})}):e.jsxs(n,{children:[e.jsxs(g,{className:"pb-1",children:[e.jsx(y,{children:"Rendez-vous annulés"}),e.jsx(b,{children:"Historique des rendez-vous annulés"})]}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Client"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Date prévue"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Référence"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Adresse"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Date d'annulation"})]})}),e.jsx("tbody",{children:o.map(s=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsxs("td",{className:"py-3 px-2",children:[e.jsx("div",{className:"font-medium",children:s.customerName}),s.enedisRef&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Ref. Enedis: ",s.enedisRef]})]}),e.jsx("td",{className:"py-3 px-2",children:s.appointmentDate?e.jsxs("div",{children:[e.jsx("div",{children:v(s.appointmentDate)}),s.timeSlot&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.timeSlot})]}):e.jsx("span",{className:"text-muted-foreground text-xs italic",children:"Non planifié"})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"font-mono text-xs",children:s.referenceNumber})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"text-sm truncate max-w-[200px]",children:p(s)})}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("div",{className:"text-sm",children:new Date(s.updatedAt||s.createdAt).toLocaleDateString("fr-FR")})})]},s.id))})]})})})]})})]}),e.jsx(Se,{isOpen:re,onClose:B,leadId:ae,onAppointmentCreated:s=>{u({title:"Rendez-vous créé",description:`Le rendez-vous a été créé avec succès pour ${s.customerName}.`}),B()}}),e.jsx(Y,{open:ne,onOpenChange:R,children:e.jsxs(Q,{children:[e.jsxs(_,{children:[e.jsx(K,{children:"Confirmer l'annulation"}),e.jsx(G,{children:"Êtes-vous sûr de vouloir annuler ce rendez-vous ? Cette action est irréversible."})]}),e.jsxs(X,{children:[e.jsx(r,{variant:"outline",onClick:()=>R(!1),children:"Annuler"}),e.jsx(r,{variant:"destructive",onClick:ce,children:F?"Confirmer l'annulation":"Fermer"})]})]})}),e.jsx(Y,{open:de,onOpenChange:k,children:e.jsxs(Q,{children:[e.jsxs(_,{children:[e.jsx(K,{children:"Envoyer un rappel"}),e.jsx(G,{children:d&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"my-2",children:["Un email de rappel sera envoyé à ",e.jsx("strong",{children:d.customerName})," pour le rendez-vous prévu le ",e.jsx("strong",{children:d.appointmentDate?v(d.appointmentDate):"Non planifié"}),d.timeSlot?` à ${d.timeSlot}`:"","."]}),e.jsxs("p",{className:"my-2",children:["Email: ",e.jsx("strong",{children:d.email})]})]})})]}),e.jsxs(X,{children:[e.jsx(r,{variant:"outline",onClick:()=>k(!1),children:"Annuler"}),e.jsx(r,{variant:"default",onClick:me,children:"Envoyer le rappel"})]})]})})]})})}export{Ns as default};
