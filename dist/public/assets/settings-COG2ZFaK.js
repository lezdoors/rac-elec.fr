import{c as K,a as D,r as w,e as G,j as e,L as u,D as l,I as n,B as d,E as O,K as V,G as Q,M as H,z as x,d as R,F as J,f as C,g as S,h as k,i as F,k as E,m as W,l as q,a6 as X,t as Y}from"./index-M7gvqbgL.js";import{u as Z}from"./useQuery-BSzkkAKP.js";import{A}from"./admin-layout-CPHGUYte.js";import{C as h,a as j,b as g,c as f,d as v,e as L}from"./card-DoUMhAKd.js";import{T as $,a as ee,b as y,c as N}from"./tabs-PQFbnNvc.js";import{S as se}from"./separator-C_P294XN.js";import{B as T}from"./badge-CBfQL8Er.js";import{S as M}from"./save-DqS2hrAt.js";import{T as re}from"./triangle-alert-B9e8v_vZ.js";import{C as ae}from"./credit-card-CwgbN4F9.js";import{E as te}from"./eye-off-BUgerO9q.js";import{P as ie}from"./pencil-JLtKNOT2.js";import{L as U}from"./lock--McrdLLd.js";import"./use-auth-DcHosK9e.js";import"./use-mobile-BOkxk8x7.js";import"./index-Cq9B3MBe.js";import"./log-out-7aDFXirP.js";import"./file-text-DiPFTDMo.js";import"./settings-DjWNnGT7.js";import"./index-DjAtW7tL.js";import"./index-PFnWDsEj.js";import"./external-link-CdBPQwVf.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=K("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=K("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=K("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);function Me(){var _,z;const{toast:c}=D(),[s,t]=w.useState({stripe:{publicKey:"",hasSecretKey:!1},email:{provider:"sendgrid",senderEmail:"",senderName:""},general:{siteName:"",defaultPrice:129.8,adminContactNumber:"",siteUrl:""}}),[p,a]=w.useState(!1),{data:i,isLoading:b}=Z({queryKey:["/api/system-config"],queryFn:async()=>{const r=await q("GET","/api/system-config");if(!r.ok){const m=await r.text();throw new Error(m||"Erreur lors de la récupération de la configuration")}return r.json()}});w.useState(()=>{i!=null&&i.success&&(i!=null&&i.configs)&&t(i.configs)});const o=G({mutationFn:async r=>{const m=await q("POST","/api/system-config",r);if(!m.ok){const B=await m.text();throw new Error(B||"Erreur lors de la mise à jour de la configuration")}return m.json()},onSuccess:()=>{X.invalidateQueries({queryKey:["/api/system-config"]}),c({title:"Configuration enregistrée",description:"Les paramètres ont été mis à jour avec succès"})},onError:r=>{c({title:"Erreur",description:r.message,variant:"destructive"})}}),P=r=>{o.mutate({section:r,config:s[r]})};return b?e.jsx(A,{title:"Paramètres",children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(u,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsx(A,{title:"Paramètres",description:"Configuration générale de l'application",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Paramètres"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Configuration générale du système et des intégrations"})]}),e.jsxs($,{defaultValue:"general",className:"w-full",children:[e.jsxs(ee,{className:"grid w-full grid-cols-4",children:[e.jsx(y,{value:"general",children:"Général"}),e.jsx(y,{value:"payments",children:"Paiements"}),e.jsx(y,{value:"emails",children:"Emails"}),e.jsx(y,{value:"security",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Sécurité"]})})]}),e.jsx(N,{value:"general",className:"space-y-4 mt-4",children:e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Configuration générale"}),e.jsx(f,{children:"Paramètres généraux de l'application"})]}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"site-name",children:"Nom du site"}),e.jsx(n,{id:"site-name",value:s.general.siteName,onChange:r=>t({...s,general:{...s.general,siteName:r.target.value}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"site-url",children:"URL du site"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx(n,{id:"site-url",value:s.general.siteUrl,onChange:r=>t({...s,general:{...s.general,siteUrl:r.target.value}}),placeholder:"https://demande-raccordement.fr"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"contact-number",children:"Numéro de contact administrateur"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx(n,{id:"contact-number",value:s.general.adminContactNumber,onChange:r=>t({...s,general:{...s.general,adminContactNumber:r.target.value}}),placeholder:"+33 1 23 45 67 89"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"default-price",children:"Prix par défaut (€)"}),e.jsx(n,{id:"default-price",type:"number",step:"0.01",value:s.general.defaultPrice,onChange:r=>t({...s,general:{...s.general,defaultPrice:parseFloat(r.target.value)}})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Prix par défaut pour les demandes de raccordement (129.80€ TTC)"})]})]}),e.jsx(L,{className:"flex justify-end",children:e.jsx(d,{onClick:()=>P("general"),disabled:o.isPending,children:o.isPending?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Enregistrer"]})})})]})}),e.jsx(N,{value:"payments",className:"space-y-4 mt-4",children:e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Configuration Stripe"}),e.jsx(f,{children:"Paramètres pour le traitement des paiements via Stripe"})]}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs(O,{children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(V,{children:"Important"}),e.jsx(Q,{children:"Les clés API Stripe sont sensibles et ne doivent jamais être partagées. Ces paramètres sont stockés de manière sécurisée dans l'environnement de l'application."})]}),e.jsxs("div",{className:"space-y-6 pt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"stripe-public-key",className:"flex items-center",children:[e.jsx("span",{children:"Clé publique Stripe"}),e.jsx(T,{variant:"outline",className:"ml-2",children:s.stripe.publicKey?"Configurée":"Non configurée"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx(n,{id:"stripe-public-key",value:p?s.stripe.publicKey:s.stripe.publicKey?"pk_•••••••••••••••••••••••••••••••":"",onChange:r=>t({...s,stripe:{...s.stripe,publicKey:r.target.value}}),placeholder:"pk_live_..."}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>a(!p),children:e.jsx(te,{className:"h-4 w-4"})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),'Commence par "pk_test_" ou "pk_live_"']})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(l,{htmlFor:"stripe-secret-key",children:"Clé secrète Stripe"}),e.jsx(T,{variant:s.stripe.hasSecretKey?"default":"destructive",children:s.stripe.hasSecretKey?"Configurée":"Manquante"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"La clé secrète est stockée en tant que variable d'environnement et n'est pas accessible via l'interface. Contactez l'administrateur système pour la modifier."})]}),e.jsx(se,{}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(l,{htmlFor:"stripe-mode",children:"Mode de paiement"}),e.jsx(T,{variant:"outline",className:(_=s.stripe.publicKey)!=null&&_.includes("pk_live")?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800",children:(z=s.stripe.publicKey)!=null&&z.includes("pk_live")?"Production":"Test"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'Le mode est déterminé automatiquement selon la clé publique utilisée. Utilisez une clé avec "pk_test_" pour le mode test, ou "pk_live_" pour le mode production.'})]})]})]}),e.jsx(L,{className:"flex justify-end",children:e.jsx(d,{onClick:()=>P("stripe"),disabled:o.isPending,children:o.isPending?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Enregistrer"]})})})]})}),e.jsx(N,{value:"emails",className:"space-y-4 mt-4",children:e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx(g,{children:"Configuration des emails"}),e.jsx(f,{children:"Paramètres pour l'envoi d'emails depuis l'application"})]}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"email-sender-name",children:"Nom d'expéditeur"}),e.jsx(n,{id:"email-sender-name",value:s.email.senderName,onChange:r=>t({...s,email:{...s.email,senderName:r.target.value}}),placeholder:"Service Raccordement Électrique"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"email-sender-email",children:"Email d'expéditeur"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx(n,{id:"email-sender-email",type:"email",value:s.email.senderEmail,onChange:r=>t({...s,email:{...s.email,senderEmail:r.target.value}}),placeholder:"contact@demande-raccordement.fr"})]})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Configuration SMTP détaillée"}),e.jsxs("div",{className:"bg-muted p-4 rounded-md",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:`La configuration SMTP avancée est disponible dans l'onglet "Config SMTP" du menu latéral.`}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>window.location.href="/admin/smtp",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Configurer le serveur SMTP"]})]})]})]}),e.jsx(L,{className:"flex justify-end",children:e.jsx(d,{onClick:()=>P("email"),disabled:o.isPending,children:o.isPending?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Enregistrer"]})})})]})}),e.jsx(N,{value:"security",className:"space-y-4 mt-4",children:e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Sécurité du compte"]}),e.jsx(f,{children:"Paramètres de sécurité et modification du mot de passe"})]}),e.jsx(v,{className:"space-y-6",children:e.jsx(oe,{})})]})})]})]})})}const ce=x.object({currentPassword:x.string().min(1,"Le mot de passe actuel est requis"),newPassword:x.string().min(6,"Le nouveau mot de passe doit contenir au moins 6 caractères"),confirmPassword:x.string().min(1,"La confirmation du mot de passe est requise")}).refine(c=>c.newPassword===c.confirmPassword,{message:"Les mots de passe ne correspondent pas",path:["confirmPassword"]});function oe(){const{toast:c}=D();w.useState(!1);const s=R({resolver:Y(ce),defaultValues:{currentPassword:"",newPassword:"",confirmPassword:""}}),t=G({mutationFn:async a=>{const i=await q("POST","/api/change-password",{currentPassword:a.currentPassword,newPassword:a.newPassword});if(!i.ok){const b=await i.json();throw new Error(b.message||"Erreur lors du changement de mot de passe")}return i.json()},onSuccess:()=>{c({title:"Mot de passe modifié",description:"Votre mot de passe a été modifié avec succès",variant:"default"}),s.reset()},onError:a=>{c({title:"Erreur",description:a.message,variant:"destructive"})}}),p=a=>{t.mutate(a)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Modifier votre mot de passe"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Modifiez votre mot de passe. Pour des raisons de sécurité, choisissez un mot de passe fort que vous n'utilisez pas ailleurs."})]}),e.jsx(J,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(p),className:"space-y-5",children:[e.jsx(C,{control:s.control,name:"currentPassword",render:({field:a})=>e.jsxs(S,{children:[e.jsx(k,{children:"Mot de passe actuel"}),e.jsx(F,{children:e.jsx(n,{type:"password",...a})}),e.jsx(E,{})]})}),e.jsx(C,{control:s.control,name:"newPassword",render:({field:a})=>e.jsxs(S,{children:[e.jsx(k,{children:"Nouveau mot de passe"}),e.jsx(F,{children:e.jsx(n,{type:"password",...a})}),e.jsx(W,{children:"Le mot de passe doit contenir au moins 6 caractères."}),e.jsx(E,{})]})}),e.jsx(C,{control:s.control,name:"confirmPassword",render:({field:a})=>e.jsxs(S,{children:[e.jsx(k,{children:"Confirmer le mot de passe"}),e.jsx(F,{children:e.jsx(n,{type:"password",...a})}),e.jsx(E,{})]})}),e.jsx(d,{type:"submit",disabled:t.isPending,className:"mt-4",children:t.isPending?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"mr-2 h-4 w-4 animate-spin"}),"Modification en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Changer le mot de passe"]})})]})})]})}export{Me as default};
