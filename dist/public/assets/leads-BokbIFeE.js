import{c as qe,a as fe,j as e,L as pe,B as C,r as h,ax as Es,au as Ye,aw as Ne,ay as Ve,az as Le,av as Ts,y as Ze,d as Ss,t as As,e as Oe,l as ae,X as Ie,F as Rs,f as A,g as R,h as _,i as P,O as ie,k,I as B,a9 as es,o as _s,s as q,x as ee,cf as J,v as $e,w as ss,at as le,a7 as Ps,M as ks,P as Ls,z as Is,D as $s}from"./index-DoOyQpDg.js";import{a as Pe}from"./use-auth-CUsndVaB.js";import{C as Fs,D as Ms,p as qs,q as Vs,x as ge,v as ke,r as D,y as Os,A as zs,U as Bs,z as Gs}from"./admin-layout-554xjVzY.js";import{C as xe,d as ue,a as Fe,b as Me,c as Us,e as Ds}from"./card-BV3MLhEv.js";import{S as se,a as re,d as ne,b as te,c as u}from"./select-D7uG6fJR.js";import{B as K,c as rs,R as Ks,I as Ws}from"./use-mobile-BJYmzBjN.js";import{T as ns,a as ts,b as W,c as H}from"./tabs-BOIci4Wz.js";import{L as y}from"./schema-77HCumTO.js";import{u as Hs}from"./index-CVS3WhXl.js";import{u as Qs}from"./index-C9E8glm3.js";import{u as Xs}from"./index-Ch80ccjy.js";import{A as Js}from"./appointment-modal-DT7SDqzP.js";import{C as Ys}from"./circle-x-B678DKtg.js";import{T as as}from"./triangle-alert-PJjzCQCi.js";import{D as is}from"./download-COO6WOaW.js";import{E as Zs}from"./jspdf.es.min-CTNytEM5.js";import er from"./html2canvas.esm-CBrSDip1.js";import{S as sr}from"./search-BPMxFEwF.js";import{P as rr}from"./plus-DtuB8TDx.js";import{P as nr}from"./phone-call-B4zvz00r.js";import{I as tr}from"./info-C9y9nRl-.js";import"./log-out-G2g80KMN.js";import"./credit-card-B63Ehg5s.js";import"./users-BJhNGsQY.js";import"./settings-DlXIVaIO.js";import"./index-DHO6DMX2.js";import"./separator-DQVI2MlT.js";import"./external-link-Cly8VjAW.js";import"./chevron-down-B9b-t5lK.js";import"./calendar-CPCgMSiy.js";import"./endOfMonth-C6raWiDY.js";import"./isBefore-kmer4VwE.js";import"./popover-DQ31Ljko.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ar=qe("CircleArrowRight",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ir=qe("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=qe("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);function ze({leadsLoading:s,incompleteLeadsData:t,currentPage:i,goToPage:c,goToPreviousPage:p,goToNextPage:o,openDetailsDialog:a,openAssignDialog:m,title:x="Leads incomplets",description:g="Formulaires partiellement remplis par les utilisateurs"}){return fe(),e.jsx(e.Fragment,{children:s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(pe,{className:"h-8 w-8 animate-spin text-blue-600"})}):!(t!=null&&t.leads)||t.leads.length===0?e.jsx(xe,{children:e.jsx(ue,{className:"py-10 text-center",children:e.jsxs("p",{className:"text-muted-foreground mb-4",children:["Aucun ",x.toLowerCase()," trouv√©."]})})}):e.jsxs(xe,{children:[e.jsxs(Fe,{className:"pb-1",children:[e.jsx(Me,{children:x}),e.jsx(Us,{children:g})]}),e.jsx(ue,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"R√©f√©rence"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Client"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Source"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"√âtape"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Date"}),e.jsx("th",{className:"text-right py-3 px-2 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:t.leads.map(r=>{const f=new Date(r.createdAt).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});return e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsxs("td",{className:"py-3 px-2",children:[e.jsx("div",{className:"font-mono text-xs text-blue-600",children:r.referenceNumber||r.reference_number||`#${r.id}`}),r.sessionToken&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Session: ",r.sessionToken.substring(0,8),"..."]})]}),e.jsxs("td",{className:"py-3 px-2",children:[e.jsx("div",{className:"font-medium",children:r.firstName||r.lastName?`${r.firstName||""} ${r.lastName||""}`.trim():r.name?r.name:r.email?`<${r.email}>`:"Non renseign√©"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[r.email||"Email non fourni",r.phone&&e.jsxs("span",{className:"ml-2 text-blue-600",children:["‚Ä¢ ",r.phone]})]}),r.clientType&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:r.clientType==="particulier"?"Particulier":r.clientType==="professionnel"?"Professionnel":r.clientType})})]}),e.jsxs("td",{className:"py-3 px-2",children:[r.referenceNumber&&r.referenceNumber.includes("LEAD-")?e.jsx(K,{variant:"outline",className:"bg-blue-50 text-blue-700 hover:bg-blue-100",children:"üìß Email"}):e.jsx(K,{variant:"outline",className:"bg-green-50 text-green-700 hover:bg-green-100",children:"üåê Web"}),r.serviceType&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:r.serviceType==="electricity"?"√âlectricit√©":r.serviceType==="photovoltaic"?"Photovolta√Øque":r.serviceType})]}),e.jsx("td",{className:"py-3 px-2",children:r.completedSteps===3?e.jsx(K,{variant:"outline",className:"bg-green-50 text-green-700 hover:bg-green-100",children:"Complet ‚úì"}):e.jsxs(K,{variant:"outline",children:["√âtape ",Math.max(1,r.completedSteps||1),"/3"]})}),e.jsx("td",{className:"py-3 px-2",children:r.status?e.jsxs(K,{variant:"secondary",className:`
                              ${r.status===y.INTERESTED?"bg-green-100 text-green-800 hover:bg-green-200":""}
                              ${r.status===y.NOT_INTERESTED?"bg-red-100 text-red-800 hover:bg-red-200":""}
                              ${r.status===y.NO_RESPONSE?"bg-amber-100 text-amber-800 hover:bg-amber-200":""}
                              ${r.status===y.CALLBACK_SCHEDULED?"bg-blue-100 text-blue-800 hover:bg-blue-200":""}
                              ${r.status===y.NEW||!r.status?"bg-gray-100 text-gray-800 hover:bg-gray-200":""}
                            `,children:[r.status===y.INTERESTED&&"Int√©ress√©",r.status===y.NOT_INTERESTED&&"Non int√©ress√©",r.status===y.NO_RESPONSE&&"Sans r√©ponse",r.status===y.CALLBACK_SCHEDULED&&"Rappel programm√©",(r.status===y.NEW||!r.status)&&"Nouveau"]}):e.jsx(K,{variant:"secondary",className:"bg-gray-100 text-gray-800 hover:bg-gray-200",children:"Nouveau"})}),e.jsx("td",{className:"py-3 px-2 text-muted-foreground text-xs",children:f}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[r.phone&&e.jsx(C,{variant:"ghost",size:"icon",title:"WhatsApp",onClick:()=>{let n=r.phone.replace(/\s+/g,"");n.startsWith("0")?n="+33"+n.substring(1):n.startsWith("+")||(n="+33"+n);const v=`Bonjour ${r.firstName||r.lastName?`${r.firstName||""} ${r.lastName||""}`.trim():r.name||"Client"}, nous avons bien re√ßu votre demande de raccordement √©lectrique. L'√©quipe Portail-Electricite.com souhaite vous contacter pour finaliser votre dossier.`;window.open(`https://wa.me/${n}?text=${encodeURIComponent(v)}`,"_blank")},className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:e.jsx("svg",{viewBox:"0 0 24 24",className:"h-4 w-4",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M17.6 6.32A7.85 7.85 0 0 0 12.025 4c-4.4 0-7.975 3.58-7.975 7.98a8.06 8.06 0 0 0 1.065 4.02L4 20l4.1-1.08a7.88 7.88 0 0 0 3.775.965h.004c4.4 0 7.975-3.58 7.975-7.98a8.05 8.05 0 0 0-2.254-5.585zM12.025 18.37h-.003a6.58 6.58 0 0 1-3.335-.92l-.24-.144-2.48.652.66-2.425-.156-.25a6.56 6.56 0 0 1-1.01-3.505 6.48 6.48 0 0 1 6.565-6.56c1.75 0 3.4.685 4.65 1.925a6.565 6.565 0 0 1 1.935 4.66c-.005 3.64-2.965 6.565-6.585 6.565zm3.595-4.92c-.2-.1-1.175-.58-1.36-.65-.18-.065-.315-.1-.445.1-.13.195-.51.645-.62.775-.115.13-.23.145-.43.05-.2-.1-.845-.31-1.605-.995-.595-.535-.995-1.2-1.115-1.4-.115-.2-.01-.31.09-.41.09-.09.2-.235.3-.355.1-.115.135-.2.2-.33.065-.135.035-.25-.015-.35-.05-.1-.445-1.075-.61-1.47-.16-.39-.32-.335-.445-.34-.115-.01-.245-.01-.375-.01s-.345.05-.525.25c-.18.2-.685.67-.685 1.64 0 .97.705 1.905.8 2.035.095.135 1.36 2.075 3.295 2.915 1.94.84 1.94.56 2.29.525.35-.035 1.125-.46 1.285-.91.16-.44.16-.82.115-.9-.05-.075-.18-.12-.38-.21z"})})}),e.jsx(C,{variant:"ghost",size:"icon",title:"Voir les d√©tails",onClick:()=>a(r.id),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]})}),e.jsx(C,{variant:"ghost",size:"icon",title:"Assigner",onClick:()=>m(r.id),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]})})]})})]},r.id)})})]})})}),e.jsxs(Ds,{className:"flex justify-between border-t p-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Affichage de ",(i-1)*20+1,"-",Math.min(i*20,t.pagination.total),"sur ",t.pagination.total," ",x.toLowerCase(),t.pagination.total!==1?"s":""]}),t.pagination.totalPages>1&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{variant:"outline",size:"sm",onClick:p,disabled:i===1,children:"Pr√©c√©dent"}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(t.pagination.totalPages,5)},(r,j)=>{let f;return t.pagination.totalPages<=5||i<=3?f=j+1:i>=t.pagination.totalPages-2?f=t.pagination.totalPages-4+j:f=i-2+j,e.jsx(C,{variant:i===f?"default":"outline",size:"sm",onClick:()=>c(f),children:f},f)})}),e.jsx(C,{variant:"outline",size:"sm",onClick:o,disabled:i>=t.pagination.totalPages,children:"Suivant"})]})]})]})})}function cr({leadsLoading:s,allLeadsData:t,currentPage:i,goToPage:c,goToPreviousPage:p,goToNextPage:o,openDetailsDialog:a,openAssignDialog:m}){return e.jsx(ze,{leadsLoading:s,incompleteLeadsData:t,currentPage:i,goToPage:c,goToPreviousPage:p,goToNextPage:o,openDetailsDialog:a,openAssignDialog:m,title:"Tous les leads",description:"Liste compl√®te de tous les leads du syst√®me"})}function or({leadsLoading:s,newLeadsData:t,currentPage:i,goToPage:c,goToPreviousPage:p,goToNextPage:o,openDetailsDialog:a,openAssignDialog:m}){return e.jsx(ze,{leadsLoading:s,incompleteLeadsData:t,currentPage:i,goToPage:c,goToPreviousPage:p,goToNextPage:o,openDetailsDialog:a,openAssignDialog:m,title:"Nouveaux leads",description:"Leads cr√©√©s dans les derni√®res 24 heures"})}var Be="Radio",[dr,ls]=Ye(Be),[mr,pr]=dr(Be),cs=h.forwardRef((s,t)=>{const{__scopeRadio:i,name:c,checked:p=!1,required:o,disabled:a,value:m="on",onCheck:x,form:g,...r}=s,[j,f]=h.useState(null),n=Ve(t,M=>f(M)),N=h.useRef(!1),v=j?g||!!j.closest("form"):!0;return e.jsxs(mr,{scope:i,checked:p,disabled:a,children:[e.jsx(Ne.button,{type:"button",role:"radio","aria-checked":p,"data-state":ps(p),"data-disabled":a?"":void 0,disabled:a,value:m,...r,ref:n,onClick:Le(s.onClick,M=>{p||x==null||x(),v&&(N.current=M.isPropagationStopped(),N.current||M.stopPropagation())})}),v&&e.jsx(ms,{control:j,bubbles:!N.current,name:c,value:m,checked:p,required:o,disabled:a,form:g,style:{transform:"translateX(-100%)"}})]})});cs.displayName=Be;var os="RadioIndicator",ds=h.forwardRef((s,t)=>{const{__scopeRadio:i,forceMount:c,...p}=s,o=pr(os,i);return e.jsx(Ts,{present:c||o.checked,children:e.jsx(Ne.span,{"data-state":ps(o.checked),"data-disabled":o.disabled?"":void 0,...p,ref:t})})});ds.displayName=os;var xr="RadioBubbleInput",ms=h.forwardRef(({__scopeRadio:s,control:t,checked:i,bubbles:c=!0,...p},o)=>{const a=h.useRef(null),m=Ve(a,o),x=Xs(i),g=Qs(t);return h.useEffect(()=>{const r=a.current;if(!r)return;const j=window.HTMLInputElement.prototype,n=Object.getOwnPropertyDescriptor(j,"checked").set;if(x!==i&&n){const N=new Event("click",{bubbles:c});n.call(r,i),r.dispatchEvent(N)}},[x,i,c]),e.jsx(Ne.input,{type:"radio","aria-hidden":!0,defaultChecked:i,...p,tabIndex:-1,ref:m,style:{...p.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ms.displayName=xr;function ps(s){return s?"checked":"unchecked"}var ur=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ve="RadioGroup",[hr]=Ye(ve,[rs,ls]),xs=rs(),us=ls(),[gr,jr]=hr(ve),hs=h.forwardRef((s,t)=>{const{__scopeRadioGroup:i,name:c,defaultValue:p,value:o,required:a=!1,disabled:m=!1,orientation:x,dir:g,loop:r=!0,onValueChange:j,...f}=s,n=xs(i),N=Hs(g),[v,M]=Es({prop:o,defaultProp:p??null,onChange:j,caller:ve});return e.jsx(gr,{scope:i,name:c,required:a,disabled:m,value:v,onValueChange:M,children:e.jsx(Ks,{asChild:!0,...n,orientation:x,dir:N,loop:r,children:e.jsx(Ne.div,{role:"radiogroup","aria-required":a,"aria-orientation":x,"data-disabled":m?"":void 0,dir:N,...f,ref:t})})})});hs.displayName=ve;var gs="RadioGroupItem",js=h.forwardRef((s,t)=>{const{__scopeRadioGroup:i,disabled:c,...p}=s,o=jr(gs,i),a=o.disabled||c,m=xs(i),x=us(i),g=h.useRef(null),r=Ve(t,g),j=o.value===p.value,f=h.useRef(!1);return h.useEffect(()=>{const n=v=>{ur.includes(v.key)&&(f.current=!0)},N=()=>f.current=!1;return document.addEventListener("keydown",n),document.addEventListener("keyup",N),()=>{document.removeEventListener("keydown",n),document.removeEventListener("keyup",N)}},[]),e.jsx(Ws,{asChild:!0,...m,focusable:!a,active:j,children:e.jsx(cs,{disabled:a,required:o.required,checked:j,...x,...p,name:o.name,ref:r,onCheck:()=>o.onValueChange(p.value),onKeyDown:Le(n=>{n.key==="Enter"&&n.preventDefault()}),onFocus:Le(p.onFocus,()=>{var n;f.current&&((n=g.current)==null||n.click())})})})});js.displayName=gs;var fr="RadioGroupIndicator",fs=h.forwardRef((s,t)=>{const{__scopeRadioGroup:i,...c}=s,p=us(i);return e.jsx(ds,{...p,...c,ref:t})});fs.displayName=fr;var Ns=hs,vs=js,Nr=fs;const ys=h.forwardRef(({className:s,...t},i)=>e.jsx(Ns,{className:Ze("grid gap-2",s),...t,ref:i}));ys.displayName=Ns.displayName;const je=h.forwardRef(({className:s,...t},i)=>e.jsx(vs,{ref:i,className:Ze("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Nr,{className:"flex items-center justify-center",children:e.jsx(Fs,{className:"h-2.5 w-2.5 fill-current text-current"})})}));je.displayName=vs.displayName;const vr=_s({clientType:ee(["particulier","professionnel","collectivite"],{errorMap:()=>({message:"Veuillez s√©lectionner un type de client"})}),firstName:q().min(1,"Le pr√©nom est requis"),lastName:q().min(1,"Le nom est requis"),email:q().email("Adresse email invalide"),phone:q().regex(/^[0-9]{10}$/,"Le num√©ro doit contenir exactement 10 chiffres"),company:q().optional().or(J("")),siret:q().optional().or(J("")),address:q().optional().or(J("")),addressComplement:q().optional().or(J("")),postalCode:q().optional().or(J("")),city:q().optional().or(J("")),serviceType:ee(["electricity"],{errorMap:()=>({message:"Veuillez s√©lectionner un type de service"})}),requestType:ee(["new_connection","power_upgrade","temporary_connection","relocation","technical_visit","other"]),buildingType:ee(["individual_house","apartment_building","commercial","industrial","agricultural","public","terrain"]).optional(),terrainViabilise:ee(["viabilise","non_viabilise"]).optional(),powerRequired:q().optional(),phaseType:ee(["monophase","triphase"]).optional(),comments:q().optional().or(J(""))}).refine(s=>!(s.clientType==="professionnel"&&(!s.company||!s.siret)),{message:"La raison sociale et le num√©ro SIRET sont requis pour les professionnels",path:["siret"]});function yr({isOpen:s,onClose:t,onLeadCreated:i}){const{toast:c}=fe(),[p,o]=h.useState(!1),a=Ss({resolver:As(vr),defaultValues:{clientType:"particulier",firstName:"",lastName:"",email:"",phone:"",company:"",siret:"",address:"",addressComplement:"",postalCode:"",city:"",serviceType:"electricity",requestType:"new_connection",buildingType:"individual_house",terrainViabilise:"viabilise",powerRequired:"9",phaseType:"monophase",comments:""}}),m=a.watch("clientType"),x=Oe({mutationFn:async r=>await(await ae("POST","/api/leads/admin-create",r)).json(),onSuccess:r=>{r.success?(c({title:"Lead cr√©√© avec succ√®s",description:`R√©f√©rence: ${r.referenceNumber}`}),i(),t()):c({title:"Erreur",description:r.message||"Une erreur est survenue lors de la cr√©ation du lead",variant:"destructive"})},onError:r=>{c({title:"Erreur",description:r.message||"Une erreur est survenue lors de la cr√©ation du lead",variant:"destructive"})},onSettled:()=>{o(!1)}}),g=async r=>{o(!0),x.mutate(r)};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Cr√©er un nouveau lead"}),e.jsx(C,{variant:"ghost",size:"icon",onClick:t,className:"h-8 w-8 rounded-full",children:e.jsx(Ie,{className:"h-4 w-4"})})]}),e.jsx(Rs,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(g),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Informations du client"}),e.jsx(A,{control:a.control,name:"clientType",render:({field:r})=>e.jsxs(R,{className:"space-y-1",children:[e.jsx(_,{children:"Type de client"}),e.jsx(P,{children:e.jsxs(ys,{onValueChange:r.onChange,defaultValue:r.value,className:"flex space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{value:"particulier",id:"particulier"}),e.jsx(ie,{htmlFor:"particulier",children:"Particulier"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{value:"professionnel",id:"professionnel"}),e.jsx(ie,{htmlFor:"professionnel",children:"Professionnel"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{value:"collectivite",id:"collectivite"}),e.jsx(ie,{htmlFor:"collectivite",children:"Collectivit√©"})]})]})}),e.jsx(k,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(A,{control:a.control,name:"firstName",render:({field:r})=>e.jsxs(R,{children:[e.jsx(_,{children:"Pr√©nom"}),e.jsx(P,{children:e.jsx(B,{placeholder:"Pr√©nom",...r})}),e.jsx(k,{})]})}),e.jsx(A,{control:a.control,name:"lastName",render:({field:r})=>e.jsxs(R,{children:[e.jsx(_,{children:"Nom"}),e.jsx(P,{children:e.jsx(B,{placeholder:"Nom",...r})}),e.jsx(k,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(A,{control:a.control,name:"email",render:({field:r})=>e.jsxs(R,{children:[e.jsx(_,{children:"Email"}),e.jsx(P,{children:e.jsx(B,{type:"email",placeholder:"email@exemple.com",...r})}),e.jsx(k,{})]})}),e.jsx(A,{control:a.control,name:"phone",render:({field:r})=>e.jsxs(R,{children:[e.jsx(_,{children:"T√©l√©phone"}),e.jsx(P,{children:e.jsx(B,{placeholder:"0600000000",...r})}),e.jsx(k,{})]})})]}),m==="professionnel"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(A,{control:a.control,name:"company",render:({field:r})=>e.jsxs(R,{children:[e.jsx(_,{children:"Raison sociale"}),e.jsx(P,{children:e.jsx(B,{placeholder:"Nom de l'entreprise",...r})}),e.jsx(k,{})]})}),e.jsx(A,{control:a.control,name:"siret",render:({field:r})=>e.jsxs(R,{children:[e.jsx(_,{children:"SIRET"}),e.jsx(P,{children:e.jsx(B,{placeholder:"SIRET",...r})}),e.jsx(k,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Adresse"}),e.jsx(A,{control:a.control,name:"address",render:({field:r})=>e.jsxs(R,{children:[e.jsx(_,{children:"Adresse"}),e.jsx(P,{children:e.jsx(B,{placeholder:"Num√©ro et nom de rue",...r})}),e.jsx(k,{})]})}),e.jsx(A,{control:a.control,name:"addressComplement",render:({field:r})=>e.jsxs(R,{children:[e.jsx(_,{children:"Compl√©ment d'adresse"}),e.jsx(P,{children:e.jsx(B,{placeholder:"Appartement, b√¢timent, etc.",...r})}),e.jsx(k,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(A,{control:a.control,name:"postalCode",render:({field:r})=>e.jsxs(R,{children:[e.jsx(_,{children:"Code postal"}),e.jsx(P,{children:e.jsx(B,{placeholder:"00000",...r})}),e.jsx(k,{})]})}),e.jsx(A,{control:a.control,name:"city",render:({field:r})=>e.jsxs(R,{children:[e.jsx(_,{children:"Ville"}),e.jsx(P,{children:e.jsx(B,{placeholder:"Ville",...r})}),e.jsx(k,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"D√©tails techniques"}),e.jsx(A,{control:a.control,name:"requestType",render:({field:r})=>e.jsxs(R,{children:[e.jsx(_,{children:"Type de demande"}),e.jsxs(se,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(P,{children:e.jsx(re,{children:e.jsx(ne,{placeholder:"S√©lectionner un type de demande"})})}),e.jsxs(te,{children:[e.jsx(u,{value:"new_connection",children:"Nouveau raccordement"}),e.jsx(u,{value:"power_upgrade",children:"Augmentation de puissance"}),e.jsx(u,{value:"temporary_connection",children:"Raccordement provisoire"}),e.jsx(u,{value:"relocation",children:"D√©placement d'ouvrage"}),e.jsx(u,{value:"technical_visit",children:"Visite technique"}),e.jsx(u,{value:"other",children:"Autre"})]})]}),e.jsx(k,{})]})}),e.jsx(A,{control:a.control,name:"buildingType",render:({field:r})=>e.jsxs(R,{children:[e.jsx(_,{children:"Type de b√¢timent"}),e.jsxs(se,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(P,{children:e.jsx(re,{children:e.jsx(ne,{placeholder:"S√©lectionner un type de b√¢timent"})})}),e.jsxs(te,{children:[e.jsx(u,{value:"individual_house",children:"Maison individuelle"}),e.jsx(u,{value:"apartment_building",children:"Immeuble collectif"}),e.jsx(u,{value:"commercial",children:"Local commercial"}),e.jsx(u,{value:"industrial",children:"Site industriel"}),e.jsx(u,{value:"agricultural",children:"Exploitation agricole"}),e.jsx(u,{value:"public",children:"√âtablissement public"}),e.jsx(u,{value:"terrain",children:"Terrain"})]})]}),e.jsx(k,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(A,{control:a.control,name:"powerRequired",render:({field:r})=>e.jsxs(R,{children:[e.jsx(_,{children:"Puissance demand√©e (kVA)"}),e.jsxs(se,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(P,{children:e.jsx(re,{children:e.jsx(ne,{placeholder:"Choisir une puissance"})})}),e.jsxs(te,{children:[e.jsx(u,{value:"3",children:"3 kVA"}),e.jsx(u,{value:"6",children:"6 kVA"}),e.jsx(u,{value:"9",children:"9 kVA"}),e.jsx(u,{value:"12",children:"12 kVA"}),e.jsx(u,{value:"15",children:"15 kVA"}),e.jsx(u,{value:"18",children:"18 kVA"}),e.jsx(u,{value:"24",children:"24 kVA"}),e.jsx(u,{value:"30",children:"30 kVA"}),e.jsx(u,{value:"36",children:"36 kVA"}),e.jsx(u,{value:"beyond",children:"Plus de 36 kVA"})]})]}),e.jsx(k,{})]})}),e.jsx(A,{control:a.control,name:"phaseType",render:({field:r})=>e.jsxs(R,{children:[e.jsx(_,{children:"Type de phase"}),e.jsxs(se,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(P,{children:e.jsx(re,{children:e.jsx(ne,{placeholder:"Choisir un type de phase"})})}),e.jsxs(te,{children:[e.jsx(u,{value:"monophase",children:"Monophas√©"}),e.jsx(u,{value:"triphase",children:"Triphas√©"})]})]}),e.jsx(k,{})]})})]}),e.jsx(A,{control:a.control,name:"comments",render:({field:r})=>e.jsxs(R,{children:[e.jsx(_,{children:"Commentaires"}),e.jsx(P,{children:e.jsx(es,{placeholder:"Informations compl√©mentaires sur la demande",className:"min-h-[100px]",...r})}),e.jsx(k,{})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(C,{variant:"outline",onClick:t,type:"button",children:"Annuler"}),e.jsx(C,{type:"submit",disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"mr-2 h-4 w-4 animate-spin"}),"Cr√©ation..."]}):"Cr√©er le lead"})]})]})})]})}):null}function br({leadDetails:s}){const t=c=>{if(!c)return"Non renseign√©";try{return new Date(c).toLocaleDateString("fr-FR")}catch{return c}},i=c=>{if(!c)return"Non renseign√©";try{return new Date(c).toLocaleString("fr-FR")}catch{return"Date invalide"}};return e.jsx(xe,{children:e.jsx(ue,{className:"p-0",children:e.jsxs(ns,{defaultValue:"step1",className:"p-4",children:[e.jsxs(ts,{className:"mb-4",children:[e.jsx(W,{value:"step1",children:"Informations client"}),e.jsx(W,{value:"step2",children:"Type de demande"}),e.jsx(W,{value:"step3",children:"Adresse & technique"}),e.jsx(W,{value:"step4",children:"Planning & facturation"}),e.jsx(W,{value:"step5",children:"M√©tadonn√©es"})]}),e.jsxs(H,{value:"step1",className:"border rounded-md p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Informations client"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Type de client:"}),e.jsx("span",{children:s.clientType==="particulier"?"Particulier":s.clientType==="professionnel"?"Professionnel":s.clientType==="collectivite"?"Collectivit√©":"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Nom complet:"}),e.jsx("span",{children:s.firstName||s.lastName?`${s.firstName||""} ${s.lastName||""}`.trim():s.email?`<${s.email}>`:"Non renseign√©"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Email:"}),e.jsx("span",{children:s.email||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"T√©l√©phone:"}),e.jsx("span",{children:s.phone||"Non renseign√©"})]}),s.clientType==="professionnel"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Entreprise:"}),e.jsx("span",{children:s.company||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"SIRET:"}),e.jsx("span",{children:s.siret||"Non renseign√©"})]})]})]})]})]}),e.jsxs(H,{value:"step2",className:"border rounded-md p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Type de demande"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Service:"}),e.jsx("span",{children:s.serviceType==="electricity"?"√âlectricit√©":s.serviceType||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Type:"}),e.jsx("span",{children:s.requestType==="new_connection"?"Nouveau raccordement":s.requestType==="power_upgrade"?"Modification de puissance":s.requestType==="temporary_connection"?"Raccordement temporaire":s.requestType==="relocation"?"D√©placement d'ouvrage":s.requestType==="technical_visit"?"Visite technique":s.requestType==="other"?"Autre":"Non renseign√©"})]}),s.requestType==="other"&&e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Description:"}),e.jsx("span",{children:s.otherRequestTypeDesc||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"B√¢timent:"}),e.jsx("span",{children:s.buildingType==="individual_house"?"Maison individuelle":s.buildingType==="apartment_building"?"Immeuble":s.buildingType==="commercial"?"Local commercial":s.buildingType==="industrial"?"B√¢timent industriel":s.buildingType==="agricultural"?"Exploitation agricole":s.buildingType==="public"?"B√¢timent public":s.buildingType==="terrain"?"Terrain":"Non renseign√©"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[135px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Terrain:"}),e.jsx("span",{children:s.terrainViabilise==="viabilise"?"Terrain viabilis√©":s.terrainViabilise==="non_viabilise"?"Terrain non viabilis√©":"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[135px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"√âtat projet:"}),e.jsx("span",{children:s.projectStatus==="planning"?"En phase de projet":s.projectStatus==="permit_pending"?"Permis d√©pos√©":s.projectStatus==="permit_approved"?"Permis approuv√©":s.projectStatus==="construction_started"?"Construction d√©marr√©e":s.projectStatus==="construction_completed"?"Construction termin√©e":"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[135px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Permis n¬∞:"}),e.jsx("span",{children:s.permitNumber||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[135px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Date permis:"}),e.jsx("span",{children:t(s.permitDeliveryDate)})]})]})]})]}),e.jsxs(H,{value:"step3",className:"border rounded-md p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Adresse & D√©tails techniques"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Adresse:"}),e.jsx("span",{children:s.address||"Non renseign√©"})]}),s.addressComplement&&e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Compl√©ment:"}),e.jsx("span",{children:s.addressComplement})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Ville:"}),e.jsx("span",{children:s.city||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Code postal:"}),e.jsx("span",{children:s.postalCode||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"R√©f. cadastrale:"}),e.jsx("span",{children:s.cadastralReference||"Non renseign√©"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Puissance:"}),e.jsx("span",{children:s.powerRequired?`${s.powerRequired} kVA`:"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Phase:"}),e.jsx("span",{children:s.phaseType==="monophase"?"Monophas√©":s.phaseType==="triphase"?"Triphas√©":"Non renseign√©"})]}),s.hasArchitect&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1 mt-4",children:[e.jsx("span",{className:"text-slate-500 font-medium",children:"Architecte:"}),e.jsx("span",{})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Nom:"}),e.jsx("span",{children:s.architectName||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"T√©l√©phone:"}),e.jsx("span",{children:s.architectPhone||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Email:"}),e.jsx("span",{children:s.architectEmail||"Non renseign√©"})]})]})]})]})]}),e.jsxs(H,{value:"step4",className:"border rounded-md p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Planning et facturation"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Date souhait√©e:"}),e.jsx("span",{children:t(s.desiredCompletionDate)})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"D√©lai connexion:"}),e.jsx("span",{children:s.connectionDelay||"Non sp√©cifi√©"})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Achat imm√©diat:"}),e.jsx("span",{children:s.immediatePurchaseAccepted?"Oui":"Non"})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"CGV accept√©es:"}),e.jsx("span",{children:s.termsAccepted?"Oui":"Non"})]})]}),e.jsxs("div",{className:"space-y-2",children:[(s.billingAddress||s.billingCity||s.billingPostalCode)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1 mt-1",children:[e.jsx("span",{className:"text-slate-500 font-medium",children:"Adresse de facturation:"}),e.jsx("span",{})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Adresse:"}),e.jsx("span",{children:s.billingAddress||"Identique √† l'adresse du projet"})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Ville:"}),e.jsx("span",{children:s.billingCity||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Code postal:"}),e.jsx("span",{children:s.billingPostalCode||"Non renseign√©"})]})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1 mt-4",children:[e.jsx("span",{className:"text-slate-500",children:"Commentaires:"}),e.jsx("span",{className:"whitespace-pre-line",children:s.comments||"Aucun commentaire"})]})]})]})]}),e.jsxs(H,{value:"step5",className:"border rounded-md p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"M√©tadonn√©es"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"R√©f√©rence:"}),e.jsx("span",{className:"font-medium",children:s.referenceNumber||"Non g√©n√©r√©e"})]}),e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Prix standard:"}),e.jsx("span",{className:"font-medium",children:"129,80 ‚Ç¨ TTC"})]}),e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"TVA:"}),e.jsx("span",{className:"font-medium",children:s.vatRate||"20%"})]}),e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Statut:"}),e.jsx("span",{className:"font-medium",children:s.isCompleted?e.jsxs("span",{className:"text-green-600 flex items-center",children:[e.jsx($e,{className:"h-4 w-4 mr-1"})," Compl√©t√©"]}):e.jsxs("span",{className:"text-amber-600 flex items-center",children:[e.jsx(ss,{className:"h-4 w-4 mr-1"})," En progression"]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Cr√©√© le:"}),e.jsx("span",{children:i(s.createdAt)})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Mis √† jour le:"}),e.jsx("span",{children:i(s.updatedAt)})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Derni√®re activit√©:"}),e.jsx("span",{children:i(s.lastTouchedAt)})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Progression:"}),e.jsxs("span",{children:[s.completedSteps,"/5 √©tapes"]})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Converti en demande:"}),e.jsx("span",{children:s.convertedToRequest?"Oui":"Non"})]}),s.ipAddress&&e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"IP:"}),e.jsx("span",{className:"font-mono text-xs",children:s.ipAddress})]})]})]})]})]})})})}function Cr({leadId:s,phone:t,email:i,firstName:c,lastName:p,currentStatus:o,hasContract:a,onRequestAppointment:m,onExportPDF:x}){const{toast:g}=fe(),r=Oe({mutationFn:async({leadId:n,status:N})=>await(await ae("PATCH",`/api/leads/${n}/status`,{status:N})).json(),onSuccess:(n,N)=>{const v={[y.INTERESTED]:"Int√©ress√© (OK)",[y.NOT_INTERESTED]:"Pas int√©ress√©",[y.NO_RESPONSE]:"Pas de r√©ponse (NRP)",[y.CALLBACK_SCHEDULED]:"Rappel programm√©"};g({title:"Statut mis √† jour",description:`Le lead a √©t√© marqu√© comme : ${v[N.status]||N.status}`}),le.invalidateQueries({queryKey:["/api/leads"]}),le.invalidateQueries({queryKey:["/api/leads/incomplete"]})},onError:n=>{g({title:"Erreur",description:`Impossible de mettre √† jour le statut: ${n.message}`,variant:"destructive"})}}),j=n=>{r.mutate({leadId:s,status:n})},f=()=>{if(!t){g({title:"Aucun num√©ro de t√©l√©phone",description:"Ce lead n'a pas de num√©ro de t√©l√©phone renseign√©.",variant:"destructive"});return}let n=t.replace(/[\s()\-+]/g,"");!n.startsWith("33")&&n.startsWith("0")&&(n="33"+n.substring(1)),window.open(`https://wa.me/${n}`,"_blank")};return e.jsxs(Ms,{children:[e.jsx(qs,{asChild:!0,children:e.jsxs(C,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx(ir,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Actions"})]})}),e.jsxs(Vs,{align:"end",className:"w-[220px]",children:[e.jsx(ge,{children:"Actions rapides"}),e.jsx(ke,{}),e.jsx(ge,{className:"text-xs text-muted-foreground font-normal",children:"Statut"}),e.jsxs(D,{className:o===y.INTERESTED?"bg-blue-50":"",onClick:()=>j(y.INTERESTED),children:[e.jsx($e,{className:"mr-2 h-4 w-4 text-green-500"})," Int√©ress√© (OK)"]}),e.jsxs(D,{className:o===y.NOT_INTERESTED?"bg-blue-50":"",onClick:()=>j(y.NOT_INTERESTED),children:[e.jsx(Ys,{className:"mr-2 h-4 w-4 text-red-500"})," Pas int√©ress√©"]}),e.jsxs(D,{className:o===y.NO_RESPONSE?"bg-blue-50":"",onClick:()=>j(y.NO_RESPONSE),children:[e.jsx(as,{className:"mr-2 h-4 w-4 text-amber-500"})," Pas de r√©ponse (NRP)"]}),e.jsxs(D,{className:o===y.CALLBACK_SCHEDULED?"bg-blue-50":"",onClick:m,children:[e.jsx(ss,{className:"mr-2 h-4 w-4 text-blue-500"})," Programmer rappel"]}),e.jsxs(D,{className:o===y.PROCESS_COMPLETE?"bg-green-50":"",onClick:()=>j(y.PROCESS_COMPLETE),children:[e.jsx($e,{className:"mr-2 h-4 w-4 text-green-600"})," 5/5 vert (complet)"]}),e.jsx(ke,{}),e.jsx(ge,{className:"text-xs text-muted-foreground font-normal",children:"Communication"}),e.jsxs(Os,{children:[e.jsxs(D,{onClick:f,children:[e.jsx(Ps,{className:"mr-2 h-4 w-4 text-green-600"})," WhatsApp"]}),e.jsxs(D,{onClick:()=>{if(!i){g({title:"Aucune adresse email",description:"Ce lead n'a pas d'adresse email renseign√©e.",variant:"destructive"});return}const n="Votre demande de raccordement",N=`Bonjour ${c||""} ${p||""},

Nous avons bien re√ßu votre demande de raccordement. 

Cordialement,
L'√©quipe Raccordement`;window.location.href=`mailto:${i}?subject=${encodeURIComponent(n)}&body=${encodeURIComponent(N)}`},children:[e.jsx(ks,{className:"mr-2 h-4 w-4 text-blue-600"})," Email"]}),e.jsxs(D,{disabled:!0,children:[e.jsx(Ls,{className:"mr-2 h-4 w-4"})," Appeler"]})]}),e.jsx(ke,{}),e.jsx(ge,{className:"text-xs text-muted-foreground font-normal",children:"Documents"}),e.jsxs(D,{onClick:x,disabled:!x,children:[e.jsx(is,{className:"mr-2 h-4 w-4"})," Exporter PDF"]}),e.jsxs(D,{className:a?"bg-green-50":"",onClick:()=>{a?ae("GET",`/api/contracts/${s}`).then(n=>n.json()).then(n=>{if(n.success&&n.url)window.open(n.url,"_blank");else throw new Error(n.message||"Erreur lors de la r√©cup√©ration du contrat")}).catch(n=>{g({title:"Erreur",description:`Impossible d'ouvrir le contrat: ${n.message}`,variant:"destructive"})}):ae("POST",`/api/contracts/${s}/generate`).then(n=>n.json()).then(n=>{if(n.success)g({title:"Contrat g√©n√©r√©",description:n.message}),n.url&&window.open(n.url,"_blank"),le.invalidateQueries({queryKey:["/api/leads"]});else throw new Error(n.message||"Erreur inconnue")}).catch(n=>{g({title:"Erreur",description:`Impossible de g√©n√©rer le contrat: ${n.message}`,variant:"destructive"})})},children:[e.jsx(Is,{className:`mr-2 h-4 w-4 ${a?"text-green-600":""}`}),a?"Voir contrat":"G√©n√©rer contrat"]})]})]})}const wr=async s=>{try{const t=["ID","R√©f√©rence","Nom","Email","T√©l√©phone","Statut","Type de service","Date de cr√©ation"],i=[];i.push(t.join(","));for(const m of s){const x=[m.id,m.referenceNumber||"",`"${m.firstName&&m.lastName?`${m.firstName} ${m.lastName}`:m.name||"Non sp√©cifi√©"}"`,`"${m.email||""}"`,`"${m.phone||""}"`,`"${m.status||"Nouveau"}"`,`"${m.serviceType||""}"`,new Date(m.createdAt).toLocaleDateString("fr-FR")];i.push(x.join(","))}const c=i.join(`
`),p=new Blob([c],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(p),a=document.createElement("a");a.setAttribute("href",o),a.setAttribute("download",`leads_export_${new Date().toISOString().slice(0,10)}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(t){throw console.error("Erreur lors de l'exportation CSV:",t),new Error("Impossible d'exporter les leads au format CSV.")}},Er=async s=>{try{const t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="800px",t.style.padding="20px",t.style.backgroundColor="white",t.style.fontFamily="Arial, sans-serif";const i=document.createElement("div");i.style.display="flex",i.style.justifyContent="space-between",i.style.alignItems="center",i.style.marginBottom="20px",i.style.padding="10px",i.style.borderBottom="1px solid #ddd";const c=document.createElement("div");c.style.fontWeight="bold",c.style.fontSize="24px",c.style.color="#3b82f6",c.textContent="Raccordement √âlectrique";const p=document.createElement("div");p.textContent=`Date: ${new Date().toLocaleDateString("fr-FR")}`,p.style.color="#666",i.appendChild(c),i.appendChild(p);const o=document.createElement("div");o.style.padding="15px";const a=document.createElement("h1");a.textContent="Fiche Lead",a.style.fontSize="20px",a.style.color="#333",a.style.marginBottom="15px";const m=document.createElement("div");m.style.marginBottom="20px";const x=document.createElement("div");x.style.marginBottom="15px",x.style.padding="10px",x.style.backgroundColor="#f8fafc",x.style.borderRadius="5px";const g=document.createElement("div");g.textContent="Identification",g.style.fontWeight="bold",g.style.marginBottom="5px",g.style.color="#3b82f6";const r=document.createElement("div");r.style.display="flex",r.style.justifyContent="space-between";const j=document.createElement("div");j.textContent=`ID: ${s.id}`,j.style.fontSize="14px";const f=document.createElement("div");f.textContent=`Cr√©√© le: ${new Date(s.createdAt).toLocaleString("fr-FR")}`,f.style.fontSize="14px",r.appendChild(j),r.appendChild(f),x.appendChild(g),x.appendChild(r);const n=document.createElement("div");n.style.marginBottom="15px",n.style.padding="10px",n.style.backgroundColor="#f8fafc",n.style.borderRadius="5px";const N=document.createElement("div");N.textContent="Informations client",N.style.fontWeight="bold",N.style.marginBottom="10px",N.style.color="#3b82f6",n.appendChild(N);const v=document.createElement("div");v.style.display="grid",v.style.gridTemplateColumns="1fr 1fr",v.style.gap="10px";const M=[{label:"Nom complet",value:`${s.firstName||""} ${s.lastName||""}`.trim()||"Non renseign√©"},{label:"Email",value:s.email||"Non renseign√©"},{label:"T√©l√©phone",value:s.phone||"Non renseign√©"},{label:"Type de client",value:s.clientType==="particulier"?"Particulier":s.clientType==="professionnel"?"Professionnel":"Non renseign√©"}];s.clientType==="professionnel"&&M.push({label:"Entreprise",value:s.company||"Non renseign√©"},{label:"SIRET",value:s.siret||"Non renseign√©"}),M.forEach(O=>{const T=document.createElement("div");T.style.marginBottom="5px";const G=document.createElement("div");G.textContent=O.label,G.style.fontSize="12px",G.style.color="#666";const U=document.createElement("div");U.textContent=O.value,U.style.fontSize="14px",T.appendChild(G),T.appendChild(U),v.appendChild(T)}),n.appendChild(v);const V=document.createElement("div");V.style.marginBottom="15px",V.style.padding="10px",V.style.backgroundColor="#f8fafc",V.style.borderRadius="5px";const w=document.createElement("div");w.textContent="Informations projet",w.style.fontWeight="bold",w.style.marginBottom="10px",w.style.color="#3b82f6",V.appendChild(w);const Q=document.createElement("div");Q.style.display="grid",Q.style.gridTemplateColumns="1fr 1fr",Q.style.gap="10px",[{label:"Adresse",value:s.address||"Non renseign√©"},{label:"Code postal",value:s.postalCode||"Non renseign√©"},{label:"Ville",value:s.city||"Non renseign√©"},{label:"Type de b√¢timent",value:s.buildingType||"Non renseign√©"}].forEach(O=>{const T=document.createElement("div");T.style.marginBottom="5px";const G=document.createElement("div");G.textContent=O.label,G.style.fontSize="12px",G.style.color="#666";const U=document.createElement("div");U.textContent=O.value,U.style.fontSize="14px",T.appendChild(G),T.appendChild(U),Q.appendChild(T)}),V.appendChild(Q);const E=document.createElement("div");E.style.marginTop="30px",E.style.borderTop="1px solid #ddd",E.style.paddingTop="10px",E.style.fontSize="12px",E.style.color="#666",E.style.textAlign="center",E.textContent="Document g√©n√©r√© automatiquement - Raccordement √âlectrique ¬© 2025",m.appendChild(x),m.appendChild(n),m.appendChild(V),o.appendChild(a),o.appendChild(m),o.appendChild(E),t.appendChild(i),t.appendChild(o),document.body.appendChild(t);const oe=await er(t);document.body.removeChild(t);const Y=oe.toDataURL("image/jpeg",1),L=new Zs("p","mm","a4"),de=L.internal.pageSize.getWidth(),X=L.internal.pageSize.getHeight(),ye=oe.width,l=oe.height,he=de/ye,Z=l*he;if(L.addImage(Y,"JPEG",0,0,de,Z),Z>X){const O=Math.ceil(Z/X);for(let T=1;T<O;T++)L.addPage(),L.addImage(Y,"JPEG",0,-(T*X),de,Z)}const me=`Lead_${s.id}_${(s.firstName||"")+(s.lastName||"")}_${new Date().toISOString().split("T")[0]}.pdf`;return L.save(me),me}catch(t){throw console.error("Erreur lors de la g√©n√©ration du PDF:",t),t}};function ln(){var De,Ke,We,He,Qe,Xe;const{toast:s}=fe(),[t,i]=h.useState(""),[c,p]=h.useState("all"),[o,a]=h.useState(1),[m,x]=h.useState(!1),[g,r]=h.useState(!1),[j,f]=h.useState(!1),[n,N]=h.useState(!1),[v,M]=h.useState(null),V=20,{data:w,isLoading:Q,refetch:ce}=Pe({queryKey:["/api/leads/incomplete",{page:o,limit:V}],queryFn:async({queryKey:d})=>{const[b,I]=d,{page:S,limit:$}=I,z=await fetch(`${b}?page=${S}&limit=${$}`);if(!z.ok)throw new Error("Erreur lors de la r√©cup√©ration des leads");return z.json()},enabled:c==="incomplete"}),{data:E,isLoading:oe,refetch:Y}=Pe({queryKey:["/api/leads/all",{page:o,limit:V}],queryFn:async({queryKey:d})=>{const[b,I]=d,{page:S,limit:$}=I,z=await fetch(`/api/leads?page=${S}&limit=${$}`);if(!z.ok)throw new Error("Erreur lors de la r√©cup√©ration des leads");const F=await z.json();return F.success&&Array.isArray(F.leads)?F:Array.isArray(F)?{success:!0,leads:F,pagination:{total:F.length,totalPages:Math.ceil(F.length/$),currentPage:S,perPage:$}}:(console.error("Format de donn√©es inattendu:",F),{success:!0,leads:[],pagination:{total:0,totalPages:1,currentPage:S,perPage:$}})},enabled:c==="all"}),{data:L,isLoading:de,refetch:X}=Pe({queryKey:["/api/leads/new",{page:o,limit:V}],queryFn:async({queryKey:d})=>{const[b,I]=d,{page:S,limit:$}=I,z=await fetch(`/api/leads?page=${S}&limit=${$}`);if(!z.ok)throw new Error("Erreur lors de la r√©cup√©ration des nouveaux leads");const F=await z.json();let Ae=[];if(F.success&&Array.isArray(F.leads))Ae=F.leads;else if(Array.isArray(F))Ae=F;else return console.error("Format de donn√©es inattendu pour les nouveaux leads:",F),{success:!0,leads:[],pagination:{total:0,totalPages:1,currentPage:S,perPage:$}};const Re=new Date;Re.setDate(Re.getDate()-1);const _e=Ae.filter(Je=>Je.createdAt?new Date(Je.createdAt)>=Re:!1);return{success:!0,leads:_e,pagination:{total:_e.length,totalPages:Math.ceil(_e.length/$),currentPage:S,perPage:$}}},enabled:c==="new"});h.useEffect(()=>{a(1)},[c]),h.useEffect(()=>{c==="incomplete"?ce():c==="all"?Y():c==="new"&&X()},[o,c,ce,Y,X]);const ye=async d=>{if(!d)return null;try{const b=await fetch(`/api/leads/${d}`);if(!b.ok)throw new Error("Erreur lors de la r√©cup√©ration des d√©tails du lead");return await b.json()}catch(b){return console.error("Erreur de r√©cup√©ration des d√©tails du lead:",b),null}},[l,he]=h.useState(null),[Z,me]=h.useState(!1),[O,T]=h.useState(!1),[G,U]=h.useState(!1);h.useEffect(()=>((async()=>{if(v&&m){me(!0);const b=await ye(v);he((b==null?void 0:b.lead)||null),me(!1)}})(),()=>{m||he(null)}),[v,m]);const bs=async d=>{if(d)try{T(!0);const I=await(await ae("POST",`/api/leads/${d}/convert`,{})).json();I.success?(s({title:"Conversion r√©ussie",description:`Le lead a √©t√© converti en demande #${I.referenceNumber}`}),x(!1),ce()):s({title:"Erreur de conversion",description:I.message||"Une erreur est survenue lors de la conversion du lead",variant:"destructive"})}catch(b){s({title:"Erreur",description:b.message||"Une erreur est survenue lors de la conversion du lead",variant:"destructive"})}finally{T(!1)}},be=d=>{M(d),x(!0)},Ce=d=>{M(d),r(!0)},Ge=d=>{M(d),N(!0)},we=d=>{a(d)},Ee=()=>{o>1&&a(o-1)},Te=()=>{const d=c==="incomplete"?w:c==="all"?E:L;d&&o<d.pagination.totalPages&&a(o+1)},Se=Oe({mutationFn:async({leadId:d,userId:b,priority:I,note:S})=>await(await ae("POST",`/api/leads/${d}/assign`,{userId:b,priority:I,note:S})).json(),onSuccess:d=>{d.success?(s({title:"Lead assign√©",description:d.message||"Le lead a √©t√© assign√© avec succ√®s"}),r(!1),c==="incomplete"&&ce(),c==="all"&&Y(),c==="new"&&X()):s({title:"Erreur",description:d.message||"Un probl√®me est survenu lors de l'assignation du lead",variant:"destructive"})},onError:d=>{console.error("Erreur lors de l'assignation du lead:",d),s({title:"Erreur",description:d.message||"Un probl√®me est survenu lors de l'assignation du lead",variant:"destructive"})}}),Cs=(d,b,I,S)=>{Se.mutate({leadId:d,userId:b,priority:I,note:S})},ws=async()=>{if(l)try{U(!0),await Er(l),s({title:"Exportation r√©ussie",description:"Le PDF a √©t√© g√©n√©r√© et t√©l√©charg√©"})}catch(d){console.error("Erreur lors de l'exportation PDF:",d),s({title:"Erreur d'exportation",description:d.message||"Impossible de g√©n√©rer le PDF",variant:"destructive"})}finally{U(!1)}},Ue={all:((De=E==null?void 0:E.pagination)==null?void 0:De.total)||0,incomplete:((Ke=w==null?void 0:w.pagination)==null?void 0:Ke.total)||0,new:((We=L==null?void 0:L.pagination)==null?void 0:We.total)||0};return e.jsxs(zs,{title:"Leads",description:"Gestion des leads et prospects",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Leads"}),e.jsx("p",{className:"text-muted-foreground",children:"Gestion des prospects et demandes entrantes"})]}),e.jsxs("div",{className:"flex w-full sm:w-auto items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(sr,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(B,{type:"search",placeholder:"Rechercher...",className:"pl-8 w-full sm:w-[300px]",value:t,onChange:d=>i(d.target.value)})]}),e.jsxs(C,{variant:"outline",onClick:async()=>{try{const d=c==="incomplete"?w==null?void 0:w.leads:c==="all"?E==null?void 0:E.leads:L==null?void 0:L.leads;d&&d.length>0?(await wr(d),s({title:"Exportation r√©ussie",description:`${d.length} leads ont √©t√© export√©s au format CSV`})):s({title:"Aucune donn√©e √† exporter",description:"Il n'y a aucun lead √† exporter dans cet onglet",variant:"default"})}catch(d){console.error("Erreur lors de l'exportation CSV:",d),s({title:"Erreur d'exportation",description:d.message||"Impossible d'exporter les leads au format CSV",variant:"destructive"})}},children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"Exporter"]}),e.jsxs(C,{onClick:()=>f(!0),children:[e.jsx(rr,{className:"h-4 w-4 mr-2"}),"Nouveau Lead"]})]})]}),e.jsxs(ns,{defaultValue:"incomplete",value:c,onValueChange:p,className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs(ts,{children:[e.jsxs(W,{value:"all",className:"relative",children:["Tous",e.jsx(K,{variant:"secondary",className:"ml-2",children:Ue.all})]}),e.jsxs(W,{value:"incomplete",className:"relative",children:["Incomplets",e.jsx(K,{variant:"secondary",className:"ml-2",children:((He=w==null?void 0:w.pagination)==null?void 0:He.total)||0})]}),e.jsxs(W,{value:"new",className:"relative",children:["Nouveaux",e.jsx(K,{variant:"secondary",className:"ml-2",children:Ue.new})]})]})}),e.jsx(H,{value:"all",className:"m-0",children:e.jsx(cr,{leadsLoading:oe,allLeadsData:E,currentPage:o,goToPage:we,goToPreviousPage:Ee,goToNextPage:Te,openDetailsDialog:be,openAssignDialog:Ce})}),e.jsx(H,{value:"incomplete",className:"m-0",children:e.jsx(ze,{leadsLoading:Q,incompleteLeadsData:w,currentPage:o,goToPage:we,goToPreviousPage:Ee,goToNextPage:Te,openDetailsDialog:be,openAssignDialog:Ce})}),e.jsx(H,{value:"new",className:"m-0",children:e.jsx(or,{leadsLoading:de,newLeadsData:L,currentPage:o,goToPage:we,goToPreviousPage:Ee,goToNextPage:Te,openDetailsDialog:be,openAssignDialog:Ce})})]})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"D√©tails du lead"}),l&&l.referenceNumber&&e.jsx("p",{className:"text-sm text-muted-foreground font-mono",children:l.referenceNumber})]}),e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>x(!1),className:"h-8 w-8 rounded-full",children:e.jsx(Ie,{className:"h-4 w-4"})})]}),Z?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(pe,{className:"h-8 w-8 animate-spin text-blue-600"})}):l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4 bg-slate-50 p-3 rounded-md",children:[e.jsxs("div",{className:"flex items-center flex-wrap gap-3",children:[e.jsxs("div",{className:"bg-white px-3 py-1 rounded-full border flex items-center gap-1.5",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${l.isCompleted?"bg-green-500":"bg-amber-500"}`}),e.jsx("span",{className:"text-sm font-medium",children:l.isCompleted?"Complet":"Incomplet"})]}),e.jsxs("div",{className:"bg-white px-3 py-1 rounded-full border flex items-center gap-1.5",children:[e.jsx($s,{className:"h-3.5 w-3.5 text-slate-500"}),e.jsx("span",{className:"text-sm",children:new Date(l.createdAt).toLocaleDateString("fr-FR")})]}),e.jsx("div",{className:"bg-white px-3 py-1 rounded-full border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-xs font-medium mr-1.5",children:"Progression:"}),e.jsxs("span",{className:"text-xs font-medium",children:[Math.max(1,l.completedSteps||1),"/5"]}),e.jsx("div",{className:"ml-2 bg-slate-200 w-16 h-1.5 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-blue-600 h-full",style:{width:`${Math.floor(Math.max(1,l.completedSteps||1)/5*100)}%`}})})]})})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs(C,{variant:"outline",size:"sm",className:"flex-1 sm:flex-auto",onClick:()=>r(!0),children:[e.jsx(Bs,{className:"h-4 w-4 mr-1"}),"Assigner"]}),e.jsxs(C,{variant:"outline",size:"sm",className:"flex-1 sm:flex-auto",onClick:()=>Ge(l.id),children:[e.jsx(nr,{className:"h-4 w-4 mr-1"}),"Nouveau RDV"]}),e.jsx(C,{variant:"default",size:"sm",className:"flex-1 sm:flex-auto",onClick:()=>bs(l.id),disabled:O,children:O?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4 mr-1 animate-spin"}),"Traitement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ar,{className:"h-4 w-4 mr-1"}),"Convertir"]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(xe,{children:[e.jsx(Fe,{className:"pb-2",children:e.jsx(Me,{className:"text-base font-medium",children:"Informations g√©n√©rales"})}),e.jsxs(ue,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"ID:"}),e.jsx("span",{className:"font-mono",children:l.id})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Cr√©√© le:"}),e.jsx("span",{children:new Date(l.createdAt).toLocaleString("fr-FR")})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Modifi√© le:"}),e.jsx("span",{children:new Date(l.updatedAt).toLocaleString("fr-FR")})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Source:"}),e.jsx("span",{children:l.ipAddress?e.jsx(Gs,{content:l.userAgent,children:e.jsxs("div",{className:"cursor-help flex items-center",children:[((Qe=l.geoLocation)==null?void 0:Qe.flag)&&e.jsx("span",{className:"mr-2 text-lg","aria-label":`Drapeau ${l.geoLocation.countryName}`,children:l.geoLocation.flag}),l.ipAddress,((Xe=l.geoLocation)==null?void 0:Xe.countryName)&&e.jsxs("span",{className:"ml-2 text-xs text-slate-500",children:["(",l.geoLocation.countryName,")"]})]})}):"Aucune"})]})]})]}),e.jsxs(xe,{children:[e.jsx(Fe,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(Me,{className:"text-base font-medium",children:"Informations de contact"}),e.jsx(Cr,{leadId:l.id,phone:l.phone,email:l.email,firstName:l.firstName,lastName:l.lastName,currentStatus:l.status||"",hasContract:l.hasContract||!1,onRequestAppointment:()=>Ge(l.id),onExportPDF:ws})]})}),e.jsxs(ue,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Nom:"}),e.jsx("span",{children:l.firstName||l.lastName?`${l.firstName||""} ${l.lastName||""}`.trim():l.email?`<${l.email}>`:"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Email:"}),e.jsx("span",{children:l.email?e.jsx("a",{href:`mailto:${l.email}`,className:"text-blue-600 hover:underline",children:l.email}):"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"T√©l√©phone:"}),e.jsx("span",{children:l.phone?e.jsx("a",{href:`tel:${l.phone}`,className:"text-blue-600 hover:underline",children:l.phone}):"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Type de client:"}),e.jsx("span",{children:l.clientType==="particulier"?"Particulier":l.clientType==="professionnel"?"Professionnel":"Non renseign√©"})]}),l.clientType==="professionnel"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Entreprise:"}),e.jsx("span",{children:l.company||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"SIRET:"}),e.jsx("span",{children:l.siret||"Non renseign√©"})]})]})]})]})]}),e.jsx(br,{leadDetails:l})]}),e.jsx("div",{className:"mt-6 flex justify-end gap-2",children:e.jsx(C,{variant:"outline",onClick:()=>x(!1),children:"Fermer"})})]}):e.jsx("div",{className:"bg-amber-50 text-amber-800 p-4 rounded-md",children:e.jsxs("p",{className:"flex items-center",children:[e.jsx(as,{className:"h-5 w-5 mr-2"}),"Aucune information disponible."]})})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Assigner le lead"}),e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>r(!1),className:"h-8 w-8 rounded-full",children:e.jsx(Ie,{className:"h-4 w-4"})})]}),v&&e.jsxs("div",{children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(tr,{className:"h-5 w-5 text-blue-500"})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:["Vous allez assigner ",e.jsxs("span",{className:"font-medium",children:["Lead #",v]})," √† un membre de l'√©quipe commerciale."]})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"assignee",children:"S√©lectionner un utilisateur"}),e.jsxs(se,{name:"assignee",children:[e.jsx(re,{children:e.jsx(ne,{placeholder:"Choisir un utilisateur"})}),e.jsxs(te,{children:[e.jsx(u,{value:"1",children:"Marina Alves"}),e.jsx(u,{value:"2",children:"Thomas Dupont"}),e.jsx(u,{value:"3",children:"Sara Benali"})]})]})]}),e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"priority",children:"Priorit√©"}),e.jsxs(se,{name:"priority",defaultValue:"medium",children:[e.jsx(re,{children:e.jsx(ne,{})}),e.jsxs(te,{children:[e.jsx(u,{value:"high",children:"Haute"}),e.jsx(u,{value:"medium",children:"Moyenne"}),e.jsx(u,{value:"low",children:"Basse"})]})]})]}),e.jsxs("div",{children:[e.jsx(ie,{htmlFor:"note",children:"Note (optionnelle)"}),e.jsx(es,{name:"note",placeholder:"Ajouter une note pour le destinataire...",className:"resize-none",rows:3})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-2",children:[e.jsx(C,{variant:"outline",onClick:()=>r(!1),children:"Annuler"}),e.jsx(C,{disabled:Se.isPending||O,onClick:()=>{var S,$,z;const d=Number((S=document.querySelector('select[name="assignee"]'))==null?void 0:S.value),b=($=document.querySelector('select[name="priority"]'))==null?void 0:$.value,I=(z=document.querySelector('textarea[name="note"]'))==null?void 0:z.value;v&&d&&b?Cs(v,d,b,I):s({title:"Erreur",description:"Veuillez s√©lectionner un utilisateur et une priorit√©",variant:"destructive"})},children:Se.isPending?e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-4 w-4 mr-2 animate-spin"}),"Traitement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(lr,{className:"h-4 w-4 mr-2"}),"Assigner"]})})]})]})]})}),e.jsx(yr,{isOpen:j,onClose:()=>f(!1),onLeadCreated:()=>{le.invalidateQueries({queryKey:["/api/leads/all"]}),le.invalidateQueries({queryKey:["/api/leads/incomplete"]}),le.invalidateQueries({queryKey:["/api/leads/new"]})}}),e.jsx(Js,{isOpen:n,onClose:()=>N(!1),leadId:v,leadInfo:l?{firstName:l.firstName,lastName:l.lastName,phone:l.phone,email:l.email}:void 0})]})}export{ln as default};
