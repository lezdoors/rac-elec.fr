const l="AW-16683623620",_={PURCHASE:"asGUCJix06gbEMTJr5M-"},y=(o,t)=>`tracking_${o}_${t}`,a=o=>typeof sessionStorage>"u"?!1:sessionStorage.getItem(o)==="true",f=o=>{typeof sessionStorage<"u"&&sessionStorage.setItem(o,"true")},g=(o,t={})=>{typeof window>"u"||(window.gtag&&window.gtag("event","conversion",{send_to:`${l}/${o}`,...t}),Array.isArray(window.dataLayer)&&window.dataLayer.push({event:t.event_name||"conversion",send_to:`${l}/${o}`,...t}))},w=(o,t)=>{if(typeof window>"u")return!1;if(!o||!o.includes("@"))return console.warn("‚ö†Ô∏è trackFormStart: valid email required"),!1;const e="tracking_form_start_fired";return a(e)?(console.log("‚ÑπÔ∏è form_start already fired this session (skipped)"),!1):(f(e),Array.isArray(window.dataLayer)&&window.dataLayer.push({event:"form_start",user_data:{email:o.toLowerCase().trim(),phone_number:(t==null?void 0:t.replace(/\s/g,""))||void 0}}),console.log("‚úÖ form_start fired ONCE [session dedupe] (analytics only, not conversion)"),!0)},p=(o,t,e)=>{if(typeof window>"u")return!1;if(!o)return console.warn("‚ö†Ô∏è trackFormSubmit: reference required"),!1;const n=y("form_submit",o);return a(n)?(console.log(`‚ÑπÔ∏è form_submit already fired for ${o} (skipped)`),!1):(f(n),t&&sessionStorage.setItem("ec_email",t.toLowerCase().trim()),e&&sessionStorage.setItem("ec_phone",e.replace(/\s/g,"")),Array.isArray(window.dataLayer)&&window.dataLayer.push({event:"form_submit",transaction_id:o,user_data:{email:(t==null?void 0:t.toLowerCase().trim())||void 0,phone_number:(e==null?void 0:e.replace(/\s/g,""))||void 0}}),console.log(`‚úÖ form_submit fired [ref: ${o}] (analytics only, not conversion)`),!0)},m=()=>{if(typeof window>"u")return null;const o=localStorage.getItem("gclid");return o||new URLSearchParams(window.location.search).get("gclid")},u=(o,t=129.8,e)=>{if(typeof window>"u")return!1;if(!o)return console.warn("‚ö†Ô∏è trackPurchase: reference required"),!1;const n=y("purchase",o);if(a(n))return console.log(`‚ÑπÔ∏è purchase already fired for ${o} (skipped)`),!1;f(n);let r=e==null?void 0:e.email,s=e==null?void 0:e.phone;typeof sessionStorage<"u"&&(r||(r=sessionStorage.getItem("ec_email")||void 0),s||(s=sessionStorage.getItem("ec_phone")||void 0),sessionStorage.removeItem("ec_email"),sessionStorage.removeItem("ec_phone"));const d=m();if(console.log("üîç PURCHASE CONVERSION:",{reference:o,value:t,gclid:d,userData:e,timestamp:new Date().toISOString()}),g(_.PURCHASE,{event_name:"purchase",transaction_id:o,value:t,currency:"EUR",gclid:d||void 0,user_data:{email:(r==null?void 0:r.toLowerCase().trim())||void 0,phone_number:(s==null?void 0:s.replace(/\s/g,""))||void 0}}),Array.isArray(window.dataLayer)){const c={event:"purchase",transaction_id:o,value:t,currency:"EUR"},i={};r&&(i.email=r.toLowerCase().trim()),s&&(i.phone_number=s.replace(/\s/g,"")),e!=null&&e.firstName&&(i.address_first_name=e.firstName),e!=null&&e.lastName&&(i.address_last_name=e.lastName),e!=null&&e.city&&(i.address_city=e.city),e!=null&&e.postalCode&&(i.address_postal_code=e.postalCode),e!=null&&e.country&&(i.address_country=e.country||"FR"),Object.keys(i).length>0&&(c.user_data=i),window.dataLayer.push(c),console.log("üéØ GTM dataLayer.push:",c)}return console.log(`‚úÖ purchase fired [ref: ${o}, ‚Ç¨${t}, gclid: ${d||"none"}]`),!0},v=(o,t,e,n)=>{typeof window<"u"&&window.dataLayer&&window.dataLayer.push({event:"custom_event",event_action:o,event_category:t,event_label:e,event_value:n})};export{p as a,u as b,v as c,w as t};
