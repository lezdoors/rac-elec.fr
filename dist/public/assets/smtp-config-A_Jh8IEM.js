import{a as D,r as m,e as y,j as e,L as x,K as t,I as c,B as N,S as V,m as h,ae as k}from"./index-aPnHnRQ7.js";import{a as L}from"./use-auth-Deh7jbVc.js";import{A}from"./admin-layout-LddxcTf3.js";import{C,a as S,b,c as w,d as E,e as T}from"./card-DboZwTUA.js";import{S as q}from"./switch-DSRVH8Ar.js";import{T as H,a as J,b as F,c as P}from"./tabs-RxYhmTzZ.js";import{S as z}from"./save-cP51L6dW.js";import{A as U}from"./at-sign-BRp_rYde.js";import"./use-mobile-C_797HEi.js";import"./index-Cpp9Ajf2.js";import"./log-out-7Y8xqOra.js";import"./file-text-DIiL9AP9.js";import"./credit-card-B-Hao0-z.js";import"./users-CB9iw_GJ.js";import"./settings-ClUtMpsH.js";import"./index-BJrk7LVH.js";import"./index-CQvbDEPH.js";import"./separator-Bmf2xrGs.js";import"./external-link-D_NpoXyo.js";import"./index-C7hF49h6.js";function he(){const{toast:d}=D(),[r,f]=m.useState({to:"",subject:"Test de configuration SMTP",message:"Ceci est un email de test pour vérifier la configuration SMTP."}),{data:n,isLoading:K}=L({queryKey:["/api/admin/smtp-config"],queryFn:async()=>{const s=await h("GET","/api/admin/smtp-config?hidePassword=true");if(!s.ok){const i=await s.text();throw new Error(i||"Erreur lors de la récupération de la configuration SMTP")}return s.json()}}),[a,o]=m.useState({host:"",port:587,secure:!1,auth:{user:"",pass:""},defaultFrom:"",enabled:!1}),[p,M]=m.useState("");m.useState(!1);const{data:l,isLoading:G}=L({queryKey:["/api/admin/notification-email"],queryFn:async()=>{const s=await h("GET","/api/admin/notification-email");if(!s.ok){const i=await s.text();throw new Error(i||"Erreur lors de la récupération de l'adresse email de notification")}return s.json()}});m.useEffect(()=>{n!=null&&n.success&&(n!=null&&n.data)&&o(n.data),l!=null&&l.success&&(l!=null&&l.data)&&M(l.data.email)},[n,l]);const j=y({mutationFn:async s=>{const i=await h("POST","/api/admin/smtp-config",s);if(!i.ok){const u=await i.text();throw new Error(u||"Erreur lors de la mise à jour de la configuration SMTP")}return i.json()},onSuccess:()=>{k.invalidateQueries({queryKey:["/api/admin/smtp-config"]}),d({title:"Configuration enregistrée",description:"La configuration SMTP a été mise à jour avec succès"})},onError:s=>{d({title:"Erreur",description:s.message,variant:"destructive"})}}),g=y({mutationFn:async s=>{const i=await h("POST","/api/admin/test-smtp",s),u=await i.json();if(!i.ok||!u.success){const B=u.error||"Erreur lors de l'envoi de l'email de test";throw new Error(B)}return u},onSuccess:()=>{d({title:"Email de test envoyé",description:"Veuillez vérifier la boîte de réception du destinataire"})},onError:s=>{d({title:"Erreur d'envoi",description:s.message,variant:"destructive"})}}),v=y({mutationFn:async s=>{const i=await h("POST","/api/admin/notification-email",{email:s});if(!i.ok){const u=await i.text();throw new Error(u||"Erreur lors de la mise à jour de l'adresse email de notification")}return i.json()},onSuccess:()=>{k.invalidateQueries({queryKey:["/api/admin/notification-email"]}),d({title:"Adresse email mise à jour",description:"L'adresse email de notification a été mise à jour avec succès"})},onError:s=>{d({title:"Erreur",description:s.message,variant:"destructive"})}}),I=()=>{j.mutate(a)},O=()=>{g.mutate(r)},Q=()=>{p&&p.trim().length>0?v.mutate(p):d({title:"Erreur",description:"L'adresse email ne peut pas être vide",variant:"destructive"})};return K?e.jsx(A,{title:"Configuration SMTP",children:e.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:e.jsx(x,{className:"h-8 w-8 animate-spin text-muted-foreground"})})}):e.jsx(A,{title:"Configuration SMTP",description:"Gérez les paramètres d'envoi d'emails",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Configuration SMTP"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Configurez les paramètres du serveur SMTP pour l'envoi d'emails depuis l'application."})]}),e.jsxs(H,{defaultValue:"config",className:"w-full",children:[e.jsxs(J,{className:"grid w-full grid-cols-3",children:[e.jsx(F,{value:"config",children:"Configuration du serveur"}),e.jsx(F,{value:"notifications",children:"Notifications"}),e.jsx(F,{value:"test",children:"Test d'envoi"})]}),e.jsx(P,{value:"config",children:e.jsxs(C,{children:[e.jsxs(S,{children:[e.jsx(b,{children:"Paramètres du serveur SMTP"}),e.jsx(w,{children:"Configurez la connexion au serveur de messagerie pour les communications par email."})]}),e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[e.jsx(t,{htmlFor:"smtp-enabled",className:"flex items-center space-x-2",children:e.jsx("span",{children:"Activer le service d'email"})}),e.jsx(q,{id:"smtp-enabled",checked:a.enabled,onCheckedChange:s=>o({...a,enabled:s})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"host",children:"Serveur SMTP"}),e.jsx(c,{id:"host",placeholder:"smtp.example.com",value:a.host,onChange:s=>o({...a,host:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"port",children:"Port"}),e.jsx(c,{id:"port",type:"number",placeholder:"587",value:a.port.toString(),onChange:s=>o({...a,port:parseInt(s.target.value)||587})})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(t,{htmlFor:"secure",children:"Connexion sécurisée (SSL/TLS)"}),e.jsx(q,{id:"secure",checked:a.secure,onCheckedChange:s=>o({...a,secure:s})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Authentification"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"auth-user",children:"Nom d'utilisateur"}),e.jsx(c,{id:"auth-user",placeholder:"user@example.com",value:a.auth.user,onChange:s=>o({...a,auth:{...a.auth,user:s.target.value}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"auth-pass",children:"Mot de passe"}),e.jsx(c,{id:"auth-pass",type:"password",placeholder:"••••••••",value:a.auth.pass,onChange:s=>o({...a,auth:{...a.auth,pass:s.target.value}})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"defaultFrom",children:"Adresse d'expéditeur par défaut"}),e.jsx(c,{id:"defaultFrom",placeholder:"no-reply@raccordementelec.fr",value:a.defaultFrom,onChange:s=>o({...a,defaultFrom:s.target.value})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cette adresse sera utilisée comme expéditeur par défaut pour tous les emails"})]})]})]}),e.jsx(T,{className:"flex justify-end",children:e.jsx(N,{onClick:I,disabled:j.isPending,children:j.isPending?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Enregistrer la configuration"]})})})]})}),e.jsx(P,{value:"notifications",children:e.jsxs(C,{children:[e.jsxs(S,{children:[e.jsx(b,{children:"Configuration des notifications"}),e.jsx(w,{children:"Configurez les adresses email pour les notifications du système."})]}),e.jsx(E,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(t,{htmlFor:"notification-email",className:"flex items-center space-x-2",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:"Adresse email pour les notifications de nouvelles demandes"})]}),e.jsx(c,{id:"notification-email",placeholder:"admin@raccordementelec.fr",value:p,onChange:s=>M(s.target.value)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cette adresse recevra les notifications lors de la soumission de nouvelles demandes de service."})]})}),e.jsx(T,{className:"flex justify-end",children:e.jsx(N,{onClick:Q,disabled:v.isPending||G,children:v.isPending?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Enregistrer l'adresse"]})})})]})}),e.jsx(P,{value:"test",children:e.jsxs(C,{children:[e.jsxs(S,{children:[e.jsx(b,{children:"Tester la configuration"}),e.jsx(w,{children:"Envoyez un email de test pour vérifier que la configuration fonctionne correctement."})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"test-email",children:"Envoyer un test à"}),e.jsx(c,{id:"test-email",placeholder:"destinataire@example.com",value:r.to,onChange:s=>f({...r,to:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"test-subject",children:"Sujet"}),e.jsx(c,{id:"test-subject",placeholder:"Test de configuration SMTP",value:r.subject,onChange:s=>f({...r,subject:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"test-message",children:"Message"}),e.jsx("textarea",{id:"test-message",className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Contenu de l'email de test",value:r.message,onChange:s=>f({...r,message:s.target.value})})]})]}),e.jsxs(T,{className:"flex justify-between",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a.enabled?"":"Le service d'email est désactivé. Activez-le dans l'onglet Configuration."}),e.jsx(N,{onClick:O,disabled:g.isPending||!a.enabled||!r.to,children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"mr-2 h-4 w-4 animate-spin"}),"Envoi en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),"Envoyer l'email de test"]})})]})]})})]})]})})}export{he as default};
