const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-Cg6ZA407.js","assets/index-CpDjrPge.js","assets/index-BvZEsLUT.css"])))=>i.map(i=>d[i]);
import{c as Ve,a as Ne,j as e,L as me,B as C,r as h,aP as Ts,aG as Ss,aD as es,aF as ve,aH as Oe,aI as Le,aE as _s,aJ as As,aK as Rs,J as ss,d as Ps,t as ks,e as ze,l as te,X as $e,F as Is,f as _,g as A,h as R,i as P,Y as ae,k,I as D,z as ee,A as se,D as ne,E as re,G as u,af as ns,o as Ls,s as V,H as Z,cx as Y,v as Fe,y as rs,aC as ie,ad as $s,M as Fs,P as Ms,_ as Ze,N as qs}from"./index-CpDjrPge.js";import{a as ke}from"./use-auth-Cwl-QG43.js";import{C as Vs,D as Os,p as zs,q as Bs,x as je,v as Ie,r as K,y as Gs,A as Ds,U as Us,z as Ks}from"./admin-layout-DX0Kk5HQ.js";import{C as pe,d as xe,a as Me,b as qe,c as Ws,e as Hs}from"./card-kwaVVhdJ.js";import{B as W,c as ts,R as Qs,I as Js}from"./use-mobile-BMh-vbEF.js";import{T as as,a as is,b as Q,c as J}from"./tabs-EStKKK4R.js";import{L as y}from"./schema-CGgaqi18.js";import{A as Xs}from"./appointment-modal-KKQPUzN8.js";import{C as Ys}from"./circle-x-8Zuf0VT4.js";import{T as ls}from"./triangle-alert-BXPVoVSW.js";import{D as cs}from"./download-D6bI144q.js";import{F as Zs}from"./file-text-CPAW-xf3.js";import{S as en}from"./search-BlnP3isV.js";import{P as sn}from"./plus-BXc0ACAZ.js";import{P as nn}from"./phone-call-DMI0G7py.js";import{I as rn}from"./info-DSBVwFh4.js";import"./log-out-CQjzW_NC.js";import"./credit-card-dLoa9KgF.js";import"./settings-DcDHKTJ-.js";import"./separator-D63b-bg3.js";import"./external-link-CKWtTz9q.js";import"./calendar-uRIXP-gn.js";import"./endOfMonth-UuFr-Cnz.js";import"./isBefore-Ct2Ldtty.js";import"./popover-CKBAvtiP.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=Ve("CircleArrowRight",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const an=Ve("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ln=Ve("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);function Be({leadsLoading:s,incompleteLeadsData:t,currentPage:i,goToPage:c,goToPreviousPage:p,goToNextPage:o,openDetailsDialog:a,openAssignDialog:m,title:x="Leads incomplets",description:g="Formulaires partiellement remplis par les utilisateurs"}){return Ne(),e.jsx(e.Fragment,{children:s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(me,{className:"h-8 w-8 animate-spin text-blue-600"})}):!(t!=null&&t.leads)||t.leads.length===0?e.jsx(pe,{children:e.jsx(xe,{className:"py-10 text-center",children:e.jsxs("p",{className:"text-muted-foreground mb-4",children:["Aucun ",x.toLowerCase()," trouv√©."]})})}):e.jsxs(pe,{children:[e.jsxs(Me,{className:"pb-1",children:[e.jsx(qe,{children:x}),e.jsx(Ws,{children:g})]}),e.jsx(xe,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"R√©f√©rence"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Client"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Source"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"√âtape"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium",children:"Date"}),e.jsx("th",{className:"text-right py-3 px-2 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:t.leads.map(n=>{const f=new Date(n.createdAt).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});return e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsxs("td",{className:"py-3 px-2",children:[e.jsx("div",{className:"font-mono text-xs text-blue-600",children:n.referenceNumber||n.reference_number||`#${n.id}`}),n.sessionToken&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Session: ",n.sessionToken.substring(0,8),"..."]})]}),e.jsxs("td",{className:"py-3 px-2",children:[e.jsx("div",{className:"font-medium",children:n.firstName||n.lastName?`${n.firstName||""} ${n.lastName||""}`.trim():n.name?n.name:n.email?`<${n.email}>`:"Non renseign√©"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[n.email||"Email non fourni",n.phone&&e.jsxs("span",{className:"ml-2 text-blue-600",children:["‚Ä¢ ",n.phone]})]}),n.clientType&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:n.clientType==="particulier"?"Particulier":n.clientType==="professionnel"?"Professionnel":n.clientType})})]}),e.jsxs("td",{className:"py-3 px-2",children:[n.referenceNumber&&n.referenceNumber.includes("LEAD-")?e.jsx(W,{variant:"outline",className:"bg-blue-50 text-blue-700 hover:bg-blue-100",children:"üìß Email"}):e.jsx(W,{variant:"outline",className:"bg-green-50 text-green-700 hover:bg-green-100",children:"üåê Web"}),n.serviceType&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:n.serviceType==="electricity"?"√âlectricit√©":n.serviceType==="photovoltaic"?"Photovolta√Øque":n.serviceType})]}),e.jsx("td",{className:"py-3 px-2",children:n.completedSteps===3?e.jsx(W,{variant:"outline",className:"bg-green-50 text-green-700 hover:bg-green-100",children:"Complet ‚úì"}):e.jsxs(W,{variant:"outline",children:["√âtape ",Math.max(1,n.completedSteps||1),"/3"]})}),e.jsx("td",{className:"py-3 px-2",children:n.status?e.jsxs(W,{variant:"secondary",className:`
                              ${n.status===y.INTERESTED?"bg-green-100 text-green-800 hover:bg-green-200":""}
                              ${n.status===y.NOT_INTERESTED?"bg-red-100 text-red-800 hover:bg-red-200":""}
                              ${n.status===y.NO_RESPONSE?"bg-amber-100 text-amber-800 hover:bg-amber-200":""}
                              ${n.status===y.CALLBACK_SCHEDULED?"bg-blue-100 text-blue-800 hover:bg-blue-200":""}
                              ${n.status===y.NEW||!n.status?"bg-gray-100 text-gray-800 hover:bg-gray-200":""}
                            `,children:[n.status===y.INTERESTED&&"Int√©ress√©",n.status===y.NOT_INTERESTED&&"Non int√©ress√©",n.status===y.NO_RESPONSE&&"Sans r√©ponse",n.status===y.CALLBACK_SCHEDULED&&"Rappel programm√©",(n.status===y.NEW||!n.status)&&"Nouveau"]}):e.jsx(W,{variant:"secondary",className:"bg-gray-100 text-gray-800 hover:bg-gray-200",children:"Nouveau"})}),e.jsx("td",{className:"py-3 px-2 text-muted-foreground text-xs",children:f}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[n.phone&&e.jsx(C,{variant:"ghost",size:"icon",title:"WhatsApp",onClick:()=>{let r=n.phone.replace(/\s+/g,"");r.startsWith("0")?r="+33"+r.substring(1):r.startsWith("+")||(r="+33"+r);const v=`Bonjour ${n.firstName||n.lastName?`${n.firstName||""} ${n.lastName||""}`.trim():n.name||"Client"}, nous avons bien re√ßu votre demande de raccordement √©lectrique. L'√©quipe Portail-Electricite.com souhaite vous contacter pour finaliser votre dossier.`;window.open(`https://wa.me/${r}?text=${encodeURIComponent(v)}`,"_blank")},className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:e.jsx("svg",{viewBox:"0 0 24 24",className:"h-4 w-4",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M17.6 6.32A7.85 7.85 0 0 0 12.025 4c-4.4 0-7.975 3.58-7.975 7.98a8.06 8.06 0 0 0 1.065 4.02L4 20l4.1-1.08a7.88 7.88 0 0 0 3.775.965h.004c4.4 0 7.975-3.58 7.975-7.98a8.05 8.05 0 0 0-2.254-5.585zM12.025 18.37h-.003a6.58 6.58 0 0 1-3.335-.92l-.24-.144-2.48.652.66-2.425-.156-.25a6.56 6.56 0 0 1-1.01-3.505 6.48 6.48 0 0 1 6.565-6.56c1.75 0 3.4.685 4.65 1.925a6.565 6.565 0 0 1 1.935 4.66c-.005 3.64-2.965 6.565-6.585 6.565zm3.595-4.92c-.2-.1-1.175-.58-1.36-.65-.18-.065-.315-.1-.445.1-.13.195-.51.645-.62.775-.115.13-.23.145-.43.05-.2-.1-.845-.31-1.605-.995-.595-.535-.995-1.2-1.115-1.4-.115-.2-.01-.31.09-.41.09-.09.2-.235.3-.355.1-.115.135-.2.2-.33.065-.135.035-.25-.015-.35-.05-.1-.445-1.075-.61-1.47-.16-.39-.32-.335-.445-.34-.115-.01-.245-.01-.375-.01s-.345.05-.525.25c-.18.2-.685.67-.685 1.64 0 .97.705 1.905.8 2.035.095.135 1.36 2.075 3.295 2.915 1.94.84 1.94.56 2.29.525.35-.035 1.125-.46 1.285-.91.16-.44.16-.82.115-.9-.05-.075-.18-.12-.38-.21z"})})}),e.jsx(C,{variant:"ghost",size:"icon",title:"Voir les d√©tails",onClick:()=>a(n.id),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]})}),e.jsx(C,{variant:"ghost",size:"icon",title:"Assigner",onClick:()=>m(n.id),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]})})]})})]},n.id)})})]})})}),e.jsxs(Hs,{className:"flex justify-between border-t p-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Affichage de ",(i-1)*20+1,"-",Math.min(i*20,t.pagination.total),"sur ",t.pagination.total," ",x.toLowerCase(),t.pagination.total!==1?"s":""]}),t.pagination.totalPages>1&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{variant:"outline",size:"sm",onClick:p,disabled:i===1,children:"Pr√©c√©dent"}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(t.pagination.totalPages,5)},(n,j)=>{let f;return t.pagination.totalPages<=5||i<=3?f=j+1:i>=t.pagination.totalPages-2?f=t.pagination.totalPages-4+j:f=i-2+j,e.jsx(C,{variant:i===f?"default":"outline",size:"sm",onClick:()=>c(f),children:f},f)})}),e.jsx(C,{variant:"outline",size:"sm",onClick:o,disabled:i>=t.pagination.totalPages,children:"Suivant"})]})]})]})})}function cn({leadsLoading:s,allLeadsData:t,currentPage:i,goToPage:c,goToPreviousPage:p,goToNextPage:o,openDetailsDialog:a,openAssignDialog:m}){return e.jsx(Be,{leadsLoading:s,incompleteLeadsData:t,currentPage:i,goToPage:c,goToPreviousPage:p,goToNextPage:o,openDetailsDialog:a,openAssignDialog:m,title:"Tous les leads",description:"Liste compl√®te de tous les leads du syst√®me"})}function on({leadsLoading:s,newLeadsData:t,currentPage:i,goToPage:c,goToPreviousPage:p,goToNextPage:o,openDetailsDialog:a,openAssignDialog:m}){return e.jsx(Be,{leadsLoading:s,incompleteLeadsData:t,currentPage:i,goToPage:c,goToPreviousPage:p,goToNextPage:o,openDetailsDialog:a,openAssignDialog:m,title:"Nouveaux leads",description:"Leads cr√©√©s dans les derni√®res 24 heures"})}var Ge="Radio",[dn,os]=es(Ge),[mn,pn]=dn(Ge),ds=h.forwardRef((s,t)=>{const{__scopeRadio:i,name:c,checked:p=!1,required:o,disabled:a,value:m="on",onCheck:x,form:g,...n}=s,[j,f]=h.useState(null),r=Oe(t,F=>f(F)),N=h.useRef(!1),v=j?g||!!j.closest("form"):!0;return e.jsxs(mn,{scope:i,checked:p,disabled:a,children:[e.jsx(ve.button,{type:"button",role:"radio","aria-checked":p,"data-state":us(p),"data-disabled":a?"":void 0,disabled:a,value:m,...n,ref:r,onClick:Le(s.onClick,F=>{p||x==null||x(),v&&(N.current=F.isPropagationStopped(),N.current||F.stopPropagation())})}),v&&e.jsx(xs,{control:j,bubbles:!N.current,name:c,value:m,checked:p,required:o,disabled:a,form:g,style:{transform:"translateX(-100%)"}})]})});ds.displayName=Ge;var ms="RadioIndicator",ps=h.forwardRef((s,t)=>{const{__scopeRadio:i,forceMount:c,...p}=s,o=pn(ms,i);return e.jsx(_s,{present:c||o.checked,children:e.jsx(ve.span,{"data-state":us(o.checked),"data-disabled":o.disabled?"":void 0,...p,ref:t})})});ps.displayName=ms;var xn="RadioBubbleInput",xs=h.forwardRef(({__scopeRadio:s,control:t,checked:i,bubbles:c=!0,...p},o)=>{const a=h.useRef(null),m=Oe(a,o),x=As(i),g=Rs(t);return h.useEffect(()=>{const n=a.current;if(!n)return;const j=window.HTMLInputElement.prototype,r=Object.getOwnPropertyDescriptor(j,"checked").set;if(x!==i&&r){const N=new Event("click",{bubbles:c});r.call(n,i),n.dispatchEvent(N)}},[x,i,c]),e.jsx(ve.input,{type:"radio","aria-hidden":!0,defaultChecked:i,...p,tabIndex:-1,ref:m,style:{...p.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});xs.displayName=xn;function us(s){return s?"checked":"unchecked"}var un=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ye="RadioGroup",[hn]=es(ye,[ts,os]),hs=ts(),gs=os(),[gn,jn]=hn(ye),js=h.forwardRef((s,t)=>{const{__scopeRadioGroup:i,name:c,defaultValue:p,value:o,required:a=!1,disabled:m=!1,orientation:x,dir:g,loop:n=!0,onValueChange:j,...f}=s,r=hs(i),N=Ts(g),[v,F]=Ss({prop:o,defaultProp:p??null,onChange:j,caller:ye});return e.jsx(gn,{scope:i,name:c,required:a,disabled:m,value:v,onValueChange:F,children:e.jsx(Qs,{asChild:!0,...r,orientation:x,dir:N,loop:n,children:e.jsx(ve.div,{role:"radiogroup","aria-required":a,"aria-orientation":x,"data-disabled":m?"":void 0,dir:N,...f,ref:t})})})});js.displayName=ye;var fs="RadioGroupItem",Ns=h.forwardRef((s,t)=>{const{__scopeRadioGroup:i,disabled:c,...p}=s,o=jn(fs,i),a=o.disabled||c,m=hs(i),x=gs(i),g=h.useRef(null),n=Oe(t,g),j=o.value===p.value,f=h.useRef(!1);return h.useEffect(()=>{const r=v=>{un.includes(v.key)&&(f.current=!0)},N=()=>f.current=!1;return document.addEventListener("keydown",r),document.addEventListener("keyup",N),()=>{document.removeEventListener("keydown",r),document.removeEventListener("keyup",N)}},[]),e.jsx(Js,{asChild:!0,...m,focusable:!a,active:j,children:e.jsx(ds,{disabled:a,required:o.required,checked:j,...x,...p,name:o.name,ref:n,onCheck:()=>o.onValueChange(p.value),onKeyDown:Le(r=>{r.key==="Enter"&&r.preventDefault()}),onFocus:Le(p.onFocus,()=>{var r;f.current&&((r=g.current)==null||r.click())})})})});Ns.displayName=fs;var fn="RadioGroupIndicator",vs=h.forwardRef((s,t)=>{const{__scopeRadioGroup:i,...c}=s,p=gs(i);return e.jsx(ps,{...p,...c,ref:t})});vs.displayName=fn;var ys=js,bs=Ns,Nn=vs;const Cs=h.forwardRef(({className:s,...t},i)=>e.jsx(ys,{className:ss("grid gap-2",s),...t,ref:i}));Cs.displayName=ys.displayName;const fe=h.forwardRef(({className:s,...t},i)=>e.jsx(bs,{ref:i,className:ss("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Nn,{className:"flex items-center justify-center",children:e.jsx(Vs,{className:"h-2.5 w-2.5 fill-current text-current"})})}));fe.displayName=bs.displayName;const vn=Ls({clientType:Z(["particulier","professionnel","collectivite"],{errorMap:()=>({message:"Veuillez s√©lectionner un type de client"})}),firstName:V().min(1,"Le pr√©nom est requis"),lastName:V().min(1,"Le nom est requis"),email:V().email("Adresse email invalide"),phone:V().regex(/^[0-9]{10}$/,"Le num√©ro doit contenir exactement 10 chiffres"),company:V().optional().or(Y("")),siret:V().optional().or(Y("")),address:V().optional().or(Y("")),addressComplement:V().optional().or(Y("")),postalCode:V().optional().or(Y("")),city:V().optional().or(Y("")),serviceType:Z(["electricity"],{errorMap:()=>({message:"Veuillez s√©lectionner un type de service"})}),requestType:Z(["new_connection","power_upgrade","temporary_connection","relocation","technical_visit","other"]),buildingType:Z(["individual_house","apartment_building","commercial","industrial","agricultural","public","terrain"]).optional(),terrainViabilise:Z(["viabilise","non_viabilise"]).optional(),powerRequired:V().optional(),phaseType:Z(["monophase","triphase"]).optional(),comments:V().optional().or(Y(""))}).refine(s=>!(s.clientType==="professionnel"&&(!s.company||!s.siret)),{message:"La raison sociale et le num√©ro SIRET sont requis pour les professionnels",path:["siret"]});function yn({isOpen:s,onClose:t,onLeadCreated:i}){const{toast:c}=Ne(),[p,o]=h.useState(!1),a=Ps({resolver:ks(vn),defaultValues:{clientType:"particulier",firstName:"",lastName:"",email:"",phone:"",company:"",siret:"",address:"",addressComplement:"",postalCode:"",city:"",serviceType:"electricity",requestType:"new_connection",buildingType:"individual_house",terrainViabilise:"viabilise",powerRequired:"9",phaseType:"monophase",comments:""}}),m=a.watch("clientType"),x=ze({mutationFn:async n=>await(await te("POST","/api/leads/admin-create",n)).json(),onSuccess:n=>{n.success?(c({title:"Lead cr√©√© avec succ√®s",description:`R√©f√©rence: ${n.referenceNumber}`}),i(),t()):c({title:"Erreur",description:n.message||"Une erreur est survenue lors de la cr√©ation du lead",variant:"destructive"})},onError:n=>{c({title:"Erreur",description:n.message||"Une erreur est survenue lors de la cr√©ation du lead",variant:"destructive"})},onSettled:()=>{o(!1)}}),g=async n=>{o(!0),x.mutate(n)};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Cr√©er un nouveau lead"}),e.jsx(C,{variant:"ghost",size:"icon",onClick:t,className:"h-8 w-8 rounded-full",children:e.jsx($e,{className:"h-4 w-4"})})]}),e.jsx(Is,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(g),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Informations du client"}),e.jsx(_,{control:a.control,name:"clientType",render:({field:n})=>e.jsxs(A,{className:"space-y-1",children:[e.jsx(R,{children:"Type de client"}),e.jsx(P,{children:e.jsxs(Cs,{onValueChange:n.onChange,defaultValue:n.value,className:"flex space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fe,{value:"particulier",id:"particulier"}),e.jsx(ae,{htmlFor:"particulier",children:"Particulier"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fe,{value:"professionnel",id:"professionnel"}),e.jsx(ae,{htmlFor:"professionnel",children:"Professionnel"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fe,{value:"collectivite",id:"collectivite"}),e.jsx(ae,{htmlFor:"collectivite",children:"Collectivit√©"})]})]})}),e.jsx(k,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_,{control:a.control,name:"firstName",render:({field:n})=>e.jsxs(A,{children:[e.jsx(R,{children:"Pr√©nom"}),e.jsx(P,{children:e.jsx(D,{placeholder:"Pr√©nom",...n})}),e.jsx(k,{})]})}),e.jsx(_,{control:a.control,name:"lastName",render:({field:n})=>e.jsxs(A,{children:[e.jsx(R,{children:"Nom"}),e.jsx(P,{children:e.jsx(D,{placeholder:"Nom",...n})}),e.jsx(k,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_,{control:a.control,name:"email",render:({field:n})=>e.jsxs(A,{children:[e.jsx(R,{children:"Email"}),e.jsx(P,{children:e.jsx(D,{type:"email",placeholder:"email@exemple.com",...n})}),e.jsx(k,{})]})}),e.jsx(_,{control:a.control,name:"phone",render:({field:n})=>e.jsxs(A,{children:[e.jsx(R,{children:"T√©l√©phone"}),e.jsx(P,{children:e.jsx(D,{placeholder:"0600000000",...n})}),e.jsx(k,{})]})})]}),m==="professionnel"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_,{control:a.control,name:"company",render:({field:n})=>e.jsxs(A,{children:[e.jsx(R,{children:"Raison sociale"}),e.jsx(P,{children:e.jsx(D,{placeholder:"Nom de l'entreprise",...n})}),e.jsx(k,{})]})}),e.jsx(_,{control:a.control,name:"siret",render:({field:n})=>e.jsxs(A,{children:[e.jsx(R,{children:"SIRET"}),e.jsx(P,{children:e.jsx(D,{placeholder:"SIRET",...n})}),e.jsx(k,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Adresse"}),e.jsx(_,{control:a.control,name:"address",render:({field:n})=>e.jsxs(A,{children:[e.jsx(R,{children:"Adresse"}),e.jsx(P,{children:e.jsx(D,{placeholder:"Num√©ro et nom de rue",...n})}),e.jsx(k,{})]})}),e.jsx(_,{control:a.control,name:"addressComplement",render:({field:n})=>e.jsxs(A,{children:[e.jsx(R,{children:"Compl√©ment d'adresse"}),e.jsx(P,{children:e.jsx(D,{placeholder:"Appartement, b√¢timent, etc.",...n})}),e.jsx(k,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_,{control:a.control,name:"postalCode",render:({field:n})=>e.jsxs(A,{children:[e.jsx(R,{children:"Code postal"}),e.jsx(P,{children:e.jsx(D,{placeholder:"00000",...n})}),e.jsx(k,{})]})}),e.jsx(_,{control:a.control,name:"city",render:({field:n})=>e.jsxs(A,{children:[e.jsx(R,{children:"Ville"}),e.jsx(P,{children:e.jsx(D,{placeholder:"Ville",...n})}),e.jsx(k,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"D√©tails techniques"}),e.jsx(_,{control:a.control,name:"requestType",render:({field:n})=>e.jsxs(A,{children:[e.jsx(R,{children:"Type de demande"}),e.jsxs(ee,{onValueChange:n.onChange,defaultValue:n.value,children:[e.jsx(P,{children:e.jsx(se,{children:e.jsx(ne,{placeholder:"S√©lectionner un type de demande"})})}),e.jsxs(re,{children:[e.jsx(u,{value:"new_connection",children:"Nouveau raccordement"}),e.jsx(u,{value:"power_upgrade",children:"Augmentation de puissance"}),e.jsx(u,{value:"temporary_connection",children:"Raccordement provisoire"}),e.jsx(u,{value:"relocation",children:"D√©placement d'ouvrage"}),e.jsx(u,{value:"technical_visit",children:"Visite technique"}),e.jsx(u,{value:"other",children:"Autre"})]})]}),e.jsx(k,{})]})}),e.jsx(_,{control:a.control,name:"buildingType",render:({field:n})=>e.jsxs(A,{children:[e.jsx(R,{children:"Type de b√¢timent"}),e.jsxs(ee,{onValueChange:n.onChange,defaultValue:n.value,children:[e.jsx(P,{children:e.jsx(se,{children:e.jsx(ne,{placeholder:"S√©lectionner un type de b√¢timent"})})}),e.jsxs(re,{children:[e.jsx(u,{value:"individual_house",children:"Maison individuelle"}),e.jsx(u,{value:"apartment_building",children:"Immeuble collectif"}),e.jsx(u,{value:"commercial",children:"Local commercial"}),e.jsx(u,{value:"industrial",children:"Site industriel"}),e.jsx(u,{value:"agricultural",children:"Exploitation agricole"}),e.jsx(u,{value:"public",children:"√âtablissement public"}),e.jsx(u,{value:"terrain",children:"Terrain"})]})]}),e.jsx(k,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(_,{control:a.control,name:"powerRequired",render:({field:n})=>e.jsxs(A,{children:[e.jsx(R,{children:"Puissance demand√©e (kVA)"}),e.jsxs(ee,{onValueChange:n.onChange,defaultValue:n.value,children:[e.jsx(P,{children:e.jsx(se,{children:e.jsx(ne,{placeholder:"Choisir une puissance"})})}),e.jsxs(re,{children:[e.jsx(u,{value:"3",children:"3 kVA"}),e.jsx(u,{value:"6",children:"6 kVA"}),e.jsx(u,{value:"9",children:"9 kVA"}),e.jsx(u,{value:"12",children:"12 kVA"}),e.jsx(u,{value:"15",children:"15 kVA"}),e.jsx(u,{value:"18",children:"18 kVA"}),e.jsx(u,{value:"24",children:"24 kVA"}),e.jsx(u,{value:"30",children:"30 kVA"}),e.jsx(u,{value:"36",children:"36 kVA"}),e.jsx(u,{value:"beyond",children:"Plus de 36 kVA"})]})]}),e.jsx(k,{})]})}),e.jsx(_,{control:a.control,name:"phaseType",render:({field:n})=>e.jsxs(A,{children:[e.jsx(R,{children:"Type de phase"}),e.jsxs(ee,{onValueChange:n.onChange,defaultValue:n.value,children:[e.jsx(P,{children:e.jsx(se,{children:e.jsx(ne,{placeholder:"Choisir un type de phase"})})}),e.jsxs(re,{children:[e.jsx(u,{value:"monophase",children:"Monophas√©"}),e.jsx(u,{value:"triphase",children:"Triphas√©"})]})]}),e.jsx(k,{})]})})]}),e.jsx(_,{control:a.control,name:"comments",render:({field:n})=>e.jsxs(A,{children:[e.jsx(R,{children:"Commentaires"}),e.jsx(P,{children:e.jsx(ns,{placeholder:"Informations compl√©mentaires sur la demande",className:"min-h-[100px]",...n})}),e.jsx(k,{})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(C,{variant:"outline",onClick:t,type:"button",children:"Annuler"}),e.jsx(C,{type:"submit",disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"mr-2 h-4 w-4 animate-spin"}),"Cr√©ation..."]}):"Cr√©er le lead"})]})]})})]})}):null}function bn({leadDetails:s}){const t=c=>{if(!c)return"Non renseign√©";try{return new Date(c).toLocaleDateString("fr-FR")}catch{return c}},i=c=>{if(!c)return"Non renseign√©";try{return new Date(c).toLocaleString("fr-FR")}catch{return"Date invalide"}};return e.jsx(pe,{children:e.jsx(xe,{className:"p-0",children:e.jsxs(as,{defaultValue:"step1",className:"p-4",children:[e.jsxs(is,{className:"mb-4",children:[e.jsx(Q,{value:"step1",children:"Informations client"}),e.jsx(Q,{value:"step2",children:"Type de demande"}),e.jsx(Q,{value:"step3",children:"Adresse & technique"}),e.jsx(Q,{value:"step4",children:"Planning & facturation"}),e.jsx(Q,{value:"step5",children:"M√©tadonn√©es"})]}),e.jsxs(J,{value:"step1",className:"border rounded-md p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Informations client"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Type de client:"}),e.jsx("span",{children:s.clientType==="particulier"?"Particulier":s.clientType==="professionnel"?"Professionnel":s.clientType==="collectivite"?"Collectivit√©":"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Nom complet:"}),e.jsx("span",{children:s.firstName||s.lastName?`${s.firstName||""} ${s.lastName||""}`.trim():s.email?`<${s.email}>`:"Non renseign√©"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Email:"}),e.jsx("span",{children:s.email||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"T√©l√©phone:"}),e.jsx("span",{children:s.phone||"Non renseign√©"})]}),s.clientType==="professionnel"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Entreprise:"}),e.jsx("span",{children:s.company||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"SIRET:"}),e.jsx("span",{children:s.siret||"Non renseign√©"})]})]})]})]})]}),e.jsxs(J,{value:"step2",className:"border rounded-md p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Type de demande"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Service:"}),e.jsx("span",{children:s.serviceType==="electricity"?"√âlectricit√©":s.serviceType||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Type:"}),e.jsx("span",{children:s.requestType==="new_connection"?"Nouveau raccordement":s.requestType==="power_upgrade"?"Modification de puissance":s.requestType==="temporary_connection"?"Raccordement temporaire":s.requestType==="relocation"?"D√©placement d'ouvrage":s.requestType==="technical_visit"?"Visite technique":s.requestType==="other"?"Autre":"Non renseign√©"})]}),s.requestType==="other"&&e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Description:"}),e.jsx("span",{children:s.otherRequestTypeDesc||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"B√¢timent:"}),e.jsx("span",{children:s.buildingType==="individual_house"?"Maison individuelle":s.buildingType==="apartment_building"?"Immeuble":s.buildingType==="commercial"?"Local commercial":s.buildingType==="industrial"?"B√¢timent industriel":s.buildingType==="agricultural"?"Exploitation agricole":s.buildingType==="public"?"B√¢timent public":s.buildingType==="terrain"?"Terrain":"Non renseign√©"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[135px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Terrain:"}),e.jsx("span",{children:s.terrainViabilise==="viabilise"?"Terrain viabilis√©":s.terrainViabilise==="non_viabilise"?"Terrain non viabilis√©":"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[135px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"√âtat projet:"}),e.jsx("span",{children:s.projectStatus==="planning"?"En phase de projet":s.projectStatus==="permit_pending"?"Permis d√©pos√©":s.projectStatus==="permit_approved"?"Permis approuv√©":s.projectStatus==="construction_started"?"Construction d√©marr√©e":s.projectStatus==="construction_completed"?"Construction termin√©e":"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[135px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Permis n¬∞:"}),e.jsx("span",{children:s.permitNumber||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[135px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Date permis:"}),e.jsx("span",{children:t(s.permitDeliveryDate)})]})]})]})]}),e.jsxs(J,{value:"step3",className:"border rounded-md p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Adresse & D√©tails techniques"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Adresse:"}),e.jsx("span",{children:s.address||"Non renseign√©"})]}),s.addressComplement&&e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Compl√©ment:"}),e.jsx("span",{children:s.addressComplement})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Ville:"}),e.jsx("span",{children:s.city||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Code postal:"}),e.jsx("span",{children:s.postalCode||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"R√©f. cadastrale:"}),e.jsx("span",{children:s.cadastralReference||"Non renseign√©"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Puissance:"}),e.jsx("span",{children:s.powerRequired?`${s.powerRequired} kVA`:"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Phase:"}),e.jsx("span",{children:s.phaseType==="monophase"?"Monophas√©":s.phaseType==="triphase"?"Triphas√©":"Non renseign√©"})]}),s.hasArchitect&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1 mt-4",children:[e.jsx("span",{className:"text-slate-500 font-medium",children:"Architecte:"}),e.jsx("span",{})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Nom:"}),e.jsx("span",{children:s.architectName||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"T√©l√©phone:"}),e.jsx("span",{children:s.architectPhone||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Email:"}),e.jsx("span",{children:s.architectEmail||"Non renseign√©"})]})]})]})]})]}),e.jsxs(J,{value:"step4",className:"border rounded-md p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"Planning et facturation"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Date souhait√©e:"}),e.jsx("span",{children:t(s.desiredCompletionDate)})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"D√©lai connexion:"}),e.jsx("span",{children:s.connectionDelay||"Non sp√©cifi√©"})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Achat imm√©diat:"}),e.jsx("span",{children:s.immediatePurchaseAccepted?"Oui":"Non"})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"CGV accept√©es:"}),e.jsx("span",{children:s.termsAccepted?"Oui":"Non"})]})]}),e.jsxs("div",{className:"space-y-2",children:[(s.billingAddress||s.billingCity||s.billingPostalCode)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1 mt-1",children:[e.jsx("span",{className:"text-slate-500 font-medium",children:"Adresse de facturation:"}),e.jsx("span",{})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Adresse:"}),e.jsx("span",{children:s.billingAddress||"Identique √† l'adresse du projet"})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Ville:"}),e.jsx("span",{children:s.billingCity||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Code postal:"}),e.jsx("span",{children:s.billingPostalCode||"Non renseign√©"})]})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1 mt-4",children:[e.jsx("span",{className:"text-slate-500",children:"Commentaires:"}),e.jsx("span",{className:"whitespace-pre-line",children:s.comments||"Aucun commentaire"})]})]})]})]}),e.jsxs(J,{value:"step5",className:"border rounded-md p-4",children:[e.jsx("h3",{className:"font-medium mb-3",children:"M√©tadonn√©es"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"R√©f√©rence:"}),e.jsx("span",{className:"font-medium",children:s.referenceNumber||"Non g√©n√©r√©e"})]}),e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Prix standard:"}),e.jsx("span",{className:"font-medium",children:"129,80 ‚Ç¨ TTC"})]}),e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"TVA:"}),e.jsx("span",{className:"font-medium",children:s.vatRate||"20%"})]}),e.jsxs("div",{className:"grid grid-cols-[140px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Statut:"}),e.jsx("span",{className:"font-medium",children:s.isCompleted?e.jsxs("span",{className:"text-green-600 flex items-center",children:[e.jsx(Fe,{className:"h-4 w-4 mr-1"})," Compl√©t√©"]}):e.jsxs("span",{className:"text-amber-600 flex items-center",children:[e.jsx(rs,{className:"h-4 w-4 mr-1"})," En progression"]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Cr√©√© le:"}),e.jsx("span",{children:i(s.createdAt)})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Mis √† jour le:"}),e.jsx("span",{children:i(s.updatedAt)})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Derni√®re activit√©:"}),e.jsx("span",{children:i(s.lastTouchedAt)})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Progression:"}),e.jsxs("span",{children:[s.completedSteps,"/5 √©tapes"]})]}),e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Converti en demande:"}),e.jsx("span",{children:s.convertedToRequest?"Oui":"Non"})]}),s.ipAddress&&e.jsxs("div",{className:"grid grid-cols-[150px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"IP:"}),e.jsx("span",{className:"font-mono text-xs",children:s.ipAddress})]})]})]})]})]})})})}function Cn({leadId:s,phone:t,email:i,firstName:c,lastName:p,currentStatus:o,hasContract:a,onRequestAppointment:m,onExportPDF:x}){const{toast:g}=Ne(),n=ze({mutationFn:async({leadId:r,status:N})=>await(await te("PATCH",`/api/leads/${r}/status`,{status:N})).json(),onSuccess:(r,N)=>{const v={[y.INTERESTED]:"Int√©ress√© (OK)",[y.NOT_INTERESTED]:"Pas int√©ress√©",[y.NO_RESPONSE]:"Pas de r√©ponse (NRP)",[y.CALLBACK_SCHEDULED]:"Rappel programm√©"};g({title:"Statut mis √† jour",description:`Le lead a √©t√© marqu√© comme : ${v[N.status]||N.status}`}),ie.invalidateQueries({queryKey:["/api/leads"]}),ie.invalidateQueries({queryKey:["/api/leads/incomplete"]})},onError:r=>{g({title:"Erreur",description:`Impossible de mettre √† jour le statut: ${r.message}`,variant:"destructive"})}}),j=r=>{n.mutate({leadId:s,status:r})},f=()=>{if(!t){g({title:"Aucun num√©ro de t√©l√©phone",description:"Ce lead n'a pas de num√©ro de t√©l√©phone renseign√©.",variant:"destructive"});return}let r=t.replace(/[\s()\-+]/g,"");!r.startsWith("33")&&r.startsWith("0")&&(r="33"+r.substring(1)),window.open(`https://wa.me/${r}`,"_blank")};return e.jsxs(Os,{children:[e.jsx(zs,{asChild:!0,children:e.jsxs(C,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:[e.jsx(an,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Actions"})]})}),e.jsxs(Bs,{align:"end",className:"w-[220px]",children:[e.jsx(je,{children:"Actions rapides"}),e.jsx(Ie,{}),e.jsx(je,{className:"text-xs text-muted-foreground font-normal",children:"Statut"}),e.jsxs(K,{className:o===y.INTERESTED?"bg-blue-50":"",onClick:()=>j(y.INTERESTED),children:[e.jsx(Fe,{className:"mr-2 h-4 w-4 text-green-500"})," Int√©ress√© (OK)"]}),e.jsxs(K,{className:o===y.NOT_INTERESTED?"bg-blue-50":"",onClick:()=>j(y.NOT_INTERESTED),children:[e.jsx(Ys,{className:"mr-2 h-4 w-4 text-red-500"})," Pas int√©ress√©"]}),e.jsxs(K,{className:o===y.NO_RESPONSE?"bg-blue-50":"",onClick:()=>j(y.NO_RESPONSE),children:[e.jsx(ls,{className:"mr-2 h-4 w-4 text-amber-500"})," Pas de r√©ponse (NRP)"]}),e.jsxs(K,{className:o===y.CALLBACK_SCHEDULED?"bg-blue-50":"",onClick:m,children:[e.jsx(rs,{className:"mr-2 h-4 w-4 text-blue-500"})," Programmer rappel"]}),e.jsxs(K,{className:o===y.PROCESS_COMPLETE?"bg-green-50":"",onClick:()=>j(y.PROCESS_COMPLETE),children:[e.jsx(Fe,{className:"mr-2 h-4 w-4 text-green-600"})," 5/5 vert (complet)"]}),e.jsx(Ie,{}),e.jsx(je,{className:"text-xs text-muted-foreground font-normal",children:"Communication"}),e.jsxs(Gs,{children:[e.jsxs(K,{onClick:f,children:[e.jsx($s,{className:"mr-2 h-4 w-4 text-green-600"})," WhatsApp"]}),e.jsxs(K,{onClick:()=>{if(!i){g({title:"Aucune adresse email",description:"Ce lead n'a pas d'adresse email renseign√©e.",variant:"destructive"});return}const r="Votre demande de raccordement",N=`Bonjour ${c||""} ${p||""},

Nous avons bien re√ßu votre demande de raccordement. 

Cordialement,
L'√©quipe Raccordement`;window.location.href=`mailto:${i}?subject=${encodeURIComponent(r)}&body=${encodeURIComponent(N)}`},children:[e.jsx(Fs,{className:"mr-2 h-4 w-4 text-blue-600"})," Email"]}),e.jsxs(K,{disabled:!0,children:[e.jsx(Ms,{className:"mr-2 h-4 w-4"})," Appeler"]})]}),e.jsx(Ie,{}),e.jsx(je,{className:"text-xs text-muted-foreground font-normal",children:"Documents"}),e.jsxs(K,{onClick:x,disabled:!x,children:[e.jsx(cs,{className:"mr-2 h-4 w-4"})," Exporter PDF"]}),e.jsxs(K,{className:a?"bg-green-50":"",onClick:()=>{a?te("GET",`/api/contracts/${s}`).then(r=>r.json()).then(r=>{if(r.success&&r.url)window.open(r.url,"_blank");else throw new Error(r.message||"Erreur lors de la r√©cup√©ration du contrat")}).catch(r=>{g({title:"Erreur",description:`Impossible d'ouvrir le contrat: ${r.message}`,variant:"destructive"})}):te("POST",`/api/contracts/${s}/generate`).then(r=>r.json()).then(r=>{if(r.success)g({title:"Contrat g√©n√©r√©",description:r.message}),r.url&&window.open(r.url,"_blank"),ie.invalidateQueries({queryKey:["/api/leads"]});else throw new Error(r.message||"Erreur inconnue")}).catch(r=>{g({title:"Erreur",description:`Impossible de g√©n√©rer le contrat: ${r.message}`,variant:"destructive"})})},children:[e.jsx(Zs,{className:`mr-2 h-4 w-4 ${a?"text-green-600":""}`}),a?"Voir contrat":"G√©n√©rer contrat"]})]})]})}const wn=async s=>{try{const t=["ID","R√©f√©rence","Nom","Email","T√©l√©phone","Statut","Type de service","Date de cr√©ation"],i=[];i.push(t.join(","));for(const m of s){const x=[m.id,m.referenceNumber||"",`"${m.firstName&&m.lastName?`${m.firstName} ${m.lastName}`:m.name||"Non sp√©cifi√©"}"`,`"${m.email||""}"`,`"${m.phone||""}"`,`"${m.status||"Nouveau"}"`,`"${m.serviceType||""}"`,new Date(m.createdAt).toLocaleDateString("fr-FR")];i.push(x.join(","))}const c=i.join(`
`),p=new Blob([c],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(p),a=document.createElement("a");a.setAttribute("href",o),a.setAttribute("download",`leads_export_${new Date().toISOString().slice(0,10)}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(t){throw console.error("Erreur lors de l'exportation CSV:",t),new Error("Impossible d'exporter les leads au format CSV.")}},En=async s=>{try{const t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="800px",t.style.padding="20px",t.style.backgroundColor="white",t.style.fontFamily="Arial, sans-serif";const i=document.createElement("div");i.style.display="flex",i.style.justifyContent="space-between",i.style.alignItems="center",i.style.marginBottom="20px",i.style.padding="10px",i.style.borderBottom="1px solid #ddd";const c=document.createElement("div");c.style.fontWeight="bold",c.style.fontSize="24px",c.style.color="#3b82f6",c.textContent="Raccordement √âlectrique";const p=document.createElement("div");p.textContent=`Date: ${new Date().toLocaleDateString("fr-FR")}`,p.style.color="#666",i.appendChild(c),i.appendChild(p);const o=document.createElement("div");o.style.padding="15px";const a=document.createElement("h1");a.textContent="Fiche Lead",a.style.fontSize="20px",a.style.color="#333",a.style.marginBottom="15px";const m=document.createElement("div");m.style.marginBottom="20px";const x=document.createElement("div");x.style.marginBottom="15px",x.style.padding="10px",x.style.backgroundColor="#f8fafc",x.style.borderRadius="5px";const g=document.createElement("div");g.textContent="Identification",g.style.fontWeight="bold",g.style.marginBottom="5px",g.style.color="#3b82f6";const n=document.createElement("div");n.style.display="flex",n.style.justifyContent="space-between";const j=document.createElement("div");j.textContent=`ID: ${s.id}`,j.style.fontSize="14px";const f=document.createElement("div");f.textContent=`Cr√©√© le: ${new Date(s.createdAt).toLocaleString("fr-FR")}`,f.style.fontSize="14px",n.appendChild(j),n.appendChild(f),x.appendChild(g),x.appendChild(n);const r=document.createElement("div");r.style.marginBottom="15px",r.style.padding="10px",r.style.backgroundColor="#f8fafc",r.style.borderRadius="5px";const N=document.createElement("div");N.textContent="Informations client",N.style.fontWeight="bold",N.style.marginBottom="10px",N.style.color="#3b82f6",r.appendChild(N);const v=document.createElement("div");v.style.display="grid",v.style.gridTemplateColumns="1fr 1fr",v.style.gap="10px";const F=[{label:"Nom complet",value:`${s.firstName||""} ${s.lastName||""}`.trim()||"Non renseign√©"},{label:"Email",value:s.email||"Non renseign√©"},{label:"T√©l√©phone",value:s.phone||"Non renseign√©"},{label:"Type de client",value:s.clientType==="particulier"?"Particulier":s.clientType==="professionnel"?"Professionnel":"Non renseign√©"}];s.clientType==="professionnel"&&F.push({label:"Entreprise",value:s.company||"Non renseign√©"},{label:"SIRET",value:s.siret||"Non renseign√©"}),F.forEach(q=>{const w=document.createElement("div");w.style.marginBottom="5px";const z=document.createElement("div");z.textContent=q.label,z.style.fontSize="12px",z.style.color="#666";const B=document.createElement("div");B.textContent=q.value,B.style.fontSize="14px",w.appendChild(z),w.appendChild(B),v.appendChild(w)}),r.appendChild(v);const O=document.createElement("div");O.style.marginBottom="15px",O.style.padding="10px",O.style.backgroundColor="#f8fafc",O.style.borderRadius="5px";const E=document.createElement("div");E.textContent="Informations projet",E.style.fontWeight="bold",E.style.marginBottom="10px",E.style.color="#3b82f6",O.appendChild(E);const X=document.createElement("div");X.style.display="grid",X.style.gridTemplateColumns="1fr 1fr",X.style.gap="10px",[{label:"Adresse",value:s.address||"Non renseign√©"},{label:"Code postal",value:s.postalCode||"Non renseign√©"},{label:"Ville",value:s.city||"Non renseign√©"},{label:"Type de b√¢timent",value:s.buildingType||"Non renseign√©"}].forEach(q=>{const w=document.createElement("div");w.style.marginBottom="5px";const z=document.createElement("div");z.textContent=q.label,z.style.fontSize="12px",z.style.color="#666";const B=document.createElement("div");B.textContent=q.value,B.style.fontSize="14px",w.appendChild(z),w.appendChild(B),X.appendChild(w)}),O.appendChild(X);const T=document.createElement("div");T.style.marginTop="30px",T.style.borderTop="1px solid #ddd",T.style.paddingTop="10px",T.style.fontSize="12px",T.style.color="#666",T.style.textAlign="center",T.textContent="Document g√©n√©r√© automatiquement - Raccordement √âlectrique ¬© 2025",m.appendChild(x),m.appendChild(r),m.appendChild(O),o.appendChild(a),o.appendChild(m),o.appendChild(T),t.appendChild(i),t.appendChild(o),document.body.appendChild(t);const be=(await Ze(async()=>{const{default:q}=await import("./html2canvas.esm-CBrSDip1.js");return{default:q}},[])).default,{jsPDF:ce}=await Ze(async()=>{const{jsPDF:q}=await import("./jspdf.es.min-Cg6ZA407.js").then(w=>w.j);return{jsPDF:q}},__vite__mapDeps([0,1,2])),M=await be(t);document.body.removeChild(t);const ue=M.toDataURL("image/jpeg",1),U=new ce("p","mm","a4"),oe=U.internal.pageSize.getWidth(),l=U.internal.pageSize.getHeight(),he=M.width,Ce=M.height,ge=oe/he,H=Ce*ge;if(U.addImage(ue,"JPEG",0,0,oe,H),H>l){const q=Math.ceil(H/l);for(let w=1;w<q;w++)U.addPage(),U.addImage(ue,"JPEG",0,-(w*l),oe,H)}const de=`Lead_${s.id}_${(s.firstName||"")+(s.lastName||"")}_${new Date().toISOString().split("T")[0]}.pdf`;return U.save(de),de}catch(t){throw console.error("Erreur lors de la g√©n√©ration du PDF:",t),t}};function Yn(){var Ke,We,He,Qe,Je,Xe;const{toast:s}=Ne(),[t,i]=h.useState(""),[c,p]=h.useState("all"),[o,a]=h.useState(1),[m,x]=h.useState(!1),[g,n]=h.useState(!1),[j,f]=h.useState(!1),[r,N]=h.useState(!1),[v,F]=h.useState(null),O=20,{data:E,isLoading:X,refetch:le}=ke({queryKey:["/api/leads/incomplete",{page:o,limit:O}],queryFn:async({queryKey:d})=>{const[b,I]=d,{page:S,limit:L}=I,G=await fetch(`${b}?page=${S}&limit=${L}`);if(!G.ok)throw new Error("Erreur lors de la r√©cup√©ration des leads");return G.json()},enabled:c==="incomplete"}),{data:T,isLoading:be,refetch:ce}=ke({queryKey:["/api/leads/all",{page:o,limit:O}],queryFn:async({queryKey:d})=>{const[b,I]=d,{page:S,limit:L}=I,G=await fetch(`/api/leads?page=${S}&limit=${L}`);if(!G.ok)throw new Error("Erreur lors de la r√©cup√©ration des leads");const $=await G.json();return $.success&&Array.isArray($.leads)?$:Array.isArray($)?{success:!0,leads:$,pagination:{total:$.length,totalPages:Math.ceil($.length/L),currentPage:S,perPage:L}}:(console.error("Format de donn√©es inattendu:",$),{success:!0,leads:[],pagination:{total:0,totalPages:1,currentPage:S,perPage:L}})},enabled:c==="all"}),{data:M,isLoading:ue,refetch:U}=ke({queryKey:["/api/leads/new",{page:o,limit:O}],queryFn:async({queryKey:d})=>{const[b,I]=d,{page:S,limit:L}=I,G=await fetch(`/api/leads?page=${S}&limit=${L}`);if(!G.ok)throw new Error("Erreur lors de la r√©cup√©ration des nouveaux leads");const $=await G.json();let Ae=[];if($.success&&Array.isArray($.leads))Ae=$.leads;else if(Array.isArray($))Ae=$;else return console.error("Format de donn√©es inattendu pour les nouveaux leads:",$),{success:!0,leads:[],pagination:{total:0,totalPages:1,currentPage:S,perPage:L}};const Re=new Date;Re.setDate(Re.getDate()-1);const Pe=Ae.filter(Ye=>Ye.createdAt?new Date(Ye.createdAt)>=Re:!1);return{success:!0,leads:Pe,pagination:{total:Pe.length,totalPages:Math.ceil(Pe.length/L),currentPage:S,perPage:L}}},enabled:c==="new"});h.useEffect(()=>{a(1)},[c]),h.useEffect(()=>{c==="incomplete"?le():c==="all"?ce():c==="new"&&U()},[o,c,le,ce,U]);const oe=async d=>{if(!d)return null;try{const b=await fetch(`/api/leads/${d}`);if(!b.ok)throw new Error("Erreur lors de la r√©cup√©ration des d√©tails du lead");return await b.json()}catch(b){return console.error("Erreur de r√©cup√©ration des d√©tails du lead:",b),null}},[l,he]=h.useState(null),[Ce,ge]=h.useState(!1),[H,de]=h.useState(!1),[q,w]=h.useState(!1);h.useEffect(()=>((async()=>{if(v&&m){ge(!0);const b=await oe(v);he((b==null?void 0:b.lead)||null),ge(!1)}})(),()=>{m||he(null)}),[v,m]);const z=async d=>{if(d)try{de(!0);const I=await(await te("POST",`/api/leads/${d}/convert`,{})).json();I.success?(s({title:"Conversion r√©ussie",description:`Le lead a √©t√© converti en demande #${I.referenceNumber}`}),x(!1),le()):s({title:"Erreur de conversion",description:I.message||"Une erreur est survenue lors de la conversion du lead",variant:"destructive"})}catch(b){s({title:"Erreur",description:b.message||"Une erreur est survenue lors de la conversion du lead",variant:"destructive"})}finally{de(!1)}},B=d=>{F(d),x(!0)},we=d=>{F(d),n(!0)},De=d=>{F(d),N(!0)},Ee=d=>{a(d)},Te=()=>{o>1&&a(o-1)},Se=()=>{const d=c==="incomplete"?E:c==="all"?T:M;d&&o<d.pagination.totalPages&&a(o+1)},_e=ze({mutationFn:async({leadId:d,userId:b,priority:I,note:S})=>await(await te("POST",`/api/leads/${d}/assign`,{userId:b,priority:I,note:S})).json(),onSuccess:d=>{d.success?(s({title:"Lead assign√©",description:d.message||"Le lead a √©t√© assign√© avec succ√®s"}),n(!1),c==="incomplete"&&le(),c==="all"&&ce(),c==="new"&&U()):s({title:"Erreur",description:d.message||"Un probl√®me est survenu lors de l'assignation du lead",variant:"destructive"})},onError:d=>{console.error("Erreur lors de l'assignation du lead:",d),s({title:"Erreur",description:d.message||"Un probl√®me est survenu lors de l'assignation du lead",variant:"destructive"})}}),ws=(d,b,I,S)=>{_e.mutate({leadId:d,userId:b,priority:I,note:S})},Es=async()=>{if(l)try{w(!0),await En(l),s({title:"Exportation r√©ussie",description:"Le PDF a √©t√© g√©n√©r√© et t√©l√©charg√©"})}catch(d){console.error("Erreur lors de l'exportation PDF:",d),s({title:"Erreur d'exportation",description:d.message||"Impossible de g√©n√©rer le PDF",variant:"destructive"})}finally{w(!1)}},Ue={all:((Ke=T==null?void 0:T.pagination)==null?void 0:Ke.total)||0,incomplete:((We=E==null?void 0:E.pagination)==null?void 0:We.total)||0,new:((He=M==null?void 0:M.pagination)==null?void 0:He.total)||0};return e.jsxs(Ds,{title:"Leads",description:"Gestion des leads et prospects",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Leads"}),e.jsx("p",{className:"text-muted-foreground",children:"Gestion des prospects et demandes entrantes"})]}),e.jsxs("div",{className:"flex w-full sm:w-auto items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(en,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(D,{type:"search",placeholder:"Rechercher...",className:"pl-8 w-full sm:w-[300px]",value:t,onChange:d=>i(d.target.value)})]}),e.jsxs(C,{variant:"outline",onClick:async()=>{try{const d=c==="incomplete"?E==null?void 0:E.leads:c==="all"?T==null?void 0:T.leads:M==null?void 0:M.leads;d&&d.length>0?(await wn(d),s({title:"Exportation r√©ussie",description:`${d.length} leads ont √©t√© export√©s au format CSV`})):s({title:"Aucune donn√©e √† exporter",description:"Il n'y a aucun lead √† exporter dans cet onglet",variant:"default"})}catch(d){console.error("Erreur lors de l'exportation CSV:",d),s({title:"Erreur d'exportation",description:d.message||"Impossible d'exporter les leads au format CSV",variant:"destructive"})}},children:[e.jsx(cs,{className:"h-4 w-4 mr-2"}),"Exporter"]}),e.jsxs(C,{onClick:()=>f(!0),children:[e.jsx(sn,{className:"h-4 w-4 mr-2"}),"Nouveau Lead"]})]})]}),e.jsxs(as,{defaultValue:"incomplete",value:c,onValueChange:p,className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs(is,{children:[e.jsxs(Q,{value:"all",className:"relative",children:["Tous",e.jsx(W,{variant:"secondary",className:"ml-2",children:Ue.all})]}),e.jsxs(Q,{value:"incomplete",className:"relative",children:["Incomplets",e.jsx(W,{variant:"secondary",className:"ml-2",children:((Qe=E==null?void 0:E.pagination)==null?void 0:Qe.total)||0})]}),e.jsxs(Q,{value:"new",className:"relative",children:["Nouveaux",e.jsx(W,{variant:"secondary",className:"ml-2",children:Ue.new})]})]})}),e.jsx(J,{value:"all",className:"m-0",children:e.jsx(cn,{leadsLoading:be,allLeadsData:T,currentPage:o,goToPage:Ee,goToPreviousPage:Te,goToNextPage:Se,openDetailsDialog:B,openAssignDialog:we})}),e.jsx(J,{value:"incomplete",className:"m-0",children:e.jsx(Be,{leadsLoading:X,incompleteLeadsData:E,currentPage:o,goToPage:Ee,goToPreviousPage:Te,goToNextPage:Se,openDetailsDialog:B,openAssignDialog:we})}),e.jsx(J,{value:"new",className:"m-0",children:e.jsx(on,{leadsLoading:ue,newLeadsData:M,currentPage:o,goToPage:Ee,goToPreviousPage:Te,goToNextPage:Se,openDetailsDialog:B,openAssignDialog:we})})]})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"D√©tails du lead"}),l&&l.referenceNumber&&e.jsx("p",{className:"text-sm text-muted-foreground font-mono",children:l.referenceNumber})]}),e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>x(!1),className:"h-8 w-8 rounded-full",children:e.jsx($e,{className:"h-4 w-4"})})]}),Ce?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(me,{className:"h-8 w-8 animate-spin text-blue-600"})}):l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4 bg-slate-50 p-3 rounded-md",children:[e.jsxs("div",{className:"flex items-center flex-wrap gap-3",children:[e.jsxs("div",{className:"bg-white px-3 py-1 rounded-full border flex items-center gap-1.5",children:[e.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${l.isCompleted?"bg-green-500":"bg-amber-500"}`}),e.jsx("span",{className:"text-sm font-medium",children:l.isCompleted?"Complet":"Incomplet"})]}),e.jsxs("div",{className:"bg-white px-3 py-1 rounded-full border flex items-center gap-1.5",children:[e.jsx(qs,{className:"h-3.5 w-3.5 text-slate-500"}),e.jsx("span",{className:"text-sm",children:new Date(l.createdAt).toLocaleDateString("fr-FR")})]}),e.jsx("div",{className:"bg-white px-3 py-1 rounded-full border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-xs font-medium mr-1.5",children:"Progression:"}),e.jsxs("span",{className:"text-xs font-medium",children:[Math.max(1,l.completedSteps||1),"/5"]}),e.jsx("div",{className:"ml-2 bg-slate-200 w-16 h-1.5 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-blue-600 h-full",style:{width:`${Math.floor(Math.max(1,l.completedSteps||1)/5*100)}%`}})})]})})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs(C,{variant:"outline",size:"sm",className:"flex-1 sm:flex-auto",onClick:()=>n(!0),children:[e.jsx(Us,{className:"h-4 w-4 mr-1"}),"Assigner"]}),e.jsxs(C,{variant:"outline",size:"sm",className:"flex-1 sm:flex-auto",onClick:()=>De(l.id),children:[e.jsx(nn,{className:"h-4 w-4 mr-1"}),"Nouveau RDV"]}),e.jsx(C,{variant:"default",size:"sm",className:"flex-1 sm:flex-auto",onClick:()=>z(l.id),disabled:H,children:H?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 mr-1 animate-spin"}),"Traitement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(tn,{className:"h-4 w-4 mr-1"}),"Convertir"]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(pe,{children:[e.jsx(Me,{className:"pb-2",children:e.jsx(qe,{className:"text-base font-medium",children:"Informations g√©n√©rales"})}),e.jsxs(xe,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"ID:"}),e.jsx("span",{className:"font-mono",children:l.id})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Cr√©√© le:"}),e.jsx("span",{children:new Date(l.createdAt).toLocaleString("fr-FR")})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Modifi√© le:"}),e.jsx("span",{children:new Date(l.updatedAt).toLocaleString("fr-FR")})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Source:"}),e.jsx("span",{children:l.ipAddress?e.jsx(Ks,{content:l.userAgent,children:e.jsxs("div",{className:"cursor-help flex items-center",children:[((Je=l.geoLocation)==null?void 0:Je.flag)&&e.jsx("span",{className:"mr-2 text-lg","aria-label":`Drapeau ${l.geoLocation.countryName}`,children:l.geoLocation.flag}),l.ipAddress,((Xe=l.geoLocation)==null?void 0:Xe.countryName)&&e.jsxs("span",{className:"ml-2 text-xs text-slate-500",children:["(",l.geoLocation.countryName,")"]})]})}):"Aucune"})]})]})]}),e.jsxs(pe,{children:[e.jsx(Me,{className:"pb-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(qe,{className:"text-base font-medium",children:"Informations de contact"}),e.jsx(Cn,{leadId:l.id,phone:l.phone,email:l.email,firstName:l.firstName,lastName:l.lastName,currentStatus:l.status||"",hasContract:l.hasContract||!1,onRequestAppointment:()=>De(l.id),onExportPDF:Es})]})}),e.jsxs(xe,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Nom:"}),e.jsx("span",{children:l.firstName||l.lastName?`${l.firstName||""} ${l.lastName||""}`.trim():l.email?`<${l.email}>`:"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Email:"}),e.jsx("span",{children:l.email?e.jsx("a",{href:`mailto:${l.email}`,className:"text-blue-600 hover:underline",children:l.email}):"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"T√©l√©phone:"}),e.jsx("span",{children:l.phone?e.jsx("a",{href:`tel:${l.phone}`,className:"text-blue-600 hover:underline",children:l.phone}):"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Type de client:"}),e.jsx("span",{children:l.clientType==="particulier"?"Particulier":l.clientType==="professionnel"?"Professionnel":"Non renseign√©"})]}),l.clientType==="professionnel"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"Entreprise:"}),e.jsx("span",{children:l.company||"Non renseign√©"})]}),e.jsxs("div",{className:"grid grid-cols-[120px_1fr] gap-1",children:[e.jsx("span",{className:"text-slate-500",children:"SIRET:"}),e.jsx("span",{children:l.siret||"Non renseign√©"})]})]})]})]})]}),e.jsx(bn,{leadDetails:l})]}),e.jsx("div",{className:"mt-6 flex justify-end gap-2",children:e.jsx(C,{variant:"outline",onClick:()=>x(!1),children:"Fermer"})})]}):e.jsx("div",{className:"bg-amber-50 text-amber-800 p-4 rounded-md",children:e.jsxs("p",{className:"flex items-center",children:[e.jsx(ls,{className:"h-5 w-5 mr-2"}),"Aucune information disponible."]})})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Assigner le lead"}),e.jsx(C,{variant:"ghost",size:"icon",onClick:()=>n(!1),className:"h-8 w-8 rounded-full",children:e.jsx($e,{className:"h-4 w-4"})})]}),v&&e.jsxs("div",{children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 mb-6",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(rn,{className:"h-5 w-5 text-blue-500"})}),e.jsx("div",{className:"ml-3",children:e.jsxs("p",{className:"text-sm text-blue-800",children:["Vous allez assigner ",e.jsxs("span",{className:"font-medium",children:["Lead #",v]})," √† un membre de l'√©quipe commerciale."]})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ae,{htmlFor:"assignee",children:"S√©lectionner un utilisateur"}),e.jsxs(ee,{name:"assignee",children:[e.jsx(se,{children:e.jsx(ne,{placeholder:"Choisir un utilisateur"})}),e.jsxs(re,{children:[e.jsx(u,{value:"1",children:"Marina Alves"}),e.jsx(u,{value:"2",children:"Thomas Dupont"}),e.jsx(u,{value:"3",children:"Sara Benali"})]})]})]}),e.jsxs("div",{children:[e.jsx(ae,{htmlFor:"priority",children:"Priorit√©"}),e.jsxs(ee,{name:"priority",defaultValue:"medium",children:[e.jsx(se,{children:e.jsx(ne,{})}),e.jsxs(re,{children:[e.jsx(u,{value:"high",children:"Haute"}),e.jsx(u,{value:"medium",children:"Moyenne"}),e.jsx(u,{value:"low",children:"Basse"})]})]})]}),e.jsxs("div",{children:[e.jsx(ae,{htmlFor:"note",children:"Note (optionnelle)"}),e.jsx(ns,{name:"note",placeholder:"Ajouter une note pour le destinataire...",className:"resize-none",rows:3})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-2",children:[e.jsx(C,{variant:"outline",onClick:()=>n(!1),children:"Annuler"}),e.jsx(C,{disabled:_e.isPending||H,onClick:()=>{var S,L,G;const d=Number((S=document.querySelector('select[name="assignee"]'))==null?void 0:S.value),b=(L=document.querySelector('select[name="priority"]'))==null?void 0:L.value,I=(G=document.querySelector('textarea[name="note"]'))==null?void 0:G.value;v&&d&&b?ws(v,d,b,I):s({title:"Erreur",description:"Veuillez s√©lectionner un utilisateur et une priorit√©",variant:"destructive"})},children:_e.isPending?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 mr-2 animate-spin"}),"Traitement..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ln,{className:"h-4 w-4 mr-2"}),"Assigner"]})})]})]})]})}),e.jsx(yn,{isOpen:j,onClose:()=>f(!1),onLeadCreated:()=>{ie.invalidateQueries({queryKey:["/api/leads/all"]}),ie.invalidateQueries({queryKey:["/api/leads/incomplete"]}),ie.invalidateQueries({queryKey:["/api/leads/new"]})}}),e.jsx(Xs,{isOpen:r,onClose:()=>N(!1),leadId:v,leadInfo:l?{firstName:l.firstName,lastName:l.lastName,phone:l.phone,email:l.email}:void 0})]})}export{Yn as default};
