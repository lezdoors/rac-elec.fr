import{a as F,r as l,j as e,R as $,W as D,T as O,v as x,l as I,O as g,I as z,B as h,a9 as B}from"./index-BdVfOFP0.js";import{A as U,Q as R}from"./admin-layout-DGr9GxZS.js";import{C as n,a as c,b as o,d,c as V,e as W}from"./card-BFTzbUnz.js";import{T as H,a as Q,b as j,c as v}from"./tabs-Kmnl6_hA.js";import{S as X}from"./switch-Cv-FG3Bl.js";import{B as f}from"./use-mobile-B3agYisv.js";import{T as J}from"./triangle-alert-BDMQIJiy.js";import{C as S}from"./circle-x-bChUWJ29.js";import{C as K}from"./copy-DX6Du4X3.js";import{I as M}from"./info-DErulkl2.js";import{S as Y}from"./save-BoY9wcZ5.js";import"./use-auth-DGsxSJVF.js";import"./log-out-CdLRRRiN.js";import"./credit-card-D7GQQiJn.js";import"./users-BRPsroSV.js";import"./settings-1EnN9Sfa.js";import"./index-CzpYjGFi.js";import"./index-Pg5uYOwx.js";import"./index-XyduB9wU.js";import"./separator-c9hqLWMe.js";import"./external-link-DDBa3YLj.js";import"./index-ClSOIKTH.js";function be(){const{toast:i}=F(),[E,G]=l.useState("step1"),[Z,b]=l.useState(!1),[m,C]=l.useState(!1),[N,w]=l.useState({id:"form-init-snippet",name:"Initialisation Formulaire",description:"Snippet déclenché lorsque l'utilisateur commence le formulaire (étape 1/3)",code:"<!-- Google snippet pour l'étape 1 - Ajoutez votre code ici -->",enabled:!0,triggerPage:"/raccordement-enedis",triggerEvent:"click",triggerSelector:".next-step-btn, .btn-start-form",lastUpdated:new Date().toISOString(),createdBy:"Admin"}),[y,q]=l.useState({id:"form-submit-snippet",name:"Soumission Formulaire",description:"Snippet déclenché lorsque l'utilisateur soumet le formulaire complet",code:"<!-- Google snippet pour l'étape 2 - Ajoutez votre code ici -->",enabled:!0,triggerPage:"/raccordement-enedis",triggerEvent:"click",triggerSelector:".submit-form-btn, .btn-submit",lastUpdated:new Date().toISOString(),createdBy:"Admin"}),[T,A]=l.useState({id:"payment-success-snippet",name:"Paiement Réussi",description:"Snippet déclenché lorsque le paiement est confirmé avec succès",code:"<!-- Google snippet pour l'étape 3 - Ajoutez votre code ici -->",enabled:!0,triggerPage:"/paiement-confirmation",triggerEvent:"load",lastUpdated:new Date().toISOString(),createdBy:"Admin"});l.useEffect(()=>{(async()=>{b(!0);try{const t=await I("GET","/api/admin/google-snippets");t.ok&&((await t.json()).snippets.forEach(r=>{r.id==="form-init-snippet"?w(r):r.id==="form-submit-snippet"?q(r):r.id==="payment-success-snippet"&&A(r)}),i({title:"Snippets chargés",description:"Les snippets Google ont été chargés avec succès."}))}catch(t){console.error("Erreur lors du chargement des snippets:",t),i({title:"Erreur",description:"Impossible de charger les snippets Google. Utilisation des valeurs par défaut.",variant:"destructive"})}finally{b(!1)}})()},[i]);const k=async s=>{C(!0);try{if((await I("POST","/api/admin/google-snippets",{snippet:s})).ok)i({title:"Snippet sauvegardé",description:`Le snippet "${s.name}" a été sauvegardé avec succès.`});else throw new Error("Erreur lors de la sauvegarde du snippet")}catch(t){console.error("Erreur lors de la sauvegarde du snippet:",t),i({title:"Erreur",description:"Impossible de sauvegarder le snippet Google.",variant:"destructive"})}finally{C(!1)}},L=s=>{navigator.clipboard.writeText(s),i({title:"Code copié",description:"Le code du snippet a été copié dans le presse-papier."})},p=(s,t,a)=>{s==="form-init-snippet"?w(r=>({...r,[t]:a,lastUpdated:new Date().toISOString()})):s==="form-submit-snippet"?q(r=>({...r,[t]:a,lastUpdated:new Date().toISOString()})):s==="payment-success-snippet"&&A(r=>({...r,[t]:a,lastUpdated:new Date().toISOString()}))},P=s=>{if(!s.code.trim()){i({title:"Test impossible",description:"Le code du snippet est vide.",variant:"destructive"});return}try{const t=s.code.replace(/<!--[\s\S]*?-->/g,"").trim();if(t&&!t.includes("<script")&&!t.includes("gtag")){i({title:"Avertissement",description:"Le code ne semble pas contenir de script Google Analytics."});return}i({title:"Test réussi",description:"Le snippet Google semble valide."})}catch{i({title:"Erreur de syntaxe",description:"Le code du snippet contient des erreurs.",variant:"destructive"})}},u=(s,t)=>e.jsxs(n,{className:"mb-8",children:[e.jsxs(c,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-xl",children:s.name}),e.jsx(V,{children:s.description})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{id:`${s.id}-toggle`,checked:s.enabled,onCheckedChange:a=>p(s.id,"enabled",a)}),e.jsx(g,{htmlFor:`${s.id}-toggle`,className:"text-sm",children:s.enabled?"Activé":"Désactivé"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsxs(f,{variant:"outline",className:"text-xs",children:["Page: ",s.triggerPage]}),e.jsxs(f,{variant:"outline",className:"text-xs",children:["Événement: ",s.triggerEvent]}),s.triggerSelector&&e.jsxs(f,{variant:"outline",className:"text-xs",children:["Sélecteur: ",s.triggerSelector]})]})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(g,{htmlFor:`${s.id}-trigger-selector`,className:"mb-1 block",children:"Sélecteur CSS (déclencheur)"}),e.jsx(z,{id:`${s.id}-trigger-selector`,value:s.triggerSelector||"",onChange:a=>p(s.id,"triggerSelector",a.target.value),placeholder:"ex: .btn-submit, #submit-button",className:"font-mono text-sm"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Sélecteur CSS pour l'élément qui déclenche le snippet (séparés par des virgules pour plusieurs)"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx(g,{htmlFor:`${s.id}-code`,children:"Code du Snippet"}),e.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>L(s.code),className:"h-6 px-2 text-xs",children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),"Copier"]})]}),e.jsx(B,{id:`${s.id}-code`,value:s.code,onChange:a=>p(s.id,"code",a.target.value),className:"font-mono h-[200px] text-sm",placeholder:"<!-- Insérez le code du snippet Google ici -->"})]}),e.jsx("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-md",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(M,{className:"h-5 w-5 text-amber-500 mr-2 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("strong",{children:"Où ce snippet sera-t-il déclenché :"}),e.jsxs("p",{className:"mt-1",children:[s.id==="form-init-snippet"&&"Ce snippet se déclenchera lorsqu'un utilisateur commence le formulaire de raccordement (étape 1/3).",s.id==="form-submit-snippet"&&"Ce snippet se déclenchera lorsqu'un utilisateur soumet le formulaire de raccordement complet.",s.id==="payment-success-snippet"&&"Ce snippet se déclenchera lorsque le paiement est confirmé comme réussi."]}),e.jsxs("p",{className:"mt-1",children:[e.jsx("strong",{children:"Condition technique :"})," ",s.triggerEvent==="click"?`Clic sur l'élément "${s.triggerSelector}" sur la page ${s.triggerPage}`:`Chargement de la page ${s.triggerPage} avec paramètre de succès`]})]})]})})]}),e.jsxs(W,{className:"flex justify-between border-t pt-4",children:[e.jsxs(h,{variant:"outline",onClick:()=>P(s),disabled:m,children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Tester le code"]}),e.jsx(h,{onClick:()=>k(s),disabled:m,children:m?e.jsx(e.Fragment,{children:"Sauvegarde..."}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Sauvegarder"]})})]})]});return e.jsx(U,{children:e.jsxs("div",{className:"container py-10",children:[e.jsx("div",{className:"flex justify-between items-center mb-8",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Gestion des Snippets Google"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Gérez les snippets de code Google Analytics pour le suivi des conversions"})]})}),e.jsxs($,{className:"mb-8",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx(D,{children:"Important"}),e.jsx(O,{children:"Les snippets configurés ici seront injectés aux points clés du parcours utilisateur. Assurez-vous que le code est correct et testé avant de l'activer."})]}),e.jsxs(H,{defaultValue:"step1",value:E,onValueChange:G,children:[e.jsxs(Q,{className:"mb-8 grid grid-cols-3 w-full",children:[e.jsxs(j,{value:"step1",children:["Étape 1: Initialisation Formulaire",N.enabled?e.jsx(x,{className:"h-3 w-3 ml-2 text-green-500"}):e.jsx(S,{className:"h-3 w-3 ml-2 text-red-500"})]}),e.jsxs(j,{value:"step2",children:["Étape 2: Soumission Formulaire",y.enabled?e.jsx(x,{className:"h-3 w-3 ml-2 text-green-500"}):e.jsx(S,{className:"h-3 w-3 ml-2 text-red-500"})]}),e.jsxs(j,{value:"step3",children:["Étape 3: Paiement Réussi",T.enabled?e.jsx(x,{className:"h-3 w-3 ml-2 text-green-500"}):e.jsx(S,{className:"h-3 w-3 ml-2 text-red-500"})]})]}),e.jsxs(v,{value:"step1",children:[u(N),e.jsxs(n,{children:[e.jsx(c,{children:e.jsx(o,{children:"Comment implémenter ce snippet (Étape 1)"})}),e.jsx(d,{children:e.jsxs("ol",{className:"list-decimal pl-5 space-y-2",children:[e.jsx("li",{children:"Ce snippet sera déclenché lorsque l'utilisateur passe à l'étape 1 du formulaire."}),e.jsx("li",{children:`Il doit être configuré pour s'activer lorsque le bouton "Commencer" ou "Suivant" est cliqué.`}),e.jsx("li",{children:"Assurez-vous que le sélecteur CSS correspond aux éléments du formulaire qui déclenchent le passage à l'étape suivante."})]})})]})]}),e.jsxs(v,{value:"step2",children:[u(y),e.jsxs(n,{children:[e.jsx(c,{children:e.jsx(o,{children:"Comment implémenter ce snippet (Étape 2)"})}),e.jsx(d,{children:e.jsxs("ol",{className:"list-decimal pl-5 space-y-2",children:[e.jsx("li",{children:"Ce snippet sera déclenché lorsque l'utilisateur soumet le formulaire complet."}),e.jsx("li",{children:`Il doit être configuré pour s'activer lorsque le bouton final "Soumettre" est cliqué.`}),e.jsx("li",{children:"Ce moment correspond à la génération d'un lead qualifié qui peut passer au paiement."})]})})]})]}),e.jsxs(v,{value:"step3",children:[u(T),e.jsxs(n,{children:[e.jsx(c,{children:e.jsx(o,{children:"Comment implémenter ce snippet (Étape 3)"})}),e.jsx(d,{children:e.jsxs("ol",{className:"list-decimal pl-5 space-y-2",children:[e.jsx("li",{children:"Ce snippet sera déclenché sur la page de confirmation de paiement réussi."}),e.jsx("li",{children:"Il s'active automatiquement au chargement de la page lorsque le paiement est validé."}),e.jsx("li",{children:"C'est le moment idéal pour enregistrer une conversion complète dans Google Analytics."})]})})]})]})]})]})})}export{be as default};
