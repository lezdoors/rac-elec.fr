import{c as $,j as e,B as c,o as H,r as u,a as V,e as z,q as Q,C as K,M as b,Q as O,T as U,V as _,W as G,a0 as W,p as J,m as T,a4 as R}from"./index-BRwE7xlx.js";import{u as X}from"./useQuery-nfF1V8ra.js";import{A as D,D as Y,p as Z,q as P,r as N,B as ee}from"./admin-layout-B7iSqNQi.js";import{T as se,a as ae,b as q,c as j,d as re,e as g}from"./table-C1eynQee.js";import{C as te,a as ie,b as ne,c as le,d as ce}from"./card-PklYs5bc.js";import{B as f}from"./badge-C5b3lhYx.js";import{C as de}from"./index-VnwELIM6.js";import{A as I,a as E}from"./avatar-C3WDw-kp.js";import{E as B}from"./eye-DffD3MnR.js";import{C as oe}from"./circle-alert-Ck8ViZy0.js";import{f as me}from"./formatDistanceToNow-BvUbsu3u.js";import"./use-auth-C4Ob6pE2.js";import"./use-mobile-Dr_2j9fp.js";import"./index-B1X_WPQa.js";import"./log-out-BSamYF2y.js";import"./file-text-BOqUZ2QR.js";import"./credit-card-DgIXokzL.js";import"./settings-C7mHEHnP.js";import"./separator-CzXOqM-L.js";import"./index-BkgbrPX1.js";import"./external-link-52c5sH2E.js";import"./endOfMonth-DrzdmEFn.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=$("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=$("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);function he({currentPage:t,totalPages:i,onPageChange:a,showPageNumbers:C=!0,maxPageButtons:w=5}){var d;const v=()=>{if(i<=w)return Array.from({length:i},(x,n)=>n+1);const r=Math.max(t-1,1),o=Math.min(t+1,i),h=r>2,l=o<i-1;if(!h&&l)return[...Array.from({length:5},(y,m)=>m+1),"...",i];if(h&&!l)return[1,"...",...Array.from({length:5},(y,m)=>i-5+m+1)];if(h&&l)return[1,"...",...[r,t,o],"...",i]};return e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(c,{variant:"outline",size:"icon",onClick:()=>a(t-1),disabled:t===1,"aria-label":"Page précédente",children:e.jsx(de,{className:"h-4 w-4"})}),C&&((d=v())==null?void 0:d.map((r,o)=>r==="..."?e.jsx("div",{className:"px-2",children:"..."},`ellipsis-${o}`):e.jsx(c,{variant:t===r?"default":"outline",onClick:()=>a(r),"aria-label":`Page ${r}`,"aria-current":t===r?"page":void 0,className:"w-9 h-9",children:r},`page-${r}`))),e.jsx(c,{variant:"outline",size:"icon",onClick:()=>a(t+1),disabled:t===i,"aria-label":"Page suivante",children:e.jsx(H,{className:"h-4 w-4"})})]})}function L(t){switch(t){case"unread":return e.jsxs(f,{variant:"destructive",className:"gap-1",children:[e.jsx(oe,{className:"h-3 w-3"}),"Non lu"]});case"read":return e.jsxs(f,{variant:"secondary",className:"gap-1",children:[e.jsx(B,{className:"h-3 w-3"}),"Lu"]});case"replied":return e.jsxs(f,{variant:"outline",className:"gap-1 bg-green-100 text-green-800 hover:bg-green-100/80",children:[e.jsx(J,{className:"h-3 w-3"}),"Répondu"]});case"archived":return e.jsxs(f,{variant:"outline",className:"gap-1",children:[e.jsx(k,{className:"h-3 w-3"}),"Archivé"]});default:return e.jsx(f,{variant:"outline",children:t})}}function $e(){var M,S;const[t,i]=u.useState(1),[a,C]=u.useState(null),[w,v]=u.useState(!1),{toast:d}=V(),{data:r,isLoading:o,error:h}=X({queryKey:["/api/contacts",t],queryFn:async()=>(await T("GET",`/api/contacts?page=${t}&limit=20`)).json(),staleTime:3e4,retry:1}),l=z({mutationFn:async({id:s,status:p})=>(await T("PATCH",`/api/contacts/${s}/status`,{status:p})).json(),onSuccess:()=>{R.invalidateQueries({queryKey:["/api/contacts"]}),R.invalidateQueries({queryKey:["/api/contacts/unread-count"]})}}),x=u.useCallback(s=>{C(s),v(!0),s.status==="unread"&&l.mutate({id:s.id,status:"read"})},[l]),n=u.useCallback((s,p)=>{l.mutate({id:s,status:p},{onSuccess:()=>{d({title:"Statut mis à jour",description:`Le contact a été ${{read:"marqué comme lu",replied:"marqué comme répondu",archived:"archivé"}[p]||p}`})},onError:()=>{d({title:"Erreur",description:"Impossible de mettre à jour le statut du contact",variant:"destructive"})}})},[l,d]),y=u.useCallback(s=>{i(s)},[]);if(o)return e.jsx(D,{children:e.jsx("div",{className:"flex items-center justify-center h-[50vh]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})})});if(h)return e.jsx(D,{children:e.jsx("div",{className:"p-4 text-center text-red-500",children:"Une erreur est survenue lors du chargement des contacts."})});const m=(r==null?void 0:r.contacts)||[],A=((M=r==null?void 0:r.pagination)==null?void 0:M.totalPages)||1;return e.jsxs(D,{children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-1",children:"Contacts"}),e.jsx("p",{className:"text-muted-foreground",children:"Gérez les messages envoyés via le formulaire de contact"})]})}),e.jsxs(te,{children:[e.jsxs(ie,{className:"pb-3",children:[e.jsx(ne,{children:"Messages reçus"}),e.jsxs(le,{children:[((S=r==null?void 0:r.pagination)==null?void 0:S.total)||0," message(s) au total"]})]}),e.jsx(ce,{children:m.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Aucun message de contact reçu pour le moment."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border overflow-hidden",children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs(q,{children:[e.jsx(j,{className:"w-[180px]",children:"Expéditeur"}),e.jsx(j,{className:"max-w-[350px]",children:"Message"}),e.jsx(j,{className:"w-[100px]",children:"Statut"}),e.jsx(j,{className:"w-[180px]",children:"Date"}),e.jsx(j,{className:"w-[50px]"})]})}),e.jsx(re,{children:m.map(s=>e.jsxs(q,{className:s.status==="unread"?"font-medium bg-blue-50/40":"",children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-8 w-8 bg-primary/10",children:e.jsx(E,{className:"text-primary",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"grid gap-0.5",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground truncate max-w-[120px]",children:s.email})]})]})}),e.jsx(g,{children:e.jsx("div",{className:"line-clamp-2 text-sm",children:s.message})}),e.jsx(g,{children:L(s.status)}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(Q,{className:"h-3 w-3"}),me(new Date(s.createdAt),{addSuffix:!0,locale:ee})]})}),e.jsx(g,{children:e.jsxs(Y,{children:[e.jsx(Z,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"icon",children:e.jsx(ue,{className:"h-4 w-4"})})}),e.jsxs(P,{align:"end",children:[e.jsxs(N,{onClick:()=>x(s),children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Voir les détails"]}),s.status!=="read"&&e.jsxs(N,{onClick:()=>n(s.id,"read"),children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Marquer comme lu"]}),s.status!=="replied"&&e.jsxs(N,{onClick:()=>n(s.id,"replied"),children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"Marquer comme répondu"]}),s.status!=="archived"&&e.jsxs(N,{onClick:()=>n(s.id,"archived"),children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Archiver"]})]})]})})]},s.id))})]})}),A>1&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx(he,{currentPage:t,totalPages:A,onPageChange:y})})]})})]})]}),e.jsx(O,{open:w,onOpenChange:v,children:e.jsxs(U,{className:"sm:max-w-[600px]",children:[e.jsxs(_,{children:[e.jsx(G,{children:"Détails du message"}),e.jsxs(W,{children:["Message envoyé le ",a&&new Date(a.createdAt).toLocaleDateString("fr-FR",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit",year:"numeric"})]})]}),a&&e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-4 pb-3 border-b",children:[e.jsx(I,{className:"h-12 w-12 bg-primary/10",children:e.jsx(E,{className:"text-primary text-lg",children:a.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-lg",children:a.name}),e.jsxs("div",{className:"text-sm text-muted-foreground flex flex-col gap-1",children:[e.jsx("a",{href:`mailto:${a.email}`,className:"hover:underline",children:a.email}),a.phone&&e.jsx("a",{href:`tel:${a.phone}`,className:"hover:underline",children:a.phone})]})]}),e.jsx("div",{className:"ml-auto",children:L(a.status)})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Message"}),e.jsx("div",{className:"bg-muted p-4 rounded-md whitespace-pre-wrap",children:a.message})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-muted-foreground pt-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Source:"})," ",a.source||"Formulaire de contact"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Date:"})," ",new Date(a.createdAt).toLocaleDateString("fr-FR",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit",year:"numeric"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"IP:"})," ",a.ipAddress||"Non disponible"]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[a.status!=="replied"&&e.jsxs(c,{variant:"outline",className:"gap-1",onClick:()=>n(a.id,"replied"),children:[e.jsx(b,{className:"h-4 w-4"}),"Marquer comme répondu"]}),a.status!=="archived"&&e.jsxs(c,{variant:"outline",className:"gap-1",onClick:()=>n(a.id,"archived"),children:[e.jsx(k,{className:"h-4 w-4"}),"Archiver"]}),e.jsxs(c,{variant:"default",className:"gap-1",onClick:()=>{window.location.href=`mailto:${a.email}?subject=Re: Message depuis le site`},children:[e.jsx(b,{className:"h-4 w-4"}),"Répondre par email"]})]})]})]})})]})}export{$e as default};
