function s(){if(typeof window>"u")return null;let t;try{t=new URLSearchParams(window.location.search)}catch{const o=window.location.search.substring(1),r=new Map;o&&o.split("&").forEach(a=>{const[i,w]=a.split("=");i&&r.set(decodeURIComponent(i),decodeURIComponent(w||""))});const c=r.get("gclid")||null;if(c){const a={utm_source:r.get("utm_source"),utm_medium:r.get("utm_medium"),utm_campaign:r.get("utm_campaign"),utm_term:r.get("utm_term"),utm_content:r.get("utm_content")};if(Object.values(a).some(i=>i!==null))try{localStorage.setItem("utm_data",JSON.stringify(a))}catch(i){console.warn("⚠️ Could not store UTM data:",i)}}return c}const e=t.get("gclid");if(e){const n={utm_source:t.get("utm_source"),utm_medium:t.get("utm_medium"),utm_campaign:t.get("utm_campaign"),utm_term:t.get("utm_term"),utm_content:t.get("utm_content")};Object.values(n).some(o=>o!==null)&&localStorage.setItem("utm_data",JSON.stringify(n))}return e}function u(t){if(!t)return;const e={gclid:t,timestamp:Date.now(),source_url:window.location.href,landing_page:window.location.pathname};try{localStorage.setItem("gclid_data",JSON.stringify(e)),console.log("✅ GCLID stored successfully:",t)}catch(n){console.warn("⚠️ Failed to store GCLID (Safari privacy settings?):",n);try{sessionStorage.setItem("gclid_data",JSON.stringify(e)),console.log("✅ GCLID stored in sessionStorage as fallback")}catch(o){console.warn("⚠️ Storage completely blocked:",o)}}}function d(){if(typeof window>"u")return null;try{let t=localStorage.getItem("gclid_data");if(!t)try{t=sessionStorage.getItem("gclid_data")}catch{console.warn("⚠️ Could not access sessionStorage")}if(!t)return null;const e=JSON.parse(t),n=90*24*60*60*1e3;return Date.now()-e.timestamp<n?e.gclid:(localStorage.removeItem("gclid_data"),null)}catch(t){return console.warn("⚠️ Failed to retrieve stored GCLID:",t),null}}function g(){const t=s();return t?(u(t),t):d()}function l(){if(typeof window>"u")return;const t=s();t&&m(t)&&(u(t),window.gtag&&(window.gtag("config","GT-MJKTJGCK",{custom_map:{custom_parameter_1:"gclid"},gclid:t}),window.gtag("event","gclid_captured",{event_category:"attribution",event_label:t,custom_parameter_1:t})),console.log("✅ GCLID tracking initialized:",t)),f()}function p(t){const e=g();return e?{...t,gclid:e}:t}function y(t,e={}){if(typeof window>"u"||!window.gtag)return;const n=g(),o={send_to:t,...e};if(n&&m(n)){o.gclid=n;const r=_();r&&Object.assign(o,r),console.log("✅ Conversion tracked with GCLID:",n)}window.gtag("event","conversion",o)}function m(t){return!t||typeof t!="string"?!1:/^[A-Za-z0-9_-]{20,150}$/.test(t)}function _(){if(typeof window>"u")return null;try{const t=localStorage.getItem("utm_data");return t?JSON.parse(t):null}catch(t){return console.warn("⚠️ Failed to retrieve UTM data:",t),null}}function f(){d()}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{l()}):l(),f());export{p as addGclidToConversion,f as cleanupExpiredGclid,g as getCurrentGclid,s as getGclidFromUrl,d as getStoredGclid,_ as getStoredUtmData,l as initializeGclidTracking,m as isValidGclid,u as storeGclid,y as trackConversionWithGclid};
