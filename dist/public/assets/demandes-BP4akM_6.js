import{c as H,j as e,B as h,b1 as Z,a as be,r as x,e as W,aR as we,I as Ce,l as Se,P as ae,A as De,x as ie,Q as Te,T as Ae,V as Re,W as Ee,a0 as Me,q as Pe,p as ke,U as te,_ as Le,m as X,a4 as J,aF as _e}from"./index-D0aNDh5L.js";import{u as Fe}from"./useQuery-4ZaN6UoW.js";import{A as Ie,D as Ve,p as ze,q as $e,r as w,v as Be}from"./admin-layout-CM4-m4Me.js";import{C as t,a as r,b as m,c as le,d as l,e as He}from"./card-g2bqyuJH.js";import{T as Ue,a as Ge,b as q,c as v,d as Qe,e as f}from"./table-CBITm6KM.js";import{S as M,a as P,d as k,b as L,c as i}from"./select-BYWjCN2B.js";import{B as D}from"./badge-BKKTlACB.js";import{A as Oe,a as Ke,b as Ye,c as Ze,d as We,e as Xe,f as Je,g as qe}from"./alert-dialog-CJkVRFeS.js";import{C as es}from"./copy-9eIj9MW4.js";import{D as ss}from"./download-Dsb6b2ke.js";import{S as as}from"./search-CR58YC69.js";import{C as is}from"./circle-x-B4QSBoHl.js";import{R as ts}from"./refresh-cw-BbKG6u6w.js";import{F as T}from"./file-text-CL78jw9P.js";import{E as ls}from"./eye-DOmFDOR3.js";import{P as ns}from"./pencil-DZ9MCTDF.js";import{T as cs}from"./trash-2-DjgYC3by.js";import{Z as ds}from"./zap-CA7-I6iE.js";import{M as rs}from"./map-pin-vKB_KP1q.js";import{C as ee}from"./credit-card-Gwd2tt5N.js";import"./use-auth-hZbjue8Y.js";import"./use-mobile-CAygICyi.js";import"./index-BbNo7xzR.js";import"./log-out-DyChWGPZ.js";import"./settings-BzJCyKZ7.js";import"./index-CN0BoPk4.js";import"./index-42c2_13v.js";import"./separator-DzodqHP2.js";import"./external-link-Bx3PZ3Bg.js";import"./index-DhyfjYr8.js";import"./chevron-down-So192k0a.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=H("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=H("HardHat",[["path",{d:"M2 18a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v2z",key:"1dej2m"}],["path",{d:"M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5",key:"1p9q5i"}],["path",{d:"M4 15v-3a6 6 0 0 1 6-6",key:"9ciidu"}],["path",{d:"M14 6a6 6 0 0 1 6 6v3",key:"1hnv84"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=H("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);function hs({referenceNumber:s}){const C=d=>`https://www.demande-raccordement.fr/paiement-multiple/${s}/${d}`,g=(d,o)=>{navigator.clipboard.writeText(d).then(()=>{Z({title:"Lien copié",description:`Le lien de paiement (x${o}) a été copié dans le presse-papier.`})}).catch(N=>{console.error("Erreur lors de la copie du lien:",N),Z({title:"Erreur",description:"Impossible de copier le lien. Veuillez réessayer.",variant:"destructive"})})};return e.jsxs(t,{children:[e.jsxs(r,{children:[e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(xs,{className:"w-5 h-5 text-blue-600"}),"Liens de paiement majoré"]}),e.jsxs(le,{children:["Liens de paiement avec montants majorés pour la référence ",e.jsx("strong",{children:s}),". Partagez ces liens avec vos clients pour différents niveaux de service."]})]}),e.jsxs(l,{className:"space-y-4",children:[e.jsx("div",{className:"rounded-md bg-blue-50 p-4 border border-blue-100",children:e.jsx("p",{className:"text-sm text-blue-700",children:"Ces liens permettent aux clients d'effectuer des paiements avec différents multiplicateurs. Choisissez le montant approprié en fonction des services supplémentaires convenus."})}),e.jsx("div",{className:"space-y-3",children:[2,3,4,5].map(d=>{const o=C(d),N=(129.8*d).toFixed(2).replace(".",",");return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md bg-white hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Paiement x",d]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 truncate max-w-xs md:max-w-md",children:o}),e.jsxs("p",{className:"text-sm font-semibold text-blue-600 mt-1",children:[N,"€"]})]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>g(o,d),className:"flex items-center gap-1",children:[e.jsx(es,{className:"w-3.5 h-3.5"}),"Copier"]})]},d)})})]}),e.jsx(He,{className:"flex justify-between border-t pt-4",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Les liens sont valables tant que la référence est active."})})]})}function _(s){return s?new Date(s).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"numeric"}):"N/A"}function ps(s){return s?new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(s):"N/A"}function se(s){return s?s.replace(/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/,"$1 $2 $3 $4 $5"):"N/A"}function ne(s,c){window.open(`tel:${s}`,"_blank"),console.log(`Appel de ${c} au ${s}`)}function js({requests:s}){const c=s.length,C=s.filter(n=>n.status==="pending").length,g=s.filter(n=>n.status==="in_progress").length,d=s.filter(n=>n.status==="completed").length,o=s.filter(n=>!n.paymentStatus||n.paymentStatus!=="succeeded").length,N=s.filter(n=>n.paymentStatus==="succeeded").length;return e.jsxs("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-6",children:[e.jsx(t,{className:"bg-blue-50 border-blue-100",children:e.jsxs(l,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(T,{className:"h-8 w-8 text-blue-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-blue-800",children:c}),e.jsx("p",{className:"text-xs text-blue-700",children:"Total demandes"})]})}),e.jsx(t,{className:"bg-yellow-50 border-yellow-100",children:e.jsxs(l,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(Pe,{className:"h-8 w-8 text-yellow-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-yellow-800",children:C}),e.jsx("p",{className:"text-xs text-yellow-700",children:"En attente"})]})}),e.jsx(t,{className:"bg-purple-50 border-purple-100",children:e.jsxs(l,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(ds,{className:"h-8 w-8 text-purple-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-purple-800",children:g}),e.jsx("p",{className:"text-xs text-purple-700",children:"En cours"})]})}),e.jsx(t,{className:"bg-green-50 border-green-100",children:e.jsxs(l,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(ke,{className:"h-8 w-8 text-green-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-green-800",children:d}),e.jsx("p",{className:"text-xs text-green-700",children:"Terminées"})]})}),e.jsx(t,{className:"bg-indigo-50 border-indigo-100",children:e.jsxs(l,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(te,{className:"h-8 w-8 text-indigo-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-indigo-800",children:N}),e.jsx("p",{className:"text-xs text-indigo-700",children:"Clients"})]})}),e.jsx(t,{className:"bg-orange-50 border-orange-100",children:e.jsxs(l,{className:"p-4 flex flex-col items-center justify-center",children:[e.jsx(T,{className:"h-8 w-8 text-orange-600 mb-1"}),e.jsx("p",{className:"text-xl font-bold text-orange-800",children:o}),e.jsx("p",{className:"text-xs text-orange-700",children:"Leads"})]})})]})}function us({request:s,onClose:c}){return s?e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:s.referenceNumber}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Créée le ",_(s.createdAt)]})]}),e.jsx(D,{variant:s.status==="completed"?"default":s.status==="in_progress"?"secondary":s.status==="pending"?"outline":"destructive",children:s.status==="completed"?"Terminé":s.status==="in_progress"?"En cours":s.status==="pending"?"En attente":"Annulé"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2 max-h-[70vh] md:max-h-none overflow-y-auto md:overflow-visible pb-4 pr-1",children:[e.jsxs(t,{children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(te,{className:"mr-2 h-5 w-5 text-blue-600"}),"Informations client"]})}),e.jsxs(l,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Nom"}),e.jsx("div",{className:"font-medium",children:s.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Email"}),e.jsx("div",{children:e.jsx("a",{href:`mailto:${s.email}`,className:"text-blue-600 hover:underline",children:s.email})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Téléphone"}),e.jsx("div",{children:e.jsx("a",{href:`tel:${s.phone}`,className:"text-blue-600 hover:underline",children:se(s.phone)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Type"}),e.jsx("div",{children:e.jsx(D,{variant:"outline",className:"font-normal",children:s.clientType==="particulier"?"Particulier":s.clientType==="professionnel"?"Professionnel":"Collectivité"})})]}),s.clientType!=="particulier"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Société"}),e.jsx("div",{className:"font-medium",children:s.company})]}),s.siret&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"SIRET"}),e.jsx("div",{className:"font-mono text-xs",children:s.siret})]})]}),s.ipAddress&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"IP"}),e.jsx("div",{className:"font-mono text-xs",children:s.ipAddress})]}),s.userAgent&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Navigateur"}),e.jsx("div",{className:"truncate text-xs",children:s.userAgent})]})]})]}),e.jsxs(t,{children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(T,{className:"mr-2 h-5 w-5 text-blue-600"}),"Détails de la demande"]})}),e.jsxs(l,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Type"}),e.jsx("div",{children:s.requestType==="new_connection"?"Nouvelle connexion":s.requestType==="power_upgrade"?"Augmentation puissance":s.requestType==="meter_upgrade"?"Modification compteur":s.requestType==="temporary_connection"?"Raccordement temporaire":s.requestType==="relocation"?"Déplacement d'ouvrage":s.requestType==="technical_visit"?"Visite technique":"Autre"})]}),s.otherRequestTypeDesc&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Détail"}),e.jsx("div",{children:s.otherRequestTypeDesc})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Puissance"}),e.jsxs("div",{children:[s.powerRequired," kVA"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Phase"}),e.jsx("div",{children:s.phaseType==="monophase"?"Monophasé":"Triphasé"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Bâtiment"}),e.jsx("div",{children:s.buildingType==="individual_house"?"Maison individuelle":s.buildingType==="apartment_building"?"Immeuble collectif":s.buildingType==="commercial"?"Local commercial":s.buildingType==="industrial"?"Bâtiment industriel":s.buildingType==="agricultural"?"Exploitation agricole":s.buildingType==="public"?"Établissement public":s.buildingType==="terrain"?"Terrain":"Autre"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Avancement"}),e.jsx("div",{children:s.projectStatus==="planning"?"En projet":s.projectStatus==="permit_pending"?"Permis déposé":s.projectStatus==="permit_approved"?"Permis approuvé":s.projectStatus==="construction_started"?"Construction démarrée":s.projectStatus==="construction_completed"?"Construction terminée":"Autre"})]}),s.terrainViabilise&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Terrain"}),e.jsx("div",{children:s.terrainViabilise==="viabilise"?"Viabilisé":"Non viabilisé"})]}),s.billingAddress&&s.billingAddress!==s.address&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Adresse facturation différente"}),e.jsx("div",{children:"Oui"})]}),s.permitNumber&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"N° Permis"}),e.jsx("div",{children:s.permitNumber})]}),s.permitDeliveryDate&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Date permis"}),e.jsx("div",{children:s.permitDeliveryDate})]}),s.desiredCompletionDate&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Date souhaitée"}),e.jsx("div",{children:s.desiredCompletionDate})]})]})]}),e.jsxs(t,{children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(rs,{className:"mr-2 h-5 w-5 text-blue-600"}),"Adresse du projet"]})}),e.jsxs(l,{className:"space-y-2",children:[e.jsxs("div",{className:"font-medium",children:[s.address,s.addressComplement&&e.jsxs("span",{children:[", ",s.addressComplement]}),e.jsx("br",{}),s.postalCode," ",s.city]}),s.cadastralReference&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Référence cadastrale"}),e.jsx("div",{children:s.cadastralReference})]}),s.billingAddress&&s.billingAddress!==s.address&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4 mb-2 text-sm font-medium",children:"Adresse de facturation"}),e.jsxs("div",{className:"font-medium",children:[s.billingAddress,e.jsx("br",{}),s.billingPostalCode," ",s.billingCity]})]})]})]}),s.hasArchitect&&e.jsxs(t,{children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(os,{className:"mr-2 h-5 w-5 text-blue-600"}),"Architecte"]})}),e.jsxs(l,{className:"space-y-2",children:[s.architectName&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Nom"}),e.jsx("div",{children:s.architectName})]}),s.architectPhone&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Téléphone"}),e.jsx("div",{children:se(s.architectPhone)})]}),s.architectEmail&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Email"}),e.jsx("div",{children:s.architectEmail})]})]})]}),e.jsxs(t,{className:"border-blue-200 bg-blue-50",children:[e.jsx(r,{className:"pb-2",children:e.jsxs(m,{className:"flex items-center text-blue-700",children:[e.jsx(ee,{className:"mr-2 h-5 w-5"}),"Informations de paiement"]})}),e.jsxs(l,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Statut"}),e.jsx("div",{children:e.jsx(D,{variant:s.paymentStatus==="succeeded"||s.paymentStatus==="paid"?"default":"outline",className:`${s.paymentStatus==="succeeded"||s.paymentStatus==="paid"?"bg-green-100 text-green-800":s.paymentStatus==="failed"?"bg-red-100 text-red-800":""}`,children:s.paymentStatus==="succeeded"||s.paymentStatus==="paid"?"Payé":s.paymentStatus==="processing"?"En cours":s.paymentStatus==="failed"?"Échec":"Non payé"})})]}),s.paymentAmount&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Montant"}),e.jsx("div",{className:"font-semibold",children:ps(parseFloat(s.paymentAmount.toString()))})]}),s.paymentMethod&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Méthode"}),e.jsx("div",{children:s.paymentMethod==="card"?"Carte bancaire":s.paymentMethod==="manual"?"Paiement manuel":s.paymentMethod})]}),s.paymentDate&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Date"}),e.jsx("div",{children:_(s.paymentDate)})]}),s.paymentId&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"ID Paiement"}),e.jsx("div",{className:"text-xs",children:s.paymentId})]}),s.cardBrand&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Carte"}),e.jsx("div",{className:"capitalize",children:s.cardBrand})]}),s.cardLast4&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Numéro"}),e.jsx("div",{className:"font-mono",children:s.cardLast4})]}),s.cardExpMonth&&s.cardExpYear&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Expiration"}),e.jsxs("div",{children:[s.cardExpMonth.toString().padStart(2,"0"),"/",s.cardExpYear]})]}),s.billingName&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Titulaire"}),e.jsx("div",{children:s.billingName})]}),s.bankName&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Banque"}),e.jsx("div",{children:s.bankName})]})]}),s.paymentError&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-red-200",children:[e.jsx("div",{className:"text-sm font-medium text-red-600 mb-1",children:"Erreur de paiement"}),e.jsx("div",{className:"text-xs whitespace-pre-wrap text-red-600 bg-red-50 p-2 rounded",children:s.paymentError})]})]})]}),(!s.paymentStatus||s.paymentStatus!=="succeeded"&&s.paymentStatus!=="paid")&&e.jsxs(t,{className:"border-green-200 bg-green-50",children:[e.jsxs(r,{className:"pb-2",children:[e.jsxs(m,{className:"flex items-center text-green-700",children:[e.jsx(ee,{className:"mr-2 h-5 w-5"}),"Liens de paiement multiples"]}),e.jsx(le,{className:"text-green-600",children:"Générateur de liens de paiement avec montant majoré"})]}),e.jsx(l,{children:e.jsx(hs,{referenceNumber:s.referenceNumber})})]}),s.scheduledDate&&e.jsxs(t,{children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(ie,{className:"mr-2 h-5 w-5 text-blue-600"}),"Rendez-vous Enedis"]})}),e.jsxs(l,{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Date"}),e.jsx("div",{children:_(s.scheduledDate)})]}),s.scheduledTime&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Créneau"}),e.jsx("div",{children:s.scheduledTime})]}),s.enedisReferenceNumber&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Référence Enedis"}),e.jsx("div",{children:s.enedisReferenceNumber})]})]})]}),s.comments&&e.jsxs(t,{className:"md:col-span-2",children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(Le,{className:"mr-2 h-5 w-5 text-blue-600"}),"Commentaires"]})}),e.jsx(l,{children:e.jsx("p",{className:"whitespace-pre-wrap",children:s.comments})})]}),s.notes&&e.jsxs(t,{className:"md:col-span-2",children:[e.jsx(r,{children:e.jsxs(m,{className:"flex items-center",children:[e.jsx(T,{className:"mr-2 h-5 w-5 text-blue-600"}),"Notes internes"]})}),e.jsx(l,{children:e.jsx("p",{className:"whitespace-pre-wrap",children:s.notes})})]})]}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-2 pt-4",children:[e.jsx(h,{variant:"outline",onClick:c,children:"Fermer"}),e.jsxs(h,{variant:"outline",className:"bg-blue-50 text-blue-700 hover:bg-blue-100",onClick:()=>ne(s.phone,s.name),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Appeler"]}),e.jsx(h,{children:"Traiter la demande"})]})]}):null}function Zs(){const{toast:s}=be(),[c,C]=x.useState(""),[g,d]=x.useState(null),[o,N]=x.useState(null),[n,ce]=x.useState("all"),[A,de]=x.useState(null),[U,re]=x.useState(null),[me,F]=x.useState(!1),[y,G]=x.useState(1),[p,I]=x.useState(null),[oe,V]=x.useState(!1),b=20,{data:xe,isLoading:Q,error:O,refetch:he}=Fe({queryKey:["/api/service-requests"],queryFn:_e({on401:"throw"})}),pe=W({mutationFn:async a=>await(await X("PATCH",`/api/service-requests/${a}`,{paymentStatus:"paid",status:"in_progress",paymentMethod:"manual",paymentDate:new Date().toISOString()})).json(),onSuccess:()=>{J.invalidateQueries({queryKey:["/api/service-requests"]})}}),je=W({mutationFn:async a=>await(await X("DELETE",`/api/service-requests/${a}`)).json(),onSuccess:a=>{a.success&&s({title:"Demande supprimée",description:"La demande a été supprimée avec succès"}),J.invalidateQueries({queryKey:["/api/service-requests"]})},onError:a=>{s({title:"Erreur",description:a.message||"Un problème est survenu lors de la suppression",variant:"destructive"})}}),ue=a=>{I(a),V(!0)},ge=()=>{p&&(je.mutate(p.id),V(!1),I(null))},z=xe||[],j=[...z.filter(a=>{var Y;const S=!c||((Y=a.referenceNumber)==null?void 0:Y.toLowerCase().includes(c.toLowerCase()))||a.name&&a.name.toLowerCase().includes(c.toLowerCase())||a.email&&a.email.toLowerCase().includes(c.toLowerCase())||a.phone&&a.phone.includes(c)||a.address&&a.address.toLowerCase().includes(c.toLowerCase()),$=!g||a.status===g,K=!o||a.requestType===o,ye=!A||A==="paid"&&(a.paymentStatus==="succeeded"||a.paymentStatus==="paid")||A==="unpaid"&&(!a.paymentStatus||a.paymentStatus!=="succeeded"&&a.paymentStatus!=="paid");let R=!0;if(n!=="all"&&a.createdAt){const B=new Date(a.createdAt),E=new Date;if(n==="today"){const u=new Date;u.setHours(0,0,0,0),R=B>=u}else if(n==="week"){const u=new Date(E);u.setDate(E.getDate()-7),R=B>=u}else if(n==="month"){const u=new Date(E);u.setMonth(E.getMonth()-1),R=B>=u}}return S&&$&&K&&ye&&R})].sort((a,S)=>{const $=new Date(a.createdAt||0);return new Date(S.createdAt||0).getTime()-$.getTime()}),Ne=a=>{re(a),F(!0)},ve=()=>{F(!1)},fe=a=>{pe.mutate(a.id)};return e.jsxs(Ie,{title:"Gestion des demandes",description:"Gérez toutes les demandes de raccordement électrique",children:[e.jsxs("div",{className:"space-y-6",children:[!Q&&!O&&z&&e.jsx(js,{requests:z}),e.jsxs(t,{children:[e.jsx(r,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(m,{children:"Toutes les demandes"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Exporter"]}),e.jsxs(h,{size:"sm",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Nouvelle demande"]})]})]})}),e.jsxs(l,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(as,{className:"absolute h-4 w-4 top-3 left-3 text-gray-400"}),e.jsx(Ce,{placeholder:"Rechercher par nom, référence, adresse...",className:"pl-10",value:c,onChange:a=>C(a.target.value)})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(M,{value:g||"all",onValueChange:a=>d(a==="all"?null:a),children:[e.jsx(P,{className:"w-[140px]",children:e.jsx(k,{placeholder:"Tous les statuts"})}),e.jsxs(L,{children:[e.jsx(i,{value:"all",children:"Tous les statuts"}),e.jsx(i,{value:"pending",children:"En attente"}),e.jsx(i,{value:"in_progress",children:"En cours"}),e.jsx(i,{value:"completed",children:"Terminées"}),e.jsx(i,{value:"cancelled",children:"Annulées"})]})]}),e.jsxs(M,{value:o||"all",onValueChange:a=>N(a==="all"?null:a),children:[e.jsx(P,{className:"w-[180px]",children:e.jsx(k,{placeholder:"Tous les types"})}),e.jsxs(L,{children:[e.jsx(i,{value:"all",children:"Tous les types"}),e.jsx(i,{value:"new_connection",children:"Nouvelle connexion"}),e.jsx(i,{value:"power_upgrade",children:"Augmentation puissance"}),e.jsx(i,{value:"meter_upgrade",children:"Modification compteur"}),e.jsx(i,{value:"technical_visit",children:"Visite technique"})]})]}),e.jsxs(M,{value:A||"all",onValueChange:a=>de(a==="all"?null:a),children:[e.jsx(P,{className:"w-[140px]",children:e.jsx(k,{placeholder:"Paiement"})}),e.jsxs(L,{children:[e.jsx(i,{value:"all",children:"Tous"}),e.jsx(i,{value:"paid",children:"Payés"}),e.jsx(i,{value:"unpaid",children:"Non payés"})]})]}),e.jsxs(M,{value:n,onValueChange:ce,children:[e.jsx(P,{className:"w-[140px]",children:e.jsx(k,{placeholder:"Période"})}),e.jsxs(L,{children:[e.jsx(i,{value:"all",children:"Toutes dates"}),e.jsx(i,{value:"today",children:"Aujourd'hui"}),e.jsx(i,{value:"week",children:"7 derniers jours"}),e.jsx(i,{value:"month",children:"30 derniers jours"})]})]})]})]}),Q?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(Se,{className:"h-8 w-8 animate-spin text-blue-600"})}):O?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(is,{className:"h-10 w-10 text-red-500 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 mb-3",children:"Une erreur est survenue lors du chargement des demandes"}),e.jsxs(h,{variant:"outline",onClick:()=>he(),children:[e.jsx(ts,{className:"h-4 w-4 mr-2"}),"Réessayer"]})]}):j.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(T,{className:"h-10 w-10 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"Aucune demande ne correspond à vos critères de recherche"})]}):e.jsxs("div",{className:"rounded-md border overflow-hidden",children:[e.jsxs(Ue,{children:[e.jsx(Ge,{children:e.jsxs(q,{children:[e.jsx(v,{className:"w-[120px]",children:"Référence"}),e.jsx(v,{children:"Client"}),e.jsx(v,{className:"hidden md:table-cell",children:"Date"}),e.jsx(v,{className:"hidden md:table-cell",children:"Type"}),e.jsx(v,{children:"Statut"}),e.jsx(v,{children:"Paiement"}),e.jsx(v,{className:"text-right",children:"Actions"})]})}),e.jsx(Qe,{children:j.slice((y-1)*b,y*b).map(a=>e.jsxs(q,{children:[e.jsx(f,{className:"font-medium",children:a.referenceNumber}),e.jsxs(f,{children:[e.jsx("div",{children:a.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.email})]}),e.jsx(f,{className:"hidden md:table-cell",children:_(a.createdAt)}),e.jsx(f,{className:"hidden md:table-cell",children:a.requestType==="new_connection"?"Nouvelle connexion":a.requestType==="power_upgrade"?"Augmentation puissance":a.requestType==="meter_upgrade"?"Modification compteur":"Visite technique"}),e.jsx(f,{children:e.jsx(D,{variant:a.status==="completed"?"default":a.status==="in_progress"?"secondary":a.status==="pending"?"outline":"destructive",children:a.status==="completed"?"Terminé":a.status==="in_progress"?"En cours":a.status==="pending"?"En attente":"Annulé"})}),e.jsx(f,{children:e.jsx(D,{variant:a.paymentStatus==="succeeded"||a.paymentStatus==="paid"?"default":"outline",className:a.paymentStatus==="succeeded"||a.paymentStatus==="paid"?"bg-green-100 text-green-800 hover:bg-green-200":a.paymentStatus==="processing"?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":a.paymentStatus==="failed"?"bg-red-100 text-red-800 hover:bg-red-200":"",children:a.paymentStatus==="succeeded"||a.paymentStatus==="paid"?"Payé":a.paymentStatus==="processing"?"En cours":a.paymentStatus==="failed"?"Échoué":"Non payé"})}),e.jsx(f,{className:"text-right",children:e.jsxs(Ve,{children:[e.jsx(ze,{asChild:!0,children:e.jsxs(h,{variant:"ghost",size:"icon",children:[e.jsx(ms,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Menu"})]})}),e.jsxs($e,{align:"end",children:[e.jsxs(w,{onClick:()=>Ne(a),children:[e.jsx(ls,{className:"mr-2 h-4 w-4"}),"Voir détails"]}),e.jsxs(w,{onClick:()=>ne(a.phone,a.name),children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Appeler client"]}),(!a.paymentStatus||a.paymentStatus!=="succeeded"&&a.paymentStatus!=="paid")&&e.jsxs(w,{onClick:()=>fe(a),children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Marquer comme payé"]}),a.paymentStatus==="succeeded"&&!a.scheduledDate&&e.jsxs(w,{children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Planifier RDV"]}),e.jsx(Be,{}),e.jsxs(w,{children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Modifier"]}),e.jsxs(w,{onClick:()=>ue(a),className:"text-red-600 focus:text-red-600 focus:bg-red-50",children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),"Supprimer"]})]})]})})]},a.id))})]}),j.length>0&&e.jsxs("div",{className:"flex justify-between items-center mt-4 px-4 pb-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Affichage de ",Math.min((y-1)*b+1,j.length)," à ",Math.min(y*b,j.length)," sur ",j.length," demandes"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>G(a=>Math.max(1,a-1)),disabled:y===1,children:"Précédent"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>G(a=>Math.min(Math.ceil(j.length/b),a+1)),disabled:y>=Math.ceil(j.length/b),children:"Suivant"})]})]})]})]})]})]}),e.jsx(Te,{open:me,onOpenChange:F,children:e.jsxs(Ae,{className:"max-w-4xl max-h-[90vh] overflow-auto",children:[e.jsxs(Re,{children:[e.jsx(Ee,{children:"Détails de la demande"}),e.jsx(Me,{children:"Consultez et gérez les informations détaillées de la demande"})]}),U&&e.jsx(us,{request:U,onClose:ve})]})}),e.jsx(Oe,{open:oe,onOpenChange:V,children:e.jsxs(Ke,{children:[e.jsxs(Ye,{children:[e.jsx(Ze,{children:"Confirmer la suppression"}),e.jsxs(We,{children:["Êtes-vous sûr de vouloir supprimer la demande ",p==null?void 0:p.referenceNumber," de ",p==null?void 0:p.name," ?",e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{className:"text-red-600 font-medium",children:"Cette action est irréversible."})]})]}),e.jsxs(Xe,{children:[e.jsx(Je,{onClick:()=>I(null),children:"Annuler"}),e.jsx(qe,{onClick:ge,className:"bg-red-600 hover:bg-red-700 text-white",children:"Supprimer"})]})]})})]})}export{Zs as default};
